!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/javascript-gpgpu-demo/",r(r.s=166)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},function(e,t){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(t)}e.exports=r},function(e,t,r){var n=r(69),i=r(70);e.exports=function(e,t){return!t||"object"!==n(t)&&"function"!==typeof t?i(e):t}},function(e,t,r){var n=r(72);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},function(e,t,r){var n=r(10),i=r(32),s=r(12).Input,a=r(13).Texture,o=/function ([^(]*)/,u=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,c=/([^\s,]+)/g,l={systemEndianness:function(){return h},getSystemEndianness:function(){var e=new ArrayBuffer(4),t=new Uint32Array(e),r=new Uint8Array(e);if(t[0]=3735928559,239===r[0])return"LE";if(222===r[0])return"BE";throw new Error("unknown endianness")},isFunction:function(e){return"function"===typeof e},isFunctionString:function(e){return"string"===typeof e&&"function"===e.slice(0,"function".length).toLowerCase()},getFunctionNameFromString:function(e){return o.exec(e)[1].trim()},getFunctionBodyFromString:function(e){return e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))},getArgumentNamesFromString:function(e){var t=e.replace(u,""),r=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(c);return null===r&&(r=[]),r},clone:function(e){if(null===e||"object"!==typeof e||e.hasOwnProperty("isActiveClone"))return e;var t=e.constructor();for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e.isActiveClone=null,t[r]=l.clone(e[r]),delete e.isActiveClone);return t},isArray:function(e){return!isNaN(e.length)},getVariableType:function(e,t){if(l.isArray(e))return"IMG"===e[0].nodeName?"HTMLImageArray":"Array";switch(e.constructor){case Boolean:return"Boolean";case Number:return t&&Number.isInteger(e)?"Integer":"Float";case a:return e.type;case s:return"Input"}return"IMG"===e.nodeName?"HTMLImage":e.hasOwnProperty("type")?e.type:"Unknown"},getKernelTextureSize:function(e,t){var r=n(t,3),i=r[0],s=r[1],a=(i||1)*(s||1)*(r[2]||1);return e.optimizeFloatMemory&&"single"===e.precision&&(i=a=Math.ceil(a/4)),s>1&&i*s===a?new Int32Array([i,s]):l.closestSquareDimensions(a)},closestSquareDimensions:function(e){for(var t=Math.sqrt(e),r=Math.ceil(t),n=Math.floor(t);r*n<e;)r--,n=Math.ceil(e/r);return new Int32Array([n,Math.ceil(e/n)])},getMemoryOptimizedFloatTextureSize:function(e,t){var r=l.roundTo((e[0]||1)*(e[1]||1)*(e[2]||1)*(e[3]||1),4)/t;return l.closestSquareDimensions(r)},getMemoryOptimizedPackedTextureSize:function(e,t){var r=n(e,3),i=r[0],s=r[1],a=r[2],o=l.roundTo((i||1)*(s||1)*(a||1),4)/(4/t);return l.closestSquareDimensions(o)},roundTo:function(e,t){return Math.floor((e+t-1)/t)*t},getDimensions:function(e,t){var r;if(l.isArray(e)){for(var n=[],i=e;l.isArray(i);)n.push(i.length),i=i[0];r=n.reverse()}else if(e instanceof a)r=e.output;else{if(!(e instanceof s))throw new Error("Unknown dimensions of ".concat(e));r=e.size}if(t)for(r=Array.from(r);r.length<3;)r.push(1);return new Int32Array(r)},flatten2dArrayTo:function(e,t){for(var r=0,n=0;n<e.length;n++)t.set(e[n],r),r+=e[n].length},flatten3dArrayTo:function(e,t){for(var r=0,n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)t.set(e[n][i],r),r+=e[n][i].length},flatten4dArrayTo:function(e,t){for(var r=0,n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)for(var s=0;s<e[n][i].length;s++)t.set(e[n][i][s],r),r+=e[n][i][s].length},flattenTo:function(e,t){l.isArray(e[0])?l.isArray(e[0][0])?l.isArray(e[0][0][0])?l.flatten4dArrayTo(e,t):l.flatten3dArrayTo(e,t):l.flatten2dArrayTo(e,t):t.set(e)},splitArray:function(e,t){for(var r=[],n=0;n<e.length;n+=t)r.push(new e.constructor(e.buffer,4*n+e.byteOffset,t));return r},getAstString:function(e,t){var r=Array.isArray(e)?e:e.split(/\r?\n/g),n=t.loc.start,i=t.loc.end,s=[];if(n.line===i.line)s.push(r[n.line-1].substring(n.column,i.column));else{s.push(r[n.line-1].slice(n.column));for(var a=n.line;a<i.line;a++)s.push(r[a]);s.push(r[i.line-1].slice(0,i.column))}return s.join("\n")},allPropertiesOf:function(e){var t=[];do{t.push.apply(t,Object.getOwnPropertyNames(e))}while(e=Object.getPrototypeOf(e));return t},linesToString:function(e){return e.length>0?e.join(";\n")+";\n":"\n"},warnDeprecated:function(e,t,r){r?console.warn("You are using a deprecated ".concat(e,' "').concat(t,'". It has been replaced with "').concat(r,'". Fixing, but please upgrade as it will soon be removed.')):console.warn("You are using a deprecated ".concat(e,' "').concat(t,'". It has been removed. Fixing, but please upgrade as it will soon be removed.'))},functionToIFunction:function(e,t){if(t=t||{},"string"!==typeof e&&"function"!==typeof e)throw new Error("source not a string or function");var r="string"===typeof e?e:e.toString();return{source:r,argumentTypes:Array.isArray(t.argumentTypes)?t.argumentTypes:"object"===typeof t.argumentTypes?l.getArgumentNamesFromString(r).map((function(e){return t.argumentTypes[e]}))||[]:t.argumentTypes||[],returnType:t.returnType||null}},flipPixels:function(e,t,r){for(var n=r/2|0,i=4*t,s=new Uint8ClampedArray(4*t),a=e.slice(0),o=0;o<n;++o){var u=o*i,c=(r-o-1)*i;s.set(a.subarray(u,u+i)),a.copyWithin(u,c,c+i),a.set(s,c)}return a},erectPackedFloat:function(e,t){return e.subarray(0,t)},erect2DPackedFloat:function(e,t,r){for(var n=new Array(r),i=0;i<r;i++){var s=i*t,a=s+t;n[i]=e.subarray(s,a)}return n},erect3DPackedFloat:function(e,t,r,n){for(var i=new Array(n),s=0;s<n;s++){for(var a=new Array(r),o=0;o<r;o++){var u=s*r*t+o*t,c=u+t;a[o]=e.subarray(u,c)}i[s]=a}return i},erectMemoryOptimizedFloat:function(e,t){return e.subarray(0,t)},erectMemoryOptimized2DFloat:function(e,t,r){for(var n=new Array(r),i=0;i<r;i++){var s=i*t;n[i]=e.subarray(s,s+t)}return n},erectMemoryOptimized3DFloat:function(e,t,r,n){for(var i=new Array(n),s=0;s<n;s++){for(var a=new Array(r),o=0;o<r;o++){var u=s*r*t+o*t;a[o]=e.subarray(u,u+t)}i[s]=a}return i},erectFloat:function(e,t){for(var r=new Float32Array(t),n=0,i=0;i<t;i++)r[i]=e[n],n+=4;return r},erect2DFloat:function(e,t,r){for(var n=new Array(r),i=0,s=0;s<r;s++){for(var a=new Float32Array(t),o=0;o<t;o++)a[o]=e[i],i+=4;n[s]=a}return n},erect3DFloat:function(e,t,r,n){for(var i=new Array(n),s=0,a=0;a<n;a++){for(var o=new Array(r),u=0;u<r;u++){for(var c=new Float32Array(t),l=0;l<t;l++)c[l]=e[s],s+=4;o[u]=c}i[a]=o}return i},erectArray2:function(e,t){for(var r=new Array(t),n=4*t,i=0,s=0;s<n;s+=4)r[i++]=e.subarray(s,s+2);return r},erect2DArray2:function(e,t,r){for(var n=new Array(r),i=4*t,s=0;s<r;s++){for(var a=new Array(t),o=s*i,u=0,c=0;c<i;c+=4)a[u++]=e.subarray(c+o,c+o+2);n[s]=a}return n},erect3DArray2:function(e,t,r,n){for(var i=4*t,s=new Array(n),a=0;a<n;a++){for(var o=new Array(r),u=0;u<r;u++){for(var c=new Array(t),l=a*i*r+u*i,h=0,p=0;p<i;p+=4)c[h++]=e.subarray(p+l,p+l+2);o[u]=c}s[a]=o}return s},erectArray3:function(e,t){for(var r=new Array(t),n=4*t,i=0,s=0;s<n;s+=4)r[i++]=e.subarray(s,s+3);return r},erect2DArray3:function(e,t,r){for(var n=4*t,i=new Array(r),s=0;s<r;s++){for(var a=new Array(t),o=s*n,u=0,c=0;c<n;c+=4)a[u++]=e.subarray(c+o,c+o+3);i[s]=a}return i},erect3DArray3:function(e,t,r,n){for(var i=4*t,s=new Array(n),a=0;a<n;a++){for(var o=new Array(r),u=0;u<r;u++){for(var c=new Array(t),l=a*i*r+u*i,h=0,p=0;p<i;p+=4)c[h++]=e.subarray(p+l,p+l+3);o[u]=c}s[a]=o}return s},erectArray4:function(e,t){for(var r=new Array(e),n=4*t,i=0,s=0;s<n;s+=4)r[i++]=e.subarray(s,s+4);return r},erect2DArray4:function(e,t,r){for(var n=4*t,i=new Array(r),s=0;s<r;s++){for(var a=new Array(t),o=s*n,u=0,c=0;c<n;c+=4)a[u++]=e.subarray(c+o,c+o+4);i[s]=a}return i},erect3DArray4:function(e,t,r,n){for(var i=4*t,s=new Array(n),a=0;a<n;a++){for(var o=new Array(r),u=0;u<r;u++){for(var c=new Array(t),l=a*i*r+u*i,h=0,p=0;p<i;p+=4)c[h++]=e.subarray(p+l,p+l+4);o[u]=c}s[a]=o}return s},flattenFunctionToString:function(e,t){var r=t.findDependency,n=t.thisLookup,s=t.doNotDefine,a=t.flattened;a||(a=t.flattened={});var o=i.parse(e),u=[];var c=function e(t){if(Array.isArray(t)){for(var i=[],a=0;a<t.length;a++)i.push(e(t[a]));return i.join("")}switch(t.type){case"Program":return e(t.body);case"FunctionDeclaration":return"function ".concat(t.id.name,"(").concat(t.params.map(e).join(", "),") ").concat(e(t.body));case"BlockStatement":for(var o=[],c=0;c<t.body.length;c++)o.push(e(t.body[c]),";\n");return"{\n".concat(o.join(""),"}");case"VariableDeclaration":switch(t.declarations[0].id.type){case"ObjectPattern":var l=e(t.declarations[0].init),h=t.declarations.map((function(t){return t.id.properties.map(e)}))[0];if(/this/.test(l)){for(var p=[],f=h.map(n),d=0;d<f.length;d++){var m=f[d];if(null!==m){var g=h[d];p.push("".concat(t.kind," ").concat(g," = ").concat(m,";\n"))}}return p.join("")}return"".concat(t.kind," { ").concat(h," } = ").concat(l);case"ArrayPattern":return"".concat(t.kind," [ ").concat(t.declarations.map((function(t){return e(t.id)})).join(", ")," ] = ").concat(e(t.declarations[0].init))}return s&&-1!==s.indexOf(t.declarations[0].id.name)?"":"".concat(t.kind," ").concat(t.declarations[0].id.name," = ").concat(e(t.declarations[0].init));case"CallExpression":if("subarray"===t.callee.property.name)return"".concat(e(t.callee.object),".").concat(e(t.callee.property),"(").concat(t.arguments.map((function(t){return e(t)})).join(", "),")");if("gl"===t.callee.object.name||"context"===t.callee.object.name)return"".concat(e(t.callee.object),".").concat(e(t.callee.property),"(").concat(t.arguments.map((function(t){return e(t)})).join(", "),")");if("ThisExpression"===t.callee.object.type)return u.push(r("this",t.callee.property.name)),"".concat(t.callee.property.name,"(").concat(t.arguments.map((function(t){return e(t)})).join(", "),")");if(t.callee.object.name){var y=r(t.callee.object.name,t.callee.property.name);return null===y?"".concat(t.callee.object.name,".").concat(t.callee.property.name,"(").concat(t.arguments.map((function(t){return e(t)})).join(", "),")"):(u.push(y),"".concat(t.callee.property.name,"(").concat(t.arguments.map((function(t){return e(t)})).join(", "),")"))}if("MemberExpression"===t.callee.object.type)return"".concat(e(t.callee.object),".").concat(t.callee.property.name,"(").concat(t.arguments.map((function(t){return e(t)})).join(", "),")");throw new Error("unknown ast.callee");case"ReturnStatement":return"return ".concat(e(t.argument));case"BinaryExpression":return"(".concat(e(t.left)).concat(t.operator).concat(e(t.right),")");case"UnaryExpression":return t.prefix?"".concat(t.operator," ").concat(e(t.argument)):"".concat(e(t.argument)," ").concat(t.operator);case"ExpressionStatement":return"(".concat(e(t.expression),")");case"ArrowFunctionExpression":return"(".concat(t.params.map(e).join(", "),") => ").concat(e(t.body));case"Literal":return t.raw;case"Identifier":return t.name;case"MemberExpression":return"ThisExpression"===t.object.type?n(t.property.name):t.computed?"".concat(e(t.object),"[").concat(e(t.property),"]"):e(t.object)+"."+e(t.property);case"ThisExpression":return"this";case"NewExpression":return"new ".concat(e(t.callee),"(").concat(t.arguments.map((function(t){return e(t)})).join(", "),")");case"ForStatement":return"for (".concat(e(t.init),";").concat(e(t.test),";").concat(e(t.update),") ").concat(e(t.body));case"AssignmentExpression":return"".concat(e(t.left)).concat(t.operator).concat(e(t.right));case"UpdateExpression":return"".concat(e(t.argument)).concat(t.operator);case"IfStatement":return"if (".concat(e(t.test),") ").concat(e(t.consequent));case"ThrowStatement":return"throw ".concat(e(t.argument));case"ObjectPattern":return t.properties.map(e).join(", ");case"ArrayPattern":return t.elements.map(e).join(", ");case"DebuggerStatement":return"debugger;";case"ConditionalExpression":return"".concat(e(t.test),"?").concat(e(t.consequent),":").concat(e(t.alternate));case"Property":if("init"===t.kind)return e(t.key)}throw new Error("unhandled ast.type of ".concat(t.type))}(o);if(u.length>0){for(var h=[],p=0;p<u.length;p++){var f=u[p];a[f]||(a[f]=!0),h.push(l.flattenFunctionToString(f,t)+";\n")}return h.join("")+c}return c},splitHTMLImageToRGB:function(e,t){var r=new GPU({mode:t}),n=r.createKernel((function(e){return 255*e[this.thread.y][this.thread.x].r}),{output:[e.width,e.height],precision:"unsigned",argumentTypes:["HTMLImage"]}),i=r.createKernel((function(e){return 255*e[this.thread.y][this.thread.x].g}),{output:[e.width,e.height],precision:"unsigned",argumentTypes:["HTMLImage"]}),s=r.createKernel((function(e){return 255*e[this.thread.y][this.thread.x].b}),{output:[e.width,e.height],precision:"unsigned",argumentTypes:["HTMLImage"]}),a=r.createKernel((function(e){return 255*e[this.thread.y][this.thread.x].a}),{output:[e.width,e.height],precision:"unsigned",argumentTypes:["HTMLImage"]}),o=[n(e),i(e),s(e),a(e)];return o.rKernel=n,o.gKernel=i,o.bKernel=s,o.aKernel=a,o.gpu=r,o},splitRGBAToCanvases:function(e,t,n,i){var s=r(31).GPU,a=new s({mode:i}),o=a.createKernel((function(e){var t=e[this.thread.y][this.thread.x];this.color(t.r/255,0,0,255)}),{output:[t,n],graphical:!0,argumentTypes:{v:"Array2D(4)"}});o(e);var u=new s({mode:i}),c=u.createKernel((function(e){var t=e[this.thread.y][this.thread.x];this.color(0,t.g/255,0,255)}),{output:[t,n],graphical:!0,argumentTypes:{v:"Array2D(4)"}});c(e);var l=new s({mode:i}),h=l.createKernel((function(e){var t=e[this.thread.y][this.thread.x];this.color(0,0,t.b/255,255)}),{output:[t,n],graphical:!0,argumentTypes:{v:"Array2D(4)"}});h(e);var p=new s({mode:i}),f=p.createKernel((function(e){var t=e[this.thread.y][this.thread.x];this.color(255,255,255,t.a/255)}),{output:[t,n],graphical:!0,argumentTypes:{v:"Array2D(4)"}});return f(e),a.destroy(),u.destroy(),l.destroy(),p.destroy(),[o.canvas,c.canvas,h.canvas,f.canvas]}},h=l.getSystemEndianness();e.exports={utils:l}},function(e,t,r){var n=r(71);function i(t,r,s){return"undefined"!==typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,r){var i=n(e,t);if(i){var s=Object.getOwnPropertyDescriptor(i,t);return s.get?s.get.call(r):s.value}},i(t,r,s||t)}e.exports=i},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=r(12).Input,l=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).dimensionsId=null,i.sizeId=null,i.initialValueConstructor=e.constructor,i.onRequestTexture=r.onRequestTexture,i.onRequestIndex=r.onRequestIndex,i.uploadValue=null,i.textureSize=null,i.bitRatio=null,i}return o(t,e),i(t,[{key:"requestTexture",value:function(){this.texture=this.onRequestTexture(),this.setupTexture()}},{key:"setupTexture",value:function(){this.contextHandle=this.onRequestContextHandle(),this.index=this.onRequestIndex(),this.dimensionsId=this.id+"Dim",this.sizeId=this.id+"Size"}},{key:"getTransferArrayType",value:function(e){if(Array.isArray(e[0]))return this.getTransferArrayType(e[0]);switch(e.constructor){case Array:case Int32Array:case Int16Array:case Int8Array:return Float32Array;case Uint8ClampedArray:case Uint8Array:case Uint16Array:case Uint32Array:case Float32Array:case Float64Array:return e.constructor}return console.warn("Unfamiliar constructor type.  Will go ahead and use, but likley this may result in a transfer of zeros"),e.constructor}},{key:"formatArrayTransfer",value:function(e,t,r){if(u.isArray(e[0])||this.optimizeFloatMemory){var n=new Float32Array(t);return u.flattenTo(e,n),n}switch(e.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:case Uint16Array:case Int16Array:case Float32Array:case Int32Array:var i=new(r||e.constructor)(t);return u.flattenTo(e,i),i;default:var s=new Float32Array(t);return u.flattenTo(e,s),s}}},{key:"getBitRatio",value:function(e){if(Array.isArray(e[0]))return this.getBitRatio(e[0]);if(e.constructor===c)return this.getBitRatio(e.value);switch(e.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}},{key:"getStringValueHandler",value:function(){throw new Error('"getStringValueHandler" not implemented on '.concat(this.constructor.name))}},{key:"getVariablePrecisionString",value:function(){switch(this.tactic){case"speed":return"lowp";case"performance":return"highp";case"balanced":default:return"mediump"}}}]),t}(r(133).KernelValue);e.exports={WebGLKernelValue:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(1)",r}return o(t,e),i(t,[{key:"renderRawOutput",value:function(){var e=this.context,t=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);var r=new Float32Array(this.size[0]*this.size[1]*4);return e.readPixels(0,0,this.size[0],this.size[1],e.RGBA,e.FLOAT,r),r}},{key:"renderValues",value:function(){return this.renderRawOutput()}},{key:"toArray",value:function(){return u.erectFloat(this.renderValues(),this.output[0])}}]),t}(r(13).Texture);e.exports={GLTextureFloat:c}},function(e,t,r){(function(t){var n=r(86)("webgl"),i=n.WebGLRenderingContext;t.on("exit",n.cleanup);var s=i.prototype;delete s["1.0.0"],delete i["1.0.0"],e.exports={gl:s,NativeWebGL:n,NativeWebGLRenderingContext:i}}).call(this,r(19))},function(e,t,r){var n=r(66),i=r(67),s=r(68);e.exports=function(e,t){return n(e)||i(e,t)||s()}},function(e,t,r){var n=r(0),i=r(1),s=function(){"use strict";function e(t){n(this,e),this._=t,this._references=[],this._refCount=0,this._pendingDelete=!1,this._binding=0}return i(e,[{key:"_link",value:function(e){return this._references.push(e),e._refCount+=1,!0}},{key:"_unlink",value:function(e){var t=this._references.indexOf(e);if(t<0)return!1;for(;t>=0;)this._references[t]=this._references[this._references.length-1],this._references.pop(),e._refCount-=1,e._checkDelete(),t=this._references.indexOf(e);return!0}},{key:"_linked",value:function(e){return this._references.indexOf(e)>=0}},{key:"_checkDelete",value:function(){if(this._refCount<=0&&this._pendingDelete&&0!==this._){for(;this._references.length>0;)this._unlink(this._references[0]);this._performDelete(),this._=0}}},{key:"_performDelete",value:function(){}}]),e}();e.exports={Linkable:s}},function(e,t,r){var n=r(10),i=r(0),s=r(1),a=function(){"use strict";function e(t,r){i(this,e),this.value=t,Array.isArray(r)?this.size=r:(this.size=new Int32Array(3),r.z?this.size=new Int32Array([r.x,r.y,r.z]):r.y?this.size=new Int32Array([r.x,r.y]):this.size=new Int32Array([r.x]));var s=n(this.size,3),a=s[0],o=s[1],u=s[2];if(u){if(this.value.length!==a*o*u)throw new Error("Input size ".concat(this.value.length," does not match ").concat(a," * ").concat(o," * ").concat(u," = ").concat(o*a*u))}else if(o){if(this.value.length!==a*o)throw new Error("Input size ".concat(this.value.length," does not match ").concat(a," * ").concat(o," = ").concat(o*a))}else if(this.value.length!==a)throw new Error("Input size ".concat(this.value.length," does not match ").concat(a))}return s(e,[{key:"toArray",value:function(){var e=r(5).utils,t=n(this.size,3),i=t[0],s=t[1],a=t[2];return a?e.erectMemoryOptimized3DFloat(this.value.subarray?this.value:new Float32Array(this.value),i,s,a):s?e.erectMemoryOptimized2DFloat(this.value.subarray?this.value:new Float32Array(this.value),i,s):this.value}}]),e}();e.exports={Input:a,input:function(e,t){return new a(e,t)}}},function(e,t,r){var n=r(0),i=r(1),s=function(){"use strict";function e(t){n(this,e);var r=t.texture,i=t.size,s=t.dimensions,a=t.output,o=t.context,u=t.type,c=void 0===u?"NumberTexture":u;if(!a)throw new Error('settings property "output" required.');if(!o)throw new Error('settings property "context" required.');this.texture=r,this.size=i,this.dimensions=s,this.output=a,this.context=o,this.kernel=null,this.type=c}return i(e,[{key:"toArray",value:function(){throw new Error("Not implemented on ".concat(this.constructor.name))}},{key:"delete",value:function(){return this.context.deleteTexture(this.texture)}}]),e}();e.exports={Texture:s}},function(e,t,r){var n=r(34),i=r(0),s=r(1),a=function(){"use strict";function e(t){if(i(this,e),t=t||{},this.kernel=t.kernel,this.rootNode=t.rootNode,this.functionNodes=t.functionNodes||[],this.subKernelNodes=t.subKernelNodes||[],this.nativeFunctions=t.nativeFunctions||[],this.functionMap={},this.nativeFunctionNames=[],this.lookupChain=[],this.argumentChain=[],this.functionNodeDependencies={},this.functionCalls={},this.rootNode&&(this.functionMap.kernel=this.rootNode),this.functionNodes)for(var r=0;r<this.functionNodes.length;r++)this.functionMap[this.functionNodes[r].name]=this.functionNodes[r];if(this.subKernelNodes)for(var n=0;n<this.subKernelNodes.length;n++)this.functionMap[this.subKernelNodes[n].name]=this.subKernelNodes[n];if(this.nativeFunctions)for(var s=0;s<this.nativeFunctions.length;s++){var a=this.nativeFunctions[s];this.nativeFunctionNames.push(a.name)}}return s(e,null,[{key:"fromKernel",value:function(t,r,n){for(var i=t.kernelArguments,s=t.kernelConstants,a=t.argumentNames,o=t.argumentSizes,u=t.argumentBitRatios,c=t.constants,l=t.constantBitRatios,h=t.debug,p=t.loopMaxIterations,f=t.nativeFunctions,d=t.output,m=t.optimizeFloatMemory,g=t.precision,y=t.plugins,_=t.source,x=t.subKernels,v=t.functions,T=t.leadingReturnStatement,E=t.followingReturnStatement,A=t.dynamicArguments,b=t.dynamicOutput,S=t.warnVarUsage,I=new Array(i.length),k={},R=0;R<i.length;R++)I[R]=i[R].type;for(var L=0;L<s.length;L++){var w=s[L];k[w.name]=w.type}var D=function(e,t){return H.needsArgumentType(e,t)},N=function(e,t,r){H.assignArgumentType(e,t,r)},C=function(e,t,r){return H.lookupReturnType(e,t,r)},F=function(e){return H.lookupFunctionArgumentTypes(e)},O=function(e,t){return H.lookupFunctionArgumentName(e,t)},P=function(e,t){return H.lookupFunctionArgumentBitRatio(e,t)},M=function(e,t,r,n){H.assignArgumentType(e,t,r,n)},U=function(e,t,r,n){H.trackArgumentSynonym(e,t,r,n)},V=function(e,t,r){return H.lookupArgumentSynonym(e,t,r)},B=function(e,t,r){H.trackFunctionCall(e,t,r)},G=Object.assign({isRootKernel:!1,onNestedFunction:function(e,t){for(var n=[],i=0;i<e.params.length;i++)n.push(e.params[i].name);var s=new r(null,Object.assign({},G,{returnType:null,ast:e,name:e.id.name,argumentNames:n,lookupReturnType:C,lookupFunctionArgumentTypes:F,lookupFunctionArgumentName:O,lookupFunctionArgumentBitRatio:P,needsArgumentType:D,assignArgumentType:N,triggerImplyArgumentType:M,triggerTrackArgumentSynonym:U,lookupArgumentSynonym:V,onFunctionCall:B,warnVarUsage:S}));s.traceFunctionAST(e),H.addFunctionNode(s)},lookupReturnType:C,lookupFunctionArgumentTypes:F,lookupFunctionArgumentName:O,lookupFunctionArgumentBitRatio:P,needsArgumentType:D,assignArgumentType:N,triggerImplyArgumentType:M,triggerTrackArgumentSynonym:U,lookupArgumentSynonym:V,onFunctionCall:B,optimizeFloatMemory:m,precision:g,constants:c,constantTypes:k,constantBitRatios:l,debug:h,loopMaxIterations:p,output:d,plugins:y,dynamicArguments:A,dynamicOutput:b},n||{}),z=Object.assign({},G,{isRootKernel:!0,name:"kernel",argumentNames:a,argumentTypes:I,argumentSizes:o,argumentBitRatios:u,leadingReturnStatement:T,followingReturnStatement:E});if("object"===typeof _&&_.functionNodes)return(new e).fromJSON(_.functionNodes,r);var K=new r(_,z),W=null;v&&(W=v.map((function(e){return new r(e.source,{returnType:e.returnType,argumentTypes:e.argumentTypes,output:d,plugins:y,constants:c,constantTypes:k,constantBitRatios:l,optimizeFloatMemory:m,precision:g,lookupReturnType:C,lookupFunctionArgumentTypes:F,lookupFunctionArgumentName:O,lookupFunctionArgumentBitRatio:P,needsArgumentType:D,assignArgumentType:N,triggerImplyArgumentType:M,triggerTrackArgumentSynonym:U,lookupArgumentSynonym:V,onFunctionCall:B})})));var X=null;x&&(X=x.map((function(e){var t=e.name,n=e.source;return new r(n,Object.assign({},G,{name:t,isSubKernel:!0,isRootKernel:!1}))})));var H=new e({kernel:t,rootNode:K,functionNodes:W,nativeFunctions:f,subKernelNodes:X});return H}}]),s(e,[{key:"addFunctionNode",value:function(e){if(!e.name)throw new Error("functionNode.name needs set");this.functionMap[e.name]=e,e.isRootKernel&&(this.rootNode=e)}},{key:"traceFunctionCalls",value:function(e,t){if(e=e||"kernel",t=t||[],this.nativeFunctionNames.indexOf(e)>-1)return-1===t.indexOf(e)&&t.push(e),t;var r=this.functionMap[e];if(r){var n=t.indexOf(e);if(-1===n){t.push(e),r.toString();for(var i=0;i<r.calledFunctions.length;++i)this.traceFunctionCalls(r.calledFunctions[i],t)}else{var s=t.splice(n,1)[0];t.push(s)}}return t}},{key:"getPrototypeString",value:function(e){return this.getPrototypes(e).join("\n")}},{key:"getPrototypes",value:function(e){return this.rootNode&&this.rootNode.toString(),e?this.getPrototypesFromFunctionNames(this.traceFunctionCalls(e,[]).reverse()):this.getPrototypesFromFunctionNames(Object.keys(this.functionMap))}},{key:"getStringFromFunctionNames",value:function(e){for(var t=[],r=0;r<e.length;++r){this.functionMap[e[r]]&&t.push(this.functionMap[e[r]].toString())}return t.join("\n")}},{key:"getPrototypesFromFunctionNames",value:function(e){for(var t=[],r=0;r<e.length;++r){var n=e[r],i=this.nativeFunctionNames.indexOf(n);if(i>-1)t.push(this.nativeFunctions[i].source);else{var s=this.functionMap[n];s&&t.push(s.toString())}}return t}},{key:"toJSON",value:function(){var e=this;return this.traceFunctionCalls(this.rootNode.name).reverse().map((function(t){var r=e.nativeFunctions.indexOf(t);if(r>-1)return{name:t,source:e.nativeFunctions[r].source};if(e.functionMap[t])return e.functionMap[t].toJSON();throw new Error("function ".concat(t," not found"))}))}},{key:"fromJSON",value:function(e,t){this.functionMap={};for(var r=0;r<e.length;r++){var n=e[r];this.functionMap[n.settings.name]=new t(n.ast,n.settings)}return this}},{key:"getString",value:function(e){return e?this.getStringFromFunctionNames(this.traceFunctionCalls(e).reverse()):this.getStringFromFunctionNames(Object.keys(this.functionMap))}},{key:"lookupReturnType",value:function(e,t,r){if("CallExpression"!==t.type)throw new Error('expected ast type of "CallExpression", but is '.concat(t.type));if(this._isNativeFunction(e))return this._lookupNativeFunctionReturnType(e);if(this._isFunction(e)){var n=this._getFunction(e);if(n.returnType)return n.returnType;for(var i=0;i<this.lookupChain.length;i++)if(this.lookupChain[i].ast===t){if(0===n.argumentTypes.length&&t.arguments.length>0){for(var s=t.arguments,a=0;a<s.length;a++)this.lookupChain.push({name:r.name,ast:s[i],requestingNode:r}),n.argumentTypes[a]=r.getType(s[a]),this.lookupChain.pop();return n.returnType=n.getType(n.getJsAST())}throw new Error("circlical logic detected!")}this.lookupChain.push({name:r.name,ast:t,requestingNode:r});var o=n.getType(n.getJsAST());return this.lookupChain.pop(),n.returnType=o}return null}},{key:"_getFunction",value:function(e){return this._isFunction(e)||new Error("Function ".concat(e," not found")),this.functionMap[e]}},{key:"_isFunction",value:function(e){return Boolean(this.functionMap[e])}},{key:"_getNativeFunction",value:function(e){for(var t=0;t<this.nativeFunctions.length;t++)if(this.nativeFunctions[t].name===e)return this.nativeFunctions[t];return null}},{key:"_isNativeFunction",value:function(e){return Boolean(this._getNativeFunction(e))}},{key:"_lookupNativeFunctionReturnType",value:function(e){var t=this._getNativeFunction(e);if(t)return t.returnType;throw new Error("Native function ".concat(e," not found"))}},{key:"lookupFunctionArgumentTypes",value:function(e){return this._isNativeFunction(e)?this._getNativeFunction(e).argumentTypes:this._isFunction(e)?this._getFunction(e).argumentTypes:null}},{key:"lookupFunctionArgumentName",value:function(e,t){return this._getFunction(e).argumentNames[t]}},{key:"lookupFunctionArgumentBitRatio",value:function(e,t){if(!this._isFunction(e))throw new Error("function not found");if(this.rootNode.name===e){var r=this.rootNode.argumentNames.indexOf(t);if(-1!==r)return this.rootNode.argumentBitRatios[r];throw new Error("argument bit ratio not found")}var n=this._getFunction(e),i=n.argumentSynonym[n.synonymIndex];if(!i)throw new Error("argument synonym not found");return this.lookupFunctionArgumentBitRatio(i.functionName,i.argumentName)}},{key:"needsArgumentType",value:function(e,t){return!!this._isFunction(e)&&!this._getFunction(e).argumentTypes[t]}},{key:"assignArgumentType",value:function(e,t,r,n){if(this._isFunction(e)){var i=this._getFunction(e);i.argumentTypes[t]||(i.argumentTypes[t]=r)}}},{key:"trackArgumentSynonym",value:function(e,t,r,n){if(this._isFunction(r)){var i=this._getFunction(r);i.argumentSynonym||(i.argumentSynonym={});var s=i.argumentNames[n];i.argumentSynonym[s]||(i.argumentSynonym[s]={}),i.synonymIndex++,i.argumentSynonym[i.synonymIndex]={functionName:e,argumentName:t,calleeArgumentName:s,calleeFunctionName:r}}}},{key:"lookupArgumentSynonym",value:function(e,t,r){if(e===t)return r;if(!this._isFunction(t))return null;var n=this._getFunction(t),i=n.argumentSynonym[n.synonymUseIndex];return i?i.calleeArgumentName!==r?null:(n.synonymUseIndex++,e!==t?this.lookupArgumentSynonym(e,i.functionName,i.argumentName):i.argumentName):null}},{key:"trackFunctionCall",value:function(e,t,r){this.functionNodeDependencies[e]||(this.functionNodeDependencies[e]=new Set,this.functionCalls[e]=[]),this.functionNodeDependencies[e].add(t),this.functionCalls[e].push(r)}},{key:"getKernelResultType",value:function(){return this.rootNode.returnType||this.rootNode.getType(this.rootNode.ast)}},{key:"getSubKernelResultType",value:function(e){for(var t=this.subKernelNodes[e],r=!1,n=0;n<this.rootNode.functionCalls.length;n++){this.rootNode.functionCalls[n].ast.callee.name===t.name&&(r=!0)}if(!r)throw new Error("SubKernel ".concat(t.name," never called by kernel"));return t.returnType||t.getType(t.getJsAST())}},{key:"getReturnTypes",value:function(){for(var e=n({},this.rootNode.name,this.rootNode.getType(this.rootNode.ast)),t=this.traceFunctionCalls(this.rootNode.name),r=0;r<t.length;r++){var i=t[r],s=this.functionMap[i];e[i]=s.getType(s.ast)}return e}}]),e}();e.exports={FunctionBuilder:a}},function(e,t,r){var n=r(0),i=r(3),s=r(2),a=r(6),o=r(1),u=r(4),c=r(43).GLKernel,l=r(14).FunctionBuilder,h=r(20).WebGLFunctionNode,p=r(5).utils,f=r(128),d=r(129).fragmentShader,m=r(130).vertexShader,g=r(44).glKernelString,y=r(132).lookupKernelValueType,_=null,x=null,v=null,T=null,E=null,A=[f],b=[],S={},I=function(e){"use strict";function t(e,r){var a;return n(this,t),(a=i(this,s(t).call(this,e,r))).program=null,a.pipeline=r.pipeline,a.endianness=p.systemEndianness(),a.extensions={},a.subKernelOutputTextures=null,a.kernelArguments=null,a.argumentTextureCount=0,a.constantTextureCount=0,a.compiledFragmentShader=null,a.compiledVertexShader=null,a.fragShader=null,a.vertShader=null,a.drawBuffersMap=null,a.outputTexture=null,a.maxTexSize=null,a.switchingKernels=!1,a.onRequestSwitchKernel=null,a.mergeSettings(e.settings||r),a.threadDim=null,a.framebuffer=null,a.buffer=null,a.textureCache={},a.programUniformLocationCache={},a.uniform1fCache={},a.uniform1iCache={},a.uniform2fCache={},a.uniform2fvCache={},a.uniform2ivCache={},a.uniform3fvCache={},a.uniform3ivCache={},a.uniform4fvCache={},a.uniform4ivCache={},a}return u(t,e),o(t,null,[{key:"setupFeatureChecks",value:function(){"undefined"!==typeof document?x=document.createElement("canvas"):"undefined"!==typeof OffscreenCanvas&&(x=new OffscreenCanvas(0,0)),x&&(v=x.getContext("webgl")||x.getContext("experimental-webgl"))&&v.getExtension&&(T={OES_texture_float:v.getExtension("OES_texture_float"),OES_texture_float_linear:v.getExtension("OES_texture_float_linear"),OES_element_index_uint:v.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:v.getExtension("WEBGL_draw_buffers")},E=this.getFeatures())}},{key:"isContextMatch",value:function(e){return"undefined"!==typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext}},{key:"getFeatures",value:function(){var e=this.getIsDrawBuffers();return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isTextureFloat:this.getIsTextureFloat(),isDrawBuffers:e,kernelMap:e,channelCount:this.getChannelCount()})}},{key:"getIsTextureFloat",value:function(){return Boolean(T.OES_texture_float)}},{key:"getIsDrawBuffers",value:function(){return Boolean(T.WEBGL_draw_buffers)}},{key:"getChannelCount",value:function(){return T.WEBGL_draw_buffers?v.getParameter(T.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}},{key:"lookupKernelValueType",value:function(e,t,r,n){return y(e,t,r,n)}},{key:"isSupported",get:function(){return null!==_?_:(this.setupFeatureChecks(),_=this.isContextMatch(v))}},{key:"testCanvas",get:function(){return x}},{key:"testContext",get:function(){return v}},{key:"features",get:function(){return E}},{key:"fragmentShader",get:function(){return d}},{key:"vertexShader",get:function(){return m}}]),o(t,[{key:"initCanvas",value:function(){if("undefined"!==typeof document){var e=document.createElement("canvas");return e.width=2,e.height=2,e}if("undefined"!==typeof OffscreenCanvas)return new OffscreenCanvas(0,0)}},{key:"initContext",value:function(){var e={alpha:!1,depth:!1,antialias:!1};return this.canvas.getContext("webgl",e)||this.canvas.getContext("experimental-webgl",e)}},{key:"initPlugins",value:function(e){var t=[],r=this.source;if("string"===typeof r)for(var n=0;n<A.length;n++){var i=A[n];r.match(i.functionMatch)&&t.push(i)}else if("object"===typeof r&&e.pluginNames)for(var s=function(r){var n=A[r];e.pluginNames.some((function(e){return e===n.name}))&&t.push(n)},a=0;a<A.length;a++)s(a);return t}},{key:"initExtensions",value:function(){this.extensions={OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:this.context.getExtension("WEBGL_color_buffer_float")}}},{key:"validateSettings",value:function(e){if(this.validate){var t=this.constructor.features;if(!0===this.optimizeFloatMemory&&!t.isTextureFloat)throw new Error("Float textures are not supported");if("single"===this.precision&&!t.isFloatRead)throw new Error("Single precision not supported");if(!this.graphical&&null===this.precision&&t.isTextureFloat&&(this.precision=t.isFloatRead?"single":"unsigned"),this.subKernels&&this.subKernels.length>0&&!this.extensions.WEBGL_draw_buffers)throw new Error("could not instantiate draw buffers extension");if(null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=!t.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&t.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||0===this.output.length){if(1!==e.length)throw new Error("Auto output only supported for kernels with only one input");var r=p.getVariableType(e[0],this.strictIntegers);if("Array"===r)this.output=p.getDimensions(r);else{if("NumberTexture"!==r&&"ArrayTexture(4)"!==r)throw new Error("Auto output not supported for input type: "+r);this.output=e[0].output}}if(this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");return"precision"===this.precision&&(this.precision="unsigned",console.warn("Cannot use graphical mode and single precision at the same time")),void(this.texSize=p.clone(this.output))}null===this.precision&&t.isTextureFloat&&(this.precision="single"),this.texSize=p.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output)}else this.texSize=p.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output)}},{key:"updateMaxTexSize",value:function(){var e=this.texSize,t=this.canvas;if(null===this.maxTexSize){var r=b.indexOf(t);-1===r&&(r=b.length,b.push(t),S[r]=[e[0],e[1]]),this.maxTexSize=S[r]}this.maxTexSize[0]<e[0]&&(this.maxTexSize[0]=e[0]),this.maxTexSize[1]<e[1]&&(this.maxTexSize[1]=e[1])}},{key:"_oldtranslateSource",value:function(){var e=l.fromKernel(this,h,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy}),t=e.getPrototypeString("kernel");this.returnType||(this.returnType=e.getKernelResultType());for(var r=0,n=e.getReturnTypes(),i=0;i<n.length;i++)switch(n[i]){case"Float":case"Number":case"Integer":r++;break;case"Array(2)":r+=2;break;case"Array(3)":r+=3;break;case"Array(4)":r+=4}if(E&&r>E.channelCount)throw new Error("Too many channels!");return this.translatedSource=t}},{key:"setupArguments",value:function(e){var t=this;this.kernelArguments=[],this.argumentTextureCount=0;var r=null===this.argumentTypes;if(r&&(this.argumentTypes=[]),this.argumentSizes=[],this.argumentBitRatios=[],e.length<this.argumentNames.length)throw new Error("not enough arguments for kernel");if(e.length>this.argumentNames.length)throw new Error("too many arguments for kernel");for(var n=this.context,i=0,s=0;s<e.length;s++){var a=e[s],o=this.argumentNames[s],u=void 0;r?(u=p.getVariableType(a,this.strictIntegers),this.argumentTypes.push(u)):u=this.argumentTypes[s];var c=this.constructor.lookupKernelValueType(u,this.dynamicArguments?"dynamic":"static",this.precision,e[s]);if(null===c)return this.requestFallback(e);var l=new c(a,{name:o,type:u,tactic:this.tactic,origin:"user",context:n,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:function(){return t.context.createTexture()},onRequestIndex:function(){return i++},onUpdateValueMismatch:function(){t.switchingKernels=!0},onRequestContextHandle:function(){return n.TEXTURE0+t.constantTextureCount+t.argumentTextureCount++}});this.kernelArguments.push(l),this.argumentSizes.push(l.textureSize),this.argumentBitRatios[s]=l.bitRatio}}},{key:"setupConstants",value:function(e){var t=this,r=this.context;this.kernelConstants=[];var n=null===this.constantTypes;n&&(this.constantTypes={}),this.constantBitRatios={};var i=0;for(var s in this.constants){var a=this.constants[s],o=void 0;n?(o=p.getVariableType(a,this.strictIntegers),this.constantTypes[s]=o):o=this.constantTypes[s];var u=this.constructor.lookupKernelValueType(o,"static",this.precision,a);if(null===u)return this.requestFallback(e);var c=new u(a,{name:s,type:o,tactic:this.tactic,origin:"constants",context:this.context,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:function(){return t.context.createTexture()},onRequestIndex:function(){return i++},onRequestContextHandle:function(){return r.TEXTURE0+t.constantTextureCount++}});this.constantBitRatios[s]=c.bitRatio,this.kernelConstants.push(c)}}},{key:"build",value:function(){if(this.initExtensions(),this.validateSettings(arguments),this.setupConstants(arguments),!this.fallbackRequested&&(this.setupArguments(arguments),!this.fallbackRequested)){this.updateMaxTexSize(),this.translateSource();var e=this.pickRenderStrategy(arguments);if(e)return e;var t=this.texSize,r=this.context,n=this.canvas;r.enable(r.SCISSOR_TEST),this.pipeline&&this.precision,r.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),n.width=this.maxTexSize[0],n.height=this.maxTexSize[1];for(var i=this.threadDim=Array.from(this.output);i.length<3;)i.push(1);var s=this.getVertexShader(arguments),a=r.createShader(r.VERTEX_SHADER);r.shaderSource(a,s),r.compileShader(a),this.vertShader=a;var o=this.getFragmentShader(arguments),u=r.createShader(r.FRAGMENT_SHADER);if(r.shaderSource(u,o),r.compileShader(u),this.fragShader=u,this.debug&&(console.log("GLSL Shader Output:"),console.log(o)),!r.getShaderParameter(a,r.COMPILE_STATUS))throw new Error("Error compiling vertex shader: "+r.getShaderInfoLog(a));if(!r.getShaderParameter(u,r.COMPILE_STATUS))throw new Error("Error compiling fragment shader: "+r.getShaderInfoLog(u));var c=this.program=r.createProgram();r.attachShader(c,a),r.attachShader(c,u),r.linkProgram(c),this.framebuffer=r.createFramebuffer(),this.framebuffer.width=t[0],this.framebuffer.height=t[1];var l=new Float32Array([-1,-1,1,-1,-1,1,1,1]),h=new Float32Array([0,0,1,0,0,1,1,1]),p=l.byteLength,f=this.buffer;f?r.bindBuffer(r.ARRAY_BUFFER,f):(f=this.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,f),r.bufferData(r.ARRAY_BUFFER,l.byteLength+h.byteLength,r.STATIC_DRAW)),r.bufferSubData(r.ARRAY_BUFFER,0,l),r.bufferSubData(r.ARRAY_BUFFER,p,h);var d=r.getAttribLocation(this.program,"aPos");r.enableVertexAttribArray(d),r.vertexAttribPointer(d,2,r.FLOAT,!1,0,0);var m=r.getAttribLocation(this.program,"aTexCoord");r.enableVertexAttribArray(m),r.vertexAttribPointer(m,2,r.FLOAT,!1,0,p),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer);var g=0;for(var y in r.useProgram(this.program),this.constants)this.kernelConstants[g++].updateValue(this.constants[y]);this.immutable||(this._setupOutputTexture(),null!==this.subKernels&&this.subKernels.length>0&&this._setupSubOutputTextures())}}},{key:"translateSource",value:function(){var e=l.fromKernel(this,h,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});if(this.translatedSource=e.getPrototypeString("kernel"),this.graphical||this.returnType||(this.returnType=e.getKernelResultType()),this.subKernels&&this.subKernels.length>0)for(var t=0;t<this.subKernels.length;t++){var r=this.subKernels[t];r.returnType||(r.returnType=e.getSubKernelResultType(t))}}},{key:"run",value:function(){var e=this.kernelArguments,t=this.texSize,r=this.context;r.useProgram(this.program),r.scissor(0,0,t[0],t[1]),this.dynamicOutput&&(this.setUniform3iv("uOutputDim",this.threadDim),this.setUniform2iv("uTexSize",t)),this.setUniform2f("ratio",t[0]/this.maxTexSize[0],t[1]/this.maxTexSize[1]),this.switchingKernels=!1;for(var n=0;n<e.length;n++)if(e[n].updateValue(arguments[n]),this.switchingKernels)return;if(this.plugins)for(var i=0;i<this.plugins.length;i++){var s=this.plugins[i];s.onBeforeRun&&s.onBeforeRun(this)}if(this.graphical)return this.pipeline?(r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),this.outputTexture&&!this.immutable||this._setupOutputTexture(),r.drawArrays(r.TRIANGLE_STRIP,0,4),new this.TextureConstructor({texture:this.outputTexture,size:t,dimensions:this.threadDim,output:this.output,context:this.context})):(r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),void r.drawArrays(r.TRIANGLE_STRIP,0,4));r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),this.immutable&&this._setupOutputTexture(),null!==this.subKernels&&(this.immutable&&this._setupSubOutputTextures(),this.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(this.drawBuffersMap)),r.drawArrays(r.TRIANGLE_STRIP,0,4)}},{key:"getOutputTexture",value:function(){return this.outputTexture}},{key:"_setupOutputTexture",value:function(){var e=this.context,t=this.texSize,r=this.outputTexture=this.context.createTexture();if(e.activeTexture(e.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),"single"===this.precision)if(this.pipeline)switch(this.returnType){case"Number":case"Float":case"Integer":this.optimizeFloatMemory,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.FLOAT,null);break;case"Array(2)":case"Array(3)":case"Array(4)":e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.FLOAT,null);break;default:if(!this.graphical)throw new Error("Unhandled return type")}else e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.FLOAT,null);else e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.UNSIGNED_BYTE,null);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)}},{key:"_setupSubOutputTextures",value:function(){var e=this.context,t=this.texSize;this.drawBuffersMap=[e.COLOR_ATTACHMENT0],this.subKernelOutputTextures=[];for(var r=0;r<this.subKernels.length;r++){var n=this.context.createTexture();this.subKernelOutputTextures.push(n),this.drawBuffersMap.push(e.COLOR_ATTACHMENT0+r+1),e.activeTexture(e.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+r),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),"single"===this.precision?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+r+1,e.TEXTURE_2D,n,0)}}},{key:"getArgumentTexture",value:function(e){return this.getTextureCache("ARGUMENT_".concat(e))}},{key:"getTextureCache",value:function(e){return this.textureCache.hasOwnProperty(e)?this.textureCache[e]:this.textureCache[e]=this.context.createTexture()}},{key:"detachTextureCache",value:function(e){delete this.textureCache[e]}},{key:"setUniform1f",value:function(e,t){if(this.uniform1fCache.hasOwnProperty(e)&&t===this.uniform1fCache[e])return;this.uniform1fCache[e]=t;var r=this.getUniformLocation(e);this.context.uniform1f(r,t)}},{key:"setUniform1i",value:function(e,t){if(this.uniform1iCache.hasOwnProperty(e)&&t===this.uniform1iCache[e])return;this.uniform1iCache[e]=t;var r=this.getUniformLocation(e);this.context.uniform1i(r,t)}},{key:"setUniform2f",value:function(e,t,r){if(this.uniform2fCache.hasOwnProperty(e)){var n=this.uniform2fCache[e];if(t===n[0]&&r===n[1])return}this.uniform2fCache[e]=[t,r];var i=this.getUniformLocation(e);this.context.uniform2f(i,t,r)}},{key:"setUniform2fv",value:function(e,t){if(this.uniform2fvCache.hasOwnProperty(e)){var r=this.uniform2fvCache[e];if(t[0]===r[0]&&t[1]===r[1])return}this.uniform2fvCache[e]=t;var n=this.getUniformLocation(e);this.context.uniform2fv(n,t)}},{key:"setUniform2iv",value:function(e,t){if(this.uniform2ivCache.hasOwnProperty(e)){var r=this.uniform2ivCache[e];if(t[0]===r[0]&&t[1]===r[1])return}this.uniform2ivCache[e]=t;var n=this.getUniformLocation(e);this.context.uniform2iv(n,t)}},{key:"setUniform3fv",value:function(e,t){if(this.uniform3fvCache.hasOwnProperty(e)){var r=this.uniform3fvCache[e];if(t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2])return}this.uniform3fvCache[e]=t;var n=this.getUniformLocation(e);this.context.uniform3fv(n,t)}},{key:"setUniform3iv",value:function(e,t){if(this.uniform3ivCache.hasOwnProperty(e)){var r=this.uniform3ivCache[e];if(t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2])return}this.uniform3ivCache[e]=t;var n=this.getUniformLocation(e);this.context.uniform3iv(n,t)}},{key:"setUniform3fv",value:function(e,t){if(this.uniform3fvCache.hasOwnProperty(e)){var r=this.uniform3fvCache[e];if(t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2])return}this.uniform3fvCache[e]=t;var n=this.getUniformLocation(e);this.context.uniform3fv(n,t)}},{key:"setUniform4iv",value:function(e,t){if(this.uniform4ivCache.hasOwnProperty(e)){var r=this.uniform4ivCache[e];if(t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3])return}this.uniform4ivCache[e]=t;var n=this.getUniformLocation(e);this.context.uniform4iv(n,t)}},{key:"setUniform4fv",value:function(e,t){if(this.uniform4fvCache.hasOwnProperty(e)){var r=this.uniform4fvCache[e];if(t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3])return}this.uniform4fvCache[e]=t;var n=this.getUniformLocation(e);this.context.uniform4fv(n,t)}},{key:"getUniformLocation",value:function(e){return this.programUniformLocationCache.hasOwnProperty(e)?this.programUniformLocationCache[e]:this.programUniformLocationCache[e]=this.context.getUniformLocation(this.program,e)}},{key:"_getFragShaderArtifactMap",value:function(e){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),PLUGINS:this._getPluginsString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),DIVIDE_WITH_INTEGER_CHECK:this._getDivideWithIntegerCheckString(),MAIN_CONSTANTS:this._getMainConstantsString(),MAIN_ARGUMENTS:this._getMainArgumentsString(e),KERNEL:this.getKernelString(),MAIN_RESULT:this.getMainResultString(),FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}},{key:"_getVertShaderArtifactMap",value:function(e){return{FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}},{key:"_getHeaderString",value:function(){return null!==this.subKernels?"#extension GL_EXT_draw_buffers : require\n":""}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" ".concat(parseInt(this.loopMaxIterations),";\n"):" 1000;\n"}},{key:"_getPluginsString",value:function(){var e=this;return this.plugins?this.plugins.map((function(t){return t.source&&e.source.match(t.functionMatch)?t.source:""})).join("\n"):"\n"}},{key:"_getConstantsString",value:function(){var e=[],t=this.threadDim,r=this.texSize;return this.dynamicOutput?e.push("uniform ivec3 uOutputDim","uniform ivec2 uTexSize"):e.push("ivec3 uOutputDim = ivec3(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")"),"ivec2 uTexSize = ivec2(".concat(r[0],", ").concat(r[1],")")),p.linesToString(e)}},{key:"_getTextureCoordinate",value:function(){var e=this.subKernels;return null===e||e.length<1?"varying vec2 vTexCoord;\n":"out vec2 vTexCoord;\n"}},{key:"_getDecode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  texel.rgba = texel.abgr;\n"}},{key:"_getEncode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  texel.rgba = texel.abgr;\n"}},{key:"_getDivideWithIntegerCheckString",value:function(){return this.fixIntegerDivisionAccuracy?"float div_with_int_check(float x, float y) {\n  if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {\n    return float(int(x)/int(y));\n  }\n  return x / y;\n}":""}},{key:"_getMainArgumentsString",value:function(e){for(var t=[],r=this.argumentNames,n=0;n<r.length;n++)t.push(this.kernelArguments[n].getSource(e[n]));return t.join("")}},{key:"_getMainConstantsString",value:function(){var e=[],t=this.constants;if(t){var r=0;for(var n in t)e.push(this.kernelConstants[r++].getSource(this.constants[n]))}return e.join("")}},{key:"getKernelString",value:function(){var e;switch(this.returnType){case"Array(2)":e="vec2 kernelResult";break;case"Array(3)":e="vec3 kernelResult";break;case"Array(4)":e="vec4 kernelResult";break;case"LiteralInteger":case"Float":case"Number":case"Integer":e="float kernelResult";break;default:if(!this.graphical)throw new Error('unrecognized output type "'.concat(this.returnType,'"'));e="float kernelResult"}var t=[],r=this.subKernels;if(null!==r)switch(t.push(e),this.returnType){case"Number":case"Float":case"Integer":for(var n=0;n<r.length;n++){var i=r[n];t.push("Integer"===i.returnType?"int subKernelResult_".concat(i.name," = 0"):"float subKernelResult_".concat(i.name," = 0.0"))}break;case"Array(2)":for(var s=0;s<r.length;s++)t.push("vec2 subKernelResult_".concat(r[s].name));break;case"Array(3)":for(var a=0;a<r.length;a++)t.push("vec3 subKernelResult_".concat(r[a].name));break;case"Array(4)":for(var o=0;o<r.length;o++)t.push("vec4 subKernelResult_".concat(r[o].name))}else t.push(e);return p.linesToString(t)+this.translatedSource}},{key:"getMainResultGraphical",value:function(){return p.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor"])}},{key:"getMainResultPackedPixels",value:function(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error('packed output only usable with Numbers, "'.concat(this.returnType,'" specified'))}}},{key:"getMainResultKernelPackedPixels",value:function(){return p.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0] = ".concat(this.useLegacyEncoder?"legacyEncode32":"encode32","(kernelResult)")])}},{key:"getMainResultSubKernelPackedPixels",value:function(){var e=[];if(!this.subKernels)return"";for(var t=0;t<this.subKernels.length;t++){"Integer"===this.subKernels[t].returnType?e.push("  gl_FragData[".concat(t+1,"] = ").concat(this.useLegacyEncoder?"legacyEncode32":"encode32","(float(subKernelResult_").concat(this.subKernels[t].name,"))")):e.push("  gl_FragData[".concat(t+1,"] = ").concat(this.useLegacyEncoder?"legacyEncode32":"encode32","(subKernelResult_").concat(this.subKernels[t].name,")"))}return p.linesToString(e)}},{key:"getMainResultMemoryOptimizedFloats",value:function(){var e=["  index *= 4"];switch(this.returnType){case"Number":case"Integer":case"Float":for(var t=["r","g","b","a"],r=0;r<t.length;r++){var n=t[r];this.getMainResultKernelMemoryOptimizedFloats(e,n),this.getMainResultSubKernelMemoryOptimizedFloats(e,n),r+1<t.length&&e.push("  index += 1")}break;default:throw new Error("optimized output only usable with Numbers, ".concat(this.returnType," specified"))}return p.linesToString(e)}},{key:"getMainResultKernelMemoryOptimizedFloats",value:function(e,t){e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0].".concat(t," = kernelResult"))}},{key:"getMainResultSubKernelMemoryOptimizedFloats",value:function(e,t){if(!this.subKernels)return e;for(var r=0;r<this.subKernels.length;r++){"Integer"===this.subKernels[r].returnType?e.push("  gl_FragData[".concat(r+1,"].").concat(t," = float(subKernelResult_").concat(this.subKernels[r].name,")")):e.push("  gl_FragData[".concat(r+1,"].").concat(t," = subKernelResult_").concat(this.subKernels[r].name))}}},{key:"getMainResultKernelNumberTexture",value:function(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult"]}},{key:"getMainResultSubKernelNumberTexture",value:function(){var e=[];if(!this.subKernels)return e;for(var t=0;t<this.subKernels.length;++t){var r=this.subKernels[t];"Integer"===r.returnType?e.push("  gl_FragData[".concat(t+1,"][0] = float(subKernelResult_").concat(r.name,")")):e.push("  gl_FragData[".concat(t+1,"][0] = subKernelResult_").concat(r.name))}return e}},{key:"getMainResultKernelArray2Texture",value:function(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]"]}},{key:"getMainResultSubKernelArray2Texture",value:function(){var e=[];if(!this.subKernels)return e;for(var t=0;t<this.subKernels.length;++t)e.push("  gl_FragData[".concat(t+1,"][0] = subKernelResult_").concat(this.subKernels[t].name,"[0]"),"  gl_FragData[".concat(t+1,"][1] = subKernelResult_").concat(this.subKernels[t].name,"[1]"));return e}},{key:"getMainResultKernelArray3Texture",value:function(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]","  gl_FragData[0][2] = kernelResult[2]"]}},{key:"getMainResultSubKernelArray3Texture",value:function(){var e=[];if(!this.subKernels)return e;for(var t=0;t<this.subKernels.length;++t)e.push("  gl_FragData[".concat(t+1,"][0] = subKernelResult_").concat(this.subKernels[t].name,"[0]"),"  gl_FragData[".concat(t+1,"][1] = subKernelResult_").concat(this.subKernels[t].name,"[1]"),"  gl_FragData[".concat(t+1,"][2] = subKernelResult_").concat(this.subKernels[t].name,"[2]"));return e}},{key:"getMainResultKernelArray4Texture",value:function(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0] = kernelResult"]}},{key:"getMainResultSubKernelArray4Texture",value:function(){var e=[];if(!this.subKernels)return e;switch(this.returnType){case"Number":case"Float":case"Integer":for(var t=0;t<this.subKernels.length;++t){"Integer"===this.subKernels[t].returnType?e.push("  gl_FragData[".concat(t+1,"] = float(subKernelResult_").concat(this.subKernels[t].name,")")):e.push("  gl_FragData[".concat(t+1,"] = subKernelResult_").concat(this.subKernels[t].name))}break;case"Array(2)":for(var r=0;r<this.subKernels.length;++r)e.push("  gl_FragData[".concat(r+1,"][0] = subKernelResult_").concat(this.subKernels[r].name,"[0]"),"  gl_FragData[".concat(r+1,"][1] = subKernelResult_").concat(this.subKernels[r].name,"[1]"));break;case"Array(3)":for(var n=0;n<this.subKernels.length;++n)e.push("  gl_FragData[".concat(n+1,"][0] = subKernelResult_").concat(this.subKernels[n].name,"[0]"),"  gl_FragData[".concat(n+1,"][1] = subKernelResult_").concat(this.subKernels[n].name,"[1]"),"  gl_FragData[".concat(n+1,"][2] = subKernelResult_").concat(this.subKernels[n].name,"[2]"));break;case"Array(4)":for(var i=0;i<this.subKernels.length;++i)e.push("  gl_FragData[".concat(i+1,"][0] = subKernelResult_").concat(this.subKernels[i].name,"[0]"),"  gl_FragData[".concat(i+1,"][1] = subKernelResult_").concat(this.subKernels[i].name,"[1]"),"  gl_FragData[".concat(i+1,"][2] = subKernelResult_").concat(this.subKernels[i].name,"[2]"),"  gl_FragData[".concat(i+1,"][3] = subKernelResult_").concat(this.subKernels[i].name,"[3]"))}return e}},{key:"replaceArtifacts",value:function(e,t){return e.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z]*[0-9]?)*)__;\n/g,(function(e,r){if(t.hasOwnProperty(r))return t[r];throw"unhandled artifact ".concat(r)}))}},{key:"getFragmentShader",value:function(e){return null!==this.compiledFragmentShader?this.compiledFragmentShader:this.compiledFragmentShader=this.replaceArtifacts(this.constructor.fragmentShader,this._getFragShaderArtifactMap(e))}},{key:"getVertexShader",value:function(e){return null!==this.compiledVertexShader?this.compiledVertexShader:this.compiledVertexShader=this.replaceArtifacts(this.constructor.vertexShader,this._getVertShaderArtifactMap(e))}},{key:"toString",value:function(){var e=p.linesToString(["const gl = context"]);return g(this.constructor,arguments,this,e)}},{key:"destroy",value:function(e){this.outputTexture&&this.context.deleteTexture(this.outputTexture),this.buffer&&this.context.deleteBuffer(this.buffer),this.framebuffer&&this.context.deleteFramebuffer(this.framebuffer),this.vertShader&&this.context.deleteShader(this.vertShader),this.fragShader&&this.context.deleteShader(this.fragShader),this.program&&this.context.deleteProgram(this.program);for(var t=Object.keys(this.textureCache),r=0;r<t.length;r++){var n=t[r];this.context.deleteTexture(this.textureCache[n])}if(this.subKernelOutputTextures)for(var i=0;i<this.subKernelOutputTextures.length;i++)this.context.deleteTexture(this.subKernelOutputTextures[i]);if(e){var s=b.indexOf(this.canvas);s>=0&&(b[s]=null,S[s]=null)}this.destroyExtensions(),delete this.context,delete this.canvas}},{key:"destroyExtensions",value:function(){this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}},{key:"toJSON",value:function(){var e=a(s(t.prototype),"toJSON",this).call(this);return e.functionNodes=l.fromKernel(this,h).toJSON(),e}}],[{key:"destroyContext",value:function(e){var t=e.getExtension("WEBGL_lose_context");t&&t.loseContext()}}]),t}(c);e.exports={WebGLKernel:I}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="NumberTexture",r}return o(t,e),i(t,[{key:"renderRawOutput",value:function(){var e=this.context,t=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);var r=new Uint8Array(this.size[0]*this.size[1]*4);return e.readPixels(0,0,this.size[0],this.size[1],e.RGBA,e.UNSIGNED_BYTE,r),r}},{key:"renderValues",value:function(){return new Float32Array(this.renderRawOutput().buffer)}},{key:"toArray",value:function(){return u.erectPackedFloat(this.renderValues(),this.output[0])}}]),t}(r(13).Texture);e.exports={GLTextureUnsigned:c}},function(e,t,r){var n=r(0),i=r(1),s=r(5).utils,a=r(12).Input,o=function(){"use strict";function e(t,r){if(n(this,e),"object"!==typeof t){if("string"!==typeof t)throw new Error("source not a string");if(!s.isFunctionString(t))throw new Error("source not a function string")}this.useLegacyEncoder=!1,this.fallbackRequested=!1,this.onRequestFallback=null,this.argumentNames="string"===typeof t?s.getArgumentNamesFromString(t):null,this.argumentTypes=null,this.argumentSizes=null,this.argumentBitRatios=null,this.kernelArguments=null,this.kernelConstants=null,this.source=t,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.constantTypes=null,this.constantBitRatios=null,this.dynamicArguments=!1,this.dynamicOutput=!0,this.canvas=null,this.context=null,this.checkContext=null,this.gpu=null,this.functions=null,this.nativeFunctions=null,this.subKernels=null,this.validate=!0,this.immutable=!1,this.pipeline=!1,this.precision=null,this.tactic="balanced",this.plugins=null,this.returnType=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.optimizeFloatMemory=null,this.strictIntegers=!1,this.fixIntegerDivisionAccuracy=null,this.warnVarUsage=!0}return i(e,null,[{key:"isContextMatch",value:function(e){throw new Error('"isContextMatch" not implemented on '.concat(this.name))}},{key:"getFeatures",value:function(){throw new Error('"getFeatures" not implemented on '.concat(this.name))}},{key:"destroyContext",value:function(e){throw new Error('"destroyContext" called on '.concat(this.name))}},{key:"nativeFunctionArguments",value:function(){throw new Error('"nativeFunctionArguments" called on '.concat(this.name))}},{key:"nativeFunctionReturnType",value:function(){throw new Error('"nativeFunctionReturnType" called on '.concat(this.name))}},{key:"combineKernels",value:function(){throw new Error('"combineKernels" called on '.concat(this.name))}},{key:"isSupported",get:function(){throw new Error('"isSupported" not implemented on '.concat(this.name))}}]),i(e,[{key:"mergeSettings",value:function(e){for(var t in e)if(e.hasOwnProperty(t)&&this.hasOwnProperty(t)){switch(t){case"output":if(!Array.isArray(e.output)){this.setOutput(e.output);continue}break;case"functions":if("function"===typeof e.functions[0]){this.functions=e.functions.map((function(e){return s.functionToIFunction(e)}));continue}break;case"graphical":e[t]&&!e.hasOwnProperty("precision")&&(this.precision="unsigned"),this[t]=e[t];continue}this[t]=e[t]}this.canvas||(this.canvas=this.initCanvas()),this.context||(this.context=this.initContext()),this.plugins||(this.plugins=this.initPlugins(e))}},{key:"build",value:function(){throw new Error('"build" not defined on '.concat(this.constructor.name))}},{key:"run",value:function(){throw new Error('"run" not defined on '.concat(this.constructor.name))}},{key:"initCanvas",value:function(){throw new Error('"initCanvas" not defined on '.concat(this.constructor.name))}},{key:"initContext",value:function(){throw new Error('"initContext" not defined on '.concat(this.constructor.name))}},{key:"initPlugins",value:function(e){throw new Error('"initPlugins" not defined on '.concat(this.constructor.name))}},{key:"setupArguments",value:function(e){if(this.kernelArguments=[],this.argumentTypes)for(var t=0;t<this.argumentTypes.length;t++)this.kernelArguments.push({type:this.argumentTypes[t]});else if(!this.argumentTypes){this.argumentTypes=[];for(var r=0;r<e.length;r++){var n=s.getVariableType(e[r],this.strictIntegers),i="Integer"===n?"Number":n;this.argumentTypes.push(i),this.kernelArguments.push({type:i})}}this.argumentSizes=new Array(e.length),this.argumentBitRatios=new Int32Array(e.length);for(var o=0;o<e.length;o++){var u=e[o];this.argumentSizes[o]=u.constructor===a?u.size:null,this.argumentBitRatios[o]=this.getBitRatio(u)}if(this.argumentNames.length!==e.length)throw new Error("arguments are miss-aligned")}},{key:"setupConstants",value:function(){this.kernelConstants=[];var e=null===this.constantTypes;if(e&&(this.constantTypes={}),this.constantBitRatios={},this.constants)for(var t in this.constants){if(e){var r=s.getVariableType(this.constants[t],this.strictIntegers);this.constantTypes[t]=r,this.kernelConstants.push({name:t,type:r})}else this.kernelConstants.push({name:t,type:this.constantTypes[t]});this.constantBitRatios[t]=this.getBitRatio(this.constants[t])}}},{key:"setOptimizeFloatMemory",value:function(e){return this.optimizeFloatMemory=e,this}},{key:"setOutput",value:function(e){return e.hasOwnProperty("x")?e.hasOwnProperty("y")?e.hasOwnProperty("z")?this.output=[e.x,e.y,e.z]:this.output=[e.x,e.y]:this.output=[e.x]:this.output=e,this}},{key:"setDebug",value:function(e){return this.debug=e,this}},{key:"setGraphical",value:function(e){return this.graphical=e,this.precision="unsigned",this}},{key:"setLoopMaxIterations",value:function(e){return this.loopMaxIterations=e,this}},{key:"setConstants",value:function(e){return this.constants=e,this}},{key:"setConstantTypes",value:function(e){return this.constantTypes=e,this}},{key:"setFunctions",value:function(e){return"function"===typeof e[0]?this.functions=e.map((function(e){return s.functionToIFunction(e)})):this.functions=e,this}},{key:"setPipeline",value:function(e){return this.pipeline=e,this}},{key:"setPrecision",value:function(e){return this.precision=e,this}},{key:"setOutputToTexture",value:function(e){return s.warnDeprecated("method","setOutputToTexture","setPipeline"),this.pipeline=e,this}},{key:"setImmutable",value:function(e){return this.immutable=e,this}},{key:"setCanvas",value:function(e){return this.canvas=e,this}},{key:"setStrictIntegers",value:function(e){return this.strictIntegers=e,this}},{key:"setDynamicOutput",value:function(e){return this.dynamicOutput=e,this}},{key:"setHardcodeConstants",value:function(e){return s.warnDeprecated("method","setHardcodeConstants"),this.setDynamicOutput(e),this.setDynamicArguments(e),this}},{key:"setDynamicArguments",value:function(e){return this.dynamicArguments=e,this}},{key:"setUseLegacyEncoder",value:function(e){return this.useLegacyEncoder=e,this}},{key:"setWarnVarUsage",value:function(e){return this.warnVarUsage=e,this}},{key:"getCanvas",value:function(){return s.warnDeprecated("method","getCanvas"),this.canvas}},{key:"getWebGl",value:function(){return s.warnDeprecated("method","getWebGl"),this.context}},{key:"setContext",value:function(e){return this.context=e,this}},{key:"setArgumentTypes",value:function(e){if(Array.isArray(e))this.argumentTypes=e;else for(var t in this.argumentTypes=[],e){var r=this.argumentNames.indexOf(t);if(-1===r)throw new Error("unable to find argument ".concat(t));this.argumentTypes[r]=e[t]}return this}},{key:"setTactic",value:function(e){return this.tactic=e,this}},{key:"requestFallback",value:function(e){if(!this.onRequestFallback)throw new Error('"onRequestFallback" not defined on '.concat(this.constructor.name));return this.fallbackRequested=!0,this.onRequestFallback(e)}},{key:"validateSettings",value:function(){throw new Error('"validateSettings" not defined on '.concat(this.constructor.name))}},{key:"addSubKernel",value:function(e){if(null===this.subKernels&&(this.subKernels=[]),!e.source)throw new Error('subKernel missing "source" property');if(!e.property&&isNaN(e.property))throw new Error('subKernel missing "property" property');if(!e.name)throw new Error('subKernel missing "name" property');return this.subKernels.push(e),this}},{key:"destroy",value:function(e){throw new Error('"destroy" called on '.concat(this.constructor.name))}},{key:"getBitRatio",value:function(e){if("single"===this.precision)return 4;if(Array.isArray(e[0]))return this.getBitRatio(e[0]);if(e.constructor===a)return this.getBitRatio(e.value);switch(e.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}},{key:"getPixels",value:function(){throw new Error('"getPixels" called on '.concat(this.constructor.name))}},{key:"checkOutput",value:function(){if(!this.output||!s.isArray(this.output))throw new Error("kernel.output not an array");if(this.output.length<1)throw new Error("kernel.output is empty, needs at least 1 value");for(var e=0;e<this.output.length;e++)if(isNaN(this.output[e])||this.output[e]<1)throw new Error("".concat(this.constructor.name,".output[").concat(e,"] incorrectly defined as `").concat(this.output[e],"`, needs to be numeric, and greater than 0"))}},{key:"toJSON",value:function(){return{settings:{output:this.output,threadDim:this.threadDim,pipeline:this.pipeline,argumentNames:this.argumentNames,argumentsTypes:this.argumentTypes,constants:this.constants,pluginNames:this.plugins?this.plugins.map((function(e){return e.name})):null,returnType:this.returnType}}}}]),e}();e.exports={Kernel:o}},function(e,t,r){var n=r(0),i=r(1),s=r(32),a=r(5).utils,o=r(73).FunctionTracer,u=function(){"use strict";function e(t,r){if(n(this,e),!t&&!r.ast)throw new Error("source parameter is missing");if(r=r||{},this.source=t,this.ast=null,this.name="string"===typeof t?r.isRootKernel?"kernel":r.name||a.getFunctionNameFromString(t):null,this.calledFunctions=[],this.constants={},this.constantTypes={},this.constantBitRatios={},this.isRootKernel=!1,this.isSubKernel=!1,this.debug=null,this.declarations=null,this.functions=null,this.identifiers=null,this.contexts=null,this.functionCalls=null,this.states=[],this.needsArgumentType=null,this.assignArgumentType=null,this.lookupReturnType=null,this.lookupFunctionArgumentTypes=null,this.lookupFunctionArgumentBitRatio=null,this.triggerImplyArgumentType=null,this.triggerTrackArgumentSynonym=null,this.lookupArgumentSynonym=null,this.onNestedFunction=null,this.onFunctionCall=null,this.optimizeFloatMemory=null,this.precision=null,this.loopMaxIterations=null,this.argumentNames="string"===typeof this.source?a.getArgumentNamesFromString(this.source):null,this.argumentTypes=[],this.argumentSizes=[],this.argumentBitRatios=null,this.returnType=null,this.output=[],this.plugins=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.dynamicOutput=null,this.dynamicArguments=null,this.strictTypingChecking=!1,this.fixIntegerDivisionAccuracy=null,this.warnVarUsage=!0,r)for(var i in r)r.hasOwnProperty(i)&&this.hasOwnProperty(i)&&(this[i]=r[i]);this.synonymIndex=-1,this.synonymUseIndex=0,this.argumentSynonym={},this.literalTypes={},this.validate(),this._string=null,this._internalVariableNames={}}return i(e,[{key:"validate",value:function(){if("string"!==typeof this.source&&!this.ast)throw new Error("this.source not a string");if(!this.ast&&!a.isFunctionString(this.source))throw new Error("this.source not a function string");if(!this.name)throw new Error("this.name could not be set");if(this.argumentTypes.length>0&&this.argumentTypes.length!==this.argumentNames.length)throw new Error("argumentTypes count of ".concat(this.argumentTypes.length," exceeds ").concat(this.argumentNames.length));if(this.output.length<1)throw new Error("this.output is not big enough")}},{key:"isIdentifierConstant",value:function(e){return!!this.constants&&this.constants.hasOwnProperty(e)}},{key:"isInput",value:function(e){return"Input"===this.argumentTypes[this.argumentNames.indexOf(e)]}},{key:"pushState",value:function(e){this.states.push(e)}},{key:"popState",value:function(e){if(this.state!==e)throw new Error("Cannot popState ".concat(e," when in ").concat(this.state));this.states.pop()}},{key:"isState",value:function(e){return this.state===e}},{key:"astMemberExpressionUnroll",value:function(e){if("Identifier"===e.type)return e.name;if("ThisExpression"===e.type)return"this";if("MemberExpression"===e.type&&e.object&&e.property)return e.object.hasOwnProperty("name")&&"_"===e.object.name[0]?this.astMemberExpressionUnroll(e.property):this.astMemberExpressionUnroll(e.object)+"."+this.astMemberExpressionUnroll(e.property);if(e.hasOwnProperty("expressions")){var t=e.expressions[0];if("Literal"===t.type&&0===t.value&&2===e.expressions.length)return this.astMemberExpressionUnroll(e.expressions[1])}throw this.astErrorOutput("Unknown astMemberExpressionUnroll",e)}},{key:"getJsAST",value:function(e){if(this.ast)return this.ast;if("object"===typeof this.source)return this.traceFunctionAST(this.source),this.ast=this.source;if(null===(e=e||s))throw new Error("Missing JS to AST parser");var t=Object.freeze(e.parse("const parser_".concat(this.name," = ").concat(this.source,";"),{locations:!0})),r=t.body[0].declarations[0].init;if(this.traceFunctionAST(r),!t)throw new Error("Failed to parse JS code");return this.ast=r}},{key:"traceFunctionAST",value:function(e){var t=new o(e),r=t.contexts,n=t.declarations,i=t.functions,s=t.identifiers,a=t.functionCalls;this.contexts=r,this.identifiers=s,this.functionCalls=a,this.declarations=[],this.functions=i;for(var u=0;u<n.length;u++){var c=n[u],l=c.ast,h=c.context,p=c.name,f=c.origin,d=c.forceInteger,m=c.assignable,g=l.init,y=this.getDependencies(g),_=null;if(d)_="Integer";else if(g){var x=this.getType(g);switch(x){case"Integer":case"Float":case"Number":_="MemberExpression"===g.type?x:"Number";break;case"LiteralInteger":_="Number";break;default:_=x}}this.declarations.push({valueType:_,dependencies:y,isSafe:this.isSafeDependencies(y),ast:l,name:p,context:h,origin:f,assignable:m})}for(var v=0;v<i.length;v++)this.onNestedFunction(i[v])}},{key:"getDeclaration",value:function(e){for(var t=0;t<this.identifiers.length;t++){var r=this.identifiers[t];if(e===r.ast&&r.context.hasOwnProperty(e.name))for(var n=0;n<this.declarations.length;n++){var i=this.declarations[n];if(i.name===e.name&&i.context[e.name]===r.context[e.name])return i}}return null}},{key:"getVariableType",value:function(e){if("Identifier"!==e.type)throw new Error("ast of ".concat(e.type,' not "Identifier"'));var t=null,r=this.argumentNames.indexOf(e.name);if(-1===r){var n=this.getDeclaration(e);if(n)return n.valueType}else{var i=this.argumentTypes[r];i&&(t=i)}if(!t&&this.strictTypingChecking)throw new Error("Declaration of ".concat(name," not found"));return t}},{key:"getLookupType",value:function(e){if(!c.hasOwnProperty(e))throw new Error("unknown typeLookupMap ".concat(e));return c[e]}},{key:"getConstantType",value:function(e){if(this.constantTypes[e]){var t=this.constantTypes[e];return"Float"===t?"Number":t}throw new Error('Type for constant "'.concat(e,'" not declared'))}},{key:"getKernelArgumentName",value:function(e){return this.lookupArgumentSynonym?-1===this.argumentNames.indexOf(e)?null:this.lookupArgumentSynonym("kernel",this.name,e):null}},{key:"toString",value:function(){return this._string?this._string:this._string=this.astGeneric(this.getJsAST(),[]).join("").trim()}},{key:"toJSON",value:function(){var e={source:this.source,name:this.name,constants:this.constants,constantTypes:this.constantTypes,isRootKernel:this.isRootKernel,isSubKernel:this.isSubKernel,debug:this.debug,output:this.output,loopMaxIterations:this.loopMaxIterations,argumentNames:this.argumentNames,argumentTypes:this.argumentTypes,argumentSizes:this.argumentSizes,returnType:this.returnType,leadingReturnStatement:this.leadingReturnStatement,followingReturnStatement:this.followingReturnStatement};return{ast:this.ast,settings:e}}},{key:"getType",value:function(e){if(Array.isArray(e))return this.getType(e[e.length-1]);switch(e.type){case"BlockStatement":return this.getType(e.body);case"ArrayExpression":return"Array(".concat(e.elements.length,")");case"Literal":var t="".concat(e.start,",").concat(e.end);return this.literalTypes[t]?this.literalTypes[t]:Number.isInteger(e.value)?"LiteralInteger":!0===e.value||!1===e.value?"Boolean":"Number";case"AssignmentExpression":return this.getType(e.left);case"CallExpression":if(this.isAstMathFunction(e))return"Number";if(!e.callee||!e.callee.name){if("SequenceExpression"===e.callee.type&&e.callee.expressions[e.callee.expressions.length-1].property.name){var r=e.callee.expressions[e.callee.expressions.length-1].property.name;return this.inferArgumentTypesIfNeeded(r,e.arguments),this.lookupReturnType(r,e,this)}throw this.astErrorOutput("Unknown call expression",e)}if(e.callee&&e.callee.name){var n=e.callee.name;return this.inferArgumentTypesIfNeeded(n,e.arguments),this.lookupReturnType(n,e,this)}throw this.astErrorOutput('Unhandled getType Type "'.concat(e.type,'"'),e);case"BinaryExpression":switch(e.operator){case"%":case"/":if(this.fixIntegerDivisionAccuracy)return"Number";break;case">":case"<":return"Boolean";case"&":case"|":case"^":case"<<":case">>":case">>>":return"Integer"}var i=this.getType(e.left);if(this.isState("skip-literal-correction"))return i;if("LiteralInteger"===i){var s=this.getType(e.right);return"LiteralInteger"===s?e.left.value%1===0?"Integer":"Float":s}return c[i]||i;case"UpdateExpression":return this.getType(e.argument);case"UnaryExpression":return"~"===e.operator?"Integer":this.getType(e.argument);case"VariableDeclaration":for(var a,o=e.declarations,u=0;u<o.length;u++){var l=o[u];a=this.getType(l)}if(!a)throw this.astErrorOutput("Unable to find type for declaration",e);return a;case"VariableDeclarator":var h=this.getDeclaration(e.id);if(!h)throw this.astErrorOutput("Unable to find declarator",e);if(!h.valueType)throw this.astErrorOutput("Unable to find declarator valueType",e);return h.valueType;case"Identifier":if("Infinity"===e.name)return"Number";if(this.isAstVariable(e))if("value"===this.getVariableSignature(e)){var p=this.getVariableType(e);if(!p)throw this.astErrorOutput("Unable to find identifier valueType",e);return p}var f=this.findIdentifierOrigin(e);return f&&f.init?this.getType(f.init):null;case"ReturnStatement":return this.getType(e.argument);case"MemberExpression":if(this.isAstMathFunction(e)){switch(e.property.name){case"ceil":case"floor":case"round":return"Integer"}return"Number"}if(this.isAstVariable(e)){switch(this.getVariableSignature(e)){case"value[]":return this.getLookupType(this.getVariableType(e.object));case"value[][]":return this.getLookupType(this.getVariableType(e.object.object));case"value[][][]":return this.getLookupType(this.getVariableType(e.object.object.object));case"value[][][][]":return this.getLookupType(this.getVariableType(e.object.object.object.object));case"value.thread.value":case"this.thread.value":return"Integer";case"this.output.value":return this.dynamicOutput?"Integer":"LiteralInteger";case"this.constants.value":return this.getConstantType(e.property.name);case"this.constants.value[]":return this.getLookupType(this.getConstantType(e.object.property.name));case"this.constants.value[][]":return this.getLookupType(this.getConstantType(e.object.object.property.name));case"this.constants.value[][][]":return this.getLookupType(this.getConstantType(e.object.object.object.property.name));case"this.constants.value[][][][]":return this.getLookupType(this.getConstantType(e.object.object.object.object.property.name));case"fn()[]":case"fn()[][]":case"fn()[][][]":return this.getLookupType(this.getType(e.object));case"value.value":if(this.isAstMathVariable(e))return"Number";switch(e.property.name){case"r":case"g":case"b":case"a":return this.getLookupType(this.getVariableType(e.object))}case"[][]":return"Number"}throw this.astErrorOutput("Unhandled getType MemberExpression",e)}throw this.astErrorOutput("Unhandled getType MemberExpression",e);case"ConditionalExpression":return this.getType(e.consequent);case"FunctionDeclaration":case"FunctionExpression":var d=this.findLastReturn(e.body);return d?this.getType(d):null;case"IfStatement":return this.getType(e.consequent);default:throw this.astErrorOutput('Unhandled getType Type "'.concat(e.type,'"'),e)}}},{key:"inferArgumentTypesIfNeeded",value:function(e,t){for(var r=0;r<t.length;r++)if(this.needsArgumentType(e,r)){var n=this.getType(t[r]);if(!n)throw this.astErrorOutput("Unable to infer argument ".concat(r),t[r]);this.assignArgumentType(e,r,n)}}},{key:"isAstMathVariable",value:function(e){return"MemberExpression"===e.type&&e.object&&"Identifier"===e.object.type&&"Math"===e.object.name&&e.property&&"Identifier"===e.property.type&&["E","PI","SQRT2","SQRT1_2","LN2","LN10","LOG2E","LOG10E"].indexOf(e.property.name)>-1}},{key:"isAstMathFunction",value:function(e){return"CallExpression"===e.type&&e.callee&&"MemberExpression"===e.callee.type&&e.callee.object&&"Identifier"===e.callee.object.type&&"Math"===e.callee.object.name&&e.callee.property&&"Identifier"===e.callee.property.type&&["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","log2","max","min","pow","random","round","sign","sin","sqrt","tan"].indexOf(e.callee.property.name)>-1}},{key:"isAstVariable",value:function(e){return"Identifier"===e.type||"MemberExpression"===e.type}},{key:"isSafe",value:function(e){return this.isSafeDependencies(this.getDependencies(e))}},{key:"isSafeDependencies",value:function(e){return!e||!e.every||e.every((function(e){return e.isSafe}))}},{key:"getDependencies",value:function(e,t,r){if(t||(t=[]),!e)return null;if(Array.isArray(e)){for(var n=0;n<e.length;n++)this.getDependencies(e[n],t,r);return t}switch(e.type){case"AssignmentExpression":return this.getDependencies(e.left,t,r),this.getDependencies(e.right,t,r),t;case"Literal":t.push({origin:"literal",value:e.value,isSafe:!0!==r&&(e.value>-1/0&&e.value<1/0&&!isNaN(e.value))});break;case"VariableDeclarator":return this.getDependencies(e.init,t,r);case"Identifier":var i=this.getDeclaration(e);if(i)t.push({name:e.name,origin:"declaration",isSafe:!r&&this.isSafeDependencies(i.dependencies)});else if(this.argumentNames.indexOf(e.name)>-1)t.push({name:e.name,origin:"argument",isSafe:!1});else if(this.strictTypingChecking)throw new Error('Cannot find identifier origin "'.concat(e.name,'"'));break;case"FunctionDeclaration":return this.getDependencies(e.body.body[e.body.body.length-1],t,r);case"ReturnStatement":return this.getDependencies(e.argument,t);case"BinaryExpression":return r="/"===e.operator||"*"===e.operator,this.getDependencies(e.left,t,r),this.getDependencies(e.right,t,r),t;case"UnaryExpression":case"UpdateExpression":return this.getDependencies(e.argument,t,r);case"VariableDeclaration":return this.getDependencies(e.declarations,t,r);case"ArrayExpression":return t.push({origin:"declaration",isSafe:!0}),t;case"CallExpression":return t.push({origin:"function",isSafe:!0}),t;case"MemberExpression":var s=this.getMemberExpressionDetails(e);switch(s.signature){case"value[]":this.getDependencies(e.object,t,r);break;case"value[][]":this.getDependencies(e.object.object,t,r);break;case"value[][][]":this.getDependencies(e.object.object.object,t,r);break;case"this.output.value":this.dynamicOutput&&t.push({name:s.name,origin:"output",isSafe:!1})}if(s)return s.property&&this.getDependencies(s.property,t,r),s.xProperty&&this.getDependencies(s.xProperty,t,r),s.yProperty&&this.getDependencies(s.yProperty,t,r),s.zProperty&&this.getDependencies(s.zProperty,t,r),t;default:throw this.astErrorOutput("Unhandled type ".concat(e.type," in getDependencies"),e)}return t}},{key:"getVariableSignature",value:function(e){if(!this.isAstVariable(e))throw new Error('ast of type "'.concat(e.type,'" is not a variable signature'));if("Identifier"===e.type)return"value";for(var t=[];e;)e.computed?t.push("[]"):"ThisExpression"===e.type?t.unshift("this"):e.property&&e.property.name?"x"===e.property.name||"y"===e.property.name||"z"===e.property.name?t.unshift(".value"):"constants"===e.property.name||"thread"===e.property.name||"output"===e.property.name?t.unshift("."+e.property.name):t.unshift(".value"):e.name?t.unshift("value"):e.callee&&e.callee.name?t.unshift("fn()"):e.elements?t.unshift("[]"):t.unshift("unknown"),e=e.object;var r=t.join("");return["value","value[]","value[][]","value[][][]","value[][][][]","value.value","value.thread.value","this.thread.value","this.output.value","this.constants.value","this.constants.value[]","this.constants.value[][]","this.constants.value[][][]","this.constants.value[][][][]","fn()[]","fn()[][]","fn()[][][]","[][]"].indexOf(r)>-1?r:null}},{key:"build",value:function(){return this.toString().length>0}},{key:"astGeneric",value:function(e,t){if(null===e)throw this.astErrorOutput("NULL ast",e);if(Array.isArray(e)){for(var r=0;r<e.length;r++)this.astGeneric(e[r],t);return t}switch(e.type){case"FunctionDeclaration":return this.astFunctionDeclaration(e,t);case"FunctionExpression":return this.astFunctionExpression(e,t);case"ReturnStatement":return this.astReturnStatement(e,t);case"Literal":return this.astLiteral(e,t);case"BinaryExpression":return this.astBinaryExpression(e,t);case"Identifier":return this.astIdentifierExpression(e,t);case"AssignmentExpression":return this.astAssignmentExpression(e,t);case"ExpressionStatement":return this.astExpressionStatement(e,t);case"EmptyStatement":return this.astEmptyStatement(e,t);case"BlockStatement":return this.astBlockStatement(e,t);case"IfStatement":return this.astIfStatement(e,t);case"SwitchStatement":return this.astSwitchStatement(e,t);case"BreakStatement":return this.astBreakStatement(e,t);case"ContinueStatement":return this.astContinueStatement(e,t);case"ForStatement":return this.astForStatement(e,t);case"WhileStatement":return this.astWhileStatement(e,t);case"DoWhileStatement":return this.astDoWhileStatement(e,t);case"VariableDeclaration":return this.astVariableDeclaration(e,t);case"VariableDeclarator":return this.astVariableDeclarator(e,t);case"ThisExpression":return this.astThisExpression(e,t);case"SequenceExpression":return this.astSequenceExpression(e,t);case"UnaryExpression":return this.astUnaryExpression(e,t);case"UpdateExpression":return this.astUpdateExpression(e,t);case"LogicalExpression":return this.astLogicalExpression(e,t);case"MemberExpression":return this.astMemberExpression(e,t);case"CallExpression":return this.astCallExpression(e,t);case"ArrayExpression":return this.astArrayExpression(e,t);case"DebuggerStatement":return this.astDebuggerStatement(e,t);case"ConditionalExpression":return this.astConditionalExpression(e,t)}throw this.astErrorOutput("Unknown ast type : "+e.type,e)}},{key:"astErrorOutput",value:function(e,t){if("string"!==typeof this.source)return new Error(e);var r=a.getAstString(this.source,t),n=this.source.substr(t.start).split(/\n/),i=n.length>0?n[n.length-1]:0;return new Error("".concat(e," on line ").concat(n.length,", position ").concat(i.length,":\n ").concat(r))}},{key:"astDebuggerStatement",value:function(e,t){return t}},{key:"astConditionalExpression",value:function(e,t){if("ConditionalExpression"!==e.type)throw this.astErrorOutput("Not a conditional expression",e);return t.push("("),this.astGeneric(e.test,t),t.push("?"),this.astGeneric(e.consequent,t),t.push(":"),this.astGeneric(e.alternate,t),t.push(")"),t}},{key:"astFunction",value:function(e,t){throw new Error('"astFunction" not defined on '.concat(this.constructor.name))}},{key:"astFunctionDeclaration",value:function(e,t){return this.isChildFunction(e)?t:this.astFunction(e,t)}},{key:"astFunctionExpression",value:function(e,t){return this.isChildFunction(e)?t:this.astFunction(e,t)}},{key:"isChildFunction",value:function(e){for(var t=0;t<this.functions.length;t++)if(this.functions[t]===e)return!0;return!1}},{key:"astReturnStatement",value:function(e,t){return t}},{key:"astLiteral",value:function(e,t){return this.literalTypes["".concat(e.start,",").concat(e.end)]="Number",t}},{key:"astBinaryExpression",value:function(e,t){return t}},{key:"astIdentifierExpression",value:function(e,t){return t}},{key:"astAssignmentExpression",value:function(e,t){return t}},{key:"astExpressionStatement",value:function(e,t){return this.astGeneric(e.expression,t),t.push(";"),t}},{key:"astEmptyStatement",value:function(e,t){return t}},{key:"astBlockStatement",value:function(e,t){return t}},{key:"astIfStatement",value:function(e,t){return t}},{key:"astSwitchStatement",value:function(e,t){return t}},{key:"astBreakStatement",value:function(e,t){return t.push("break;"),t}},{key:"astContinueStatement",value:function(e,t){return t.push("continue;\n"),t}},{key:"astForStatement",value:function(e,t){return t}},{key:"astWhileStatement",value:function(e,t){return t}},{key:"astDoWhileStatement",value:function(e,t){return t}},{key:"astVariableDeclaration",value:function(e,t){var r=e.declarations;if(!r||!r[0]||!r[0].init)throw this.astErrorOutput("Unexpected expression",e);var n=r[0],i=n.init,s=this.isState("in-for-loop-init")?"Integer":this.getType(i);"LiteralInteger"===s&&(s="Number");var a=typeMap[s];if(!a)throw this.astErrorOutput("Markup type ".concat(a," not handled"),e);this.getDependencies(n.init);throw new Error("remove me")}},{key:"astVariableDeclarator",value:function(e,t){return this.astGeneric(e.id,t),null!==e.init&&(t.push("="),this.astGeneric(e.init,t)),t}},{key:"astThisExpression",value:function(e,t){return t}},{key:"astSequenceExpression",value:function(e,t){for(var r=0;r<e.expressions.length;r++)r>0&&t.push(","),this.astGeneric(e.expressions,t);return t}},{key:"astUnaryExpression",value:function(e,t){return this.checkAndUpconvertBitwiseUnary(e,t)?t:(e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t)):(this.astGeneric(e.argument,t),t.push(e.operator)),t)}},{key:"checkAndUpconvertBitwiseUnary",value:function(e,t){}},{key:"astUpdateExpression",value:function(e,t){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t)):(this.astGeneric(e.argument,t),t.push(e.operator)),t}},{key:"astLogicalExpression",value:function(e,t){return t.push("("),this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t),t.push(")"),t}},{key:"astMemberExpression",value:function(e,t){return t}},{key:"astCallExpression",value:function(e,t){return t}},{key:"astArrayExpression",value:function(e,t){return t}},{key:"getMemberExpressionDetails",value:function(e){if("MemberExpression"!==e.type)throw this.astErrorOutput("Expression ".concat(e.type," not a MemberExpression"),e);var t=null,r=null,n=this.getVariableSignature(e);switch(n){case"value":return null;case"value.thread.value":case"this.thread.value":case"this.output.value":return{signature:n,type:"Integer",name:e.property.name};case"value[]":if("string"!==typeof e.object.name)throw this.astErrorOutput("Unexpected expression",e);return{name:t=e.object.name,origin:"user",signature:n,type:this.getVariableType(e.object),xProperty:e.property};case"value[][]":if("string"!==typeof e.object.object.name)throw this.astErrorOutput("Unexpected expression",e);return{name:t=e.object.object.name,origin:"user",signature:n,type:this.getVariableType(e.object.object),yProperty:e.object.property,xProperty:e.property};case"value[][][]":if("string"!==typeof e.object.object.object.name)throw this.astErrorOutput("Unexpected expression",e);return{name:t=e.object.object.object.name,origin:"user",signature:n,type:this.getVariableType(e.object.object.object),zProperty:e.object.object.property,yProperty:e.object.property,xProperty:e.property};case"value[][][][]":if("string"!==typeof e.object.object.object.object.name)throw this.astErrorOutput("Unexpected expression",e);return{name:t=e.object.object.object.object.name,origin:"user",signature:n,type:this.getVariableType(e.object.object.object.object),zProperty:e.object.object.property,yProperty:e.object.property,xProperty:e.property};case"value.value":if("string"!==typeof e.property.name)throw this.astErrorOutput("Unexpected expression",e);if(this.isAstMathVariable(e))return{name:t=e.property.name,origin:"Math",type:"Number",signature:n};switch(e.property.name){case"r":case"g":case"b":case"a":return{name:t=e.object.name,property:e.property.name,origin:"user",signature:n,type:"Number"};default:throw this.astErrorOutput("Unexpected expression",e)}case"this.constants.value":if("string"!==typeof e.property.name)throw this.astErrorOutput("Unexpected expression",e);if(t=e.property.name,!(r=this.getConstantType(t)))throw this.astErrorOutput("Constant has no type",e);return{name:t,type:r,origin:"constants",signature:n};case"this.constants.value[]":if("string"!==typeof e.object.property.name)throw this.astErrorOutput("Unexpected expression",e);if(t=e.object.property.name,!(r=this.getConstantType(t)))throw this.astErrorOutput("Constant has no type",e);return{name:t,type:r,origin:"constants",signature:n,xProperty:e.property};case"this.constants.value[][]":if("string"!==typeof e.object.object.property.name)throw this.astErrorOutput("Unexpected expression",e);if(t=e.object.object.property.name,!(r=this.getConstantType(t)))throw this.astErrorOutput("Constant has no type",e);return{name:t,type:r,origin:"constants",signature:n,yProperty:e.object.property,xProperty:e.property};case"this.constants.value[][][]":if("string"!==typeof e.object.object.object.property.name)throw this.astErrorOutput("Unexpected expression",e);if(t=e.object.object.object.property.name,!(r=this.getConstantType(t)))throw this.astErrorOutput("Constant has no type",e);return{name:t,type:r,origin:"constants",signature:n,zProperty:e.object.object.property,yProperty:e.object.property,xProperty:e.property};case"fn()[]":case"[][]":return{signature:n,property:e.property};default:throw this.astErrorOutput("Unexpected expression",e)}}},{key:"findIdentifierOrigin",value:function(e){for(var t=[this.ast];t.length>0;){var r=t[0];if("VariableDeclarator"===r.type&&r.id&&r.id.name&&r.id.name===e.name)return r;if(t.shift(),r.argument)t.push(r.argument);else if(r.body)t.push(r.body);else if(r.declarations)t.push(r.declarations);else if(Array.isArray(r))for(var n=0;n<r.length;n++)t.push(r[n])}return null}},{key:"findLastReturn",value:function(e){for(var t=[e||this.ast];t.length>0;){var r=t.pop();if("ReturnStatement"===r.type)return r;if("FunctionDeclaration"!==r.type)if(r.argument)t.push(r.argument);else if(r.body)t.push(r.body);else if(r.declarations)t.push(r.declarations);else if(Array.isArray(r))for(var n=0;n<r.length;n++)t.push(r[n]);else r.consequent?t.push(r.consequent):r.cases&&t.push(r.cases)}return null}},{key:"getInternalVariableName",value:function(e){return this._internalVariableNames.hasOwnProperty(e)||(this._internalVariableNames[e]=0),this._internalVariableNames[e]++,1===this._internalVariableNames[e]?e:e+this._internalVariableNames[e]}},{key:"varWarn",value:function(){console.warn("var declarations are deprecated, weird things happen when falling back to CPU because var scope differs in javascript than in most languages.  Use const or let")}},{key:"state",get:function(){return this.states[this.states.length-1]}}]),e}(),c={Number:"Number",Float:"Float",Integer:"Integer",Array:"Number","Array(2)":"Number","Array(3)":"Number","Array(4)":"Number",Array2D:"Number",Array3D:"Number",Input:"Number",HTMLImage:"Array(4)",HTMLImageArray:"Array(4)",NumberTexture:"Number",MemoryOptimizedNumberTexture:"Number","Array1D(2)":"Array(2)","Array1D(3)":"Array(3)","Array1D(4)":"Array(4)","Array2D(2)":"Array(2)","Array2D(3)":"Array(3)","Array2D(4)":"Array(4)","Array3D(2)":"Array(2)","Array3D(3)":"Array(3)","Array3D(4)":"Array(4)","ArrayTexture(1)":"Number","ArrayTexture(2)":"Array(2)","ArrayTexture(3)":"Array(3)","ArrayTexture(4)":"Array(4)"};e.exports={FunctionNode:u}},function(e,t){var r,n,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"===typeof setTimeout?setTimeout:s}catch(e){r=s}try{n="function"===typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,c=[],l=!1,h=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!l){var e=o(p);l=!0;for(var t=c.length;t;){for(u=c,c=[];++h<t;)u&&u[h].run();h=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new d(e,t)),1!==c.length||l||o(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=(r(5).utils,function(e){"use strict";function t(e,r){var i;return n(this,t),i=s(this,a(t).call(this,e,r)),r&&r.hasOwnProperty("fixIntegerDivisionAccuracy")&&(i.fixIntegerDivisionAccuracy=r.fixIntegerDivisionAccuracy),i}return o(t,e),i(t,[{key:"astFunction",value:function(e,t){if(this.isRootKernel)t.push("void");else{if(!this.returnType)this.findLastReturn()&&(this.returnType=this.getType(e.body),"LiteralInteger"===this.returnType&&(this.returnType="Number"));var r=this.returnType;if(r){var n=c[r];if(!n)throw new Error("unknown type ".concat(r));t.push(n)}else t.push("void")}if(t.push(" "),t.push(this.name),t.push("("),!this.isRootKernel)for(var i=0;i<this.argumentNames.length;++i){var s=this.argumentNames[i];i>0&&t.push(", ");var a=this.argumentTypes[this.argumentNames.indexOf(s)];if(!a)throw this.astErrorOutput("Unknown argument ".concat(s," type"),e);"LiteralInteger"===a&&(this.argumentTypes[i]=a="Number");var o=c[a];if(!o)throw this.astErrorOutput("Unexpected expression",e);t.push(o),t.push(" "),t.push("user_"),t.push(s)}t.push(") {\n");for(var u=0;u<e.body.body.length;++u)this.astGeneric(e.body.body[u],t),t.push("\n");return t.push("}\n"),t}},{key:"astReturnStatement",value:function(e,t){if(!e.argument)throw this.astErrorOutput("Unexpected return statement",e);this.pushState("skip-literal-correction");var r=this.getType(e.argument);this.popState("skip-literal-correction");var n=[];switch(this.returnType||(this.returnType="LiteralInteger"===r||"Integer"===r?"Number":r),this.returnType){case"LiteralInteger":case"Number":case"Float":switch(r){case"Integer":n.push("float("),this.astGeneric(e.argument,n),n.push(")");break;case"LiteralInteger":this.castLiteralToFloat(e.argument,n),"Integer"===this.getType(e)&&(n.unshift("float("),n.push(")"));break;default:this.astGeneric(e.argument,n)}break;case"Integer":switch(r){case"Float":case"Number":this.castValueToInteger(e.argument,n);break;case"LiteralInteger":this.castLiteralToInteger(e.argument,n);break;default:this.astGeneric(e.argument,n)}break;case"Array(4)":case"Array(3)":case"Array(2)":case"Input":this.astGeneric(e.argument,n);break;default:throw this.astErrorOutput("unhandled return type ".concat(this.returnType),e)}return this.isRootKernel?(t.push("kernelResult = ".concat(n.join(""),";")),t.push("return;")):this.isSubKernel?(t.push("subKernelResult_".concat(this.name," = ").concat(n.join(""),";")),t.push("return subKernelResult_".concat(this.name,";"))):t.push("return ".concat(n.join(""),";")),t}},{key:"astLiteral",value:function(e,t){if(isNaN(e.value))throw this.astErrorOutput("Non-numeric literal not supported : "+e.value,e);var r="".concat(e.start,",").concat(e.end);return Number.isInteger(e.value)?this.isState("in-for-loop-init")||this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[r]="Integer",t.push("".concat(e.value))):(this.isState("casting-to-float")||this.isState("building-float"),this.literalTypes[r]="Number",t.push("".concat(e.value,".0"))):this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[r]="Integer",t.push(Math.round(e.value))):(this.literalTypes[r]="Number",t.push("".concat(e.value))),t}},{key:"astBinaryExpression",value:function(e,t){if(this.checkAndUpconvertOperator(e,t))return t;if(this.fixIntegerDivisionAccuracy&&"/"===e.operator){switch(t.push("div_with_int_check("),this.pushState("building-float"),this.getType(e.left)){case"Integer":this.castValueToFloat(e.left,t);break;case"LiteralInteger":this.castLiteralToFloat(e.left,t);break;default:this.astGeneric(e.left,t)}switch(t.push(", "),this.getType(e.right)){case"Integer":this.castValueToFloat(e.right,t);break;case"LiteralInteger":this.castLiteralToFloat(e.right,t);break;default:this.astGeneric(e.right,t)}return this.popState("building-float"),t.push(")"),t}t.push("(");var r=this.getType(e.left)||"Number",n=this.getType(e.right)||"Number";if(!r||!n)throw this.astErrorOutput("Unhandled binary expression",e);var i=r+" & "+n;switch(i){case"Integer & Integer":this.pushState("building-integer"),this.astGeneric(e.left,t),t.push(l[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-integer");break;case"Number & Float":case"Float & Number":case"Float & Float":case"Number & Number":this.pushState("building-float"),this.astGeneric(e.left,t),t.push(l[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-float");break;case"LiteralInteger & LiteralInteger":this.isState("casting-to-integer")||this.isState("building-integer")?(this.pushState("building-integer"),this.astGeneric(e.left,t),t.push(l[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-integer")):(this.pushState("building-float"),this.castLiteralToFloat(e.left,t),t.push(l[e.operator]||e.operator),this.castLiteralToFloat(e.right,t),this.popState("building-float"));break;case"Integer & Float":case"Integer & Number":if((">"===e.operator||"<"===e.operator&&"Literal"===e.right.type)&&!Number.isInteger(e.right.value)){this.pushState("building-float"),this.castValueToFloat(e.left,t),t.push(l[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-float");break}if(this.pushState("building-integer"),this.astGeneric(e.left,t),t.push(l[e.operator]||e.operator),this.pushState("casting-to-integer"),"Literal"===e.right.type){var s=[];if(this.astGeneric(e.right,s),"Integer"!==this.getType(e.right))throw this.astErrorOutput("Unhandled binary expression with literal",e);t.push(s.join(""))}else t.push("int("),this.astGeneric(e.right,t),t.push(")");this.popState("casting-to-integer"),this.popState("building-integer");break;case"Integer & LiteralInteger":this.pushState("building-integer"),this.astGeneric(e.left,t),t.push(l[e.operator]||e.operator),this.castLiteralToInteger(e.right,t),this.popState("building-integer");break;case"Number & Integer":this.pushState("building-float"),this.astGeneric(e.left,t),t.push(l[e.operator]||e.operator),this.castValueToFloat(e.right,t),this.popState("building-float");break;case"Float & LiteralInteger":case"Number & LiteralInteger":this.isState("in-for-loop-test")?(this.pushState("building-integer"),t.push("int("),this.astGeneric(e.left,t),t.push(")"),t.push(l[e.operator]||e.operator),this.castLiteralToInteger(e.right,t),this.popState("building-integer")):(this.pushState("building-float"),this.astGeneric(e.left,t),t.push(l[e.operator]||e.operator),this.castLiteralToFloat(e.right,t),this.popState("building-float"));break;case"LiteralInteger & Float":case"LiteralInteger & Number":this.isState("in-for-loop-test")||this.isState("in-for-loop-init")||this.isState("casting-to-integer")?(this.pushState("building-integer"),this.castLiteralToInteger(e.left,t),t.push(l[e.operator]||e.operator),this.castValueToInteger(e.right,t),this.popState("building-integer")):(this.pushState("building-float"),this.astGeneric(e.left,t),t.push(l[e.operator]||e.operator),this.pushState("casting-to-float"),this.astGeneric(e.right,t),this.popState("casting-to-float"),this.popState("building-float"));break;case"LiteralInteger & Integer":this.pushState("building-integer"),this.castLiteralToInteger(e.left,t),t.push(l[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-integer");break;case"Boolean & Boolean":this.pushState("building-boolean"),this.astGeneric(e.left,t),t.push(l[e.operator]||e.operator),this.astGeneric(e.right,t),this.popState("building-boolean");break;case"Float & Integer":this.pushState("building-float"),this.astGeneric(e.left,t),t.push(l[e.operator]||e.operator),this.castValueToFloat(e.right,t),this.popState("building-float");break;default:throw this.astErrorOutput("Unhandled binary expression between ".concat(i),e)}return t.push(")"),t}},{key:"checkAndUpconvertOperator",value:function(e,t){var r=this.checkAndUpconvertBitwiseOperators(e,t);if(r)return r;var n={"%":"mod","**":"pow"}[e.operator];if(!n)return null;switch(t.push(n),t.push("("),this.getType(e.left)){case"Integer":this.castValueToFloat(e.left,t);break;case"LiteralInteger":this.castLiteralToFloat(e.left,t);break;default:this.astGeneric(e.left,t)}switch(t.push(","),this.getType(e.right)){case"Integer":this.castValueToFloat(e.right,t);break;case"LiteralInteger":this.castLiteralToFloat(e.right,t);break;default:this.astGeneric(e.right,t)}return t.push(")"),t}},{key:"checkAndUpconvertBitwiseOperators",value:function(e,t){var r={"&":"bitwiseAnd","|":"bitwiseOr","^":"bitwiseXOR","<<":"bitwiseZeroFillLeftShift",">>":"bitwiseSignedRightShift",">>>":"bitwiseZeroFillRightShift"}[e.operator];if(!r)return null;switch(t.push(r),t.push("("),this.getType(e.left)){case"Number":case"Float":this.castValueToInteger(e.left,t);break;case"LiteralInteger":this.castLiteralToInteger(e.left,t);break;default:this.astGeneric(e.left,t)}switch(t.push(","),this.getType(e.right)){case"Number":case"Float":this.castValueToInteger(e.right,t);break;case"LiteralInteger":this.castLiteralToInteger(e.right,t);break;default:this.astGeneric(e.right,t)}return t.push(")"),t}},{key:"checkAndUpconvertBitwiseUnary",value:function(e,t){var r={"~":"bitwiseNot"}[e.operator];if(!r)return null;switch(t.push(r),t.push("("),this.getType(e.argument)){case"Number":case"Float":this.castValueToInteger(e.argument,t);break;case"LiteralInteger":this.castLiteralToInteger(e.argument,t);break;default:this.astGeneric(e.argument,t)}return t.push(")"),t}},{key:"castLiteralToInteger",value:function(e,t){return this.pushState("casting-to-integer"),this.astGeneric(e,t),this.popState("casting-to-integer"),t}},{key:"castLiteralToFloat",value:function(e,t){return this.pushState("casting-to-float"),this.astGeneric(e,t),this.popState("casting-to-float"),t}},{key:"castValueToInteger",value:function(e,t){return this.pushState("casting-to-integer"),t.push("int("),this.astGeneric(e,t),t.push(")"),this.popState("casting-to-integer"),t}},{key:"castValueToFloat",value:function(e,t){return this.pushState("casting-to-float"),t.push("float("),this.astGeneric(e,t),t.push(")"),this.popState("casting-to-float"),t}},{key:"astIdentifierExpression",value:function(e,t){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e);var r=this.getType(e);if("Infinity"===e.name)t.push("3.402823466e+38");else if("Boolean"===r)this.argumentNames.indexOf(e.name)>-1?t.push("bool(user_".concat(e.name,")")):t.push("user_".concat(e.name));else{var n=this.getKernelArgumentName(e.name);n?t.push("user_".concat(n)):t.push("user_".concat(e.name))}return t}},{key:"astForStatement",value:function(e,t){if("ForStatement"!==e.type)throw this.astErrorOutput("Invalid for statement",e);var r=[],n=[],i=[],s=[],a=null;if(e.init){this.pushState("in-for-loop-init"),this.astGeneric(e.init,r);for(var o=e.init.declarations,u=0;u<o.length;u++)o[u].init&&"Literal"!==o[u].init.type&&(a=!1);if(a)for(var c=0;c<r.length;c++)r[c].includes&&r[c].includes(",")&&(a=!1);this.popState("in-for-loop-init")}else a=!1;if(e.test?(this.pushState("in-for-loop-test"),this.astGeneric(e.test,n),this.popState("in-for-loop-test")):a=!1,e.update?this.astGeneric(e.update,i):a=!1,e.body&&(this.pushState("loop-body"),this.astGeneric(e.body,s),this.popState("loop-body")),null===a&&(a=this.isSafe(e.init)&&this.isSafe(e.test)),a)t.push("for (".concat(r.join(""),";").concat(n.join(""),";").concat(i.join(""),"){\n")),t.push(s.join("")),t.push("}\n");else{var l=this.getInternalVariableName("safeI");r.length>0&&t.push(r.join(""),";\n"),t.push("for (int ".concat(l,"=0;").concat(l,"<LOOP_MAX;").concat(l,"++){\n")),n.length>0&&t.push("if (!".concat(n.join(""),") break;\n")),t.push(s.join("")),t.push("\n".concat(i.join(""),";")),t.push("}\n")}return t}},{key:"astWhileStatement",value:function(e,t){if("WhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statement",e);var r=this.getInternalVariableName("safeI");return t.push("for (int ".concat(r,"=0;").concat(r,"<LOOP_MAX;").concat(r,"++){\n")),t.push("if (!"),this.astGeneric(e.test,t),t.push(") break;\n"),this.astGeneric(e.body,t),t.push("}\n"),t}},{key:"astDoWhileStatement",value:function(e,t){if("DoWhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statement",e);var r=this.getInternalVariableName("safeI");return t.push("for (int ".concat(r,"=0;").concat(r,"<LOOP_MAX;").concat(r,"++){\n")),this.astGeneric(e.body,t),t.push("if (!"),this.astGeneric(e.test,t),t.push(") break;\n"),t.push("}\n"),t}},{key:"astAssignmentExpression",value:function(e,t){var r=this.getDeclaration(e.left);if(r&&!r.assignable)throw new this.astErrorOutput("Variable ".concat(e.left.name," is not assignable here"),e);if("%="===e.operator)this.astGeneric(e.left,t),t.push("="),t.push("mod("),this.astGeneric(e.left,t),t.push(","),this.astGeneric(e.right,t),t.push(")");else{if("**="!==e.operator){var n=this.getType(e.left),i=this.getType(e.right);return this.astGeneric(e.left,t),t.push(e.operator),"Integer"!==n&&"Integer"===i?(t.push("float("),this.astGeneric(e.right,t),t.push(")")):this.astGeneric(e.right,t),t}this.astGeneric(e.left,t),t.push("="),t.push("pow("),this.astGeneric(e.left,t),t.push(","),this.astGeneric(e.right,t),t.push(")")}}},{key:"astBlockStatement",value:function(e,t){if(this.isState("loop-body")){this.pushState("block-body");for(var r=0;r<e.body.length;r++)this.astGeneric(e.body[r],t);this.popState("block-body")}else{t.push("{\n");for(var n=0;n<e.body.length;n++)this.astGeneric(e.body[n],t);t.push("}\n")}return t}},{key:"astVariableDeclaration",value:function(e,t){"var"===e.kind&&this.warnVarUsage&&this.varWarn();var r=e.declarations;if(!r||!r[0]||!r[0].init)throw this.astErrorOutput("Unexpected expression",e);for(var n=[],i=null,s=this.isState("in-for-loop-init"),a=0;a<r.length;a++){var o=r[a],u=o.init,l=this.getDeclaration(o.id),h=(l.valueType,this.getType(o.init)),p=(l.dependencies,s?"Integer":h);"LiteralInteger"===p&&(p="Number");var f=c[p];if(!f)throw this.astErrorOutput("Markup type ".concat(f," not handled"),e);var d=[];if("Integer"!==h||"Integer"!==p||s)l.valueType=p,0===a||null===i?d.push("".concat(f," ")):p!==i?(n.push(";"),d.push("".concat(f," "))):d.push(","),i=p,d.push("user_".concat(o.id.name,"=")),"Number"===h&&"Integer"===p?u.left&&"Literal"===u.left.type?this.astGeneric(u,d):(d.push("int("),this.astGeneric(u,d),d.push(")")):this.astGeneric(u,d);else{if(l.valueType="Number",0===a||null===i)d.push("float ");else{if(p!==i)throw new Error("Unhandled declaration");d.push(",")}i=p,d.push("user_".concat(o.id.name,"=")),d.push("float("),this.astGeneric(u,d),d.push(")")}n.push(d.join(""))}return t.push(n.join("")),s||t.push(";"),t}},{key:"astIfStatement",value:function(e,t){return t.push("if ("),this.astGeneric(e.test,t),t.push(")"),"BlockStatement"===e.consequent.type?this.astGeneric(e.consequent,t):(t.push(" {\n"),this.astGeneric(e.consequent,t),t.push("\n}\n")),e.alternate&&(t.push("else "),"BlockStatement"===e.alternate.type?this.astGeneric(e.alternate,t):(t.push(" {\n"),this.astGeneric(e.alternate,t),t.push("\n}\n"))),t}},{key:"astSwitchStatement",value:function(e,t){if("SwitchStatement"!==e.type)throw this.astErrorOutput("Invalid switch statement",e);var r=e.discriminant,n=e.cases,i=this.getType(r),s="switchDiscriminant".concat(e.start,"_").concat(e.end);switch(i){case"Float":case"Number":t.push("float ".concat(s," = ")),this.astGeneric(r,t),t.push(";\n");break;case"Integer":t.push("int ".concat(s," = ")),this.astGeneric(r,t),t.push(";\n")}if(1===n.length&&!n[0].test)return this.astGeneric(n[0].consequent,t),t;for(var a=!1,o=[],u=!1,c=!1,l=0;l<n.length;l++){if(n[l].test){if(0!==l&&c?a?(t.push("".concat(s," == ")),a=!1):t.push(" else if (".concat(s," == ")):(c=!0,t.push("if (".concat(s," == "))),"Integer"===i){switch(this.getType(n[l].test)){case"Number":case"Float":this.castValueToInteger(n[l].test,t);break;case"LiteralInteger":this.castLiteralToInteger(n[l].test,t)}}else{if("Float"!==i)throw new Error("unhanlded");switch(this.getType(n[l].test)){case"LiteralInteger":this.castLiteralToFloat(n[l].test,t);break;case"Integer":this.castValueToFloat(n[l].test,t)}}if(!n[l].consequent||0===n[l].consequent.length){a=!0,t.push(" || ");continue}t.push(") {\n")}else{if(n.length>l+1){u=!0,this.astGeneric(n[l].consequent,o);continue}t.push(" else {\n")}this.astGeneric(n[l].consequent,t),t.push("\n}")}return u&&(t.push(" else {"),t.push(o.join("")),t.push("}")),t}},{key:"astThisExpression",value:function(e,t){return t.push("this"),t}},{key:"astMemberExpression",value:function(e,t){var r=this.getMemberExpressionDetails(e),n=r.property,i=r.name,s=r.signature,a=r.origin,o=r.type,u=r.xProperty,c=r.yProperty,l=r.zProperty;switch(s){case"value.thread.value":case"this.thread.value":if("x"!==i&&"y"!==i&&"z"!==i)throw this.astErrorOutput("Unexpected expression, expected `this.thread.x`, `this.thread.y`, or `this.thread.z`",e);return t.push("threadId.".concat(i)),t;case"this.output.value":if(this.dynamicOutput)switch(i){case"x":this.isState("casting-to-float")?t.push("float(uOutputDim.x)"):t.push("uOutputDim.x");break;case"y":this.isState("casting-to-float")?t.push("float(uOutputDim.y)"):t.push("uOutputDim.y");break;case"z":this.isState("casting-to-float")?t.push("float(uOutputDim.z)"):t.push("uOutputDim.z");break;default:throw this.astErrorOutput("Unexpected expression",e)}else switch(i){case"x":this.isState("casting-to-integer")?t.push(this.output[0]):t.push(this.output[0],".0");break;case"y":this.isState("casting-to-integer")?t.push(this.output[1]):t.push(this.output[1],".0");break;case"z":this.isState("casting-to-integer")?t.push(this.output[2]):t.push(this.output[2],".0");break;default:throw this.astErrorOutput("Unexpected expression",e)}return t;case"value":throw this.astErrorOutput("Unexpected expression",e);case"value[]":case"value[][]":case"value[][][]":case"value[][][][]":case"value.value":if("Math"===a)return t.push(Math[i]),t;switch(n){case"r":return t.push("user_".concat(i,".r")),t;case"g":return t.push("user_".concat(i,".g")),t;case"b":return t.push("user_".concat(i,".b")),t;case"a":return t.push("user_".concat(i,".a")),t}break;case"this.constants.value":if("undefined"===typeof u)switch(o){case"Array(2)":case"Array(3)":case"Array(4)":return t.push("constants_".concat(i)),t}case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":case"this.constants.value[][][][]":break;case"fn()[]":return this.astCallExpression(e.object,t),t.push("["),t.push(this.memberExpressionPropertyMarkup(n)),t.push("]"),t;case"[][]":return this.astArrayExpression(e.object,t),t.push("["),t.push(this.memberExpressionPropertyMarkup(n)),t.push("]"),t;default:throw this.astErrorOutput("Unexpected expression",e)}if(!1===e.computed)switch(o){case"Number":case"Integer":case"Float":case"Boolean":return t.push("".concat(a,"_").concat(i)),t}var h=this.getKernelArgumentName(i),p="".concat(a,"_").concat(h||i);switch(o){case"Array(2)":case"Array(3)":case"Array(4)":this.astGeneric(e.object,t),t.push("["),t.push(this.memberExpressionPropertyMarkup(u)),t.push("]");break;case"HTMLImageArray":t.push("getImage3D(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, ")),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"ArrayTexture(1)":t.push("getFloatFromSampler2D(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, ")),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"Array1D(2)":case"Array2D(2)":case"Array3D(2)":t.push("getMemoryOptimizedVec2(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, ")),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"ArrayTexture(2)":t.push("getVec2FromSampler2D(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, ")),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"Array1D(3)":case"Array2D(3)":case"Array3D(3)":t.push("getMemoryOptimizedVec3(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, ")),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"ArrayTexture(3)":t.push("getVec3FromSampler2D(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, ")),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"Array1D(4)":case"Array2D(4)":case"Array3D(4)":t.push("getMemoryOptimizedVec4(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, ")),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"ArrayTexture(4)":case"HTMLImage":t.push("getVec4FromSampler2D(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, ")),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;case"NumberTexture":case"Array":case"Array2D":case"Array3D":case"Array4D":case"Input":case"Number":case"Float":case"Integer":if("single"===this.precision)t.push("getMemoryOptimized32(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, ")),this.memberExpressionXYZ(u,c,l,t),t.push(")");else{var f="user"===a?this.lookupFunctionArgumentBitRatio(this.name,i):this.constantBitRatios[i];switch(f){case 1:t.push("get8(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, "));break;case 2:t.push("get16(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, "));break;case 4:case 0:t.push("get32(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, "));break;default:throw new Error("unhandled bit ratio of ".concat(f))}this.memberExpressionXYZ(u,c,l,t),t.push(")")}break;case"MemoryOptimizedNumberTexture":t.push("getMemoryOptimized32(".concat(p,", ").concat(p,"Size, ").concat(p,"Dim, ")),this.memberExpressionXYZ(u,c,l,t),t.push(")");break;default:throw new Error('unhandled member expression "'.concat(o,'"'))}return t}},{key:"astCallExpression",value:function(e,t){if(!e.callee)throw this.astErrorOutput("Unknown CallExpression",e);var r=null,n=this.isAstMathFunction(e);if(!(r=n||e.callee.object&&"ThisExpression"===e.callee.object.type?e.callee.property.name:"SequenceExpression"!==e.callee.type||"Literal"!==e.callee.expressions[0].type||isNaN(e.callee.expressions[0].raw)?e.callee.name:e.callee.expressions[1].property.name))throw this.astErrorOutput("Unhandled function, couldn't find name",e);if("atan2"===r&&(r="atan"),this.calledFunctions.indexOf(r)<0&&this.calledFunctions.push(r),"random"===r&&this.plugins&&this.plugins.length>0)for(var i=0;i<this.plugins.length;i++){var s=this.plugins[i];if("Math.random()"===s.functionMatch&&s.functionReplace)return t.push(s.functionReplace),t}if(this.onFunctionCall&&this.onFunctionCall(this.name,r,e.arguments),t.push(r),t.push("("),n)for(var a=0;a<e.arguments.length;++a){var o=e.arguments[a],u=this.getType(o);switch(a>0&&t.push(", "),u){case"Integer":this.castValueToFloat(o,t);break;default:this.astGeneric(o,t)}}else for(var c=this.lookupFunctionArgumentTypes(r)||[],l=0;l<e.arguments.length;++l){var h=e.arguments[l],p=c[l];l>0&&t.push(", ");var f=this.getType(h);switch(p||(this.triggerImplyArgumentType(r,l,f,this),p=f),f){case"Number":case"Float":if("Integer"===p){t.push("int("),this.astGeneric(h,t),t.push(")");continue}if("Number"===p||"Float"===p){this.astGeneric(h,t);continue}if("LiteralInteger"===p){this.castLiteralToFloat(h,t);continue}break;case"Integer":if("Number"===p||"Float"===p){t.push("float("),this.astGeneric(h,t),t.push(")");continue}if("Integer"===p){this.astGeneric(h,t);continue}break;case"LiteralInteger":if("Integer"===p){this.castLiteralToInteger(h,t);continue}if("Number"===p||"Float"===p){this.castLiteralToFloat(h,t);continue}if("LiteralInteger"===p){this.astGeneric(h,t);continue}break;case"Array(2)":case"Array(3)":case"Array(4)":if(p===f){this.astGeneric(h,t);continue}break;case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"Array":case"Input":if(p===f){this.triggerTrackArgumentSynonym(this.name,h.name,r,l),this.astGeneric(h,t);continue}}throw this.astErrorOutput("Unhandled argument combination of ".concat(f," and ").concat(p,' for argument named "').concat(h.name,'"'),e)}return t.push(")"),t}},{key:"astArrayExpression",value:function(e,t){var r=e.elements.length;t.push("vec"+r+"(");for(var n=0;n<r;++n){n>0&&t.push(", ");var i=e.elements[n];this.astGeneric(i,t)}return t.push(")"),t}},{key:"memberExpressionXYZ",value:function(e,t,r,n){return r?n.push(this.memberExpressionPropertyMarkup(r),", "):n.push("0, "),t?n.push(this.memberExpressionPropertyMarkup(t),", "):n.push("0, "),n.push(this.memberExpressionPropertyMarkup(e)),n}},{key:"memberExpressionPropertyMarkup",value:function(e){if(!e)throw new Error("Property not set");var t=[];switch(this.getType(e)){case"Number":case"Float":this.castValueToInteger(e,t);break;case"LiteralInteger":this.castLiteralToInteger(e,t);break;default:this.astGeneric(e,t)}return t.join("")}}]),t}(r(18).FunctionNode)),c={Array:"sampler2D","Array(2)":"vec2","Array(3)":"vec3","Array(4)":"vec4",Array2D:"sampler2D",Array3D:"sampler2D",Boolean:"bool",Float:"float",Input:"sampler2D",Integer:"int",Number:"float",LiteralInteger:"float",NumberTexture:"sampler2D",MemoryOptimizedNumberTexture:"sampler2D","ArrayTexture(1)":"sampler2D","ArrayTexture(2)":"sampler2D","ArrayTexture(3)":"sampler2D","ArrayTexture(4)":"sampler2D"},l={"===":"==","!==":"!="};e.exports={WebGLFunctionNode:u}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e,r){var i;n(this,t),i=s(this,a(t).call(this,e,r));var o=e.width,u=e.height;return i.dimensions=[o,u,1],i.requestTexture(),i.textureSize=[o,u],i.uploadValue=e,i}return o(t,e),i(t,[{key:"getStringValueHandler",value:function(){return"const uploadValue_".concat(this.name," = ").concat(this.varName,";\n")}},{key:"getSource",value:function(){return u.linesToString(["uniform sampler2D ".concat(this.id),"ivec2 ".concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"ivec3 ".concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.uploadValue=e),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(7).WebGLKernelValue);e.exports={WebGLKernelValueHTMLImage:c}},function(e,t,r){var n=r(10),i=r(0),s=r(1),a=r(3),o=r(2),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(e,r){var s;i(this,t),(s=a(this,o(t).call(this,e,r))).requestTexture(),s.bitRatio=4;var u=n(e.size,3),l=u[0],h=u[1],p=u[2];return s.dimensions=new Int32Array([l||1,h||1,p||1]),s.textureSize=c.getMemoryOptimizedFloatTextureSize(s.dimensions,s.bitRatio),s.uploadArrayLength=s.textureSize[0]*s.textureSize[1]*s.bitRatio,s.uploadValue=new Float32Array(s.uploadArrayLength),s}return u(t,e),s(t,[{key:"getStringValueHandler",value:function(){return c.linesToString(["const uploadValue_".concat(this.name," = new Float32Array(").concat(this.uploadArrayLength,")"),"flattenTo(".concat(this.varName,".value, uploadValue_").concat(this.name,")")])}},{key:"getSource",value:function(){return c.linesToString(["uniform sampler2D ".concat(this.id),"ivec2 ".concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"ivec3 ".concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;c.flattenTo(e.value,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(7).WebGLKernelValue);e.exports={WebGLKernelValueSingleInput:l}},function(e,t,r){var n=r(10),i=r(0),s=r(1),a=r(3),o=r(2),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(e,r){var s;i(this,t),(s=a(this,o(t).call(this,e,r))).requestTexture(),s.bitRatio=s.getBitRatio(e);var u=n(e.size,3),l=u[0],h=u[1],p=u[2];return s.dimensions=new Int32Array([l||1,h||1,p||1]),s.textureSize=c.getMemoryOptimizedPackedTextureSize(s.dimensions,s.bitRatio),s.uploadArrayLength=s.textureSize[0]*s.textureSize[1]*(4/s.bitRatio),s.TranserArrayType=s.getTransferArrayType(e.value),s.preUploadValue=new s.TranserArrayType(s.uploadArrayLength),s.uploadValue=new Uint8Array(s.preUploadValue.buffer),s}return u(t,e),s(t,[{key:"getStringValueHandler",value:function(){return c.linesToString(["const preUploadValue_".concat(this.name," = new ").concat(this.TranserArrayType.name,"(").concat(this.uploadArrayLength,")"),"const uploadValue_".concat(this.name," = new Uint8Array(preUploadValue_").concat(this.name,".buffer)"),"flattenTo(".concat(this.varName,".value, preUploadValue_").concat(this.name,")")])}},{key:"getSource",value:function(){return c.linesToString(["uniform sampler2D ".concat(this.id),"ivec2 ".concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"ivec3 ".concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;c.flattenTo(e.value,this.preUploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(7).WebGLKernelValue);e.exports={WebGLKernelValueUnsignedInput:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).setupTexture(),i.dimensions=e.dimensions,i.textureSize=e.size,i.uploadValue=e.texture,i}return o(t,e),i(t,[{key:"getStringValueHandler",value:function(){return"const uploadValue_".concat(this.name," = ").concat(this.varName,".texture;\n")}},{key:"getSource",value:function(){return u.linesToString(["uniform sampler2D ".concat(this.id),"ivec2 ".concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"ivec3 ".concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){if(this.checkContext&&e.context!==this.context)throw new Error("Value ".concat(this.name," (").concat(this.type,") must be from same context"));var t=this.context;t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.uploadValue=e.texture),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(7).WebGLKernelValue);e.exports={WebGLKernelValueMemoryOptimizedNumberTexture:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e,r){var i;n(this,t),(i=s(this,a(t).call(this,e,r))).setupTexture();var o=e.size,u=e.dimensions;return i.bitRatio=i.getBitRatio(e),i.dimensions=u,i.textureSize=o,i.uploadValue=e.texture,i}return o(t,e),i(t,[{key:"getStringValueHandler",value:function(){return"const uploadValue_".concat(this.name," = ").concat(this.varName,".texture;\n")}},{key:"getSource",value:function(){return u.linesToString(["uniform sampler2D ".concat(this.id),"ivec2 ".concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"ivec3 ".concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){if(this.checkContext&&e.context!==this.context)throw new Error("Value ".concat(this.name," (").concat(this.type,") must be from same context"));var t=this.context;t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.uploadValue=e.texture),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(7).WebGLKernelValue);e.exports={WebGLKernelValueNumberTexture:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).requestTexture(),i.bitRatio=4,i.dimensions=u.getDimensions(e,!0),i.textureSize=u.getMemoryOptimizedFloatTextureSize(i.dimensions,i.bitRatio),i.uploadArrayLength=i.textureSize[0]*i.textureSize[1]*i.bitRatio,i.uploadValue=new Float32Array(i.uploadArrayLength),i}return o(t,e),i(t,[{key:"getStringValueHandler",value:function(){return u.linesToString(["const uploadValue_".concat(this.name," = new Float32Array(").concat(this.uploadArrayLength,")"),"flattenTo(".concat(this.varName,", uploadValue_").concat(this.name,")")])}},{key:"getSource",value:function(){return u.linesToString(["uniform sampler2D ".concat(this.id),"ivec2 ".concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"ivec3 ".concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;u.flattenTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(7).WebGLKernelValue);e.exports={WebGLKernelValueSingleArray:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).requestTexture(),i.bitRatio=4,i.setShape(e),i}return o(t,e),i(t,[{key:"setShape",value:function(e){var t=u.getDimensions(e,!0);this.textureSize=u.getMemoryOptimizedFloatTextureSize(t,this.bitRatio),this.dimensions=new Int32Array([t[1],1,1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.uploadValue=new Float32Array(this.uploadArrayLength)}},{key:"getStringValueHandler",value:function(){return u.linesToString(["const uploadValue_".concat(this.name," = new Float32Array(").concat(this.uploadArrayLength,")"),"flattenTo(".concat(this.varName,", uploadValue_").concat(this.name,")")])}},{key:"getSource",value:function(){return u.linesToString(["uniform sampler2D ".concat(this.id),"ivec2 ".concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"ivec3 ".concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;u.flatten2dArrayTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(7).WebGLKernelValue);e.exports={WebGLKernelValueSingleArray1DI:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).requestTexture(),i.bitRatio=4,i.setShape(e),i}return o(t,e),i(t,[{key:"setShape",value:function(e){var t=u.getDimensions(e,!0);this.textureSize=u.getMemoryOptimizedFloatTextureSize(t,this.bitRatio),this.dimensions=new Int32Array([t[1],t[2],1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.uploadValue=new Float32Array(this.uploadArrayLength)}},{key:"getStringValueHandler",value:function(){return u.linesToString(["const uploadValue_".concat(this.name," = new Float32Array(").concat(this.uploadArrayLength,")"),"flattenTo(".concat(this.varName,", uploadValue_").concat(this.name,")")])}},{key:"getSource",value:function(){return u.linesToString(["uniform sampler2D ".concat(this.id),"ivec2 ".concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"ivec3 ".concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;u.flatten3dArrayTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(7).WebGLKernelValue);e.exports={WebGLKernelValueSingleArray2DI:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).requestTexture(),i.bitRatio=4,i.setShape(e),i}return o(t,e),i(t,[{key:"setShape",value:function(e){var t=u.getDimensions(e,!0);this.textureSize=u.getMemoryOptimizedFloatTextureSize(t,this.bitRatio),this.dimensions=new Int32Array([t[1],t[2],t[3]]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.uploadValue=new Float32Array(this.uploadArrayLength)}},{key:"getStringValueHandler",value:function(){return u.linesToString(["const uploadValue_".concat(this.name," = new Float32Array(").concat(this.uploadArrayLength,")"),"flattenTo(".concat(this.varName,", uploadValue_").concat(this.name,")")])}},{key:"getSource",value:function(){return u.linesToString(["uniform sampler2D ".concat(this.id),"ivec2 ".concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"ivec3 ".concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;u.flatten4dArrayTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(7).WebGLKernelValue);e.exports={WebGLKernelValueSingleArray3DI:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).requestTexture(),i.bitRatio=i.getBitRatio(e),i.dimensions=u.getDimensions(e,!0),i.textureSize=u.getMemoryOptimizedPackedTextureSize(i.dimensions,i.bitRatio),i.uploadArrayLength=i.textureSize[0]*i.textureSize[1]*(4/i.bitRatio),i.TranserArrayType=i.getTransferArrayType(e),i.preUploadValue=new i.TranserArrayType(i.uploadArrayLength),i.uploadValue=new Uint8Array(i.preUploadValue.buffer),i}return o(t,e),i(t,[{key:"getStringValueHandler",value:function(){return u.linesToString(["const preUploadValue_".concat(this.name," = new ").concat(this.TranserArrayType.name,"(").concat(this.uploadArrayLength,")"),"const uploadValue_".concat(this.name," = new Uint8Array(preUploadValue_").concat(this.name,".buffer)"),"flattenTo(".concat(this.varName,", preUploadValue_").concat(this.name,")")])}},{key:"getSource",value:function(){return u.linesToString(["uniform sampler2D ".concat(this.id),"ivec2 ".concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"ivec3 ".concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;u.flattenTo(e,this.preUploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(7).WebGLKernelValue);e.exports={WebGLKernelValueUnsignedArray:c}},function(e,t,r){var n=r(0),i=r(1),s=r(65).gpuMock,a=r(5).utils,o=r(33).CPUKernel,u=r(36).HeadlessGLKernel,c=r(56).WebGL2Kernel,l=r(15).WebGLKernel,h=r(164).kernelRunShortcut,p=[u,c,l],f=["gpu","cpu"],d={headlessgl:u,webgl2:c,webgl:l},m=!0,g=function(){"use strict";function e(t){if(n(this,e),t=t||{},this.canvas=t.canvas||null,this.context=t.context||null,this.mode=t.mode,this.Kernel=null,this.kernels=[],this.functions=[],this.nativeFunctions=[],"dev"!==this.mode){if(this.chooseKernel(),t.functions)for(var r=0;r<t.functions.length;r++)this.addFunction(t.functions[r]);if(t.nativeFunctions)for(var i in t.nativeFunctions)this.addNativeFunction(i,t.nativeFunctions[i])}}return i(e,null,[{key:"disableValidation",value:function(){m=!1}},{key:"enableValidation",value:function(){m=!0}},{key:"isGPUSupported",get:function(){return p.some((function(e){return e.isSupported}))}},{key:"isKernelMapSupported",get:function(){return p.some((function(e){return e.isSupported&&e.features.kernelMap}))}},{key:"isOffscreenCanvasSupported",get:function(){return"undefined"!==typeof Worker&&"undefined"!==typeof OffscreenCanvas||"undefined"!==typeof importScripts}},{key:"isWebGLSupported",get:function(){return l.isSupported}},{key:"isWebGL2Supported",get:function(){return c.isSupported}},{key:"isHeadlessGLSupported",get:function(){return u.isSupported}},{key:"isCanvasSupported",get:function(){return"undefined"!==typeof HTMLCanvasElement}},{key:"isGPUHTMLImageArraySupported",get:function(){return c.isSupported}},{key:"isSinglePrecisionSupported",get:function(){return p.some((function(e){return e.isSupported&&e.features.isFloatRead&&e.features.isTextureFloat}))}}]),i(e,[{key:"chooseKernel",value:function(){if(!this.Kernel){var e=null;if(this.context){for(var t=0;t<p.length;t++){var r=p[t];if(r.isContextMatch(this.context)){if(!r.isSupported)throw new Error("Kernel type ".concat(r.name," not supported"));e=r;break}}if(null===e)throw new Error("unknown Context")}else if(this.mode){if(this.mode in d)m&&!d[this.mode].isSupported||(e=d[this.mode]);else if("gpu"===this.mode){for(var n=0;n<p.length;n++)if(p[n].isSupported){e=p[n];break}}else"cpu"===this.mode&&(e=o);if(!e)throw new Error('A requested mode of "'.concat(this.mode,'" and is not supported'))}else{for(var i=0;i<p.length;i++)if(p[i].isSupported){e=p[i];break}e||(e=o)}this.mode||(this.mode=e.mode),this.Kernel=e}}},{key:"createKernel",value:function(e,t){if("undefined"===typeof e)throw new Error("Missing source parameter");if("object"!==typeof e&&!a.isFunction(e)&&"string"!==typeof e)throw new Error("source parameter not a function");if("dev"===this.mode){var r=s(e,y(t));return this.kernels.push(r),r}e="function"===typeof e?e.toString():e;var n={},i=y(t)||{};function u(t){var r=new o(e,{argumentTypes:l.argumentTypes,constantTypes:l.constantTypes,graphical:l.graphical,loopMaxIterations:l.loopMaxIterations,constants:l.constants,dynamicOutput:l.dynamicOutput,dynamicArgument:l.dynamicArguments,output:l.output,precision:l.precision,pipeline:l.pipeline,immutable:l.immutable,optimizeFloatMemory:l.optimizeFloatMemory,fixIntegerDivisionAccuracy:l.fixIntegerDivisionAccuracy,functions:l.functions,nativeFunctions:l.nativeFunctions,subKernels:l.subKernels,strictIntegers:l.strictIntegers,debug:l.debug,warnVarUsage:l.warnVarUsage});r.build.apply(r,t);var n=r.run.apply(r,t);return l.replaceKernel(r),n}t&&"object"===typeof t.argumentTypes&&(i.argumentTypes=Object.keys(t.argumentTypes).map((function(e){return t.argumentTypes[e]})));var c=Object.assign({context:this.context,canvas:this.canvas,functions:this.functions,nativeFunctions:this.nativeFunctions,gpu:this,validate:m,onRequestFallback:u,onRequestSwitchKernel:function t(r,i){for(var s=new Array(r.length),o=0;o<r.length;o++){var c=r[o],h=i.argumentTypes[o];if(c.type)s[o]=c.type;else switch(h){case"Number":case"Integer":case"Float":case"ArrayTexture(1)":s[o]=a.getVariableType(c);break;default:s[o]=h}}var p=s.join(","),f=n[p];if(f)return f.run.apply(f,r),f.renderKernels?f.renderKernels():f.renderOutput();var d=n[p]=new i.constructor(e,{argumentTypes:s,constantTypes:i.constantTypes,graphical:i.graphical,loopMaxIterations:i.loopMaxIterations,constants:i.constants,dynamicOutput:i.dynamicOutput,dynamicArgument:i.dynamicArguments,context:i.context,canvas:i.canvas,output:i.output,precision:i.precision,pipeline:i.pipeline,immutable:i.immutable,optimizeFloatMemory:i.optimizeFloatMemory,fixIntegerDivisionAccuracy:i.fixIntegerDivisionAccuracy,functions:i.functions,nativeFunctions:i.nativeFunctions,subKernels:i.subKernels,strictIntegers:i.strictIntegers,debug:i.debug,gpu:i.gpu,validate:m,warnVarUsage:i.warnVarUsage,returnType:i.returnType,onRequestFallback:u,onRequestSwitchKernel:t});return d.build.apply(d,r),d.run.apply(d,r),l.replaceKernel(d),d.renderKernels?d.renderKernels():d.renderOutput()}},i),l=h(new this.Kernel(e,c));return this.canvas||(this.canvas=l.canvas),this.context||(this.context=l.context),this.kernels.push(l),l}},{key:"createKernelMap",value:function(){var e,t;if("function"===typeof arguments[arguments.length-2]?(e=arguments[arguments.length-2],t=arguments[arguments.length-1]):e=arguments[arguments.length-1],"dev"!==this.mode&&(!this.Kernel.isSupported||!this.Kernel.features.kernelMap)&&this.mode&&f.indexOf(this.mode)<0)throw new Error("kernelMap not supported on ".concat(this.Kernel.name));var r=y(t);if(t&&"object"===typeof t.argumentTypes&&(r.argumentTypes=Object.keys(t.argumentTypes).map((function(e){return t.argumentTypes[e]}))),Array.isArray(arguments[0])){r.subKernels=[];for(var n=arguments[0],i=0;i<n.length;i++){var s=n[i].toString(),o=a.getFunctionNameFromString(s);r.subKernels.push({name:o,source:s,property:i})}}else{r.subKernels=[];var u=arguments[0];for(var c in u)if(u.hasOwnProperty(c)){var l=u[c].toString(),h=a.getFunctionNameFromString(l);r.subKernels.push({name:h||c,source:l,property:c})}}var p=this.createKernel(e,r);return p}},{key:"combineKernels",value:function(){var e=arguments[0],t=arguments[arguments.length-1];if("cpu"===e.kernel.constructor.mode)return t;for(var r=arguments[0].canvas,n=arguments[0].context,i=arguments.length-1,s=0;s<i;s++)arguments[s].setCanvas(r).setContext(n).setPipeline(!0);return function(){var e=t.apply(this,arguments);return e.toArray?e.toArray():e}}},{key:"addFunction",value:function(e,t){return this.functions.push(a.functionToIFunction(e,t)),this}},{key:"addNativeFunction",value:function(e,t,r){if(this.kernels.length>0)throw new Error('Cannot call "addNativeFunction" after "createKernels" has been called.');r=r||{};var n=this.Kernel.nativeFunctionArguments(t)||{},i=n.argumentTypes,s=n.argumentNames;return this.nativeFunctions.push({name:e,source:t,settings:r,argumentTypes:i,argumentNames:s,returnType:r.returnType||this.Kernel.nativeFunctionReturnType(t)}),this}},{key:"destroy",value:function(){var e=this;this.kernels&&setTimeout((function(){for(var t=0;t<e.kernels.length;t++)e.kernels[t].destroy(!0);var r=e.kernels[0];r&&(r.kernel&&(r=r.kernel),r.constructor.destroyContext&&r.constructor.destroyContext(e.context))}),0)}}]),e}();function y(e){if(!e)return{};var t=Object.assign({},e);return e.hasOwnProperty("floatOutput")&&(a.warnDeprecated("setting","floatOutput","precision"),t.precision=e.floatOutput?"single":"unsigned"),e.hasOwnProperty("outputToTexture")&&(a.warnDeprecated("setting","outputToTexture","pipeline"),t.pipeline=Boolean(e.outputToTexture)),e.hasOwnProperty("outputImmutable")&&(a.warnDeprecated("setting","outputImmutable","immutable"),t.immutable=Boolean(e.outputImmutable)),e.hasOwnProperty("floatTextures")&&(a.warnDeprecated("setting","floatTextures","optimizeFloatMemory"),t.optimizeFloatMemory=Boolean(e.floatTextures)),t}e.exports={GPU:g,kernelOrder:p,kernelTypes:f}},function(e,t,r){"use strict";r.r(t),r.d(t,"version",(function(){return Se})),r.d(t,"parse",(function(){return Ie})),r.d(t,"parseExpressionAt",(function(){return ke})),r.d(t,"tokenizer",(function(){return Re})),r.d(t,"parse_dammit",(function(){return Ee})),r.d(t,"LooseParser",(function(){return Ae})),r.d(t,"pluginsLoose",(function(){return be})),r.d(t,"addLooseExports",(function(){return Le})),r.d(t,"Parser",(function(){return B})),r.d(t,"plugins",(function(){return U})),r.d(t,"defaultOptions",(function(){return P})),r.d(t,"Position",(function(){return C})),r.d(t,"SourceLocation",(function(){return F})),r.d(t,"getLineInfo",(function(){return O})),r.d(t,"Node",(function(){return ee})),r.d(t,"TokenType",(function(){return g})),r.d(t,"tokTypes",(function(){return E})),r.d(t,"keywordTypes",(function(){return v})),r.d(t,"TokContext",(function(){return ne})),r.d(t,"tokContexts",(function(){return ie})),r.d(t,"isIdentifierChar",(function(){return m})),r.d(t,"isIdentifierStart",(function(){return d})),r.d(t,"Token",(function(){return _e})),r.d(t,"isNewLine",(function(){return S})),r.d(t,"lineBreak",(function(){return A})),r.d(t,"lineBreakG",(function(){return b})),r.d(t,"nonASCIIwhitespace",(function(){return I}));var n={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},i="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",s={5:i,6:i+" const class extends export import super"},a=/^in(stanceof)?$/,o="\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0560-\u0588\u05d0-\u05ea\u05ef-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u0860-\u086a\u08a0-\u08b4\u08b6-\u08bd\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u09fc\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0af9\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58-\u0c5a\u0c60\u0c61\u0c80\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d54-\u0d56\u0d5f-\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f5\u13f8-\u13fd\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1878\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1c80-\u1c88\u1c90-\u1cba\u1cbd-\u1cbf\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2118-\u211d\u2124\u2126\u2128\u212a-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309b-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312f\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fef\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua7b9\ua7f7-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua8fd\ua8fe\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab65\uab70-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc",u="\u200c\u200d\xb7\u0300-\u036f\u0387\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u07fd\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08d3-\u08e1\u08e3-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u09fe\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0afa-\u0aff\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c00-\u0c04\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c81-\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d00-\u0d03\u0d3b\u0d3c\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0de6-\u0def\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19d0-\u19da\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1ab0-\u1abd\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1cf7-\u1cf9\u1dc0-\u1df9\u1dfb-\u1dff\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69e\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c5\ua8d0-\ua8d9\ua8e0-\ua8f1\ua8ff-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\ua9e5\ua9f0-\ua9f9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b-\uaa7d\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe2f\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f",c=new RegExp("["+o+"]"),l=new RegExp("["+o+u+"]");o=u=null;var h=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,477,28,11,0,9,21,190,52,76,44,33,24,27,35,30,0,12,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,26,230,43,117,63,32,0,257,0,11,39,8,0,22,0,12,39,3,3,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,270,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,68,12,0,67,12,65,1,31,6129,15,754,9486,286,82,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],p=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,525,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,4,9,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,280,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239];function f(e,t){for(var r=65536,n=0;n<t.length;n+=2){if((r+=t[n])>e)return!1;if((r+=t[n+1])>=e)return!0}}function d(e,t){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&c.test(String.fromCharCode(e)):!1!==t&&f(e,h)))}function m(e,t){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&l.test(String.fromCharCode(e)):!1!==t&&(f(e,h)||f(e,p)))))}var g=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function y(e,t){return new g(e,{beforeExpr:!0,binop:t})}var _={beforeExpr:!0},x={startsExpr:!0},v={};function T(e,t){return void 0===t&&(t={}),t.keyword=e,v[e]=new g(e,t)}var E={num:new g("num",x),regexp:new g("regexp",x),string:new g("string",x),name:new g("name",x),eof:new g("eof"),bracketL:new g("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new g("]"),braceL:new g("{",{beforeExpr:!0,startsExpr:!0}),braceR:new g("}"),parenL:new g("(",{beforeExpr:!0,startsExpr:!0}),parenR:new g(")"),comma:new g(",",_),semi:new g(";",_),colon:new g(":",_),dot:new g("."),question:new g("?",_),arrow:new g("=>",_),template:new g("template"),invalidTemplate:new g("invalidTemplate"),ellipsis:new g("...",_),backQuote:new g("`",x),dollarBraceL:new g("${",{beforeExpr:!0,startsExpr:!0}),eq:new g("=",{beforeExpr:!0,isAssign:!0}),assign:new g("_=",{beforeExpr:!0,isAssign:!0}),incDec:new g("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new g("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:y("||",1),logicalAND:y("&&",2),bitwiseOR:y("|",3),bitwiseXOR:y("^",4),bitwiseAND:y("&",5),equality:y("==/!=/===/!==",6),relational:y("</>/<=/>=",7),bitShift:y("<</>>/>>>",8),plusMin:new g("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:y("%",10),star:y("*",10),slash:y("/",10),starstar:new g("**",{beforeExpr:!0}),_break:T("break"),_case:T("case",_),_catch:T("catch"),_continue:T("continue"),_debugger:T("debugger"),_default:T("default",_),_do:T("do",{isLoop:!0,beforeExpr:!0}),_else:T("else",_),_finally:T("finally"),_for:T("for",{isLoop:!0}),_function:T("function",x),_if:T("if"),_return:T("return",_),_switch:T("switch"),_throw:T("throw",_),_try:T("try"),_var:T("var"),_const:T("const"),_while:T("while",{isLoop:!0}),_with:T("with"),_new:T("new",{beforeExpr:!0,startsExpr:!0}),_this:T("this",x),_super:T("super",x),_class:T("class",x),_extends:T("extends",_),_export:T("export"),_import:T("import"),_null:T("null",x),_true:T("true",x),_false:T("false",x),_in:T("in",{beforeExpr:!0,binop:7}),_instanceof:T("instanceof",{beforeExpr:!0,binop:7}),_typeof:T("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:T("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:T("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},A=/\r\n?|\n|\u2028|\u2029/,b=new RegExp(A.source,"g");function S(e,t){return 10===e||13===e||!t&&(8232===e||8233===e)}var I=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,k=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,R=Object.prototype,L=R.hasOwnProperty,w=R.toString;function D(e,t){return L.call(e,t)}var N=Array.isArray||function(e){return"[object Array]"===w.call(e)},C=function(e,t){this.line=e,this.column=t};C.prototype.offset=function(e){return new C(this.line,this.column+e)};var F=function(e,t,r){this.start=t,this.end=r,null!==e.sourceFile&&(this.source=e.sourceFile)};function O(e,t){for(var r=1,n=0;;){b.lastIndex=n;var i=b.exec(e);if(!(i&&i.index<t))return new C(r,t-n);++r,n=i.index+i[0].length}}var P={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}};function M(e){var t={};for(var r in P)t[r]=e&&D(e,r)?e[r]:P[r];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),N(t.onToken)){var n=t.onToken;t.onToken=function(e){return n.push(e)}}return N(t.onComment)&&(t.onComment=function(e,t){return function(r,n,i,s,a,o){var u={type:r?"Block":"Line",value:n,start:i,end:s};e.locations&&(u.loc=new F(this,a,o)),e.ranges&&(u.range=[i,s]),t.push(u)}}(t,t.onComment)),t}var U={};function V(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var B=function(e,t,r){this.options=e=M(e),this.sourceFile=e.sourceFile,this.keywords=V(s[e.ecmaVersion>=6?6:5]);var i="";if(!e.allowReserved){for(var a=e.ecmaVersion;!(i=n[a]);a--);"module"===e.sourceType&&(i+=" await")}this.reservedWords=V(i);var o=(i?i+" ":"")+n.strict;this.reservedWordsStrict=V(o),this.reservedWordsStrictBind=V(o+" "+n.strictBind),this.input=String(t),this.containsEsc=!1,this.loadPlugins(e.plugins),r?(this.pos=r,this.lineStart=this.input.lastIndexOf("\n",r-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(A).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=E.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterFunctionScope(),this.regexpState=null};B.prototype.isKeyword=function(e){return this.keywords.test(e)},B.prototype.isReservedWord=function(e){return this.reservedWords.test(e)},B.prototype.extend=function(e,t){this[e]=t(this[e])},B.prototype.loadPlugins=function(e){for(var t in e){var r=U[t];if(!r)throw new Error("Plugin '"+t+"' not found");r(this,e[t])}},B.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};var G=B.prototype,z=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)"|;)/;function K(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}G.strictDirective=function(e){for(;;){k.lastIndex=e,e+=k.exec(this.input)[0].length;var t=z.exec(this.input.slice(e));if(!t)return!1;if("use strict"===(t[1]||t[2]))return!0;e+=t[0].length}},G.eat=function(e){return this.type===e&&(this.next(),!0)},G.isContextual=function(e){return this.type===E.name&&this.value===e&&!this.containsEsc},G.eatContextual=function(e){return!!this.isContextual(e)&&(this.next(),!0)},G.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},G.canInsertSemicolon=function(){return this.type===E.eof||this.type===E.braceR||A.test(this.input.slice(this.lastTokEnd,this.start))},G.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},G.semicolon=function(){this.eat(E.semi)||this.insertSemicolon()||this.unexpected()},G.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},G.expect=function(e){this.eat(e)||this.unexpected()},G.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},G.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var r=t?e.parenthesizedAssign:e.parenthesizedBind;r>-1&&this.raiseRecoverable(r,"Parenthesized pattern")}},G.checkExpressionErrors=function(e,t){if(!e)return!1;var r=e.shorthandAssign,n=e.doubleProto;if(!t)return r>=0||n>=0;r>=0&&this.raise(r,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")},G.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},G.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var W=B.prototype;W.parseTopLevel=function(e){var t={};for(e.body||(e.body=[]);this.type!==E.eof;){var r=this.parseStatement(!0,!0,t);e.body.push(r)}return this.adaptDirectivePrologue(e.body),this.next(),this.options.ecmaVersion>=6&&(e.sourceType=this.options.sourceType),this.finishNode(e,"Program")};var X={kind:"loop"},H={kind:"switch"};W.isLet=function(){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;k.lastIndex=this.pos;var e=k.exec(this.input),t=this.pos+e[0].length,r=this.input.charCodeAt(t);if(91===r||123===r)return!0;if(d(r,!0)){for(var n=t+1;m(this.input.charCodeAt(n),!0);)++n;var i=this.input.slice(t,n);if(!a.test(i))return!0}return!1},W.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;k.lastIndex=this.pos;var e=k.exec(this.input),t=this.pos+e[0].length;return!A.test(this.input.slice(this.pos,t))&&"function"===this.input.slice(t,t+8)&&(t+8===this.input.length||!m(this.input.charAt(t+8)))},W.parseStatement=function(e,t,r){var n,i=this.type,s=this.startNode();switch(this.isLet()&&(i=E._var,n="let"),i){case E._break:case E._continue:return this.parseBreakContinueStatement(s,i.keyword);case E._debugger:return this.parseDebuggerStatement(s);case E._do:return this.parseDoStatement(s);case E._for:return this.parseForStatement(s);case E._function:return!e&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1);case E._class:return e||this.unexpected(),this.parseClass(s,!0);case E._if:return this.parseIfStatement(s);case E._return:return this.parseReturnStatement(s);case E._switch:return this.parseSwitchStatement(s);case E._throw:return this.parseThrowStatement(s);case E._try:return this.parseTryStatement(s);case E._const:case E._var:return n=n||this.value,e||"var"===n||this.unexpected(),this.parseVarStatement(s,n);case E._while:return this.parseWhileStatement(s);case E._with:return this.parseWithStatement(s);case E.braceL:return this.parseBlock();case E.semi:return this.parseEmptyStatement(s);case E._export:case E._import:return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===E._import?this.parseImport(s):this.parseExport(s,r);default:if(this.isAsyncFunction())return e||this.unexpected(),this.next(),this.parseFunctionStatement(s,!0);var a=this.value,o=this.parseExpression();return i===E.name&&"Identifier"===o.type&&this.eat(E.colon)?this.parseLabeledStatement(s,a,o):this.parseExpressionStatement(s,o)}},W.parseBreakContinueStatement=function(e,t){var r="break"===t;this.next(),this.eat(E.semi)||this.insertSemicolon()?e.label=null:this.type!==E.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var i=this.labels[n];if(null==e.label||i.name===e.label.name){if(null!=i.kind&&(r||"loop"===i.kind))break;if(e.label&&r)break}}return n===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,r?"BreakStatement":"ContinueStatement")},W.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},W.parseDoStatement=function(e){return this.next(),this.labels.push(X),e.body=this.parseStatement(!1),this.labels.pop(),this.expect(E._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(E.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},W.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(X),this.enterLexicalScope(),this.expect(E.parenL),this.type===E.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var r=this.isLet();if(this.type===E._var||this.type===E._const||r){var n=this.startNode(),i=r?"let":this.value;return this.next(),this.parseVar(n,!0,i),this.finishNode(n,"VariableDeclaration"),!(this.type===E._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==n.declarations.length||"var"!==i&&n.declarations[0].init?(t>-1&&this.unexpected(t),this.parseFor(e,n)):(this.options.ecmaVersion>=9&&(this.type===E._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,n))}var s=new K,a=this.parseExpression(!0,s);return this.type===E._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===E._in?t>-1&&this.unexpected(t):e.await=t>-1),this.toAssignable(a,!1,s),this.checkLVal(a),this.parseForIn(e,a)):(this.checkExpressionErrors(s,!0),t>-1&&this.unexpected(t),this.parseFor(e,a))},W.parseFunctionStatement=function(e,t){return this.next(),this.parseFunction(e,!0,!1,t)},W.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement(!this.strict&&this.type===E._function),e.alternate=this.eat(E._else)?this.parseStatement(!this.strict&&this.type===E._function):null,this.finishNode(e,"IfStatement")},W.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(E.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},W.parseSwitchStatement=function(e){var t;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(E.braceL),this.labels.push(H),this.enterLexicalScope();for(var r=!1;this.type!==E.braceR;)if(this.type===E._case||this.type===E._default){var n=this.type===E._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),n?t.test=this.parseExpression():(r&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),r=!0,t.test=null),this.expect(E.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(!0));return this.exitLexicalScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},W.parseThrowStatement=function(e){return this.next(),A.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var j=[];W.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===E._catch){var t=this.startNode();this.next(),this.eat(E.parenL)?(t.param=this.parseBindingAtom(),this.enterLexicalScope(),this.checkLVal(t.param,"let"),this.expect(E.parenR)):(this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterLexicalScope()),t.body=this.parseBlock(!1),this.exitLexicalScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(E._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},W.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},W.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(X),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"WhileStatement")},W.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement(!1),this.finishNode(e,"WithStatement")},W.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},W.parseLabeledStatement=function(e,t,r){for(var n=0,i=this.labels;n<i.length;n+=1){i[n].name===t&&this.raise(r.start,"Label '"+t+"' is already declared")}for(var s=this.type.isLoop?"loop":this.type===E._switch?"switch":null,a=this.labels.length-1;a>=0;a--){var o=this.labels[a];if(o.statementStart!==e.start)break;o.statementStart=this.start,o.kind=s}return this.labels.push({name:t,kind:s,statementStart:this.start}),e.body=this.parseStatement(!0),("ClassDeclaration"===e.body.type||"VariableDeclaration"===e.body.type&&"var"!==e.body.kind||"FunctionDeclaration"===e.body.type&&(this.strict||e.body.generator||e.body.async))&&this.raiseRecoverable(e.body.start,"Invalid labeled declaration"),this.labels.pop(),e.label=r,this.finishNode(e,"LabeledStatement")},W.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},W.parseBlock=function(e){void 0===e&&(e=!0);var t=this.startNode();for(t.body=[],this.expect(E.braceL),e&&this.enterLexicalScope();!this.eat(E.braceR);){var r=this.parseStatement(!0);t.body.push(r)}return e&&this.exitLexicalScope(),this.finishNode(t,"BlockStatement")},W.parseFor=function(e,t){return e.init=t,this.expect(E.semi),e.test=this.type===E.semi?null:this.parseExpression(),this.expect(E.semi),e.update=this.type===E.parenR?null:this.parseExpression(),this.expect(E.parenR),this.exitLexicalScope(),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"ForStatement")},W.parseForIn=function(e,t){var r=this.type===E._in?"ForInStatement":"ForOfStatement";return this.next(),"ForInStatement"===r&&("AssignmentPattern"===t.type||"VariableDeclaration"===t.type&&null!=t.declarations[0].init&&(this.strict||"Identifier"!==t.declarations[0].id.type))&&this.raise(t.start,"Invalid assignment in for-in loop head"),e.left=t,e.right="ForInStatement"===r?this.parseExpression():this.parseMaybeAssign(),this.expect(E.parenR),this.exitLexicalScope(),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,r)},W.parseVar=function(e,t,r){for(e.declarations=[],e.kind=r;;){var n=this.startNode();if(this.parseVarId(n,r),this.eat(E.eq)?n.init=this.parseMaybeAssign(t):"const"!==r||this.type===E._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===n.id.type||t&&(this.type===E._in||this.isContextual("of"))?n.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),e.declarations.push(this.finishNode(n,"VariableDeclarator")),!this.eat(E.comma))break}return e},W.parseVarId=function(e,t){e.id=this.parseBindingAtom(t),this.checkLVal(e.id,t,!1)},W.parseFunction=function(e,t,r,n){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(e.generator=this.eat(E.star)),this.options.ecmaVersion>=8&&(e.async=!!n),t&&(e.id="nullableID"===t&&this.type!==E.name?null:this.parseIdent(),e.id&&this.checkLVal(e.id,this.inModule&&!this.inFunction?"let":"var"));var i=this.inGenerator,s=this.inAsync,a=this.yieldPos,o=this.awaitPos,u=this.inFunction;return this.inGenerator=e.generator,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),t||(e.id=this.type===E.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,r),this.inGenerator=i,this.inAsync=s,this.yieldPos=a,this.awaitPos=o,this.inFunction=u,this.finishNode(e,t?"FunctionDeclaration":"FunctionExpression")},W.parseFunctionParams=function(e){this.expect(E.parenL),e.params=this.parseBindingList(E.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},W.parseClass=function(e,t){this.next(),this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),n=!1;for(r.body=[],this.expect(E.braceL);!this.eat(E.braceR);){var i=this.parseClassMember(r);i&&"MethodDefinition"===i.type&&"constructor"===i.kind&&(n&&this.raise(i.start,"Duplicate constructor in the same class"),n=!0)}return e.body=this.finishNode(r,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},W.parseClassMember=function(e){var t=this;if(this.eat(E.semi))return null;var r=this.startNode(),n=function(e,n){void 0===n&&(n=!1);var i=t.start,s=t.startLoc;return!!t.eatContextual(e)&&(!(t.type===E.parenL||n&&t.canInsertSemicolon())||(r.key&&t.unexpected(),r.computed=!1,r.key=t.startNodeAt(i,s),r.key.name=e,t.finishNode(r.key,"Identifier"),!1))};r.kind="method",r.static=n("static");var i=this.eat(E.star),s=!1;i||(this.options.ecmaVersion>=8&&n("async",!0)?(s=!0,i=this.options.ecmaVersion>=9&&this.eat(E.star)):n("get")?r.kind="get":n("set")&&(r.kind="set")),r.key||this.parsePropertyName(r);var a=r.key;return r.computed||r.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?r.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==r.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),s&&this.raise(a.start,"Constructor can't be an async method"),r.kind="constructor"),this.parseClassMethod(e,r,i,s),"get"===r.kind&&0!==r.value.params.length&&this.raiseRecoverable(r.value.start,"getter should have no params"),"set"===r.kind&&1!==r.value.params.length&&this.raiseRecoverable(r.value.start,"setter should have exactly one param"),"set"===r.kind&&"RestElement"===r.value.params[0].type&&this.raiseRecoverable(r.value.params[0].start,"Setter cannot use rest params"),r},W.parseClassMethod=function(e,t,r,n){t.value=this.parseMethod(r,n),e.body.push(this.finishNode(t,"MethodDefinition"))},W.parseClassId=function(e,t){e.id=this.type===E.name?this.parseIdent():!0===t?this.unexpected():null},W.parseClassSuper=function(e){e.superClass=this.eat(E._extends)?this.parseExprSubscripts():null},W.parseExport=function(e,t){if(this.next(),this.eat(E.star))return this.expectContextual("from"),this.type!==E.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(E._default)){var r;if(this.checkExport(t,"default",this.lastTokStart),this.type===E._function||(r=this.isAsyncFunction())){var n=this.startNode();this.next(),r&&this.next(),e.declaration=this.parseFunction(n,"nullableID",!1,r)}else if(this.type===E._class){var i=this.startNode();e.declaration=this.parseClass(i,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(!0),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==E.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var s=0,a=e.specifiers;s<a.length;s+=1){var o=a[s];this.checkUnreserved(o.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},W.checkExport=function(e,t,r){e&&(D(e,t)&&this.raiseRecoverable(r,"Duplicate export '"+t+"'"),e[t]=!0)},W.checkPatternExport=function(e,t){var r=t.type;if("Identifier"===r)this.checkExport(e,t.name,t.start);else if("ObjectPattern"===r)for(var n=0,i=t.properties;n<i.length;n+=1){var s=i[n];this.checkPatternExport(e,s)}else if("ArrayPattern"===r)for(var a=0,o=t.elements;a<o.length;a+=1){var u=o[a];u&&this.checkPatternExport(e,u)}else"Property"===r?this.checkPatternExport(e,t.value):"AssignmentPattern"===r?this.checkPatternExport(e,t.left):"RestElement"===r?this.checkPatternExport(e,t.argument):"ParenthesizedExpression"===r&&this.checkPatternExport(e,t.expression)},W.checkVariableExport=function(e,t){if(e)for(var r=0,n=t;r<n.length;r+=1){var i=n[r];this.checkPatternExport(e,i.id)}},W.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},W.parseExportSpecifiers=function(e){var t=[],r=!0;for(this.expect(E.braceL);!this.eat(E.braceR);){if(r)r=!1;else if(this.expect(E.comma),this.afterTrailingComma(E.braceR))break;var n=this.startNode();n.local=this.parseIdent(!0),n.exported=this.eatContextual("as")?this.parseIdent(!0):n.local,this.checkExport(e,n.exported.name,n.exported.start),t.push(this.finishNode(n,"ExportSpecifier"))}return t},W.parseImport=function(e){return this.next(),this.type===E.string?(e.specifiers=j,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===E.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},W.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===E.name){var r=this.startNode();if(r.local=this.parseIdent(),this.checkLVal(r.local,"let"),e.push(this.finishNode(r,"ImportDefaultSpecifier")),!this.eat(E.comma))return e}if(this.type===E.star){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLVal(n.local,"let"),e.push(this.finishNode(n,"ImportNamespaceSpecifier")),e}for(this.expect(E.braceL);!this.eat(E.braceR);){if(t)t=!1;else if(this.expect(E.comma),this.afterTrailingComma(E.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,"let"),e.push(this.finishNode(i,"ImportSpecifier"))}return e},W.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},W.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"===typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var Y=B.prototype;Y.toAssignable=function(e,t,r){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",r&&this.checkPatternErrors(r,!0);for(var n=0,i=e.properties;n<i.length;n+=1){var s=i[n];this.toAssignable(s,t),"RestElement"!==s.type||"ArrayPattern"!==s.argument.type&&"ObjectPattern"!==s.argument.type||this.raise(s.argument.start,"Unexpected token")}break;case"Property":"init"!==e.kind&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",r&&this.checkPatternErrors(r,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),"AssignmentPattern"===e.argument.type&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==e.operator&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t);break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else r&&this.checkPatternErrors(r,!0);return e},Y.toAssignableList=function(e,t){for(var r=e.length,n=0;n<r;n++){var i=e[n];i&&this.toAssignable(i,t)}if(r){var s=e[r-1];6===this.options.ecmaVersion&&t&&s&&"RestElement"===s.type&&"Identifier"!==s.argument.type&&this.unexpected(s.argument.start)}return e},Y.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},Y.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==E.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},Y.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case E.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(E.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case E.braceL:return this.parseObj(!0)}return this.parseIdent()},Y.parseBindingList=function(e,t,r){for(var n=[],i=!0;!this.eat(e);)if(i?i=!1:this.expect(E.comma),t&&this.type===E.comma)n.push(null);else{if(r&&this.afterTrailingComma(e))break;if(this.type===E.ellipsis){var s=this.parseRestBinding();this.parseBindingListItem(s),n.push(s),this.type===E.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),n.push(a)}return n},Y.parseBindingListItem=function(e){return e},Y.parseMaybeDefault=function(e,t,r){if(r=r||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(E.eq))return r;var n=this.startNodeAt(e,t);return n.left=r,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")},Y.checkLVal=function(e,t,r){switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),r&&(D(r,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),r[e.name]=!0),t&&"none"!==t&&(("var"===t&&!this.canDeclareVarName(e.name)||"var"!==t&&!this.canDeclareLexicalName(e.name))&&this.raiseRecoverable(e.start,"Identifier '"+e.name+"' has already been declared"),"var"===t?this.declareVarName(e.name):this.declareLexicalName(e.name));break;case"MemberExpression":t&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var n=0,i=e.properties;n<i.length;n+=1){var s=i[n];this.checkLVal(s,t,r)}break;case"Property":this.checkLVal(e.value,t,r);break;case"ArrayPattern":for(var a=0,o=e.elements;a<o.length;a+=1){var u=o[a];u&&this.checkLVal(u,t,r)}break;case"AssignmentPattern":this.checkLVal(e.left,t,r);break;case"RestElement":this.checkLVal(e.argument,t,r);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,r);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var q=B.prototype;q.checkPropClash=function(e,t,r){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===e.type)&&!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var n,i=e.key;switch(i.type){case"Identifier":n=i.name;break;case"Literal":n=String(i.value);break;default:return}var s=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===n&&"init"===s&&(t.proto&&(r&&r.doubleProto<0?r.doubleProto=i.start:this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),t.proto=!0);else{var a=t[n="$"+n];if(a)("init"===s?this.strict&&a.init||a.get||a.set:a.init||a[s])&&this.raiseRecoverable(i.start,"Redefinition of property");else a=t[n]={init:!1,get:!1,set:!1};a[s]=!0}}},q.parseExpression=function(e,t){var r=this.start,n=this.startLoc,i=this.parseMaybeAssign(e,t);if(this.type===E.comma){var s=this.startNodeAt(r,n);for(s.expressions=[i];this.eat(E.comma);)s.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(s,"SequenceExpression")}return i},q.parseMaybeAssign=function(e,t,r){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var n=!1,i=-1,s=-1;t?(i=t.parenthesizedAssign,s=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new K,n=!0);var a=this.start,o=this.startLoc;this.type!==E.parenL&&this.type!==E.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(e,t);if(r&&(u=r.call(this,u,a,o)),this.type.isAssign){var c=this.startNodeAt(a,o);return c.operator=this.value,c.left=this.type===E.eq?this.toAssignable(u,!1,t):u,n||K.call(t),t.shorthandAssign=-1,this.checkLVal(u),this.next(),c.right=this.parseMaybeAssign(e),this.finishNode(c,"AssignmentExpression")}return n&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),s>-1&&(t.trailingComma=s),u},q.parseMaybeConditional=function(e,t){var r=this.start,n=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(E.question)){var s=this.startNodeAt(r,n);return s.test=i,s.consequent=this.parseMaybeAssign(),this.expect(E.colon),s.alternate=this.parseMaybeAssign(e),this.finishNode(s,"ConditionalExpression")}return i},q.parseExprOps=function(e,t){var r=this.start,n=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)?i:i.start===r&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,r,n,-1,e)},q.parseExprOp=function(e,t,r,n,i){var s=this.type.binop;if(null!=s&&(!i||this.type!==E._in)&&s>n){var a=this.type===E.logicalOR||this.type===E.logicalAND,o=this.value;this.next();var u=this.start,c=this.startLoc,l=this.parseExprOp(this.parseMaybeUnary(null,!1),u,c,s,i),h=this.buildBinary(t,r,e,l,o,a);return this.parseExprOp(h,t,r,n,i)}return e},q.buildBinary=function(e,t,r,n,i,s){var a=this.startNodeAt(e,t);return a.left=r,a.operator=i,a.right=n,this.finishNode(a,s?"LogicalExpression":"BinaryExpression")},q.parseMaybeUnary=function(e,t){var r,n=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))r=this.parseAwait(),t=!0;else if(this.type.prefix){var s=this.startNode(),a=this.type===E.incDec;s.operator=this.value,s.prefix=!0,this.next(),s.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),a?this.checkLVal(s.argument):this.strict&&"delete"===s.operator&&"Identifier"===s.argument.type?this.raiseRecoverable(s.start,"Deleting local variable in strict mode"):t=!0,r=this.finishNode(s,a?"UpdateExpression":"UnaryExpression")}else{if(r=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return r;for(;this.type.postfix&&!this.canInsertSemicolon();){var o=this.startNodeAt(n,i);o.operator=this.value,o.prefix=!1,o.argument=r,this.checkLVal(r),this.next(),r=this.finishNode(o,"UpdateExpression")}}return!t&&this.eat(E.starstar)?this.buildBinary(n,i,r,this.parseMaybeUnary(null,!1),"**",!1):r},q.parseExprSubscripts=function(e){var t=this.start,r=this.startLoc,n=this.parseExprAtom(e),i="ArrowFunctionExpression"===n.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(e)||i)return n;var s=this.parseSubscripts(n,t,r);return e&&"MemberExpression"===s.type&&(e.parenthesizedAssign>=s.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=s.start&&(e.parenthesizedBind=-1)),s},q.parseSubscripts=function(e,t,r,n){for(var i=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&"async"===this.input.slice(e.start,e.end),s=void 0;;)if((s=this.eat(E.bracketL))||this.eat(E.dot)){var a=this.startNodeAt(t,r);a.object=e,a.property=s?this.parseExpression():this.parseIdent(!0),a.computed=!!s,s&&this.expect(E.bracketR),e=this.finishNode(a,"MemberExpression")}else if(!n&&this.eat(E.parenL)){var o=new K,u=this.yieldPos,c=this.awaitPos;this.yieldPos=0,this.awaitPos=0;var l=this.parseExprList(E.parenR,this.options.ecmaVersion>=8,!1,o);if(i&&!this.canInsertSemicolon()&&this.eat(E.arrow))return this.checkPatternErrors(o,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=u,this.awaitPos=c,this.parseArrowExpression(this.startNodeAt(t,r),l,!0);this.checkExpressionErrors(o,!0),this.yieldPos=u||this.yieldPos,this.awaitPos=c||this.awaitPos;var h=this.startNodeAt(t,r);h.callee=e,h.arguments=l,e=this.finishNode(h,"CallExpression")}else{if(this.type!==E.backQuote)return e;var p=this.startNodeAt(t,r);p.tag=e,p.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(p,"TaggedTemplateExpression")}},q.parseExprAtom=function(e){var t,r=this.potentialArrowAt===this.start;switch(this.type){case E._super:return this.inFunction||this.raise(this.start,"'super' outside of function or class"),t=this.startNode(),this.next(),this.type!==E.dot&&this.type!==E.bracketL&&this.type!==E.parenL&&this.unexpected(),this.finishNode(t,"Super");case E._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case E.name:var n=this.start,i=this.startLoc,s=this.containsEsc,a=this.parseIdent(this.type!==E.name);if(this.options.ecmaVersion>=8&&!s&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(E._function))return this.parseFunction(this.startNodeAt(n,i),!1,!1,!0);if(r&&!this.canInsertSemicolon()){if(this.eat(E.arrow))return this.parseArrowExpression(this.startNodeAt(n,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===E.name&&!s)return a=this.parseIdent(),!this.canInsertSemicolon()&&this.eat(E.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(n,i),[a],!0)}return a;case E.regexp:var o=this.value;return(t=this.parseLiteral(o.value)).regex={pattern:o.pattern,flags:o.flags},t;case E.num:case E.string:return this.parseLiteral(this.value);case E._null:case E._true:case E._false:return(t=this.startNode()).value=this.type===E._null?null:this.type===E._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case E.parenL:var u=this.start,c=this.parseParenAndDistinguishExpression(r);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(c)&&(e.parenthesizedAssign=u),e.parenthesizedBind<0&&(e.parenthesizedBind=u)),c;case E.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(E.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case E.braceL:return this.parseObj(!1,e);case E._function:return t=this.startNode(),this.next(),this.parseFunction(t,!1);case E._class:return this.parseClass(this.startNode(),!1);case E._new:return this.parseNew();case E.backQuote:return this.parseTemplate();default:this.unexpected()}},q.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(t,"Literal")},q.parseParenExpression=function(){this.expect(E.parenL);var e=this.parseExpression();return this.expect(E.parenR),e},q.parseParenAndDistinguishExpression=function(e){var t,r=this.start,n=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var s,a=this.start,o=this.startLoc,u=[],c=!0,l=!1,h=new K,p=this.yieldPos,f=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==E.parenR;){if(c?c=!1:this.expect(E.comma),i&&this.afterTrailingComma(E.parenR,!0)){l=!0;break}if(this.type===E.ellipsis){s=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===E.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,h,this.parseParenItem))}var d=this.start,m=this.startLoc;if(this.expect(E.parenR),e&&!this.canInsertSemicolon()&&this.eat(E.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=p,this.awaitPos=f,this.parseParenArrowList(r,n,u);u.length&&!l||this.unexpected(this.lastTokStart),s&&this.unexpected(s),this.checkExpressionErrors(h,!0),this.yieldPos=p||this.yieldPos,this.awaitPos=f||this.awaitPos,u.length>1?((t=this.startNodeAt(a,o)).expressions=u,this.finishNodeAt(t,"SequenceExpression",d,m)):t=u[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var g=this.startNodeAt(r,n);return g.expression=t,this.finishNode(g,"ParenthesizedExpression")}return t},q.parseParenItem=function(e){return e},q.parseParenArrowList=function(e,t,r){return this.parseArrowExpression(this.startNodeAt(e,t),r)};var Z=[];q.parseNew=function(){var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(E.dot)){e.meta=t;var r=this.containsEsc;return e.property=this.parseIdent(!0),("target"!==e.property.name||r)&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(e.start,"new.target can only be used in functions"),this.finishNode(e,"MetaProperty")}var n=this.start,i=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(),n,i,!0),this.eat(E.parenL)?e.arguments=this.parseExprList(E.parenR,this.options.ecmaVersion>=8,!1):e.arguments=Z,this.finishNode(e,"NewExpression")},q.parseTemplateElement=function(e){var t=e.isTagged,r=this.startNode();return this.type===E.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),r.value={raw:this.value,cooked:null}):r.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),r.tail=this.type===E.backQuote,this.finishNode(r,"TemplateElement")},q.parseTemplate=function(e){void 0===e&&(e={});var t=e.isTagged;void 0===t&&(t=!1);var r=this.startNode();this.next(),r.expressions=[];var n=this.parseTemplateElement({isTagged:t});for(r.quasis=[n];!n.tail;)this.type===E.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(E.dollarBraceL),r.expressions.push(this.parseExpression()),this.expect(E.braceR),r.quasis.push(n=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(r,"TemplateLiteral")},q.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===E.name||this.type===E.num||this.type===E.string||this.type===E.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===E.star)&&!A.test(this.input.slice(this.lastTokEnd,this.start))},q.parseObj=function(e,t){var r=this.startNode(),n=!0,i={};for(r.properties=[],this.next();!this.eat(E.braceR);){if(n)n=!1;else if(this.expect(E.comma),this.afterTrailingComma(E.braceR))break;var s=this.parseProperty(e,t);e||this.checkPropClash(s,i,t),r.properties.push(s)}return this.finishNode(r,e?"ObjectPattern":"ObjectExpression")},q.parseProperty=function(e,t){var r,n,i,s,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(E.ellipsis))return e?(a.argument=this.parseIdent(!1),this.type===E.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===E.parenL&&t&&(t.parenthesizedAssign<0&&(t.parenthesizedAssign=this.start),t.parenthesizedBind<0&&(t.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,t),this.type===E.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(e||t)&&(i=this.start,s=this.startLoc),e||(r=this.eat(E.star)));var o=this.containsEsc;return this.parsePropertyName(a),!e&&!o&&this.options.ecmaVersion>=8&&!r&&this.isAsyncProp(a)?(n=!0,r=this.options.ecmaVersion>=9&&this.eat(E.star),this.parsePropertyName(a,t)):n=!1,this.parsePropertyValue(a,e,r,n,i,s,t,o),this.finishNode(a,"Property")},q.parsePropertyValue=function(e,t,r,n,i,s,a,o){if((r||n)&&this.type===E.colon&&this.unexpected(),this.eat(E.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===E.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(r,n);else if(t||o||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type===E.comma||this.type===E.braceR)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?(this.checkUnreserved(e.key),e.kind="init",t?e.value=this.parseMaybeDefault(i,s,e.key):this.type===E.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,s,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected();else{(r||n)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var u="get"===e.kind?0:1;if(e.value.params.length!==u){var c=e.value.start;"get"===e.kind?this.raiseRecoverable(c,"getter should have no params"):this.raiseRecoverable(c,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},q.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(E.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(E.bracketR),e.key;e.computed=!1}return e.key=this.type===E.num||this.type===E.string?this.parseExprAtom():this.parseIdent(!0)},q.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=!1,e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},q.parseMethod=function(e,t){var r=this.startNode(),n=this.inGenerator,i=this.inAsync,s=this.yieldPos,a=this.awaitPos,o=this.inFunction;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=e),this.options.ecmaVersion>=8&&(r.async=!!t),this.inGenerator=r.generator,this.inAsync=r.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),this.expect(E.parenL),r.params=this.parseBindingList(E.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1),this.inGenerator=n,this.inAsync=i,this.yieldPos=s,this.awaitPos=a,this.inFunction=o,this.finishNode(r,"FunctionExpression")},q.parseArrowExpression=function(e,t,r){var n=this.inGenerator,i=this.inAsync,s=this.yieldPos,a=this.awaitPos,o=this.inFunction;return this.enterFunctionScope(),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!r),this.inGenerator=!1,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0),this.inGenerator=n,this.inAsync=i,this.yieldPos=s,this.awaitPos=a,this.inFunction=o,this.finishNode(e,"ArrowFunctionExpression")},q.parseFunctionBody=function(e,t){var r=t&&this.type!==E.braceL,n=this.strict,i=!1;if(r)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var s=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);n&&!s||(i=this.strictDirective(this.end))&&s&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var a=this.labels;this.labels=[],i&&(this.strict=!0),this.checkParams(e,!n&&!i&&!t&&this.isSimpleParamList(e.params)),e.body=this.parseBlock(!1),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=a}this.exitFunctionScope(),this.strict&&e.id&&this.checkLVal(e.id,"none"),this.strict=n},q.isSimpleParamList=function(e){for(var t=0,r=e;t<r.length;t+=1){if("Identifier"!==r[t].type)return!1}return!0},q.checkParams=function(e,t){for(var r={},n=0,i=e.params;n<i.length;n+=1){var s=i[n];this.checkLVal(s,"var",t?null:r)}},q.parseExprList=function(e,t,r,n){for(var i=[],s=!0;!this.eat(e);){if(s)s=!1;else if(this.expect(E.comma),t&&this.afterTrailingComma(e))break;var a=void 0;r&&this.type===E.comma?a=null:this.type===E.ellipsis?(a=this.parseSpread(n),n&&this.type===E.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):a=this.parseMaybeAssign(!1,n),i.push(a)}return i},q.checkUnreserved=function(e){var t=e.start,r=e.end,n=e.name;(this.inGenerator&&"yield"===n&&this.raiseRecoverable(t,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===n&&this.raiseRecoverable(t,"Can not use 'await' as identifier inside an async function"),this.isKeyword(n)&&this.raise(t,"Unexpected keyword '"+n+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(t,r).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(n)&&(this.inAsync||"await"!==n||this.raiseRecoverable(t,"Can not use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+n+"' is reserved"))},q.parseIdent=function(e,t){var r=this.startNode();return e&&"never"===this.options.allowReserved&&(e=!1),this.type===E.name?r.name=this.value:this.type.keyword?(r.name=this.type.keyword,"class"!==r.name&&"function"!==r.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(),this.finishNode(r,"Identifier"),e||this.checkUnreserved(r),r},q.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===E.semi||this.canInsertSemicolon()||this.type!==E.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(E.star),e.argument=this.parseMaybeAssign()),this.finishNode(e,"YieldExpression")},q.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0),this.finishNode(e,"AwaitExpression")};var J=B.prototype;J.raise=function(e,t){var r=O(this.input,e);t+=" ("+r.line+":"+r.column+")";var n=new SyntaxError(t);throw n.pos=e,n.loc=r,n.raisedAt=this.pos,n},J.raiseRecoverable=J.raise,J.curPosition=function(){if(this.options.locations)return new C(this.curLine,this.pos-this.lineStart)};var Q=B.prototype,$=Object.assign||function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var n=0,i=t;n<i.length;n+=1){var s=i[n];for(var a in s)D(s,a)&&(e[a]=s[a])}return e};Q.enterFunctionScope=function(){this.scopeStack.push({var:{},lexical:{},childVar:{},parentLexical:{}})},Q.exitFunctionScope=function(){this.scopeStack.pop()},Q.enterLexicalScope=function(){var e=this.scopeStack[this.scopeStack.length-1],t={var:{},lexical:{},childVar:{},parentLexical:{}};this.scopeStack.push(t),$(t.parentLexical,e.lexical,e.parentLexical)},Q.exitLexicalScope=function(){var e=this.scopeStack.pop(),t=this.scopeStack[this.scopeStack.length-1];$(t.childVar,e.var,e.childVar)},Q.canDeclareVarName=function(e){var t=this.scopeStack[this.scopeStack.length-1];return!D(t.lexical,e)&&!D(t.parentLexical,e)},Q.canDeclareLexicalName=function(e){var t=this.scopeStack[this.scopeStack.length-1];return!D(t.lexical,e)&&!D(t.var,e)&&!D(t.childVar,e)},Q.declareVarName=function(e){this.scopeStack[this.scopeStack.length-1].var[e]=!0},Q.declareLexicalName=function(e){this.scopeStack[this.scopeStack.length-1].lexical[e]=!0};var ee=function(e,t,r){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new F(e,r)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},te=B.prototype;function re(e,t,r,n){return e.type=t,e.end=r,this.options.locations&&(e.loc.end=n),this.options.ranges&&(e.range[1]=r),e}te.startNode=function(){return new ee(this,this.start,this.startLoc)},te.startNodeAt=function(e,t){return new ee(this,e,t)},te.finishNode=function(e,t){return re.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},te.finishNodeAt=function(e,t,r,n){return re.call(this,e,t,r,n)};var ne=function(e,t,r,n,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!r,this.override=n,this.generator=!!i},ie={b_stat:new ne("{",!1),b_expr:new ne("{",!0),b_tmpl:new ne("${",!1),p_stat:new ne("(",!1),p_expr:new ne("(",!0),q_tmpl:new ne("`",!0,!0,(function(e){return e.tryReadTemplateToken()})),f_stat:new ne("function",!1),f_expr:new ne("function",!0),f_expr_gen:new ne("function",!0,!1,null,!0),f_gen:new ne("function",!1,!1,null,!0)},se=B.prototype;se.initialContext=function(){return[ie.b_stat]},se.braceIsBlock=function(e){var t=this.curContext();return t===ie.f_expr||t===ie.f_stat||(e!==E.colon||t!==ie.b_stat&&t!==ie.b_expr?e===E._return||e===E.name&&this.exprAllowed?A.test(this.input.slice(this.lastTokEnd,this.start)):e===E._else||e===E.semi||e===E.eof||e===E.parenR||e===E.arrow||(e===E.braceL?t===ie.b_stat:e!==E._var&&e!==E.name&&!this.exprAllowed):!t.isExpr)},se.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if("function"===t.token)return t.generator}return!1},se.updateContext=function(e){var t,r=this.type;r.keyword&&e===E.dot?this.exprAllowed=!1:(t=r.updateContext)?t.call(this,e):this.exprAllowed=r.beforeExpr},E.parenR.updateContext=E.braceR.updateContext=function(){if(1!==this.context.length){var e=this.context.pop();e===ie.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},E.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?ie.b_stat:ie.b_expr),this.exprAllowed=!0},E.dollarBraceL.updateContext=function(){this.context.push(ie.b_tmpl),this.exprAllowed=!0},E.parenL.updateContext=function(e){var t=e===E._if||e===E._for||e===E._with||e===E._while;this.context.push(t?ie.p_stat:ie.p_expr),this.exprAllowed=!0},E.incDec.updateContext=function(){},E._function.updateContext=E._class.updateContext=function(e){e.beforeExpr&&e!==E.semi&&e!==E._else&&(e!==E.colon&&e!==E.braceL||this.curContext()!==ie.b_stat)?this.context.push(ie.f_expr):this.context.push(ie.f_stat),this.exprAllowed=!1},E.backQuote.updateContext=function(){this.curContext()===ie.q_tmpl?this.context.pop():this.context.push(ie.q_tmpl),this.exprAllowed=!1},E.star.updateContext=function(e){if(e===E._function){var t=this.context.length-1;this.context[t]===ie.f_expr?this.context[t]=ie.f_expr_gen:this.context[t]=ie.f_gen}this.exprAllowed=!0},E.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==E.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var ae={$LONE:["ASCII","ASCII_Hex_Digit","AHex","Alphabetic","Alpha","Any","Assigned","Bidi_Control","Bidi_C","Bidi_Mirrored","Bidi_M","Case_Ignorable","CI","Cased","Changes_When_Casefolded","CWCF","Changes_When_Casemapped","CWCM","Changes_When_Lowercased","CWL","Changes_When_NFKC_Casefolded","CWKCF","Changes_When_Titlecased","CWT","Changes_When_Uppercased","CWU","Dash","Default_Ignorable_Code_Point","DI","Deprecated","Dep","Diacritic","Dia","Emoji","Emoji_Component","Emoji_Modifier","Emoji_Modifier_Base","Emoji_Presentation","Extender","Ext","Grapheme_Base","Gr_Base","Grapheme_Extend","Gr_Ext","Hex_Digit","Hex","IDS_Binary_Operator","IDSB","IDS_Trinary_Operator","IDST","ID_Continue","IDC","ID_Start","IDS","Ideographic","Ideo","Join_Control","Join_C","Logical_Order_Exception","LOE","Lowercase","Lower","Math","Noncharacter_Code_Point","NChar","Pattern_Syntax","Pat_Syn","Pattern_White_Space","Pat_WS","Quotation_Mark","QMark","Radical","Regional_Indicator","RI","Sentence_Terminal","STerm","Soft_Dotted","SD","Terminal_Punctuation","Term","Unified_Ideograph","UIdeo","Uppercase","Upper","Variation_Selector","VS","White_Space","space","XID_Continue","XIDC","XID_Start","XIDS"],General_Category:["Cased_Letter","LC","Close_Punctuation","Pe","Connector_Punctuation","Pc","Control","Cc","cntrl","Currency_Symbol","Sc","Dash_Punctuation","Pd","Decimal_Number","Nd","digit","Enclosing_Mark","Me","Final_Punctuation","Pf","Format","Cf","Initial_Punctuation","Pi","Letter","L","Letter_Number","Nl","Line_Separator","Zl","Lowercase_Letter","Ll","Mark","M","Combining_Mark","Math_Symbol","Sm","Modifier_Letter","Lm","Modifier_Symbol","Sk","Nonspacing_Mark","Mn","Number","N","Open_Punctuation","Ps","Other","C","Other_Letter","Lo","Other_Number","No","Other_Punctuation","Po","Other_Symbol","So","Paragraph_Separator","Zp","Private_Use","Co","Punctuation","P","punct","Separator","Z","Space_Separator","Zs","Spacing_Mark","Mc","Surrogate","Cs","Symbol","S","Titlecase_Letter","Lt","Unassigned","Cn","Uppercase_Letter","Lu"],Script:["Adlam","Adlm","Ahom","Anatolian_Hieroglyphs","Hluw","Arabic","Arab","Armenian","Armn","Avestan","Avst","Balinese","Bali","Bamum","Bamu","Bassa_Vah","Bass","Batak","Batk","Bengali","Beng","Bhaiksuki","Bhks","Bopomofo","Bopo","Brahmi","Brah","Braille","Brai","Buginese","Bugi","Buhid","Buhd","Canadian_Aboriginal","Cans","Carian","Cari","Caucasian_Albanian","Aghb","Chakma","Cakm","Cham","Cherokee","Cher","Common","Zyyy","Coptic","Copt","Qaac","Cuneiform","Xsux","Cypriot","Cprt","Cyrillic","Cyrl","Deseret","Dsrt","Devanagari","Deva","Duployan","Dupl","Egyptian_Hieroglyphs","Egyp","Elbasan","Elba","Ethiopic","Ethi","Georgian","Geor","Glagolitic","Glag","Gothic","Goth","Grantha","Gran","Greek","Grek","Gujarati","Gujr","Gurmukhi","Guru","Han","Hani","Hangul","Hang","Hanunoo","Hano","Hatran","Hatr","Hebrew","Hebr","Hiragana","Hira","Imperial_Aramaic","Armi","Inherited","Zinh","Qaai","Inscriptional_Pahlavi","Phli","Inscriptional_Parthian","Prti","Javanese","Java","Kaithi","Kthi","Kannada","Knda","Katakana","Kana","Kayah_Li","Kali","Kharoshthi","Khar","Khmer","Khmr","Khojki","Khoj","Khudawadi","Sind","Lao","Laoo","Latin","Latn","Lepcha","Lepc","Limbu","Limb","Linear_A","Lina","Linear_B","Linb","Lisu","Lycian","Lyci","Lydian","Lydi","Mahajani","Mahj","Malayalam","Mlym","Mandaic","Mand","Manichaean","Mani","Marchen","Marc","Masaram_Gondi","Gonm","Meetei_Mayek","Mtei","Mende_Kikakui","Mend","Meroitic_Cursive","Merc","Meroitic_Hieroglyphs","Mero","Miao","Plrd","Modi","Mongolian","Mong","Mro","Mroo","Multani","Mult","Myanmar","Mymr","Nabataean","Nbat","New_Tai_Lue","Talu","Newa","Nko","Nkoo","Nushu","Nshu","Ogham","Ogam","Ol_Chiki","Olck","Old_Hungarian","Hung","Old_Italic","Ital","Old_North_Arabian","Narb","Old_Permic","Perm","Old_Persian","Xpeo","Old_South_Arabian","Sarb","Old_Turkic","Orkh","Oriya","Orya","Osage","Osge","Osmanya","Osma","Pahawh_Hmong","Hmng","Palmyrene","Palm","Pau_Cin_Hau","Pauc","Phags_Pa","Phag","Phoenician","Phnx","Psalter_Pahlavi","Phlp","Rejang","Rjng","Runic","Runr","Samaritan","Samr","Saurashtra","Saur","Sharada","Shrd","Shavian","Shaw","Siddham","Sidd","SignWriting","Sgnw","Sinhala","Sinh","Sora_Sompeng","Sora","Soyombo","Soyo","Sundanese","Sund","Syloti_Nagri","Sylo","Syriac","Syrc","Tagalog","Tglg","Tagbanwa","Tagb","Tai_Le","Tale","Tai_Tham","Lana","Tai_Viet","Tavt","Takri","Takr","Tamil","Taml","Tangut","Tang","Telugu","Telu","Thaana","Thaa","Thai","Tibetan","Tibt","Tifinagh","Tfng","Tirhuta","Tirh","Ugaritic","Ugar","Vai","Vaii","Warang_Citi","Wara","Yi","Yiii","Zanabazar_Square","Zanb"]};Array.prototype.push.apply(ae.$LONE,ae.General_Category),ae.gc=ae.General_Category,ae.sc=ae.Script_Extensions=ae.scx=ae.Script;var oe=B.prototype,ue=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":""),this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function ce(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function le(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function he(e){return e>=65&&e<=90||e>=97&&e<=122}function pe(e){return he(e)||95===e}function fe(e){return pe(e)||de(e)}function de(e){return e>=48&&e<=57}function me(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function ge(e){return e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:e-48}function ye(e){return e>=48&&e<=55}ue.prototype.reset=function(e,t,r){var n=-1!==r.indexOf("u");this.start=0|e,this.source=t+"",this.flags=r,this.switchU=n&&this.parser.options.ecmaVersion>=6,this.switchN=n&&this.parser.options.ecmaVersion>=9},ue.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)},ue.prototype.at=function(e){var t=this.source,r=t.length;if(e>=r)return-1;var n=t.charCodeAt(e);return!this.switchU||n<=55295||n>=57344||e+1>=r?n:(n<<10)+t.charCodeAt(e+1)-56613888},ue.prototype.nextIndex=function(e){var t=this.source,r=t.length;if(e>=r)return r;var n=t.charCodeAt(e);return!this.switchU||n<=55295||n>=57344||e+1>=r?e+1:e+2},ue.prototype.current=function(){return this.at(this.pos)},ue.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},ue.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},ue.prototype.eat=function(e){return this.current()===e&&(this.advance(),!0)},oe.validateRegExpFlags=function(e){for(var t=e.validFlags,r=e.flags,n=0;n<r.length;n++){var i=r.charAt(n);-1===t.indexOf(i)&&this.raise(e.start,"Invalid regular expression flag"),r.indexOf(i,n+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}},oe.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},oe.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,r=e.backReferenceNames;t<r.length;t+=1){var n=r[t];-1===e.groupNames.indexOf(n)&&e.raise("Invalid named capture referenced")}},oe.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},oe.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},oe.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!(e.switchU?!this.regexp_eatAtom(e):!this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},oe.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var r=!1;if(this.options.ecmaVersion>=9&&(r=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!r,!0}return e.pos=t,!1},oe.regexp_eatQuantifier=function(e,t){return void 0===t&&(t=!1),!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},oe.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},oe.regexp_eatBracedQuantifier=function(e,t){var r=e.pos;if(e.eat(123)){var n=0,i=-1;if(this.regexp_eatDecimalDigits(e)&&(n=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return-1!==i&&i<n&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=r}return!1},oe.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},oe.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},oe.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1},oe.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},oe.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},oe.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},oe.regexp_eatSyntaxCharacter=function(e){var t=e.current();return!!le(t)&&(e.lastIntValue=t,e.advance(),!0)},oe.regexp_eatPatternCharacters=function(e){for(var t=e.pos,r=0;-1!==(r=e.current())&&!le(r);)e.advance();return e.pos!==t},oe.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return!(-1===t||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t)&&(e.advance(),!0)},oe.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e))return-1!==e.groupNames.indexOf(e.lastStringValue)&&e.raise("Duplicate capture group name"),void e.groupNames.push(e.lastStringValue);e.raise("Invalid group")}},oe.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},oe.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=ce(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=ce(e.lastIntValue);return!0}return!1},oe.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,r=e.current();return e.advance(),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e)&&(r=e.lastIntValue),function(e){return d(e,!0)||36===e||95===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},oe.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,r=e.current();return e.advance(),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e)&&(r=e.lastIntValue),function(e){return m(e,!0)||36===e||95===e||8204===e||8205===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},oe.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},oe.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var r=e.lastIntValue;if(e.switchU)return r>e.maxBackReference&&(e.maxBackReference=r),!0;if(r<=e.numCapturingParens)return!0;e.pos=t}return!1},oe.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},oe.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},oe.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},oe.regexp_eatZero=function(e){return 48===e.current()&&!de(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},oe.regexp_eatControlEscape=function(e){var t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},oe.regexp_eatControlLetter=function(e){var t=e.current();return!!he(t)&&(e.lastIntValue=t%32,e.advance(),!0)},oe.regexp_eatRegExpUnicodeEscapeSequence=function(e){var t,r=e.pos;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var n=e.lastIntValue;if(e.switchU&&n>=55296&&n<=56319){var i=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var s=e.lastIntValue;if(s>=56320&&s<=57343)return e.lastIntValue=1024*(n-55296)+(s-56320)+65536,!0}e.pos=i,e.lastIntValue=n}return!0}if(e.switchU&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&((t=e.lastIntValue)>=0&&t<=1114111))return!0;e.switchU&&e.raise("Invalid unicode escape"),e.pos=r}return!1},oe.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);var t=e.current();return!(99===t||e.switchN&&107===t)&&(e.lastIntValue=t,e.advance(),!0)},oe.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do{e.lastIntValue=10*e.lastIntValue+(t-48),e.advance()}while((t=e.current())>=48&&t<=57);return!0}return!1},oe.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(function(e){return 100===e||68===e||115===e||83===e||119===e||87===e}(t))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(80===t||112===t)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1},oe.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var r=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var n=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,r,n),!0}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i),!0}return!1},oe.regexp_validateUnicodePropertyNameAndValue=function(e,t,r){ae.hasOwnProperty(t)&&-1!==ae[t].indexOf(r)||e.raise("Invalid property name")},oe.regexp_validateUnicodePropertyNameOrValue=function(e,t){-1===ae.$LONE.indexOf(t)&&e.raise("Invalid property name")},oe.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";pe(t=e.current());)e.lastStringValue+=ce(t),e.advance();return""!==e.lastStringValue},oe.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";fe(t=e.current());)e.lastStringValue+=ce(t),e.advance();return""!==e.lastStringValue},oe.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},oe.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1},oe.regexp_classRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var r=e.lastIntValue;!e.switchU||-1!==t&&-1!==r||e.raise("Invalid character class"),-1!==t&&-1!==r&&t>r&&e.raise("Range out of order in character class")}}},oe.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var r=e.current();(99===r||ye(r))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var n=e.current();return 93!==n&&(e.lastIntValue=n,e.advance(),!0)},oe.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},oe.regexp_eatClassControlLetter=function(e){var t=e.current();return!(!de(t)&&95!==t)&&(e.lastIntValue=t%32,e.advance(),!0)},oe.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},oe.regexp_eatDecimalDigits=function(e){var t=e.pos,r=0;for(e.lastIntValue=0;de(r=e.current());)e.lastIntValue=10*e.lastIntValue+(r-48),e.advance();return e.pos!==t},oe.regexp_eatHexDigits=function(e){var t=e.pos,r=0;for(e.lastIntValue=0;me(r=e.current());)e.lastIntValue=16*e.lastIntValue+ge(r),e.advance();return e.pos!==t},oe.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var r=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*r+e.lastIntValue:e.lastIntValue=8*t+r}else e.lastIntValue=t;return!0}return!1},oe.regexp_eatOctalDigit=function(e){var t=e.current();return ye(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},oe.regexp_eatFixedHexDigits=function(e,t){var r=e.pos;e.lastIntValue=0;for(var n=0;n<t;++n){var i=e.current();if(!me(i))return e.pos=r,!1;e.lastIntValue=16*e.lastIntValue+ge(i),e.advance()}return!0};var _e=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new F(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},xe=B.prototype;function ve(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}xe.next=function(){this.options.onToken&&this.options.onToken(new _e(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},xe.getToken=function(){return this.next(),new _e(this)},"undefined"!==typeof Symbol&&(xe[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===E.eof,value:t}}}}),xe.curContext=function(){return this.context[this.context.length-1]},xe.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(E.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},xe.readToken=function(e){return d(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},xe.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);return e<=55295||e>=57344?e:(e<<10)+this.input.charCodeAt(this.pos+1)-56613888},xe.skipBlockComment=function(){var e,t=this.options.onComment&&this.curPosition(),r=this.pos,n=this.input.indexOf("*/",this.pos+=2);if(-1===n&&this.raise(this.pos-2,"Unterminated comment"),this.pos=n+2,this.options.locations)for(b.lastIndex=r;(e=b.exec(this.input))&&e.index<this.pos;)++this.curLine,this.lineStart=e.index+e[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(r+2,n),r,this.pos,t,this.curPosition())},xe.skipLineComment=function(e){for(var t=this.pos,r=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!S(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,r,this.curPosition())},xe.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(e>8&&e<14||e>=5760&&I.test(String.fromCharCode(e))))break e;++this.pos}}},xe.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var r=this.type;this.type=e,this.value=t,this.updateContext(r)},xe.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(E.ellipsis)):(++this.pos,this.finishToken(E.dot))},xe.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(E.assign,2):this.finishOp(E.slash,1)},xe.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),r=1,n=42===e?E.star:E.modulo;return this.options.ecmaVersion>=7&&42===e&&42===t&&(++r,n=E.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(E.assign,r+1):this.finishOp(n,r)},xe.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?this.finishOp(124===e?E.logicalOR:E.logicalAND,2):61===t?this.finishOp(E.assign,2):this.finishOp(124===e?E.bitwiseOR:E.bitwiseAND,1)},xe.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(E.assign,2):this.finishOp(E.bitwiseXOR,1)},xe.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!==t||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!A.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(E.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(E.assign,2):this.finishOp(E.plusMin,1)},xe.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),r=1;return t===e?(r=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+r)?this.finishOp(E.assign,r+1):this.finishOp(E.bitShift,r)):33!==t||60!==e||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===t&&(r=2),this.finishOp(E.relational,r)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},xe.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(E.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(E.arrow)):this.finishOp(61===e?E.eq:E.prefix,1)},xe.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(E.parenL);case 41:return++this.pos,this.finishToken(E.parenR);case 59:return++this.pos,this.finishToken(E.semi);case 44:return++this.pos,this.finishToken(E.comma);case 91:return++this.pos,this.finishToken(E.bracketL);case 93:return++this.pos,this.finishToken(E.bracketR);case 123:return++this.pos,this.finishToken(E.braceL);case 125:return++this.pos,this.finishToken(E.braceR);case 58:return++this.pos,this.finishToken(E.colon);case 63:return++this.pos,this.finishToken(E.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(E.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 126:return this.finishOp(E.prefix,1)}this.raise(this.pos,"Unexpected character '"+ve(e)+"'")},xe.finishOp=function(e,t){var r=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,r)},xe.readRegexp=function(){for(var e,t,r=this.pos;;){this.pos>=this.input.length&&this.raise(r,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(A.test(n)&&this.raise(r,"Unterminated regular expression"),e)e=!1;else{if("["===n)t=!0;else if("]"===n&&t)t=!1;else if("/"===n&&!t)break;e="\\"===n}++this.pos}var i=this.input.slice(r,this.pos);++this.pos;var s=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(s);var o=this.regexpState||(this.regexpState=new ue(this));o.reset(r,i,a),this.validateRegExpFlags(o),this.validateRegExpPattern(o);var u=null;try{u=new RegExp(i,a)}catch(c){}return this.finishToken(E.regexp,{pattern:i,flags:a,value:u})},xe.readInt=function(e,t){for(var r=this.pos,n=0,i=0,s=null==t?1/0:t;i<s;++i){var a=this.input.charCodeAt(this.pos),o=void 0;if((o=a>=97?a-97+10:a>=65?a-65+10:a>=48&&a<=57?a-48:1/0)>=e)break;++this.pos,n=n*e+o}return this.pos===r||null!=t&&this.pos-r!==t?null:n},xe.readRadixNumber=function(e){this.pos+=2;var t=this.readInt(e);return null==t&&this.raise(this.start+2,"Expected number in radix "+e),d(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(E.num,t)},xe.readNumber=function(e){var t=this.pos;e||null!==this.readInt(10)||this.raise(t,"Invalid number");var r=this.pos-t>=2&&48===this.input.charCodeAt(t);r&&this.strict&&this.raise(t,"Invalid number"),r&&/[89]/.test(this.input.slice(t,this.pos))&&(r=!1);var n=this.input.charCodeAt(this.pos);46!==n||r||(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),69!==n&&101!==n||r||(43!==(n=this.input.charCodeAt(++this.pos))&&45!==n||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),d(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var i=this.input.slice(t,this.pos),s=r?parseInt(i,8):parseFloat(i);return this.finishToken(E.num,s)},xe.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},xe.readString=function(e){for(var t="",r=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===e)break;92===n?(t+=this.input.slice(r,this.pos),t+=this.readEscapedChar(!1),r=this.pos):(S(n,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(r,this.pos++),this.finishToken(E.string,t)};var Te={};xe.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==Te)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},xe.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Te;this.raise(e,t)},xe.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var r=this.input.charCodeAt(this.pos);if(96===r||36===r&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==E.template&&this.type!==E.invalidTemplate?(e+=this.input.slice(t,this.pos),this.finishToken(E.template,e)):36===r?(this.pos+=2,this.finishToken(E.dollarBraceL)):(++this.pos,this.finishToken(E.backQuote));if(92===r)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(S(r)){switch(e+=this.input.slice(t,this.pos),++this.pos,r){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(r)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},xe.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(E.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},xe.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ve(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(t>=48&&t<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],n=parseInt(r,8);return n>255&&(r=r.slice(0,-1),n=parseInt(r,8)),this.pos+=r.length-1,t=this.input.charCodeAt(this.pos),"0"===r&&56!==t&&57!==t||!this.strict&&!e||this.invalidStringToken(this.pos-1-r.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(n)}return String.fromCharCode(t)}},xe.readHexChar=function(e){var t=this.pos,r=this.readInt(16,e);return null===r&&this.invalidStringToken(t,"Bad character escape sequence"),r},xe.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,r=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(m(i,n))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,e+=this.input.slice(r,this.pos);var s=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(t?d:m)(a,n)||this.invalidStringToken(s,"Invalid Unicode escape"),e+=ve(a),r=this.pos}t=!1}return e+this.input.slice(r,this.pos)},xe.readWord=function(){var e=this.readWord1(),t=E.name;return this.keywords.test(e)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+e),t=v[e]),this.finishToken(t,e)};var Ee,Ae,be,Se="5.7.3";function Ie(e,t){return new B(t,e).parse()}function ke(e,t,r){var n=new B(r,e,t);return n.nextToken(),n.parseExpression()}function Re(e,t){return new B(t,e)}function Le(e,t,r){Ee=e,Ae=t,be=r}},function(e,t,r){var n=r(10),i=r(0),s=r(3),a=r(2),o=r(6),u=r(1),c=r(4),l=r(17).Kernel,h=r(14).FunctionBuilder,p=r(35).CPUFunctionNode,f=r(5).utils,d=r(74).cpuKernelString,m=function(e){"use strict";function t(e,r){var n;return i(this,t),(n=s(this,a(t).call(this,e,r))).mergeSettings(e.settings||r),n._imageData=null,n._colorData=null,n._kernelString=null,n.thread={x:0,y:0,z:0},n.translatedSources=null,n}return c(t,e),u(t,null,[{key:"getFeatures",value:function(){return this.features}},{key:"isContextMatch",value:function(e){return!1}},{key:"nativeFunctionArguments",value:function(){return null}},{key:"nativeFunctionReturnType",value:function(){return null}},{key:"combineKernels",value:function(e){return e}},{key:"features",get:function(){return Object.freeze({kernelMap:!0,isIntegerDivisionAccurate:!0})}},{key:"isSupported",get:function(){return!0}},{key:"mode",get:function(){return"cpu"}}]),u(t,[{key:"initCanvas",value:function(){return"undefined"!==typeof document?document.createElement("canvas"):"undefined"!==typeof OffscreenCanvas?new OffscreenCanvas(0,0):void 0}},{key:"initContext",value:function(){return this.canvas?this.canvas.getContext("2d"):null}},{key:"initPlugins",value:function(e){return[]}},{key:"validateSettings",value:function(e){if(!this.output||0===this.output.length){if(1!==e.length)throw new Error("Auto output only supported for kernels with only one input");var t=f.getVariableType(e[0],this.strictIntegers);if("Array"===t)this.output=f.getDimensions(t);else{if("NumberTexture"!==t&&"ArrayTexture(4)"!==t)throw new Error("Auto output not supported for input type: "+t);this.output=e[0].output}}if(this.graphical&&2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.checkOutput()}},{key:"translateSource",value:function(){if(this.leadingReturnStatement=this.output.length>1?"resultX[x] = ":"result[x] = ",this.subKernels){for(var e=[],t=0;t<this.subKernels.length;t++){var r=this.subKernels[t].name;e.push(this.output.length>1?"resultX_".concat(r,"[x] = subKernelResult_").concat(r,";\n"):"result_".concat(r,"[x] = subKernelResult_").concat(r,";\n"))}this.followingReturnStatement=e.join("")}var n=h.fromKernel(this,p);this.translatedSources=n.getPrototypes("kernel"),this.graphical||this.returnType||(this.returnType=n.getKernelResultType())}},{key:"build",value:function(){if(this.setupConstants(),this.setupArguments(arguments),this.validateSettings(arguments),this.translateSource(),this.graphical){var e=this.canvas,t=this.output;if(!e)throw new Error("no canvas available for using graphical output");var r=t[0],n=t[1]||1;e.width=r,e.height=n,this._imageData=this.context.createImageData(r,n),this._colorData=new Uint8ClampedArray(r*n*4)}var i=this.getKernelString();this.kernelString=i,this.debug&&(console.log("Function output:"),console.log(i));try{this.run=new Function([],i).bind(this)()}catch(s){console.error("An error occurred compiling the javascript: ",s)}}},{key:"color",value:function(e,t,r,n){"undefined"===typeof n&&(n=1),e=Math.floor(255*e),t=Math.floor(255*t),r=Math.floor(255*r),n=Math.floor(255*n);var i=this.output[0],s=this.output[1],a=this.thread.x+(s-this.thread.y-1)*i;this._colorData[4*a+0]=e,this._colorData[4*a+1]=t,this._colorData[4*a+2]=r,this._colorData[4*a+3]=n}},{key:"getKernelString",value:function(){if(null!==this._kernelString)return this._kernelString;var e=null,t=this.translatedSources;return t.length>1?t=t.filter((function(t){return/^function/.test(t)?t:(e=t,!1)})):e=t.shift(),this._kernelString="  const LOOP_MAX = ".concat(this._getLoopMaxString(),"\n  const constants = this.constants;\n  const _this = this;\n  return (").concat(this.argumentNames.map((function(e){return"user_"+e})).join(", "),") => {\n    ").concat(this._processConstants(),"\n    ").concat(this._processArguments(),"\n    ").concat(this.graphical?this._graphicalKernelBody(e):this._resultKernelBody(e),"\n    ").concat(t.length>0?t.join("\n"):"","\n  };")}},{key:"toString",value:function(){return d(this)}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" ".concat(parseInt(this.loopMaxIterations),";"):" 1000;"}},{key:"_processConstants",value:function(){if(!this.constants)return"";var e=[];for(var t in this.constants){switch(this.constantTypes[t]){case"HTMLImage":e.push("    const constants_".concat(t," = this._imageTo2DArray(this.constants.").concat(t,");\n"));break;case"HTMLImageArray":e.push("    const constants_".concat(t," = this._imageTo3DArray(this.constants.").concat(t,");\n"));break;case"Input":e.push("    const constants_".concat(t," = this.constants.").concat(t,".value;\n"));break;default:e.push("    const constants_".concat(t," = this.constants.").concat(t,";\n"))}}return e.join("")}},{key:"_processArguments",value:function(){for(var e=[],t=0;t<this.argumentTypes.length;t++){var r="user_".concat(this.argumentNames[t]);switch(this.argumentTypes[t]){case"HTMLImage":e.push("    ".concat(r," = this._imageTo2DArray(").concat(r,");\n"));break;case"HTMLImageArray":e.push("    ".concat(r," = this._imageTo3DArray(").concat(r,");\n"));break;case"Input":e.push("    ".concat(r," = ").concat(r,".value;\n"));break;case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"NumberTexture":case"MemoryOptimizedNumberTexture":e.push("\n    if (".concat(r,".toArray) {\n      if (!_this.textureCache) {\n        _this.textureCache = [];\n        _this.arrayCache = [];\n      }\n      const textureIndex = _this.textureCache.indexOf(").concat(r,");\n      if (textureIndex !== -1) {\n        ").concat(r," = _this.arrayCache[textureIndex];\n      } else {\n        _this.textureCache.push(").concat(r,");\n        ").concat(r," = ").concat(r,".toArray();\n        _this.arrayCache.push(").concat(r,");\n      }\n    }"))}}return e.join("")}},{key:"_imageTo2DArray",value:function(e){var t=this.canvas;t.width<e.width&&(t.width=e.width),t.height<e.height&&(t.height=e.height);var r=this.context;r.drawImage(e,0,0,e.width,e.height);for(var n=r.getImageData(0,0,e.width,e.height).data,i=new Array(e.height),s=0,a=e.height-1;a>=0;a--)for(var o=i[a]=new Array(e.width),u=0;u<e.width;u++){var c=new Float32Array(4);c[0]=n[s++]/255,c[1]=n[s++]/255,c[2]=n[s++]/255,c[3]=n[s++]/255,o[u]=c}return i}},{key:"getPixels",value:function(e){var t=n(this.output,2),r=t[0],i=t[1];return e?f.flipPixels(this._imageData.data,r,i):this._imageData.data.slice(0)}},{key:"_imageTo3DArray",value:function(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=this._imageTo2DArray(e[r]);return t}},{key:"_resultKernelBody",value:function(e){switch(this.output.length){case 1:return this._resultKernel1DLoop(e)+this._kernelOutput();case 2:return this._resultKernel2DLoop(e)+this._kernelOutput();case 3:return this._resultKernel3DLoop(e)+this._kernelOutput();default:throw new Error("unsupported size kernel")}}},{key:"_graphicalKernelBody",value:function(e){switch(this.output.length){case 2:return this._graphicalKernel2DLoop(e)+this._graphicalOutput();default:throw new Error("unsupported size kernel")}}},{key:"_graphicalOutput",value:function(){return"\n    this._imageData.data.set(this._colorData);\n    this.context.putImageData(this._imageData, 0, 0);\n    return;"}},{key:"_getKernelResultTypeConstructorString",value:function(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return"Float32Array";case"Array(2)":case"Array(3)":case"Array(4)":return"Array";default:if(this.graphical)return"Float32Array";throw new Error("unhandled returnType ".concat(this.returnType))}}},{key:"_resultKernel1DLoop",value:function(e){this.output;var t=this._getKernelResultTypeConstructorString();return"  const outputX = _this.output[0];\n    const result = new ".concat(t,"(outputX);\n    ").concat(this._mapSubKernels((function(e){return"const result_".concat(e.name," = new ").concat(t,"(outputX);\n")})).join("    "),"\n    ").concat(this._mapSubKernels((function(e){return"let subKernelResult_".concat(e.name,";\n")})).join("    "),"\n    for (let x = 0; x < outputX; x++) {\n      this.thread.x = x;\n      this.thread.y = 0;\n      this.thread.z = 0;\n      ").concat(e,"\n    }")}},{key:"_resultKernel2DLoop",value:function(e){this.output;var t=this._getKernelResultTypeConstructorString();return"  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const result = new Array(outputY);\n    ".concat(this._mapSubKernels((function(e){return"const result_".concat(e.name," = new Array(outputY);\n")})).join("    "),"\n    ").concat(this._mapSubKernels((function(e){return"let subKernelResult_".concat(e.name,";\n")})).join("    "),"\n    for (let y = 0; y < outputY; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      const resultX = result[y] = new ").concat(t,"(outputX);\n      ").concat(this._mapSubKernels((function(e){return"const resultX_".concat(e.name," = result_").concat(e.name,"[y] = new ").concat(t,"(outputX);\n")})).join(""),"\n      for (let x = 0; x < outputX; x++) {\n        this.thread.x = x;\n        ").concat(e,"\n      }\n    }")}},{key:"_graphicalKernel2DLoop",value:function(e){this.output;var t=this._getKernelResultTypeConstructorString();return"  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    ".concat(this._mapSubKernels((function(e){return"const result_".concat(e.name," = new Array(outputY);\n")})).join("    "),"\n    ").concat(this._mapSubKernels((function(e){return"let subKernelResult_".concat(e.name,";\n")})).join("    "),"\n    for (let y = 0; y < outputY; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      ").concat(this._mapSubKernels((function(e){return"const resultX_".concat(e.name," = result_").concat(e.name,"[y] = new ").concat(t,"(outputX);\n")})).join(""),"\n      for (let x = 0; x < outputX; x++) {\n        this.thread.x = x;\n        ").concat(e,"\n      }\n    }")}},{key:"_resultKernel3DLoop",value:function(e){this.output;var t=this._getKernelResultTypeConstructorString();return"  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const outputZ = _this.output[2];\n    const result = new Array(outputZ);\n    ".concat(this._mapSubKernels((function(e){return"const result_".concat(e.name," = new Array(outputZ);\n")})).join("    "),"\n    ").concat(this._mapSubKernels((function(e){return"let subKernelResult_".concat(e.name,";\n")})).join("    "),"\n    for (let z = 0; z < outputZ; z++) {\n      this.thread.z = z;\n      const resultY = result[z] = new Array(outputY);\n      ").concat(this._mapSubKernels((function(e){return"const resultY_".concat(e.name," = result_").concat(e.name,"[z] = new Array(outputY);\n")})).join("      "),"\n      for (let y = 0; y < outputY; y++) {\n        this.thread.y = y;\n        const resultX = resultY[y] = new ").concat(t,"(outputX);\n        ").concat(this._mapSubKernels((function(e){return"const resultX_".concat(e.name," = resultY_").concat(e.name,"[y] = new ").concat(t,"(outputX);\n")})).join("        "),"\n        for (let x = 0; x < outputX; x++) {\n          this.thread.x = x;\n          ").concat(e,"\n        }\n      }\n    }")}},{key:"_kernelOutput",value:function(){return this.subKernels?"\n    return {\n      result: result,\n      ".concat(this.subKernels.map((function(e){return"".concat(e.property,": result_").concat(e.name)})).join(",\n      "),"\n    };"):"\n    return result;"}},{key:"_mapSubKernels",value:function(e){return null===this.subKernels?[""]:this.subKernels.map(e)}},{key:"destroy",value:function(e){e&&delete this.canvas}},{key:"toJSON",value:function(){var e=o(a(t.prototype),"toJSON",this).call(this);return e.functionNodes=h.fromKernel(this,p).toJSON(),e}},{key:"setOutput",value:function(e){o(a(t.prototype),"setOutput",this).call(this,e);var r=n(this.output,2),i=r[0],s=r[1];this.graphical&&(this._imageData=this.context.createImageData(i,s),this._colorData=new Uint8ClampedArray(i*s*4))}}],[{key:"destroyContext",value:function(e){}}]),t}(l);e.exports={CPUKernel:m}},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"astFunction",value:function(e,t){if(!this.isRootKernel){t.push("function"),t.push(" "),t.push(this.name),t.push("(");for(var r=0;r<this.argumentNames.length;++r){var n=this.argumentNames[r];r>0&&t.push(", "),t.push("user_"),t.push(n)}t.push(") {\n")}for(var i=0;i<e.body.body.length;++i)this.astGeneric(e.body.body[i],t),t.push("\n");return this.isRootKernel||t.push("}\n"),t}},{key:"astReturnStatement",value:function(e,t){var r=this.returnType||this.getType(e.argument);return this.returnType||(this.returnType=r),this.isRootKernel?(t.push(this.leadingReturnStatement),this.astGeneric(e.argument,t),t.push(";\n"),t.push(this.followingReturnStatement),t.push("continue;\n")):this.isSubKernel?(t.push("subKernelResult_".concat(this.name," = ")),this.astGeneric(e.argument,t),t.push(";"),t.push("return subKernelResult_".concat(this.name,";"))):(t.push("return "),this.astGeneric(e.argument,t),t.push(";")),t}},{key:"astLiteral",value:function(e,t){if(isNaN(e.value))throw this.astErrorOutput("Non-numeric literal not supported : "+e.value,e);return t.push(e.value),t}},{key:"astBinaryExpression",value:function(e,t){return t.push("("),this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t),t.push(")"),t}},{key:"astIdentifierExpression",value:function(e,t){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e);switch(e.name){case"Infinity":t.push("Infinity");break;default:if(this.constants&&this.constants.hasOwnProperty(e.name))t.push("constants_"+e.name);else{var r=this.getKernelArgumentName(e.name);r?t.push("user_"+r):t.push("user_"+e.name)}}return t}},{key:"astForStatement",value:function(e,t){if("ForStatement"!==e.type)throw this.astErrorOutput("Invalid for statement",e);var r=[],n=[],i=[],s=[],a=null;if(e.init){this.pushState("in-for-loop-init"),this.astGeneric(e.init,r);for(var o=0;o<r.length;o++)r[o].includes&&r[o].includes(",")&&(a=!1);this.popState("in-for-loop-init")}else a=!1;if(e.test?this.astGeneric(e.test,n):a=!1,e.update?this.astGeneric(e.update,i):a=!1,e.body&&(this.pushState("loop-body"),this.astGeneric(e.body,s),this.popState("loop-body")),null===a&&(a=this.isSafe(e.init)&&this.isSafe(e.test)),a)t.push("for (".concat(r.join(""),";").concat(n.join(""),";").concat(i.join(""),"){\n")),t.push(s.join("")),t.push("}\n");else{var u=this.getInternalVariableName("safeI");r.length>0&&t.push(r.join(""),";\n"),t.push("for (let ".concat(u,"=0;").concat(u,"<LOOP_MAX;").concat(u,"++){\n")),n.length>0&&t.push("if (!".concat(n.join(""),") break;\n")),t.push(s.join("")),t.push("\n".concat(i.join(""),";")),t.push("}\n")}return t}},{key:"astWhileStatement",value:function(e,t){if("WhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statement",e);return t.push("for (let i = 0; i < LOOP_MAX; i++) {"),t.push("if ("),this.astGeneric(e.test,t),t.push(") {\n"),this.astGeneric(e.body,t),t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astDoWhileStatement",value:function(e,t){if("DoWhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statement",e);return t.push("for (let i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(e.body,t),t.push("if (!"),this.astGeneric(e.test,t),t.push(") {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astAssignmentExpression",value:function(e,t){var r=this.getDeclaration(e.left);if(r&&!r.assignable)throw new this.astErrorOutput("Variable ".concat(e.left.name," is not assignable here"),e);return this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t),t}},{key:"astBlockStatement",value:function(e,t){if(this.isState("loop-body")){this.pushState("block-body");for(var r=0;r<e.body.length;r++)this.astGeneric(e.body[r],t);this.popState("block-body")}else{t.push("{\n");for(var n=0;n<e.body.length;n++)this.astGeneric(e.body[n],t);t.push("}\n")}return t}},{key:"astVariableDeclaration",value:function(e,t){"var"===e.kind&&this.warnVarUsage&&this.varWarn(),t.push("".concat(e.kind," "));for(var r=e.declarations,n=0;n<r.length;n++)n>0&&t.push(","),this.astGeneric(r[n],t);return this.isState("in-for-loop-init")||t.push(";"),t}},{key:"astIfStatement",value:function(e,t){return t.push("if ("),this.astGeneric(e.test,t),t.push(")"),"BlockStatement"===e.consequent.type?this.astGeneric(e.consequent,t):(t.push(" {\n"),this.astGeneric(e.consequent,t),t.push("\n}\n")),e.alternate&&(t.push("else "),"BlockStatement"===e.alternate.type?this.astGeneric(e.alternate,t):(t.push(" {\n"),this.astGeneric(e.alternate,t),t.push("\n}\n"))),t}},{key:"astSwitchStatement",value:function(e,t){var r=e.discriminant,n=e.cases;t.push("switch ("),this.astGeneric(r,t),t.push(") {\n");for(var i=0;i<n.length;i++)null!==n[i].test?(t.push("case "),this.astGeneric(n[i].test,t),t.push(":\n"),n[i].consequent&&n[i].consequent.length>0&&(this.astGeneric(n[i].consequent,t),t.push("break;\n"))):(t.push("default:\n"),this.astGeneric(n[i].consequent,t),n[i].consequent&&n[i].consequent.length>0&&t.push("break;\n"));t.push("\n}")}},{key:"astThisExpression",value:function(e,t){return t.push("_this"),t}},{key:"astMemberExpression",value:function(e,t){var r=this.getMemberExpressionDetails(e),n=r.signature,i=r.type,s=r.property,a=r.xProperty,o=r.yProperty,u=r.zProperty,c=r.name,l=r.origin;switch(n){case"this.thread.value":return t.push("_this.thread.".concat(c)),t;case"this.output.value":switch(c){case"x":t.push("outputX");break;case"y":t.push("outputY");break;case"z":t.push("outputZ");break;default:throw this.astErrorOutput("Unexpected expression",e)}return t;case"value":throw this.astErrorOutput("Unexpected expression",e);case"value[]":case"value[][]":case"value[][][]":case"value.value":if("Math"===l)return t.push(Math[c]),t;switch(s){case"r":return t.push("user_".concat(c,"[0]")),t;case"g":return t.push("user_".concat(c,"[1]")),t;case"b":return t.push("user_".concat(c,"[2]")),t;case"a":return t.push("user_".concat(c,"[3]")),t}break;case"this.constants.value":case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":break;case"fn()[]":return this.astGeneric(e.object,t),t.push("["),this.astGeneric(e.property,t),t.push("]"),t;default:throw this.astErrorOutput("Unexpected expression",e)}if(!e.computed)switch(i){case"Number":case"Integer":case"Float":case"Boolean":return t.push("".concat(l,"_").concat(c)),t}var h=this.getKernelArgumentName(c),p="".concat(l,"_").concat(h||c);switch(i){case"Array(2)":case"Array(3)":case"Array(4)":case"HTMLImageArray":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"HTMLImage":default:var f,d;if("constants"===l){var m=this.constants[c];f=(d="Input"===this.constantTypes[c])?m.size:null}else f=(d=this.isInput(h||c))?this.argumentSizes[this.argumentNames.indexOf(c)]:null;t.push("".concat(p)),u&&o?d?(t.push("[("),this.astGeneric(u,t),t.push("*".concat(this.dynamicArguments?"(outputY * outputX)":f[1]*f[0],")+(")),this.astGeneric(o,t),t.push("*".concat(this.dynamicArguments?"outputX":f[0],")+")),this.astGeneric(a,t),t.push("]")):(t.push("["),this.astGeneric(u,t),t.push("]"),t.push("["),this.astGeneric(o,t),t.push("]"),t.push("["),this.astGeneric(a,t),t.push("]")):o?d?(t.push("[("),this.astGeneric(o,t),t.push("*".concat(this.dynamicArguments?"outputX":f[0],")+")),this.astGeneric(a,t),t.push("]")):(t.push("["),this.astGeneric(o,t),t.push("]"),t.push("["),this.astGeneric(a,t),t.push("]")):"undefined"!==typeof a&&(t.push("["),this.astGeneric(a,t),t.push("]"))}return t}},{key:"astCallExpression",value:function(e,t){if("CallExpression"!==e.type)throw this.astErrorOutput("Unknown CallExpression",e);var r=this.astMemberExpressionUnroll(e.callee);this.calledFunctions.indexOf(r)<0&&this.calledFunctions.push(r);this.isAstMathFunction(e);this.onFunctionCall&&this.onFunctionCall(this.name,r,e.arguments),t.push(r),t.push("(");for(var n=this.lookupFunctionArgumentTypes(r)||[],i=0;i<e.arguments.length;++i){var s=e.arguments[i],a=this.getType(s);n[i]||this.triggerImplyArgumentType(r,i,a,this),i>0&&t.push(", "),this.astGeneric(s,t)}return t.push(")"),t}},{key:"astArrayExpression",value:function(e,t){var r=e.elements.length;t.push("new Float32Array([");for(var n=0;n<r;++n){n>0&&t.push(", ");var i=e.elements[n];this.astGeneric(i,t)}return t.push("])"),t}},{key:"astDebuggerStatement",value:function(e,t){return t.push("debugger;"),t}}]),t}(r(18).FunctionNode);e.exports={CPUFunctionNode:u}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(75),l=r(15).WebGLKernel,h=r(44).glKernelString,p=null,f=null,d=null,m=null,g=null,y=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"initCanvas",value:function(){return{}}},{key:"initContext",value:function(){return c(2,2,{preserveDrawingBuffer:!0})}},{key:"initExtensions",value:function(){this.extensions={STACKGL_resize_drawingbuffer:this.context.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:this.context.getExtension("STACKGL_destroy_context"),OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers")}}},{key:"build",value:function(){o(a(t.prototype),"build",this).apply(this,arguments),this.fallbackRequested||this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1])}},{key:"destroyExtensions",value:function(){this.extensions.STACKGL_resize_drawingbuffer=null,this.extensions.STACKGL_destroy_context=null,this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}},{key:"toString",value:function(){var e="const gl = context || require('gl')(1, 1);\n",t="if (!context) { gl.getExtension('STACKGL_destroy_context').destroy(); }\n";return h(this.constructor,arguments,this,e,t)}},{key:"setOutput",value:function(e){o(a(t.prototype),"setOutput",this).call(this,e),this.graphical&&this.extensions.STACKGL_resize_drawingbuffer&&this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1])}}],[{key:"setupFeatureChecks",value:function(){if(f=null,m=null,"function"===typeof c)try{if(!(d=c(2,2,{preserveDrawingBuffer:!0}))||!d.getExtension)return;m={STACKGL_resize_drawingbuffer:d.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:d.getExtension("STACKGL_destroy_context"),OES_texture_float:d.getExtension("OES_texture_float"),OES_texture_float_linear:d.getExtension("OES_texture_float_linear"),OES_element_index_uint:d.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:d.getExtension("WEBGL_draw_buffers")},g=this.getFeatures()}catch(e){console.warn(e)}}},{key:"isContextMatch",value:function(e){try{return"ANGLE"===e.getParameter(e.RENDERER)}catch(t){return!1}}},{key:"getFeatures",value:function(){var e=this.getIsDrawBuffers();return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isTextureFloat:this.getIsTextureFloat(),isDrawBuffers:e,kernelMap:e,channelCount:this.getChannelCount()})}},{key:"getIsTextureFloat",value:function(){return Boolean(m.OES_texture_float)}},{key:"getIsDrawBuffers",value:function(){return Boolean(m.WEBGL_draw_buffers)}},{key:"getChannelCount",value:function(){return m.WEBGL_draw_buffers?d.getParameter(m.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}},{key:"destroyContext",value:function(e){var t=e.getExtension("STACKGL_destroy_context");t&&t.destroy&&t.destroy()}},{key:"isSupported",get:function(){return null!==p?p:(this.setupFeatureChecks(),p=null!==d)}},{key:"testCanvas",get:function(){return f}},{key:"testContext",get:function(){return d}},{key:"features",get:function(){return g}}]),t}(l);e.exports={HeadlessGLKernel:y}},function(e,t,r){"use strict";function n(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(e){return(e>0)-(e<0)},t.abs=function(e){var t=e>>31;return(e^t)-t},t.min=function(e,t){return t^(e^t)&-(e<t)},t.max=function(e,t){return e^(e^t)&-(e<t)},t.isPow2=function(e){return!(e&e-1)&&!!e},t.log2=function(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1},t.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},t.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},t.countTrailingZeros=n,t.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},t.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var i=new Array(256);!function(e){for(var t=0;t<256;++t){var r=t,n=t,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;e[t]=n<<i&255}}(i),t.reverse=function(e){return i[255&e]<<24|i[e>>>8&255]<<16|i[e>>>16&255]<<8|i[e>>>24&255]},t.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},t.interleave3=function(e,t,r){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},t.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},t.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>n(e)+1}},function(e,t){e.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},function(e,t){e.exports=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]},function(e,t,r){(function(e){function r(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function n(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}t.resolve=function(){for(var t="",i=!1,s=arguments.length-1;s>=-1&&!i;s--){var a=s>=0?arguments[s]:e.cwd();if("string"!==typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(t=a+"/"+t,i="/"===a.charAt(0))}return(i?"/":"")+(t=r(n(t.split("/"),(function(e){return!!e})),!i).join("/"))||"."},t.normalize=function(e){var s=t.isAbsolute(e),a="/"===i(e,-1);return(e=r(n(e.split("/"),(function(e){return!!e})),!s).join("/"))||s||(e="."),e&&a&&(e+="/"),(s?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(n(e,(function(e,t){if("string"!==typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,r){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var i=n(e.split("/")),s=n(r.split("/")),a=Math.min(i.length,s.length),o=a,u=0;u<a;u++)if(i[u]!==s[u]){o=u;break}var c=[];for(u=o;u<i.length;u++)c.push("..");return(c=c.concat(s.slice(o))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!==typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),r=47===t,n=-1,i=!0,s=e.length-1;s>=1;--s)if(47===(t=e.charCodeAt(s))){if(!i){n=s;break}}else i=!1;return-1===n?r?"/":".":r&&1===n?"/":e.slice(0,n)},t.basename=function(e,t){var r=function(e){"string"!==typeof e&&(e+="");var t,r=0,n=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){r=t+1;break}}else-1===n&&(i=!1,n=t+1);return-1===n?"":e.slice(r,n)}(e);return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){"string"!==typeof e&&(e+="");for(var t=-1,r=0,n=-1,i=!0,s=0,a=e.length-1;a>=0;--a){var o=e.charCodeAt(a);if(47!==o)-1===n&&(i=!1,n=a+1),46===o?-1===t?t=a:1!==s&&(s=1):-1!==t&&(s=-1);else if(!i){r=a+1;break}}return-1===t||-1===n||0===s||1===s&&t===n-1&&t===r+1?"":e.slice(t,n)};var i="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(this,r(19))},function(e,t,r){(function(t){var n=r(9).gl,i=r(42).WebGLUniformLocation;function s(e){return new Uint8Array(e.buffer).subarray(e.byteOffset,e.byteLength+e.byteOffset)}e.exports={bindPublics:function(e,t,r,n){for(var i=0;i<e.length;i++){var s=e[i],a=r[s];if("function"===typeof a)-1===n.indexOf(s)&&(t[s]=a.bind(r));else{if("_"===s[0]||"0"===s[0]||"1"===s[0])continue;t[s]=a}}},checkObject:function(e){return"object"===typeof e||void 0===e},isTypedArray:function(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Uint32Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array},isValidString:function(e){var t=e.replace(/(?:\/\*(?:[\s\S]*?)\*\/)|(?:([\s;])+\/\/(?:.*)$)/gm,"");return!/["$`@\\'\0]/.test(t)},vertexCount:function(e,t){switch(e){case n.TRIANGLES:return t-t%3;case n.LINES:return t-t%2;case n.LINE_LOOP:case n.POINTS:return t;case n.TRIANGLE_FAN:case n.LINE_STRIP:return t<2?0:t;case n.TRIANGLE_STRIP:return t<3?0:t;default:return-1}},typeSize:function(e){switch(e){case n.UNSIGNED_BYTE:case n.BYTE:return 1;case n.UNSIGNED_SHORT:case n.SHORT:return 2;case n.UNSIGNED_INT:case n.INT:case n.FLOAT:return 4}return 0},uniformTypeSize:function(e){switch(e){case n.BOOL_VEC4:case n.INT_VEC4:case n.FLOAT_VEC4:return 4;case n.BOOL_VEC3:case n.INT_VEC3:case n.FLOAT_VEC3:return 3;case n.BOOL_VEC2:case n.INT_VEC2:case n.FLOAT_VEC2:return 2;case n.BOOL:case n.INT:case n.FLOAT:case n.SAMPLER_2D:case n.SAMPLER_CUBE:return 1;default:return 0}},unpackTypedArray:s,extractImageData:function(e){if("object"===typeof e&&"undefined"!==typeof e.width&&"undefined"!==typeof e.height){if("undefined"!==typeof e.data)return e;var t=null;if("function"===typeof e.getContext)t=e.getContext("2d");else if("undefined"!==typeof e.src&&"object"===typeof document&&"function"===typeof document.createElement){var r=document.createElement("canvas");"object"===typeof r&&"function"===typeof r.getContext&&null!==(t=r.getContext("2d"))&&t.drawImage(e,0,0)}if(null!==t)return t.getImageData(0,0,e.width,e.height)}return null},formatSize:function(e){switch(e){case n.ALPHA:case n.LUMINANCE:return 1;case n.LUMINANCE_ALPHA:return 2;case n.RGB:return 3;case n.RGBA:return 4}return 0},checkFormat:function(e){return e===n.ALPHA||e===n.LUMINANCE_ALPHA||e===n.LUMINANCE||e===n.RGB||e===n.RGBA},checkUniform:function(e,t){return t instanceof i&&t._program===e&&t._linkCount===e._linkCount},convertPixels:function(e){if("object"===typeof e&&null!==e){if(e instanceof ArrayBuffer)return new Uint8Array(e);if(e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint8ClampedArray||e instanceof Float32Array)return s(e);if(e instanceof t)return new Uint8Array(e)}return null},validCubeTarget:function(e){return e===n.TEXTURE_CUBE_MAP_POSITIVE_X||e===n.TEXTURE_CUBE_MAP_NEGATIVE_X||e===n.TEXTURE_CUBE_MAP_POSITIVE_Y||e===n.TEXTURE_CUBE_MAP_NEGATIVE_Y||e===n.TEXTURE_CUBE_MAP_POSITIVE_Z||e===n.TEXTURE_CUBE_MAP_NEGATIVE_Z}}}).call(this,r(90).Buffer)},function(e,t,r){var n=r(0);e.exports={WebGLUniformLocation:function e(t,r,i){"use strict";n(this,e),this._=t,this._program=r,this._linkCount=r._linkCount,this._activeInfo=i,this._array=null}}},function(e,t,r){var n=r(10),i=r(0),s=r(3),a=r(2),o=r(6),u=r(1),c=r(4),l=r(17).Kernel,h=(r(13).Texture,r(5).utils),p=r(111).GLTextureArray2Float,f=r(112).GLTextureArray2Float2D,d=r(113).GLTextureArray2Float3D,m=r(114).GLTextureArray3Float,g=r(115).GLTextureArray3Float2D,y=r(116).GLTextureArray3Float3D,_=r(117).GLTextureArray4Float,x=r(118).GLTextureArray4Float2D,v=r(119).GLTextureArray4Float3D,T=r(8).GLTextureFloat,E=r(120).GLTextureFloat2D,A=r(121).GLTextureFloat3D,b=r(122).GLTextureMemoryOptimized,S=r(123).GLTextureMemoryOptimized2D,I=r(124).GLTextureMemoryOptimized3D,k=r(16).GLTextureUnsigned,R=r(125).GLTextureUnsigned2D,L=r(126).GLTextureUnsigned3D,w=r(127).GLTextureGraphical,D=function(e){"use strict";function t(e,r){var n;return i(this,t),(n=s(this,a(t).call(this,e,r))).transferValues=null,n.formatValues=null,n.TextureConstructor=null,n.renderOutput=null,n.renderRawOutput=null,n.texSize=null,n.translatedSource=null,n.renderStrategy=null,n.compiledFragmentShader=null,n.compiledVertexShader=null,n}return c(t,e),u(t,[{key:"setFixIntegerDivisionAccuracy",value:function(e){return this.fixIntegerDivisionAccuracy=e,this}},{key:"setPrecision",value:function(e){return this.precision=e,this}},{key:"setFloatTextures",value:function(e){return h.warnDeprecated("method","setFloatTextures","setOptimizeFloatMemory"),this.floatTextures=e,this}}],[{key:"getIsFloatRead",value:function(){var e=new this("function kernelFunction() {\n      return 1;\n    }",{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[1],precision:"single",returnType:"Number",tactic:"speed"});e.build(),e.run();var t=e.renderOutput();return e.destroy(!0),1===t[0]}},{key:"getIsIntegerDivisionAccurate",value:function(){var e=new this(function(e,t){return e[this.thread.x]/t[this.thread.x]}.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[2],returnType:"Number",precision:"unsigned",tactic:"speed"}),t=[[6,6030401],[3,3991]];e.build.apply(e,t),e.run.apply(e,t);var r=e.renderOutput();return e.destroy(!0),2===r[0]&&1511===r[1]}},{key:"setupFeatureChecks",value:function(){throw new Error('"setupFeatureChecks" not defined on '.concat(this.name))}},{key:"nativeFunctionArguments",value:function(e){for(var t=[],r=[],n=[],i=/^[a-zA-Z_]/,s=/[a-zA-Z_0-9]/,a=0,o=null,u=null;a<e.length;){var c=e[a],l=e[a+1],h=n.length>0?n[n.length-1]:null;if("FUNCTION_ARGUMENTS"!==h||"/"!==c||"*"!==l)if("MULTI_LINE_COMMENT"!==h||"*"!==c||"/"!==l)if("FUNCTION_ARGUMENTS"!==h||"/"!==c||"/"!==l)if("COMMENT"!==h||"\n"!==c)if(null!==h||"("!==c){if("FUNCTION_ARGUMENTS"===h){if(")"===c){n.pop();break}if("f"===c&&"l"===l&&"o"===e[a+2]&&"a"===e[a+3]&&"t"===e[a+4]&&" "===e[a+5]){n.push("DECLARE_VARIABLE"),u="float",o="",a+=6;continue}if("i"===c&&"n"===l&&"t"===e[a+2]&&" "===e[a+3]){n.push("DECLARE_VARIABLE"),u="int",o="",a+=4;continue}if("v"===c&&"e"===l&&"c"===e[a+2]&&"2"===e[a+3]&&" "===e[a+4]){n.push("DECLARE_VARIABLE"),u="vec2",o="",a+=5;continue}if("v"===c&&"e"===l&&"c"===e[a+2]&&"3"===e[a+3]&&" "===e[a+4]){n.push("DECLARE_VARIABLE"),u="vec3",o="",a+=5;continue}if("v"===c&&"e"===l&&"c"===e[a+2]&&"4"===e[a+3]&&" "===e[a+4]){n.push("DECLARE_VARIABLE"),u="vec4",o="",a+=5;continue}}else if("DECLARE_VARIABLE"===h){if(""===o){if(" "===c){a++;continue}if(!i.test(c))throw new Error("variable name is not expected string")}o+=c,s.test(l)||(n.pop(),r.push(o),t.push(C[u]))}a++}else n.push("FUNCTION_ARGUMENTS"),a++;else n.pop(),a++;else n.push("COMMENT"),a+=2;else n.pop(),a+=2;else n.push("MULTI_LINE_COMMENT"),a+=2}if(n.length>0)throw new Error("GLSL function was not parsable");return{argumentNames:r,argumentTypes:t}}},{key:"nativeFunctionReturnType",value:function(e){return C[e.match(/int|float|vec[2-4]/)[0]]}},{key:"combineKernels",value:function(e,t){e.apply(null,arguments);var r,n=t.texSize,i=n.texSize,s=n.context,a=n.threadDim;if("single"===t.precision){var o=i[0],u=Math.ceil(i[1]/4);r=new Float32Array(o*u*4*4),s.readPixels(0,0,o,4*u,s.RGBA,s.FLOAT,r)}else{var c=new Uint8Array(i[0]*i[1]*4);s.readPixels(0,0,i[0],i[1],s.RGBA,s.UNSIGNED_BYTE,c),r=new Float32Array(c.buffer)}if(r=r.subarray(0,a[0]*a[1]*a[2]),1===t.output.length)return r;if(2===t.output.length)return h.splitArray(r,t.output[0]);if(3===t.output.length){var l=h.splitArray(r,t.output[0]*t.output[1]);return l.map((function(e){return h.splitArray(e,t.output[0])}))}}},{key:"mode",get:function(){return"gpu"}},{key:"testCanvas",get:function(){throw new Error('"testCanvas" not defined on '.concat(this.name))}},{key:"testContext",get:function(){throw new Error('"testContext" not defined on '.concat(this.name))}},{key:"features",get:function(){throw new Error('"features" not defined on '.concat(this.name))}}]),u(t,[{key:"translateSource",value:function(){throw new Error('"translateSource" not defined on '.concat(this.constructor.name))}},{key:"pickRenderStrategy",value:function(e){if(this.graphical)return this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=function(e){return e},this.TextureConstructor=w,null;if("unsigned"===this.precision)if(this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=this.readPackedPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,null!==this.subKernels&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=L,this.renderStrategy=N.PackedPixelTo3DFloat,null):this.output[1]>0?(this.TextureConstructor=R,this.renderStrategy=N.PackedPixelTo2DFloat,null):(this.TextureConstructor=k,this.renderStrategy=N.PackedPixelToFloat,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(e)}else switch(null!==this.subKernels&&(this.renderKernels=this.renderKernelsToArrays),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.renderOutput=this.renderValues,this.output[2]>0?(this.TextureConstructor=L,this.renderStrategy=N.PackedPixelTo3DFloat,this.formatValues=h.erect3DPackedFloat,null):this.output[1]>0?(this.TextureConstructor=R,this.renderStrategy=N.PackedPixelTo2DFloat,this.formatValues=h.erect2DPackedFloat,null):(this.TextureConstructor=k,this.renderStrategy=N.PackedPixelToFloat,this.formatValues=h.erectPackedFloat,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(e)}else{if("single"!==this.precision)throw new Error('unhandled precision of "'.concat(this.precision,'"'));if(this.renderRawOutput=this.readFloatPixelsToFloat32Array,this.transferValues=this.readFloatPixelsToFloat32Array,this.pipeline)switch(this.renderStrategy=N.FloatTexture,this.renderOutput=this.renderTexture,null!==this.subKernels&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.optimizeFloatMemory?this.output[2]>0?(this.TextureConstructor=I,null):this.output[1]>0?(this.TextureConstructor=S,null):(this.TextureConstructor=b,null):this.output[2]>0?(this.TextureConstructor=A,null):this.output[1]>0?(this.TextureConstructor=E,null):(this.TextureConstructor=T,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=d,null):this.output[1]>0?(this.TextureConstructor=f,null):(this.TextureConstructor=p,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=y,null):this.output[1]>0?(this.TextureConstructor=g,null):(this.TextureConstructor=m,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=v,null):this.output[1]>0?(this.TextureConstructor=x,null):(this.TextureConstructor=_,null)}if(this.renderOutput=this.renderValues,null!==this.subKernels&&(this.renderKernels=this.renderKernelsToArrays),this.optimizeFloatMemory)switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=I,this.renderStrategy=N.MemoryOptimizedFloatPixelToMemoryOptimized3DFloat,this.formatValues=h.erectMemoryOptimized3DFloat,null):this.output[1]>0?(this.TextureConstructor=S,this.renderStrategy=N.MemoryOptimizedFloatPixelToMemoryOptimized2DFloat,this.formatValues=h.erectMemoryOptimized2DFloat,null):(this.TextureConstructor=b,this.renderStrategy=N.MemoryOptimizedFloatPixelToMemoryOptimizedFloat,this.formatValues=h.erectMemoryOptimizedFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=d,this.renderStrategy=N.FloatPixelTo3DArray2,this.formatValues=h.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=f,this.renderStrategy=N.FloatPixelTo2DArray2,this.formatValues=h.erect2DArray2,null):(this.TextureConstructor=p,this.renderStrategy=N.FloatPixelToArray2,this.formatValues=h.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=y,this.renderStrategy=N.FloatPixelTo3DArray3,this.formatValues=h.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=g,this.renderStrategy=N.FloatPixelTo2DArray3,this.formatValues=h.erect2DArray3,null):(this.TextureConstructor=m,this.renderStrategy=N.FloatPixelToArray3,this.formatValues=h.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=v,this.renderStrategy=N.FloatPixelTo3DArray4,this.formatValues=h.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=x,this.renderStrategy=N.FloatPixelTo2DArray4,this.formatValues=h.erect2DArray4,null):(this.TextureConstructor=_,this.renderStrategy=N.FloatPixelToArray4,this.formatValues=h.erectArray4,null)}else switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=A,this.renderStrategy=N.FloatPixelTo3DFloat,this.formatValues=h.erect3DFloat,null):this.output[1]>0?(this.TextureConstructor=E,this.renderStrategy=N.FloatPixelTo2DFloat,this.formatValues=h.erect2DFloat,null):(this.TextureConstructor=T,this.renderStrategy=N.FloatPixelToFloat,this.formatValues=h.erectFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=d,this.renderStrategy=N.FloatPixelTo3DArray2,this.formatValues=h.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=f,this.renderStrategy=N.FloatPixelTo2DArray2,this.formatValues=h.erect2DArray2,null):(this.TextureConstructor=p,this.renderStrategy=N.FloatPixelToArray2,this.formatValues=h.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=y,this.renderStrategy=N.FloatPixelTo3DArray3,this.formatValues=h.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=g,this.renderStrategy=N.FloatPixelTo2DArray3,this.formatValues=h.erect2DArray3,null):(this.TextureConstructor=m,this.renderStrategy=N.FloatPixelToArray3,this.formatValues=h.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=v,this.renderStrategy=N.FloatPixelTo3DArray4,this.formatValues=h.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=x,this.renderStrategy=N.FloatPixelTo2DArray4,this.formatValues=h.erect2DArray4,null):(this.TextureConstructor=_,this.renderStrategy=N.FloatPixelToArray4,this.formatValues=h.erectArray4,null)}}throw new Error('unhandled return type "'.concat(this.returnType,'"'))}},{key:"getKernelString",value:function(){throw new Error("abstract method call")}},{key:"getMainResultTexture",value:function(){switch(this.returnType){case"LiteralInteger":case"Float":case"Integer":case"Number":return this.getMainResultNumberTexture();case"Array(2)":return this.getMainResultArray2Texture();case"Array(3)":return this.getMainResultArray3Texture();case"Array(4)":return this.getMainResultArray4Texture();default:throw new Error("unhandled returnType type ".concat(this.returnType))}}},{key:"getMainResultKernelNumberTexture",value:function(){throw new Error("abstract method call")}},{key:"getMainResultSubKernelNumberTexture",value:function(){throw new Error("abstract method call")}},{key:"getMainResultKernelArray2Texture",value:function(){throw new Error("abstract method call")}},{key:"getMainResultSubKernelArray2Texture",value:function(){throw new Error("abstract method call")}},{key:"getMainResultKernelArray3Texture",value:function(){throw new Error("abstract method call")}},{key:"getMainResultSubKernelArray3Texture",value:function(){throw new Error("abstract method call")}},{key:"getMainResultKernelArray4Texture",value:function(){throw new Error("abstract method call")}},{key:"getMainResultSubKernelArray4Texture",value:function(){throw new Error("abstract method call")}},{key:"getMainResultGraphical",value:function(){throw new Error("abstract method call")}},{key:"getMainResultMemoryOptimizedFloats",value:function(){throw new Error("abstract method call")}},{key:"getMainResultPackedPixels",value:function(){throw new Error("abstract method call")}},{key:"getMainResultString",value:function(){return this.graphical?this.getMainResultGraphical():"single"===this.precision?this.optimizeFloatMemory?this.getMainResultMemoryOptimizedFloats():this.getMainResultTexture():this.getMainResultPackedPixels()}},{key:"getMainResultNumberTexture",value:function(){return h.linesToString(this.getMainResultKernelNumberTexture())+h.linesToString(this.getMainResultSubKernelNumberTexture())}},{key:"getMainResultArray2Texture",value:function(){return h.linesToString(this.getMainResultKernelArray2Texture())+h.linesToString(this.getMainResultSubKernelArray2Texture())}},{key:"getMainResultArray3Texture",value:function(){return h.linesToString(this.getMainResultKernelArray3Texture())+h.linesToString(this.getMainResultSubKernelArray3Texture())}},{key:"getMainResultArray4Texture",value:function(){return h.linesToString(this.getMainResultKernelArray4Texture())+h.linesToString(this.getMainResultSubKernelArray4Texture())}},{key:"getFloatTacticDeclaration",value:function(){switch(this.tactic){case"speed":return"precision lowp float;\n";case"performance":return"precision highp float;\n";case"balanced":default:return"precision mediump float;\n"}}},{key:"getIntTacticDeclaration",value:function(){switch(this.tactic){case"speed":return"precision lowp int;\n";case"performance":return"precision highp int;\n";case"balanced":default:return"precision mediump int;\n"}}},{key:"getSampler2DTacticDeclaration",value:function(){switch(this.tactic){case"speed":return"precision lowp sampler2D;\n";case"performance":return"precision highp sampler2D;\n";case"balanced":default:return"precision mediump sampler2D;\n"}}},{key:"getSampler2DArrayTacticDeclaration",value:function(){switch(this.tactic){case"speed":return"precision lowp sampler2DArray;\n";case"performance":return"precision highp sampler2DArray;\n";case"balanced":default:return"precision mediump sampler2DArray;\n"}}},{key:"renderTexture",value:function(){return new this.TextureConstructor({texture:this.outputTexture,size:this.texSize,dimensions:this.threadDim,output:this.output,context:this.context})}},{key:"readPackedPixelsToUint8Array",value:function(){if("unsigned"!==this.precision)throw new Error('Requires this.precision to be "unsigned"');var e=this.texSize,t=this.context,r=new Uint8Array(e[0]*e[1]*4);return t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,r),r}},{key:"readPackedPixelsToFloat32Array",value:function(){return new Float32Array(this.readPackedPixelsToUint8Array().buffer)}},{key:"readFloatPixelsToFloat32Array",value:function(){if("single"!==this.precision)throw new Error('Requires this.precision to be "single"');var e=this.texSize,t=this.context,r=e[0],n=e[1],i=new Float32Array(r*n*4);return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,i),i}},{key:"readMemoryOptimizedFloatPixelsToFloat32Array",value:function(){if("single"!==this.precision)throw new Error('Requires this.precision to be "single"');var e=this.texSize,t=this.context,r=e[0],n=e[1],i=new Float32Array(r*n*4);return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,i),i}},{key:"getPixels",value:function(e){var t=this.context,r=this.output,i=n(r,2),s=i[0],a=i[1],o=new Uint8Array(s*a*4);return t.readPixels(0,0,s,a,t.RGBA,t.UNSIGNED_BYTE,o),new Uint8ClampedArray((e?o:h.flipPixels(o,s,a)).buffer)}},{key:"renderKernelsToArrays",value:function(){for(var e={result:this.renderOutput()},t=0;t<this.subKernels.length;t++)e[this.subKernels[t].property]=new this.TextureConstructor({texture:this.subKernelOutputTextures[t],size:this.texSize,dimensions:this.threadDim,output:this.output,context:this.context}).toArray();return e}},{key:"renderKernelsToTextures",value:function(){for(var e={result:this.renderOutput()},t=0;t<this.subKernels.length;t++)e[this.subKernels[t].property]=new this.TextureConstructor({texture:this.subKernelOutputTextures[t],size:this.texSize,dimensions:this.threadDim,output:this.output,context:this.context});return e}},{key:"setOutput",value:function(e){if(o(a(t.prototype),"setOutput",this).call(this,e),this.program){this.threadDim=[this.output[0],this.output[1]||1,this.output[2]||1],this.texSize=h.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output);var r=this.context;r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),this.updateMaxTexSize(),this.framebuffer.width=this.texSize[0],this.framebuffer.height=this.texSize[1],this.context.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),this.canvas.width=this.maxTexSize[0],this.canvas.height=this.maxTexSize[1],this._setupOutputTexture(),this.subKernels&&this.subKernels.length>0&&this._setupSubOutputTextures()}return this}},{key:"renderValues",value:function(){return this.formatValues(this.transferValues(),this.output[0],this.output[1],this.output[2])}}]),t}(l),N=Object.freeze({PackedPixelToUint8Array:Symbol("PackedPixelToUint8Array"),PackedPixelToFloat:Symbol("PackedPixelToFloat"),PackedPixelTo2DFloat:Symbol("PackedPixelTo2DFloat"),PackedPixelTo3DFloat:Symbol("PackedPixelTo3DFloat"),PackedTexture:Symbol("PackedTexture"),FloatPixelToFloat32Array:Symbol("FloatPixelToFloat32Array"),FloatPixelToFloat:Symbol("FloatPixelToFloat"),FloatPixelTo2DFloat:Symbol("FloatPixelTo2DFloat"),FloatPixelTo3DFloat:Symbol("FloatPixelTo3DFloat"),FloatPixelToArray2:Symbol("FloatPixelToArray2"),FloatPixelTo2DArray2:Symbol("FloatPixelTo2DArray2"),FloatPixelTo3DArray2:Symbol("FloatPixelTo3DArray2"),FloatPixelToArray3:Symbol("FloatPixelToArray3"),FloatPixelTo2DArray3:Symbol("FloatPixelTo2DArray3"),FloatPixelTo3DArray3:Symbol("FloatPixelTo3DArray3"),FloatPixelToArray4:Symbol("FloatPixelToArray4"),FloatPixelTo2DArray4:Symbol("FloatPixelTo2DArray4"),FloatPixelTo3DArray4:Symbol("FloatPixelTo3DArray4"),FloatTexture:Symbol("FloatTexture"),MemoryOptimizedFloatPixelToMemoryOptimizedFloat:Symbol("MemoryOptimizedFloatPixelToFloat"),MemoryOptimizedFloatPixelToMemoryOptimized2DFloat:Symbol("MemoryOptimizedFloatPixelTo2DFloat"),MemoryOptimizedFloatPixelToMemoryOptimized3DFloat:Symbol("MemoryOptimizedFloatPixelTo3DFloat")}),C={int:"Integer",float:"Number",vec2:"Array(2)",vec3:"Array(3)",vec4:"Array(4)"};e.exports={GLKernel:D,renderStrategy:N}},function(e,t,r){var n=r(131).glWiretap,i=r(5).utils;function s(e){return e.toString().replace("=>","").replace(/^function /,"").replace(/utils[.]/g,"/*utils.*/")}function a(e,t){var r="single"===t.precision?e:"new Float32Array(".concat(e,".buffer)");return t.output[2]?"renderOutput(".concat(r,", ").concat(t.output[0],", ").concat(t.output[1],", ").concat(t.output[2],")"):t.output[1]?"renderOutput(".concat(r,", ").concat(t.output[0],", ").concat(t.output[1],")"):"renderOutput(".concat(r,", ").concat(t.output[0],")")}function o(e,t){var r=e.toArray.toString(),n=!/^function/.test(r),s=i.flattenFunctionToString("".concat(n?"function ":"").concat(r),{findDependency:function(t,r){if("utils"===t)return"const ".concat(r," = ").concat(i[r].toString(),";");if("this"===t)return"".concat(n?"function ":"").concat(e[r].toString());throw new Error("unhandled fromObject")},thisLookup:function(r){if("texture"===r)return t;if(e.hasOwnProperty(r))return JSON.stringify(e[r]);throw new Error("unhandled thisLookup ".concat(r))}});return"() => {\n  ".concat(s,"\n  return toArray();\n  }")}e.exports={glKernelString:function(e,t,r,u,c){var l=[],h=n(r.context,{useTrackablePrimitives:!0,onReadPixels:function(e){if(D.subKernels){if(p){var t=D.subKernels[f++].property;l.push("    result".concat(isNaN(t)?"."+t:"[".concat(t,"]")," = ").concat(a(e,D),";"))}else l.push("    const result = { result: ".concat(a(e,D)," };")),p=!0;f===D.subKernels.length&&l.push("    return result;")}else e?l.push("    return ".concat(a(e,D),";")):l.push("    return null;")},onUnrecognizedArgumentLookup:function(e){for(var t=0;t<D.kernelConstants.length;t++){var r=D.kernelConstants[t];if("HTMLImageArray"===r.type){var n=D.constants[r.name],i="uploadValue_".concat(r.name,"[").concat(n.indexOf(r.uploadValue),"]");return h.insertVariable(i,D.constants),i}if(r.uploadValue===e){var s="uploadValue_".concat(r.name);return h.insertVariable(s,r),s}}}}),p=!1,f=0,d=r.source,m=r.canvas,g=r.output,y=r.pipeline,_=r.graphical,x=r.loopMaxIterations,v=r.constants,T=r.optimizeFloatMemory,E=r.precision,A=r.fixIntegerDivisionAccuracy,b=r.functions,S=r.nativeFunctions,I=r.subKernels,k=r.immutable,R=r.argumentTypes,L=r.constantTypes,w=(r.kernelArguments,r.kernelConstants),D=new e(d,{canvas:m,context:h,checkContext:!1,output:g,pipeline:y,graphical:_,loopMaxIterations:x,constants:v,optimizeFloatMemory:T,precision:E,fixIntegerDivisionAccuracy:A,functions:b,nativeFunctions:S,subKernels:I,immutable:k,argumentTypes:R,constantTypes:L}),N=[];h.setIndent(2),D.build.apply(D,t),N.push(h.toString()),h.reset();var C=Array.from(t).map((function(e){switch(typeof e){case"number":case"boolean":return new e.constructor(e)}return e}));if(D.kernelArguments.forEach((function(e,r){switch(e.type){case"Integer":case"Boolean":case"Number":case"Float":h.insertVariable("uploadValue_".concat(e.name),C[r]);break;case"Array":case"Array(2)":case"Array(3)":case"Array(4)":case"HTMLImage":h.insertVariable("uploadValue_".concat(e.name),C[r]);break;case"HTMLImageArray":for(var n=0;n<t[r].length;n++){var i=t[r];h.insertVariable("uploadValue_".concat(e.name,"[").concat(n,"]"),i[n])}break;case"Input":h.insertVariable("uploadValue_".concat(e.name),e.uploadValue);break;case"MemoryOptimizedNumberTexture":case"NumberTexture":case"Array1D(2)":case"Array1D(3)":case"Array1D(4)":case"Array2D(2)":case"Array2D(3)":case"Array2D(4)":case"Array3D(2)":case"Array3D(3)":case"Array3D(4)":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":h.insertVariable("uploadValue_".concat(e.name),C[r].texture);break;default:throw new Error("unhandled kernelArgumentType insertion for glWiretap of type ".concat(e.type))}})),N.push("/** start of injected functions **/"),N.push("function ".concat(s(i.flattenTo))),N.push("function ".concat(s(i.flatten2dArrayTo))),N.push("function ".concat(s(i.flatten3dArrayTo))),N.push("function ".concat(s(i.isArray))),D.renderOutput!==D.renderTexture&&D.formatValues&&N.push("  const renderOutput = function ".concat(s(D.formatValues),";")),N.push("/** end of injected functions **/"),N.push("  const innerKernel = function (".concat(D.kernelArguments.map((function(e){return e.varName})).join(", "),") {")),h.setIndent(4),D.run.apply(D,C),D.renderKernels?D.renderKernels():D.renderOutput&&D.renderOutput(),N.push("/** start setup uploads for kernel values **/"),D.kernelArguments.forEach((function(e){N.push(e.getStringValueHandler())})),N.push("/** end setup uploads for kernel values **/"),N.push(h.toString()),D.renderOutput===D.renderTexture){h.reset();var F=D.renderKernels(),O=h.getContextVariableName(D.outputTexture);N.push("    return {\n      result: {\n        texture: ".concat(O,",\n        type: '").concat(F.result.type,"',\n        toArray: ").concat(o(F.result,O),"\n      },"));for(var P=D.subKernels,M=D.subKernelOutputTextures,U=0;U<P.length;U++){var V=M[U],B=P[U],G=F[B.property],z=h.getContextVariableName(V);N.push("\n      ".concat(B.property,": {\n        texture: ").concat(z,",\n        type: '").concat(G.type,"',\n        toArray: ").concat(o(G,z),"\n      },"))}N.push("    };")}N.push("    ".concat(c?"\n"+c+"    ":"")),N.push(l.join("\n")),N.push("  };"),D.graphical&&(N.push(function(e){var t=e.getPixels.toString(),r=!/^function/.test(t);return i.flattenFunctionToString("".concat(r?"function ":"").concat(t),{findDependency:function(e,t){return"utils"===e?"const ".concat(t," = ").concat(i[t].toString(),";"):null},thisLookup:function(t){if("context"===t)return null;if(e.hasOwnProperty(t))return JSON.stringify(e[t]);throw new Error("unhandled thisLookup ".concat(t))}})}(D)),N.push("innerKernel.getPixels = getPixels;")),N.push("  return innerKernel;");var K=[];return w.forEach((function(e){K.push("".concat(e.getStringValueHandler()))})),"function kernel(settings) {\n  const { context, constants } = settings;\n  ".concat(K.join(""),"\n  ").concat(u||"","\n").concat(N.join("\n"),"\n}")}}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=(r(5).utils,function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).uploadValue=e,i}return o(t,e),i(t,[{key:"getSource",value:function(e){return"constants"===this.origin?"const bool ".concat(this.id," = ").concat(e,";\n"):"uniform bool ".concat(this.id,";\n")}},{key:"getStringValueHandler",value:function(){return"const uploadValue_".concat(this.name," = ").concat(this.varName,";\n")}},{key:"updateValue",value:function(e){"constants"!==this.origin&&this.kernel.setUniform1i(this.id,this.uploadValue=e)}}]),t}(r(7).WebGLKernelValue));e.exports={WebGLKernelValueBoolean:u}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=(r(5).utils,function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).uploadValue=e,i}return o(t,e),i(t,[{key:"getStringValueHandler",value:function(){return"const uploadValue_".concat(this.name," = ").concat(this.varName,";\n")}},{key:"getSource",value:function(e){return"constants"===this.origin?Number.isInteger(e)?"const float ".concat(this.id," = ").concat(e,".0;\n"):"const float ".concat(this.id," = ").concat(e,";\n"):"uniform float ".concat(this.id,";\n")}},{key:"updateValue",value:function(e){"constants"!==this.origin&&this.kernel.setUniform1f(this.id,this.uploadValue=e)}}]),t}(r(7).WebGLKernelValue));e.exports={WebGLKernelValueFloat:u}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=(r(5).utils,function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).uploadValue=e,i}return o(t,e),i(t,[{key:"getStringValueHandler",value:function(){return"const uploadValue_".concat(this.name," = ").concat(this.varName,";\n")}},{key:"getSource",value:function(e){return"constants"===this.origin?"const int ".concat(this.id," = ").concat(parseInt(e),";\n"):"uniform int ".concat(this.id,";\n")}},{key:"updateValue",value:function(e){"constants"!==this.origin&&this.kernel.setUniform1i(this.id,this.uploadValue=e)}}]),t}(r(7).WebGLKernelValue));e.exports={WebGLKernelValueInteger:u}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){return c.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){var r=e.width,n=e.height;this.dimensions=[r,n,1],this.textureSize=[r,n],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(21).WebGLKernelValueHTMLImage);e.exports={WebGLKernelValueDynamicHTMLImage:l}},function(e,t,r){var n=r(10),i=r(0),s=r(1),a=r(3),o=r(2),u=r(6),c=r(4),l=r(5).utils,h=function(e){"use strict";function t(){return i(this,t),a(this,o(t).apply(this,arguments))}return c(t,e),s(t,[{key:"getSource",value:function(){return l.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){var r=n(e.size,3),i=r[0],s=r[1],a=r[2];this.dimensions=new Int32Array([i||1,s||1,a||1]),this.textureSize=l.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio);var c=this.getTransferArrayType(e.value);this.preUploadValue=new c(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),u(o(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(23).WebGLKernelValueUnsignedInput);e.exports={WebGLKernelValueDynamicUnsignedInput:h}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){return c.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.dimensions=e.dimensions,this.textureSize=e.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(24).WebGLKernelValueMemoryOptimizedNumberTexture);e.exports={WebGLKernelValueDynamicMemoryOptimizedNumberTexture:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){return c.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.dimensions=e.dimensions,this.textureSize=e.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(25).WebGLKernelValueNumberTexture);e.exports={WebGLKernelValueDynamicNumberTexture:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=(r(5).utils,function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).uploadValue=e,i}return o(t,e),i(t,[{key:"getSource",value:function(e){return"constants"===this.origin?"const vec2 ".concat(this.id," = vec2(").concat(e[0],",").concat(e[1],");\n"):"uniform vec2 ".concat(this.id,";\n")}},{key:"getStringValueHandler",value:function(){return"const uploadValue_".concat(this.name," = ").concat(this.varName,";\n")}},{key:"updateValue",value:function(e){"constants"!==this.origin&&this.kernel.setUniform2fv(this.id,this.uploadValue=e)}}]),t}(r(7).WebGLKernelValue));e.exports={WebGLKernelValueSingleArray2:u}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=(r(5).utils,function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).uploadValue=e,i}return o(t,e),i(t,[{key:"getSource",value:function(e){return"constants"===this.origin?"const vec3 ".concat(this.id," = vec3(").concat(e[0],",").concat(e[1],",").concat(e[2],");\n"):"uniform vec3 ".concat(this.id,";\n")}},{key:"getStringValueHandler",value:function(){return"const uploadValue_".concat(this.name," = ").concat(this.varName,";\n")}},{key:"updateValue",value:function(e){"constants"!==this.origin&&this.kernel.setUniform3fv(this.id,this.uploadValue=e)}}]),t}(r(7).WebGLKernelValue));e.exports={WebGLKernelValueSingleArray3:u}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=(r(5).utils,function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).uploadValue=e,i}return o(t,e),i(t,[{key:"getSource",value:function(e){return"constants"===this.origin?"const vec4 ".concat(this.id," = vec4(").concat(e[0],",").concat(e[1],",").concat(e[2],",").concat(e[3],");\n"):"uniform vec4 ".concat(this.id,";\n")}},{key:"getStringValueHandler",value:function(){return"const uploadValue_".concat(this.name," = ").concat(this.varName,";\n")}},{key:"updateValue",value:function(e){"constants"!==this.origin&&this.kernel.setUniform4fv(this.id,this.uploadValue=e)}}]),t}(r(7).WebGLKernelValue));e.exports={WebGLKernelValueSingleArray4:u}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){return c.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.dimensions=c.getDimensions(e,!0),this.textureSize=c.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio);var r=this.getTransferArrayType(e);this.preUploadValue=new r(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(30).WebGLKernelValueUnsignedArray);e.exports={WebGLKernelValueDynamicUnsignedArray:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(15).WebGLKernel,l=r(57).WebGL2FunctionNode,h=r(14).FunctionBuilder,p=r(5).utils,f=r(139).fragmentShader,d=r(140).vertexShader,m=r(141).lookupKernelValueType,g=null,y=null,_=null,x=null,v=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"initContext",value:function(){return this.canvas.getContext("webgl2",{alpha:!1,depth:!1,antialias:!1})}},{key:"initExtensions",value:function(){this.extensions={EXT_color_buffer_float:this.context.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear")}}},{key:"validateSettings",value:function(e){if(this.validate){var t=this.constructor.features;if("single"===this.precision&&!t.isFloatRead)throw new Error("Float texture outputs are not supported");if(this.graphical||null!==this.precision||(this.precision=t.isFloatRead?"single":"unsigned"),null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=!t.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&t.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||0===this.output.length){if(1!==e.length)throw new Error("Auto output only supported for kernels with only one input");var r=p.getVariableType(e[0],this.strictIntegers);switch(r){case"Array":this.output=p.getDimensions(r);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=e[0].output;break;default:throw new Error("Auto output not supported for input type: "+r)}}if(this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");return"single"===this.precision&&(console.warn("Cannot use graphical mode and single precision at the same time"),this.precision="unsigned"),void(this.texSize=p.clone(this.output))}!this.graphical&&null===this.precision&&t.isTextureFloat&&(this.precision="single"),this.texSize=p.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output)}else this.texSize=p.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output)}},{key:"translateSource",value:function(){var e=h.fromKernel(this,l,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});if(this.translatedSource=e.getPrototypeString("kernel"),this.graphical||this.returnType||(this.returnType=e.getKernelResultType()),this.subKernels&&this.subKernels.length>0)for(var t=0;t<this.subKernels.length;t++){var r=this.subKernels[t];r.returnType||(r.returnType=e.getSubKernelResultType(t))}}},{key:"run",value:function(){var e=this.kernelArguments,t=this.texSize,r=this.context;r.useProgram(this.program),r.scissor(0,0,t[0],t[1]),this.dynamicOutput&&(this.setUniform3iv("uOutputDim",new Int32Array(this.threadDim)),this.setUniform2iv("uTexSize",t)),this.setUniform2f("ratio",t[0]/this.maxTexSize[0],t[1]/this.maxTexSize[1]);for(var n=0;n<e.length;n++)if(e[n].updateValue(arguments[n]),this.switchingKernels)return;if(this.plugins)for(var i=0;i<this.plugins.length;i++){var s=this.plugins[i];s.onBeforeRun&&s.onBeforeRun(this)}if(this.graphical)return this.pipeline?(r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),this.outputTexture&&!this.immutable||this._setupOutputTexture(),r.drawArrays(r.TRIANGLE_STRIP,0,4),new this.TextureConstructor({texture:this.outputTexture,size:t,dimensions:this.threadDim,output:this.output,context:this.context})):(r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),void r.drawArrays(r.TRIANGLE_STRIP,0,4));r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),this.immutable&&this._setupOutputTexture(),null!==this.subKernels&&(this.immutable&&this._setupSubOutputTextures(),r.drawBuffers(this.drawBuffersMap)),r.drawArrays(r.TRIANGLE_STRIP,0,4)}},{key:"drawBuffers",value:function(){this.context.drawBuffers(this.drawBuffersMap)}},{key:"getOutputTexture",value:function(){return this.outputTexture}},{key:"_setupOutputTexture",value:function(){var e=this.texSize,t=this.context,r=this.outputTexture=t.createTexture();if(t.activeTexture(t.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),"single"===this.precision)if(this.pipeline)switch(this.returnType){case"Number":case"Float":case"Integer":this.optimizeFloatMemory?t.texStorage2D(t.TEXTURE_2D,1,t.RGBA32F,e[0],e[1]):t.texStorage2D(t.TEXTURE_2D,1,t.R32F,e[0],e[1]);break;case"Array(2)":t.texStorage2D(t.TEXTURE_2D,1,t.RG32F,e[0],e[1]);break;case"Array(3)":case"Array(4)":t.texStorage2D(t.TEXTURE_2D,1,t.RGBA32F,e[0],e[1]);break;default:throw new Error("Unhandled return type")}else t.texStorage2D(t.TEXTURE_2D,1,t.RGBA32F,e[0],e[1]);else t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.UNSIGNED_BYTE,null);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)}},{key:"_setupSubOutputTextures",value:function(){var e=this.texSize,t=this.context;this.drawBuffersMap=[t.COLOR_ATTACHMENT0],this.subKernelOutputTextures=[];for(var r=0;r<this.subKernels.length;r++){var n=this.context.createTexture();this.subKernelOutputTextures.push(n),this.drawBuffersMap.push(t.COLOR_ATTACHMENT0+r+1),t.activeTexture(t.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+r),t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),"single"===this.precision?t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,e[0],e[1],0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+r+1,t.TEXTURE_2D,n,0)}}},{key:"_getHeaderString",value:function(){return""}},{key:"_getTextureCoordinate",value:function(){var e=this.subKernels;if(null===e||e.length<1)switch(this.tactic){case"speed":return"in lowp vec2 vTexCoord;\n";case"performance":return"in highp vec2 vTexCoord;\n";case"balanced":default:return"in mediump vec2 vTexCoord;\n"}else switch(this.tactic){case"speed":return"out lowp vec2 vTexCoord;\n";case"performance":return"out highp vec2 vTexCoord;\n";case"balanced":default:return"out mediump vec2 vTexCoord;\n"}}},{key:"_getMainArgumentsString",value:function(e){for(var t=[],r=this.argumentNames,n=0;n<r.length;n++)t.push(this.kernelArguments[n].getSource(e[n]));return t.join("")}},{key:"getKernelString",value:function(){var e;switch(this.returnType){case"Array(2)":e="vec2 kernelResult";break;case"Array(3)":e="vec3 kernelResult";break;case"Array(4)":e="vec4 kernelResult";break;case"LiteralInteger":case"Float":case"Number":case"Integer":e="float kernelResult";break;default:if(!this.graphical)throw new Error('unrecognized output type "'.concat(this.returnType,'"'));e="float kernelResult"}var t=[],r=this.subKernels;if(null!==r){t.push(e,"layout(location = 0) out vec4 data0");for(var n=0;n<r.length;n++){var i=r[n];t.push("Integer"===i.returnType?"int subKernelResult_".concat(i.name," = 0"):"float subKernelResult_".concat(i.name," = 0.0"),"layout(location = ".concat(n+1,") out vec4 data").concat(n+1))}}else t.push("out vec4 data0",e);return p.linesToString(t)+this.translatedSource}},{key:"getMainResultGraphical",value:function(){return p.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = actualColor"])}},{key:"getMainResultPackedPixels",value:function(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error('packed output only usable with Numbers, "'.concat(this.returnType,'" specified'))}}},{key:"getMainResultKernelPackedPixels",value:function(){return p.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = ".concat(this.useLegacyEncoder?"legacyEncode32":"encode32","(kernelResult)")])}},{key:"getMainResultSubKernelPackedPixels",value:function(){var e=[];if(!this.subKernels)return"";for(var t=0;t<this.subKernels.length;t++){"Integer"===this.subKernels[t].returnType?e.push("  data".concat(t+1," = ").concat(this.useLegacyEncoder?"legacyEncode32":"encode32","(float(subKernelResult_").concat(this.subKernels[t].name,"))")):e.push("  data".concat(t+1," = ").concat(this.useLegacyEncoder?"legacyEncode32":"encode32","(subKernelResult_").concat(this.subKernels[t].name,")"))}return p.linesToString(e)}},{key:"getMainResultMemoryOptimizedFloats",value:function(){var e=["  index *= 4"];switch(this.returnType){case"Number":case"Integer":case"Float":for(var t=["r","g","b","a"],r=0;r<t.length;r++){var n=t[r];this.getMainResultKernelMemoryOptimizedFloats(e,n),this.getMainResultSubKernelMemoryOptimizedFloats(e,n),r+1<t.length&&e.push("  index += 1")}break;default:throw new Error("optimized output only usable with Numbers, ".concat(this.returnType," specified"))}return p.linesToString(e)}},{key:"getMainResultKernelMemoryOptimizedFloats",value:function(e,t){e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0.".concat(t," = kernelResult"))}},{key:"getMainResultSubKernelMemoryOptimizedFloats",value:function(e,t){if(!this.subKernels)return e;for(var r=0;r<this.subKernels.length;r++){var n=this.subKernels[r];"Integer"===n.returnType?e.push("  data".concat(r+1,".").concat(t," = float(subKernelResult_").concat(n.name,")")):e.push("  data".concat(r+1,".").concat(t," = subKernelResult_").concat(n.name))}}},{key:"getMainResultKernelNumberTexture",value:function(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult"]}},{key:"getMainResultSubKernelNumberTexture",value:function(){var e=[];if(!this.subKernels)return e;for(var t=0;t<this.subKernels.length;++t){var r=this.subKernels[t];"Integer"===r.returnType?e.push("  data".concat(t+1,"[0] = float(subKernelResult_").concat(r.name,")")):e.push("  data".concat(t+1,"[0] = subKernelResult_").concat(r.name))}return e}},{key:"getMainResultKernelArray2Texture",value:function(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]"]}},{key:"getMainResultSubKernelArray2Texture",value:function(){var e=[];if(!this.subKernels)return e;for(var t=0;t<this.subKernels.length;++t){var r=this.subKernels[t];e.push("  data".concat(t+1,"[0] = subKernelResult_").concat(r.name,"[0]"),"  data".concat(t+1,"[1] = subKernelResult_").concat(r.name,"[1]"))}return e}},{key:"getMainResultKernelArray3Texture",value:function(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]","  data0[2] = kernelResult[2]"]}},{key:"getMainResultSubKernelArray3Texture",value:function(){var e=[];if(!this.subKernels)return e;for(var t=0;t<this.subKernels.length;++t){var r=this.subKernels[t];e.push("  data".concat(t+1,"[0] = subKernelResult_").concat(r.name,"[0]"),"  data".concat(t+1,"[1] = subKernelResult_").concat(r.name,"[1]"),"  data".concat(t+1,"[2] = subKernelResult_").concat(r.name,"[2]"))}return e}},{key:"getMainResultKernelArray4Texture",value:function(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = kernelResult"]}},{key:"getMainResultSubKernelArray4Texture",value:function(){var e=[];if(!this.subKernels)return e;for(var t=0;t<this.subKernels.length;++t)e.push("  data".concat(t+1," = subKernelResult_").concat(this.subKernels[t].name));return e}},{key:"destroyExtensions",value:function(){this.extensions.EXT_color_buffer_float=null,this.extensions.OES_texture_float_linear=null}},{key:"toJSON",value:function(){var e=o(a(t.prototype),"toJSON",this).call(this);return e.functionNodes=h.fromKernel(this,l).toJSON(),e}}],[{key:"setupFeatureChecks",value:function(){"undefined"!==typeof document?y=document.createElement("canvas"):"undefined"!==typeof OffscreenCanvas&&(y=new OffscreenCanvas(0,0)),y&&(_=y.getContext("webgl2"))&&_.getExtension&&({EXT_color_buffer_float:_.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:_.getExtension("OES_texture_float_linear")},x=this.getFeatures())}},{key:"isContextMatch",value:function(e){return"undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext}},{key:"getFeatures",value:function(){return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),kernelMap:!0,isTextureFloat:!0,channelCount:this.getChannelCount()})}},{key:"getIsTextureFloat",value:function(){return!0}},{key:"getIsIntegerDivisionAccurate",value:function(){return o(a(t),"getIsIntegerDivisionAccurate",this).call(this)}},{key:"getChannelCount",value:function(){return _.getParameter(_.MAX_DRAW_BUFFERS)}},{key:"lookupKernelValueType",value:function(e,t,r,n){return m(e,t,r,n)}},{key:"isSupported",get:function(){return null!==g?g:(this.setupFeatureChecks(),g=this.isContextMatch(_))}},{key:"testCanvas",get:function(){return y}},{key:"testContext",get:function(){return _}},{key:"features",get:function(){return x}},{key:"fragmentShader",get:function(){return f}},{key:"vertexShader",get:function(){return d}}]),t}(c);e.exports={WebGL2Kernel:v}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"astIdentifierExpression",value:function(e,t){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e);var r=this.getType(e);if("Infinity"===e.name)t.push("intBitsToFloat(2139095039)");else if("Boolean"===r)this.argumentNames.indexOf(e.name)>-1?t.push("bool(user_".concat(e.name,")")):t.push("user_".concat(e.name));else{var n=this.getKernelArgumentName(e.name);n?t.push("user_".concat(n)):t.push("user_".concat(e.name))}return t}}]),t}(r(20).WebGLFunctionNode);e.exports={WebGL2FunctionNode:u}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e,r))).requestTexture(),i.dimensions=[e[0].width,e[0].height,e.length],i.textureSize=[e[0].width,e[0].height],i}return o(t,e),i(t,[{key:"getStringValueHandler",value:function(){return"const uploadValue_".concat(this.name," = ").concat(this.varName,";\n")}},{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2DArray ").concat(this.id),"".concat(e," ivec2 ").concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"".concat(e," ivec3 ").concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){var t=this.context;t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D_ARRAY,this.texture),t.texParameteri(t.TEXTURE_2D_ARRAY,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D_ARRAY,t.TEXTURE_MIN_FILTER,t.NEAREST),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage3D(t.TEXTURE_2D_ARRAY,0,t.RGBA,e[0].width,e[0].height,e.length,0,t.RGBA,t.UNSIGNED_BYTE,null);for(var r=0;r<e.length;r++){t.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,r,e[r].width,e[r].height,1,t.RGBA,t.UNSIGNED_BYTE,this.uploadValue=e[r])}this.kernel.setUniform1i(this.id,this.index)}}]),t}(r(7).WebGLKernelValue);e.exports={WebGL2KernelValueHtmlImageArray:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"".concat(e," ivec2 ").concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"".concat(e," ivec3 ").concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){var t=this.context;u.flattenTo(e.value,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}]),t}(r(22).WebGLKernelValueSingleInput);e.exports={WebGL2KernelValueSingleInput:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"".concat(e," ivec2 ").concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"".concat(e," ivec3 ").concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}},{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;u.flattenTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(26).WebGLKernelValueSingleArray);e.exports={WebGL2KernelValueSingleArray:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;u.flattenTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(27).WebGLKernelValueSingleArray1DI);e.exports={WebGL2KernelValueSingleArray1DI:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;u.flattenTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(28).WebGLKernelValueSingleArray2DI);e.exports={WebGL2KernelValueSingleArray2DI:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"updateValue",value:function(e){if(e.constructor===this.initialValueConstructor){var t=this.context;u.flattenTo(e,this.uploadValue),t.activeTexture(this.contextHandle),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,this.textureSize[0],this.textureSize[1],0,t.RGBA,t.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}else this.onUpdateValueMismatch()}}]),t}(r(29).WebGLKernelValueSingleArray3DI);e.exports={WebGL2KernelValueSingleArray3DI:c}},function(e,t,r){var n=r(31).GPU,i=r(165).alias,s=r(5).utils,a=r(12),o=a.Input,u=a.input,c=r(13).Texture,l=r(14).FunctionBuilder,h=r(18).FunctionNode,p=r(35).CPUFunctionNode,f=r(33).CPUKernel,d=r(36).HeadlessGLKernel,m=r(20).WebGLFunctionNode,g=r(15).WebGLKernel,y=r(57).WebGL2FunctionNode,_=r(56).WebGL2Kernel,x=r(43).GLKernel,v=r(17).Kernel;e.exports={alias:i,CPUFunctionNode:p,CPUKernel:f,GPU:n,FunctionBuilder:l,FunctionNode:h,HeadlessGLKernel:d,Input:o,input:u,Texture:c,utils:s,WebGL2FunctionNode:y,WebGL2Kernel:_,WebGLFunctionNode:m,WebGLKernel:g,GLKernel:x,Kernel:v}},function(e,t,r){var n=r(10);function i(e){for(var t=new Array(e.length),r=0;r<e.length;r++){var n=e[r];n.toArray?t[r]=n.toArray():t[r]=n}return t}function s(){for(var e=i(arguments),t=new Float32Array(this.output.x),r=0;r<this.output.x;r++)this.thread.x=r,this.thread.y=0,this.thread.z=0,t[r]=this._fn.apply(this,e);return t}function a(){for(var e=i(arguments),t=new Array(this.output.y),r=0;r<this.output.y;r++){for(var n=new Float32Array(this.output.x),s=0;s<this.output.x;s++)this.thread.x=s,this.thread.y=r,this.thread.z=0,n[s]=this._fn.apply(this,e);t[r]=n}return t}function o(){for(var e=i(arguments),t=0;t<this.output.y;t++)for(var r=0;r<this.output.x;r++)this.thread.x=r,this.thread.y=t,this.thread.z=0,this._fn.apply(this,e)}function u(){for(var e=i(arguments),t=new Array(this.output.z),r=0;r<this.output.z;r++){for(var n=new Array(this.output.y),s=0;s<this.output.y;s++){for(var a=new Float32Array(this.output.x),o=0;o<this.output.x;o++)this.thread.x=o,this.thread.y=s,this.thread.z=r,a[o]=this._fn.apply(this,e);n[s]=a}t[r]=n}return t}function c(e){return e.setOutput=function(t){e.output=h(t),e.graphical&&l(e)},e.toJSON=function(){throw new Error("Not usable with gpuMock")},e.setConstants=function(t){return e.constants=t,e},e.setGraphical=function(t){return e.graphical=t,e},e.setCanvas=function(t){return e.canvas=t,e},e.setContext=function(t){return e.context=t,e},e.exec=function(){var t=arguments;return new Promise((function(r,n){try{r(e.apply(e,t))}catch(i){n(i)}}))},e.getPixels=function(t){var r=e.output,n=r.x,i=r.y;return t?function(e,t,r){for(var n=r/2|0,i=4*t,s=new Uint8ClampedArray(4*t),a=e.slice(0),o=0;o<n;++o){var u=o*i,c=(r-o-1)*i;s.set(a.subarray(u,u+i)),a.copyWithin(u,c,c+i),a.set(s,c)}return a}(e._imageData.data,n,i):e._imageData.data.slice(0)},e.color=function(t,r,n,i){"undefined"===typeof i&&(i=1),t=Math.floor(255*t),r=Math.floor(255*r),n=Math.floor(255*n),i=Math.floor(255*i);var s=e.output.x,a=e.output.y,o=e.thread.x+(a-e.thread.y-1)*s;e._colorData[4*o+0]=t,e._colorData[4*o+1]=r,e._colorData[4*o+2]=n,e._colorData[4*o+3]=i},e.setWarnVarUsage=function(){return e},e.setOptimizeFloatMemory=function(){return e},e.setArgumentTypes=function(){return e},e.setDebug=function(){return e},e.setLoopMaxIterations=function(){return e},e.setPipeline=function(){return e},e.setPrecision=function(){return e},e.setImmutable=function(){return e},e.setFunctions=function(){return e},e.addSubKernel=function(){return e},e.destroy=function(){},e.validateSettings=function(){},e.graphical&&e.output&&l(e),e}function l(e){var t=e.output,r=t.x,n=t.y;if(e.context&&e.context.createImageData){var i=new Uint8ClampedArray(r*n*4);e._imageData=e.context.createImageData(r,n),e._colorData=i}else{var s=new Uint8ClampedArray(r*n*4);e._imageData={data:s},e._colorData=s}}function h(e){var t=null;if(e.length)if(3===e.length){var r=n(e,3);t={x:r[0],y:r[1],z:r[2]}}else if(2===e.length){var i=n(e,2);t={x:i[0],y:i[1]}}else{t={x:n(e,1)[0]}}else t=e;return t}e.exports={gpuMock:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.output?h(t.output):null;function n(){return n.output.z?u.apply(n,arguments):n.output.y?n.graphical?o.apply(n,arguments):a.apply(n,arguments):s.apply(n,arguments)}return n._fn=e,n.constants=t.constants||null,n.context=t.context||null,n.canvas=t.canvas||null,n.graphical=t.graphical||!1,n._imageData=null,n._colorData=null,n.output=r,n.thread={x:0,y:0,z:0},c(n)}}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(u){i=!0,s=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return r}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t){function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(t){return"function"===typeof Symbol&&"symbol"===r(Symbol.iterator)?e.exports=n=function(e){return r(e)}:e.exports=n=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)},n(t)}e.exports=n},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,r){var n=r(2);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}},function(e,t){function r(t,n){return e.exports=r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(t,n)}e.exports=r},function(e,t,r){var n=r(0),i=r(1),s=function(){"use strict";function e(t){n(this,e),this.runningContexts=[],this.contexts=[],this.functionCalls=[],this.declarations=[],this.identifiers=[],this.functions=[],this.returnStatements=[],this.inLoopInit=!1,this.scan(t)}return i(e,[{key:"newContext",value:function(e){var t=Object.assign({},this.currentContext);this.contexts.push(t),this.runningContexts.push(t),e(),this.runningContexts.pop()}},{key:"scan",value:function(e){var t=this;if(Array.isArray(e))for(var r=0;r<e.length;r++)this.scan(e[r]);else switch(e.type){case"Program":this.scan(e.body);break;case"BlockStatement":this.newContext((function(){t.scan(e.body)}));break;case"AssignmentExpression":this.scan(e.left),this.scan(e.right);break;case"BinaryExpression":this.scan(e.left),e.right&&this.scan(e.right);break;case"UpdateExpression":case"UnaryExpression":this.scan(e.argument);break;case"VariableDeclaration":this.scan(e.declarations);break;case"VariableDeclarator":var n=this.currentContext,i={ast:e,context:n,name:e.id.name,origin:"declaration",forceInteger:this.inLoopInit,assignable:!this.inLoopInit&&!n.hasOwnProperty(e.id.name)};n[e.id.name]=i,this.declarations.push(i),this.scan(e.id),this.scan(e.init);break;case"FunctionExpression":case"FunctionDeclaration":0===this.runningContexts.length?this.scan(e.body):this.functions.push(e);break;case"IfStatement":this.scan(e.test),this.scan(e.consequent),e.alternate&&this.scan(e.alternate);break;case"ForStatement":this.newContext((function(){e.init&&(t.inLoopInit=!0,t.scan(e.init),t.inLoopInit=!1),e.test&&t.scan(e.test),t.scan(e.update),t.newContext((function(){t.scan(e.body)}))}));break;case"DoWhileStatement":case"WhileStatement":this.newContext((function(){t.scan(e.body),t.scan(e.test)}));break;case"Identifier":this.identifiers.push({context:this.currentContext,ast:e});break;case"ReturnStatement":this.returnStatements.push(e),this.scan(e.argument);break;case"MemberExpression":this.scan(e.object),this.scan(e.property);break;case"ExpressionStatement":this.scan(e.expression);break;case"ThisExpression":break;case"CallExpression":this.functionCalls.push({context:this.currentContext,ast:e}),this.scan(e.arguments);break;case"ArrayExpression":this.scan(e.elements);break;case"ConditionalExpression":this.scan(e.test),this.scan(e.alternate),this.scan(e.consequent);break;case"SwitchStatement":this.scan(e.discriminant),this.scan(e.cases);break;case"SwitchCase":e.test&&this.scan(e.test),this.scan(e.consequent);break;case"LogicalExpression":this.scan(e.left),this.scan(e.right);break;case"Literal":case"DebuggerStatement":case"EmptyStatement":case"BreakStatement":break;default:throw new Error('unhandled type "'.concat(e.type,'"'))}}},{key:"currentContext",get:function(){return this.runningContexts.length>0?this.runningContexts[this.runningContexts.length-1]:null}}]),e}();e.exports={FunctionTracer:s}},function(e,t,r){var n=r(5).utils;r(12).Input;e.exports={cpuKernelString:function(e,t){var r=[],i=[],s=[],a=!/^function/.test(e.color.toString());if(r.push("  const { context, canvas, constants } = settings;","  const output = new Int32Array(".concat(JSON.stringify(Array.from(e.output)),");"),"  const _constants = ".concat(function(e){var t=[];for(var r in e){var n=e[r];switch(typeof n){case"number":case"boolean":t.push("".concat(r,":").concat(n))}}return"{ ".concat(t.join()," }")}(e.constants),";")),i.push("    constants: _constants,","    context,","    output,","    thread: {x: 0, y: 0, z: 0},"),e.graphical){r.push("  const _imageData = context.createImageData(".concat(e.output[0],", ").concat(e.output[1],");")),r.push("  const _colorData = new Uint8ClampedArray(".concat(e.output[0]," * ").concat(e.output[1]," * 4);"));var o=n.flattenFunctionToString((a?"function ":"")+e.color.toString(),{thisLookup:function(t){switch(t){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(e[t])},findDependency:function(e,t){return null}}),u=n.flattenFunctionToString((a?"function ":"")+e.getPixels.toString(),{thisLookup:function(t){switch(t){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(e[t])},findDependency:function(){return null}});i.push("    _imageData,","    _colorData,","    color: ".concat(o,",")),s.push("  kernel.getPixels = ".concat(u,";"))}for(var c=[],l=Object.keys(e.constantTypes),h=0;h<l.length;h++)c.push(e.constantTypes[l]);if(-1!==e.argumentTypes.indexOf("HTMLImageArray")||-1!==c.indexOf("HTMLImageArray")){var p=n.flattenFunctionToString((a?"function ":"")+e._imageTo3DArray.toString(),{doNotDefine:["canvas"],findDependency:function(t,r){return"this"===t?(a?"function ":"")+e[r].toString():null},thisLookup:function(e){switch(e){case"canvas":return;case"context":return"context"}}});s.push(p),i.push("    _imageTo2DArray,"),i.push("    _imageTo3DArray,")}else if(-1!==e.argumentTypes.indexOf("HTMLImage")||-1!==c.indexOf("HTMLImage")){var f=n.flattenFunctionToString((a?"function ":"")+e._imageTo2DArray.toString(),{findDependency:function(e,t){return null},thisLookup:function(e){switch(e){case"canvas":return"settings.canvas";case"context":return"settings.context"}throw new Error("unhandled thisLookup")}});s.push(f),i.push("    _imageTo2DArray,")}return"function(settings) {\n".concat(r.join("\n"),"\n  for (const p in constants) {\n    const constant = constants[p];\n    switch (typeof constant) {\n      case 'number':\n      case 'boolean':\n        continue;\n    }\n    _constants[p] = constant;\n  }\n  const kernel = (function() {\n").concat(e._kernelString,"\n  })\n    .apply({ ").concat(i.join("\n")," });\n  ").concat(s.join("\n"),"\n  return kernel;\n}")}}},function(e,t,r){"undefined"!==typeof WebGLRenderingContext?e.exports=r(76):e.exports=r(77)},function(e,t){e.exports=function(e,t,r){if(t|=0,!((e|=0)>0&&t>0))return null;var n,i=document.createElement("canvas");if(!i)return null;i.width=e,i.height=t;try{n=i.getContext("webgl",r)}catch(c){try{n=i.getContext("experimental-webgl",r)}catch(c){return null}}var s=n.getExtension,a={destroy:function(){var e=s.call(n,"WEBGL_lose_context");e&&e.loseContext()}},o={resize:function(e,t){i.width=e,i.height=t}},u=n.getSupportedExtensions().slice();return u.push("STACKGL_destroy_context","STACKGL_resize_drawingbuffer"),n.getSupportedExtensions=function(){return u.slice()},n.getExtension=function(e){var t=e.toLowerCase();return"stackgl_resize_drawingbuffer"===t?o:"stackgl_destroy_context"===t?a:s.call(n,e)},n||null}},function(e,t,r){var n=r(37),i=r(78).WebGLContextAttributes,s=r(79),a=s.WebGLRenderingContext,o=s.wrapContext,u=r(109).WebGLTextureUnit,c=r(110).WebGLVertexAttribute,l=0;function h(e,t,r){return e&&"object"===typeof e&&t in e?!!e[t]:r}e.exports=function(e,t,r){if(t|=0,!((e|=0)>0&&t>0))return null;var s,p=new i(h(r,"alpha",!0),h(r,"depth",!0),h(r,"stencil",!1),!1,h(r,"premultipliedAlpha",!0),h(r,"preserveDrawingBuffer",!1),h(r,"preferLowPowerToHighPerformance",!1),h(r,"failIfMajorPerformanceCaveat",!1));p.premultipliedAlpha=p.premultipliedAlpha&&p.alpha;try{s=new a(1,1,p.alpha,p.depth,p.stencil,p.antialias,p.premultipliedAlpha,p.preserveDrawingBuffer,p.preferLowPowerToHighPerformance,p.failIfMajorPerformanceCaveat)}catch(_){}if(!s)return null;s.drawingBufferWidth=e,s.drawingBufferHeight=t,s._=l++,s._contextAttributes=p,s._extensions={},s._programs={},s._shaders={},s._buffers={},s._textures={},s._framebuffers={},s._renderbuffers={},s._activeProgram=null,s._activeFramebuffer=null,s._activeArrayBuffer=null,s._activeElementArrayBuffer=null,s._activeRenderbuffer=null;var f=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);s._textureUnits=new Array(f);for(var d=0;d<f;++d)s._textureUnits[d]=new u(d);s._activeTextureUnit=0,s.activeTexture(s.TEXTURE0),s._errorStack=[];var m=s.getParameter(s.MAX_VERTEX_ATTRIBS);s._vertexAttribs=new Array(m);for(var g=0;g<m;++g)s._vertexAttribs[g]=new c(s,g);s._maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),s._maxTextureLevel=n.log2(n.nextPow2(s._maxTextureSize)),s._maxCubeMapSize=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),s._maxCubeMapLevel=n.log2(n.nextPow2(s._maxCubeMapSize)),s._unpackAlignment=4,s._packAlignment=4,s._allocateDrawingBuffer(e,t);var y=s.createBuffer();return s._attrib0Buffer=y,s.bindBuffer(s.ARRAY_BUFFER,null),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindRenderbuffer(s.RENDERBUFFER,null),s.viewport(0,0,e,t),s.scissor(0,0,e,t),s.clearDepth(1),s.clearColor(0,0,0,0),s.clearStencil(0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT|s.STENCIL_BUFFER_BIT),o(s)}},function(e,t,r){var n=r(0);e.exports={WebGLContextAttributes:function e(t,r,i,s,a,o,u,c){"use strict";n(this,e),this.alpha=t,this.depth=r,this.stencil=i,this.antialias=s,this.premultipliedAlpha=a,this.preserveDrawingBuffer=o,this.preferLowPowerToHighPerformance=u,this.failIfMajorPerformanceCaveat=c}}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(37),l=r(80),h=r(85).version,p=r(9),f=p.gl,d=p.NativeWebGLRenderingContext,m=p.NativeWebGL,g=r(89).getANGLEInstancedArrays,y=r(95).getOESElementIndexUint,_=r(96).getOESTextureFloat,x=r(97).getSTACKGLDestroyContext,v=r(98).getSTACKGLResizeDrawingBuffer,T=r(99).getWebGLDrawBuffers,E=r(41),A=E.bindPublics,b=E.checkObject,S=E.checkUniform,I=E.formatSize,k=E.isValidString,R=E.typeSize,L=E.uniformTypeSize,w=E.extractImageData,D=E.vertexCount,N=E.isTypedArray,C=E.unpackTypedArray,F=E.convertPixels,O=E.checkFormat,P=E.validCubeTarget,M=r(100).WebGLActiveInfo,U=r(101).WebGLFramebuffer,V=r(102).WebGLBuffer,B=r(103).WebGLDrawingBufferWrapper,G=r(104).WebGLProgram,z=r(105).WebGLRenderbuffer,K=r(106).WebGLShader,W=r(107).WebGLShaderPrecisionFormat,X=r(108).WebGLTexture,H=r(42).WebGLUniformLocation,j=[f.COLOR_ATTACHMENT0,f.DEPTH_ATTACHMENT,f.STENCIL_ATTACHMENT,f.DEPTH_STENCIL_ATTACHMENT],Y=[f.COLOR_ATTACHMENT0],q={angle_instanced_arrays:g,oes_element_index_uint:y,oes_texture_float:_,stackgl_destroy_context:x,stackgl_resize_drawingbuffer:v,webgl_draw_buffers:T},Z=["resize","destroy"];var J=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"_checkDimensions",value:function(e,t,r,n){if(n<0||t<0||r<0)return this.setError(f.INVALID_VALUE),!1;if(e===f.TEXTURE_2D){if(t>this._maxTextureSize||r>this._maxTextureSize||n>this._maxTextureLevel)return this.setError(f.INVALID_VALUE),!1}else{if(!this._validCubeTarget(e))return this.setError(f.INVALID_ENUM),!1;if(t>this._maxCubeMapSize||r>this._maxCubeMapSize||n>this._maxCubeMapLevel)return this.setError(f.INVALID_VALUE),!1}return!0}},{key:"_checkLocation",value:function(e){return e instanceof H?e._program._ctx===this&&e._linkCount===e._program._linkCount||(this.setError(f.INVALID_OPERATION),!1):(this.setError(f.INVALID_VALUE),!1)}},{key:"_checkLocationActive",value:function(e){return!!e&&(!!this._checkLocation(e)&&(e._program===this._activeProgram||(this.setError(f.INVALID_OPERATION),!1)))}},{key:"_checkOwns",value:function(e){return"object"===typeof e&&e._ctx===this}},{key:"_checkShaderSource",value:function(e){for(var t=e._source,r=l(t),n=!1,i=[],s=0;s<r.length;++s){var a=r[s];switch(a.type){case"ident":this._validGLSLIdentifier(a.data)||(n=!0,i.push(a.line+":"+a.column+" invalid identifier - "+a.data));break;case"preprocessor":for(var o=l(a.data.match(/^\s*#\s*(.*)$/)[1]),u=0;u<o.length;++u){var c=o[u];"ident"!==c.type&&void 0!==c.type||this._validGLSLIdentifier(c.data)||(n=!0,i.push(a.line+":"+c.column+" invalid identifier - "+c.data))}break;case"keyword":switch(a.data){case"do":n=!0,i.push(a.line+":"+a.column+" do not supported")}}}return n&&(e._compileInfo=i.join("\n")),!n}},{key:"_checkStencilState",value:function(){return this.getParameter(f.STENCIL_WRITEMASK)===this.getParameter(f.STENCIL_BACK_WRITEMASK)&&this.getParameter(f.STENCIL_VALUE_MASK)===this.getParameter(f.STENCIL_BACK_VALUE_MASK)&&this.getParameter(f.STENCIL_REF)===this.getParameter(f.STENCIL_BACK_REF)||(this.setError(f.INVALID_OPERATION),!1)}},{key:"_checkTextureTarget",value:function(e){var t=this._getActiveTextureUnit(),r=null;if(e===f.TEXTURE_2D)r=t._bind2D;else{if(e!==f.TEXTURE_CUBE_MAP)return this.setError(f.INVALID_ENUM),!1;r=t._bindCube}return!!r||(this.setError(f.INVALID_OPERATION),!1)}},{key:"_checkWrapper",value:function(e,t){return this._checkValid(e,t)?!!this._checkOwns(e)||(this.setError(f.INVALID_OPERATION),!1):(this.setError(f.INVALID_VALUE),!1)}},{key:"_checkValid",value:function(e,t){return e instanceof t&&0!==e._}},{key:"_checkVertexAttribState",value:function(e){var t=this._activeProgram;if(!t)return this.setError(f.INVALID_OPERATION),!1;for(var r=this._vertexAttribs,n=0;n<r.length;++n){var i=r[n];if(i._isPointer){var s=i._pointerBuffer;if(!s)return this.setError(f.INVALID_OPERATION),!1;if(t._attributes.indexOf(n)>=0){if((i._divisor?i._pointerSize+i._pointerOffset:i._pointerStride*e+i._pointerSize+i._pointerOffset)>s._size)return this.setError(f.INVALID_OPERATION),!1}}}return!0}},{key:"_checkVertexIndex",value:function(e){return!(e<0||e>=this._vertexAttribs.length)||(this.setError(f.INVALID_VALUE),!1)}},{key:"_computePixelSize",value:function(e,t){var r=I(t);if(0===r)return this.setError(f.INVALID_ENUM),0;switch(e){case f.UNSIGNED_BYTE:return r;case f.UNSIGNED_SHORT_5_6_5:if(t!==f.RGB){this.setError(f.INVALID_OPERATION);break}return 2;case f.UNSIGNED_SHORT_4_4_4_4:case f.UNSIGNED_SHORT_5_5_5_1:if(t!==f.RGBA){this.setError(f.INVALID_OPERATION);break}return 2;case f.FLOAT:return 1}return this.setError(f.INVALID_ENUM),0}},{key:"_computeRowStride",value:function(e,t){var r=e*t;return r%this._unpackAlignment&&(r+=this._unpackAlignment-r%this._unpackAlignment),r}},{key:"_fixupLink",value:function(e){if(!o(a(t.prototype),"getProgramParameter",this).call(this,e._,f.LINK_STATUS))return e._linkInfoLog=o(a(t.prototype),"getProgramInfoLog",this).call(this,e),!1;var r=this.getProgramParameter(e,f.ACTIVE_ATTRIBUTES),n=new Array(r);e._attributes.length=r;for(var i=0;i<r;++i)n[i]=this.getActiveAttrib(e,i).name,e._attributes[i]=0|this.getAttribLocation(e,n[i]);for(var s=0;s<n.length;++s)if(n[s].length>256)return e._linkInfoLog="attribute "+n[s]+" is too long",!1;for(var u=0;u<r;++u)o(a(t.prototype),"bindAttribLocation",this).call(this,0|e._,e._attributes[u],n[u]);o(a(t.prototype),"linkProgram",this).call(this,0|e._);var c=this.getProgramParameter(e,f.ACTIVE_UNIFORMS);e._uniforms.length=c;for(var l=0;l<c;++l)e._uniforms[l]=this.getActiveUniform(e,l);for(var h=0;h<e._uniforms.length;++h)if(e._uniforms[h].name.length>256)return e._linkInfoLog="uniform "+e._uniforms[h].name+" is too long",!1;return e._linkInfoLog="",!0}},{key:"_framebufferOk",value:function(){var e=this._activeFramebuffer;return!e||this._preCheckFramebufferStatus(e)===f.FRAMEBUFFER_COMPLETE||(this.setError(f.INVALID_FRAMEBUFFER_OPERATION),!1)}},{key:"_getActiveBuffer",value:function(e){return e===f.ARRAY_BUFFER?this._activeArrayBuffer:e===f.ELEMENT_ARRAY_BUFFER?this._activeElementArrayBuffer:null}},{key:"_getActiveTextureUnit",value:function(){return this._textureUnits[this._activeTextureUnit]}},{key:"_getActiveTexture",value:function(e){var t=this._getActiveTextureUnit();return e===f.TEXTURE_2D?t._bind2D:e===f.TEXTURE_CUBE_MAP?t._bindCube:null}},{key:"_getAttachments",value:function(){return this._extensions.webgl_draw_buffers?this._extensions.webgl_draw_buffers._ALL_ATTACHMENTS:j}},{key:"_getColorAttachments",value:function(){return this._extensions.webgl_draw_buffers?this._extensions.webgl_draw_buffers._ALL_COLOR_ATTACHMENTS:Y}},{key:"_getParameterDirect",value:function(e){return o(a(t.prototype),"getParameter",this).call(this,e)}},{key:"_getTexImage",value:function(e){var t=this._getActiveTextureUnit();return e===f.TEXTURE_2D?t._bind2D:P(e)?t._bindCube:(this.setError(f.INVALID_ENUM),null)}},{key:"_preCheckFramebufferStatus",value:function(e){var t=e._attachments,r=[],n=[],i=t[f.DEPTH_ATTACHMENT],s=t[f.DEPTH_STENCIL_ATTACHMENT],a=t[f.STENCIL_ATTACHMENT];if(s&&(a||i)||a&&i)return f.FRAMEBUFFER_UNSUPPORTED;var o=this._getColorAttachments(),u=0;for(var c in t)t[c]&&-1!==o.indexOf(1*c)&&u++;if(0===u)return f.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT;if(s instanceof X)return f.FRAMEBUFFER_UNSUPPORTED;if(s instanceof z){if(s._format!==f.DEPTH_STENCIL)return f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT;r.push(s._width),n.push(s._height)}if(i instanceof X)return f.FRAMEBUFFER_UNSUPPORTED;if(i instanceof z){if(i._format!==f.DEPTH_COMPONENT16)return f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT;r.push(i._width),n.push(i._height)}if(a instanceof X)return f.FRAMEBUFFER_UNSUPPORTED;if(a instanceof z){if(a._format!==f.STENCIL_INDEX8)return f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT;r.push(a._width),n.push(a._height)}for(var l=!1,h=0;h<o.length;++h){var p=t[o[h]];if(p instanceof X){if(p._format!==f.RGBA||p._type!==f.UNSIGNED_BYTE&&p._type!==f.FLOAT)return f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT;l=!0;var d=e._attachmentLevel[f.COLOR_ATTACHMENT0];r.push(p._levelWidth[d]),n.push(p._levelHeight[d])}else if(p instanceof z){var m=p._format;if(m!==f.RGBA4&&m!==f.RGB565&&m!==f.RGB5_A1)return f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT;l=!0,r.push(p._width),n.push(p._height)}}if(!l&&!a&&!i&&!s)return f.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT;if(r.length<=0||n.length<=0)return f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT;for(var g=1;g<r.length;++g)if(r[g-1]!==r[g]||n[g-1]!==n[g])return f.FRAMEBUFFER_INCOMPLETE_DIMENSIONS;return 0===r[0]||0===n[0]?f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:(e._width=r[0],e._height=n[0],f.FRAMEBUFFER_COMPLETE)}},{key:"_isConstantBlendFunc",value:function(e){return e===f.CONSTANT_COLOR||e===f.ONE_MINUS_CONSTANT_COLOR||e===f.CONSTANT_ALPHA||e===f.ONE_MINUS_CONSTANT_ALPHA}},{key:"_isObject",value:function(e,t,r){if(null!==e&&void 0!==e&&!(e instanceof r))throw new TypeError(t+"("+r.name+")");return!(!this._checkValid(e,r)||!this._checkOwns(e))}},{key:"_resizeDrawingBuffer",value:function(e,r){var n=this._activeFramebuffer,i=this._getActiveTexture(f.TEXTURE_2D),s=this._activeRenderbuffer,u=this._contextAttributes,c=this._drawingBuffer;o(a(t.prototype),"bindFramebuffer",this).call(this,f.FRAMEBUFFER,c._framebuffer);for(var l=this._getAttachments(),h=0;h<l.length;++h)o(a(t.prototype),"framebufferTexture2D",this).call(this,f.FRAMEBUFFER,l[h],f.TEXTURE_2D,0,0);o(a(t.prototype),"bindTexture",this).call(this,f.TEXTURE_2D,c._color);var p=u.alpha?f.RGBA:f.RGB;o(a(t.prototype),"texImage2D",this).call(this,f.TEXTURE_2D,0,p,e,r,0,p,f.UNSIGNED_BYTE,null),o(a(t.prototype),"texParameteri",this).call(this,f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),o(a(t.prototype),"texParameteri",this).call(this,f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),o(a(t.prototype),"framebufferTexture2D",this).call(this,f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c._color,0);var d=0,m=0;u.depth&&u.stencil?(d=f.DEPTH_STENCIL,m=f.DEPTH_STENCIL_ATTACHMENT):u.depth?(d=33191,m=f.DEPTH_ATTACHMENT):u.stencil&&(d=f.STENCIL_INDEX8,m=f.STENCIL_ATTACHMENT),d&&(o(a(t.prototype),"bindRenderbuffer",this).call(this,f.RENDERBUFFER,c._depthStencil),o(a(t.prototype),"renderbufferStorage",this).call(this,f.RENDERBUFFER,d,e,r),o(a(t.prototype),"framebufferRenderbuffer",this).call(this,f.FRAMEBUFFER,m,f.RENDERBUFFER,c._depthStencil)),this.bindFramebuffer(f.FRAMEBUFFER,n),this.bindTexture(f.TEXTURE_2D,i),this.bindRenderbuffer(f.RENDERBUFFER,s)}},{key:"_restoreError",value:function(e){var t=this._errorStack.pop();t===f.NO_ERROR?this.setError(e):this.setError(t)}},{key:"_saveError",value:function(){this._errorStack.push(this.getError())}},{key:"_switchActiveBuffer",value:function(e,t){e!==t&&(e&&(e._refCount-=1,e._checkDelete()),t&&(t._refCount+=1))}},{key:"_switchActiveProgram",value:function(e){e&&(e._refCount-=1,e._checkDelete())}},{key:"_tryDetachFramebuffer",value:function(e,t){if(e&&e._linked(t))for(var r=this._getAttachments(),n=Object.keys(e._attachments),i=0;i<n.length;++i)e._attachments[r[i]]===t&&this.framebufferTexture2D(f.FRAMEBUFFER,0|r[i],f.TEXTURE_2D,null)}},{key:"_updateFramebufferAttachments",value:function(e){var r=e._status,n=this._getAttachments();if(e._status=this._preCheckFramebufferStatus(e),e._status===f.FRAMEBUFFER_COMPLETE){for(var i=0;i<n.length;++i){var s=n[i];o(a(t.prototype),"framebufferTexture2D",this).call(this,f.FRAMEBUFFER,s,e._attachmentFace[s],0,e._attachmentLevel[s])}for(var u=0;u<n.length;++u){var c=n[u],l=e._attachments[c];l instanceof X?o(a(t.prototype),"framebufferTexture2D",this).call(this,f.FRAMEBUFFER,c,e._attachmentFace[c],0|l._,e._attachmentLevel[c]):l instanceof z&&o(a(t.prototype),"framebufferRenderbuffer",this).call(this,f.FRAMEBUFFER,c,f.RENDERBUFFER,0|l._)}}else if(r===f.FRAMEBUFFER_COMPLETE)for(var h=0;h<n.length;++h){var p=n[h];o(a(t.prototype),"framebufferTexture2D",this).call(this,f.FRAMEBUFFER,p,e._attachmentFace[p],0,e._attachmentLevel[p])}}},{key:"_validBlendFunc",value:function(e){return e===f.ZERO||e===f.ONE||e===f.SRC_COLOR||e===f.ONE_MINUS_SRC_COLOR||e===f.DST_COLOR||e===f.ONE_MINUS_DST_COLOR||e===f.SRC_ALPHA||e===f.ONE_MINUS_SRC_ALPHA||e===f.DST_ALPHA||e===f.ONE_MINUS_DST_ALPHA||e===f.SRC_ALPHA_SATURATE||e===f.CONSTANT_COLOR||e===f.ONE_MINUS_CONSTANT_COLOR||e===f.CONSTANT_ALPHA||e===f.ONE_MINUS_CONSTANT_ALPHA}},{key:"_validBlendMode",value:function(e){return e===f.FUNC_ADD||e===f.FUNC_SUBTRACT||e===f.FUNC_REVERSE_SUBTRACT}},{key:"_validCubeTarget",value:function(e){return e===f.TEXTURE_CUBE_MAP_POSITIVE_X||e===f.TEXTURE_CUBE_MAP_NEGATIVE_X||e===f.TEXTURE_CUBE_MAP_POSITIVE_Y||e===f.TEXTURE_CUBE_MAP_NEGATIVE_Y||e===f.TEXTURE_CUBE_MAP_POSITIVE_Z||e===f.TEXTURE_CUBE_MAP_NEGATIVE_Z}},{key:"_validFramebufferAttachment",value:function(e){switch(e){case f.DEPTH_ATTACHMENT:case f.STENCIL_ATTACHMENT:case f.DEPTH_STENCIL_ATTACHMENT:case f.COLOR_ATTACHMENT0:return!0}if(this._extensions.webgl_draw_buffers){var t=this._extensions.webgl_draw_buffers;return e<t.COLOR_ATTACHMENT0_WEBGL+t._maxDrawBuffers}return!1}},{key:"_validGLSLIdentifier",value:function(e){return!(0===e.indexOf("webgl_")||0===e.indexOf("_webgl_")||e.length>256)}},{key:"_validTextureTarget",value:function(e){return e===f.TEXTURE_2D||e===f.TEXTURE_CUBE_MAP}},{key:"_verifyTextureCompleteness",value:function(e,t,r){var n=this._getActiveTextureUnit(),i=null;if(e===f.TEXTURE_2D?i=n._bind2D:this._validCubeTarget(e)&&(i=n._bindCube),this._extensions.oes_texture_float&&i&&i._type===f.FLOAT&&(t===f.TEXTURE_MAG_FILTER||t===f.TEXTURE_MIN_FILTER)&&(r===f.LINEAR||r===f.LINEAR_MIPMAP_NEAREST||r===f.NEAREST_MIPMAP_LINEAR||r===f.LINEAR_MIPMAP_LINEAR))return i._complete=!1,void this.bindTexture(e,i);i&&!1===i._complete&&(i._complete=!0,this.bindTexture(e,i))}},{key:"_wrapShader",value:function(e,t){return this._extensions.webgl_draw_buffers?t:this._extensions.webgl_draw_buffers?t:"#define gl_MaxDrawBuffers 1\n"+t}},{key:"_beginAttrib0Hack",value:function(){o(a(t.prototype),"bindBuffer",this).call(this,f.ARRAY_BUFFER,this._attrib0Buffer._),o(a(t.prototype),"bufferData",this).call(this,f.ARRAY_BUFFER,this._vertexAttribs[0]._data,f.STREAM_DRAW),o(a(t.prototype),"enableVertexAttribArray",this).call(this,0),o(a(t.prototype),"vertexAttribPointer",this).call(this,0,4,f.FLOAT,!1,0,0),o(a(t.prototype),"_vertexAttribDivisor",this).call(this,0,1)}},{key:"_endAttrib0Hack",value:function(){var e=this._vertexAttribs[0];e._pointerBuffer?o(a(t.prototype),"bindBuffer",this).call(this,f.ARRAY_BUFFER,e._pointerBuffer._):o(a(t.prototype),"bindBuffer",this).call(this,f.ARRAY_BUFFER,0),o(a(t.prototype),"vertexAttribPointer",this).call(this,0,e._inputSize,e._pointerType,e._pointerNormal,e._inputStride,e._pointerOffset),o(a(t.prototype),"_vertexAttribDivisor",this).call(this,0,e._divisor),o(a(t.prototype),"disableVertexAttribArray",this).call(this,0),this._activeArrayBuffer?o(a(t.prototype),"bindBuffer",this).call(this,f.ARRAY_BUFFER,this._activeArrayBuffer._):o(a(t.prototype),"bindBuffer",this).call(this,f.ARRAY_BUFFER,0)}},{key:"activeTexture",value:function(e){var r=(e|=0)-f.TEXTURE0;if(r>=0&&r<this._textureUnits.length)return this._activeTextureUnit=r,o(a(t.prototype),"activeTexture",this).call(this,e);this.setError(f.INVALID_ENUM)}},{key:"attachShader",value:function(e,r){if(!b(e)||!b(r))throw new TypeError("attachShader(WebGLProgram, WebGLShader)");if(e&&r){if(e instanceof G&&r instanceof K&&this._checkOwns(e)&&this._checkOwns(r)&&!e._linked(r)){this._saveError(),o(a(t.prototype),"attachShader",this).call(this,0|e._,0|r._);var n=this.getError();return this._restoreError(n),void(n===f.NO_ERROR&&e._link(r))}this.setError(f.INVALID_OPERATION)}else this.setError(f.INVALID_VALUE)}},{key:"bindAttribLocation",value:function(e,r,n){if(!b(e)||"string"!==typeof n)throw new TypeError("bindAttribLocation(WebGLProgram, GLint, String)");if(!k(n+="")||n.length>256)this.setError(f.INVALID_VALUE);else if(/^_?webgl_a/.test(n))this.setError(f.INVALID_OPERATION);else if(this._checkWrapper(e,G))return o(a(t.prototype),"bindAttribLocation",this).call(this,0|e._,0|r,n)}},{key:"bindFramebuffer",value:function(e,r){if(!b(r))throw new TypeError("bindFramebuffer(GLenum, WebGLFramebuffer)");if(e===f.FRAMEBUFFER){if(r){if(r._pendingDelete)return;if(!this._checkWrapper(r,U))return;o(a(t.prototype),"bindFramebuffer",this).call(this,f.FRAMEBUFFER,0|r._)}else o(a(t.prototype),"bindFramebuffer",this).call(this,f.FRAMEBUFFER,this._drawingBuffer._framebuffer);var n=this._activeFramebuffer;n!==r&&(n&&(n._refCount-=1,n._checkDelete()),r&&(r._refCount+=1)),this._activeFramebuffer=r,r&&this._updateFramebufferAttachments(r)}else this.setError(f.INVALID_ENUM)}},{key:"bindBuffer",value:function(e,r){if(e|=0,!b(r))throw new TypeError("bindBuffer(GLenum, WebGLBuffer)");if(e===f.ARRAY_BUFFER||e===f.ELEMENT_ARRAY_BUFFER){if(r){if(r._pendingDelete)return;if(!this._checkWrapper(r,V))return;if(r._binding&&r._binding!==e)return void this.setError(f.INVALID_OPERATION);r._binding=0|e,o(a(t.prototype),"bindBuffer",this).call(this,e,0|r._)}else o(a(t.prototype),"bindBuffer",this).call(this,e,0);e===f.ARRAY_BUFFER?(this._switchActiveBuffer(this._activeArrayBuffer,r),this._activeArrayBuffer=r):(this._switchActiveBuffer(this._activeElementArrayBuffer,r),this._activeElementArrayBuffer=r)}else this.setError(f.INVALID_ENUM)}},{key:"bindRenderbuffer",value:function(e,r){if(!b(r))throw new TypeError("bindRenderbuffer(GLenum, WebGLRenderbuffer)");if(e===f.RENDERBUFFER){if(r){if(r._pendingDelete)return;if(!this._checkWrapper(r,z))return;o(a(t.prototype),"bindRenderbuffer",this).call(this,0|e,0|r._)}else o(a(t.prototype),"bindRenderbuffer",this).call(this,0|e,0);var n=this._activeRenderbuffer;n!==r&&(n&&(n._refCount-=1,n._checkDelete()),r&&(r._refCount+=1)),this._activeRenderbuffer=r}else this.setError(f.INVALID_ENUM)}},{key:"bindTexture",value:function(e,r){if(e|=0,!b(r))throw new TypeError("bindTexture(GLenum, WebGLTexture)");if(this._validTextureTarget(e)){var n=0;if(r){if(r instanceof X&&r._pendingDelete)return;if(!this._checkWrapper(r,X))return;if(r._binding&&r._binding!==e)return void this.setError(f.INVALID_OPERATION);r._binding=e,r._complete&&(n=0|r._)}else r=null;this._saveError(),o(a(t.prototype),"bindTexture",this).call(this,e,n);var i=this.getError();if(this._restoreError(i),i===f.NO_ERROR){var s=this._getActiveTextureUnit(),u=this._getActiveTexture(e);u!==r&&(u&&(u._refCount-=1,u._checkDelete()),r&&(r._refCount+=1)),e===f.TEXTURE_2D?s._bind2D=r:e===f.TEXTURE_CUBE_MAP&&(s._bindCube=r)}}else this.setError(f.INVALID_ENUM)}},{key:"blendColor",value:function(e,r,n,i){return o(a(t.prototype),"blendColor",this).call(this,+e,+r,+n,+i)}},{key:"blendEquation",value:function(e){if(e|=0,this._validBlendMode(e))return o(a(t.prototype),"blendEquation",this).call(this,e);this.setError(f.INVALID_ENUM)}},{key:"blendEquationSeparate",value:function(e,r){if(e|=0,r|=0,this._validBlendMode(e)&&this._validBlendMode(r))return o(a(t.prototype),"blendEquationSeparate",this).call(this,e,r);this.setError(f.INVALID_ENUM)}},{key:"createBuffer",value:function(){var e=o(a(t.prototype),"createBuffer",this).call(this);if(e<=0)return null;var r=new V(e,this);return this._buffers[e]=r,r}},{key:"createFramebuffer",value:function(){var e=o(a(t.prototype),"createFramebuffer",this).call(this);if(e<=0)return null;var r=new U(e,this);return this._framebuffers[e]=r,r}},{key:"createProgram",value:function(){var e=o(a(t.prototype),"createProgram",this).call(this);if(e<=0)return null;var r=new G(e,this);return this._programs[e]=r,r}},{key:"createRenderbuffer",value:function(){var e=o(a(t.prototype),"createRenderbuffer",this).call(this);if(e<=0)return null;var r=new z(e,this);return this._renderbuffers[e]=r,r}},{key:"createTexture",value:function(){var e=o(a(t.prototype),"createTexture",this).call(this);if(e<=0)return null;var r=new X(e,this);return this._textures[e]=r,r}},{key:"getContextAttributes",value:function(){return this._contextAttributes}},{key:"getExtension",value:function(e){var t=e.toLowerCase();if(t in this._extensions)return this._extensions[t];var r=q[t]?q[t](this):null;return r&&(this._extensions[t]=r),r}},{key:"getSupportedExtensions",value:function(){var e=["ANGLE_instanced_arrays","STACKGL_resize_drawingbuffer","STACKGL_destroy_context"],r=o(a(t.prototype),"getSupportedExtensions",this).call(this);return r.indexOf("GL_OES_element_index_uint")>=0&&e.push("OES_element_index_uint"),r.indexOf("GL_OES_texture_float")>=0&&e.push("OES_texture_float"),r.indexOf("EXT_draw_buffers")>=0&&e.push("WEBGL_draw_buffers"),e}},{key:"setError",value:function(e){m.setError.call(this,0|e)}},{key:"blendFunc",value:function(e,r){e|=0,r|=0,this._validBlendFunc(e)&&this._validBlendFunc(r)?this._isConstantBlendFunc(e)&&this._isConstantBlendFunc(r)?this.setError(f.INVALID_OPERATION):o(a(t.prototype),"blendFunc",this).call(this,e,r):this.setError(f.INVALID_ENUM)}},{key:"blendFuncSeparate",value:function(e,r,n,i){e|=0,r|=0,n|=0,i|=0,this._validBlendFunc(e)&&this._validBlendFunc(r)&&this._validBlendFunc(n)&&this._validBlendFunc(i)?this._isConstantBlendFunc(e)&&this._isConstantBlendFunc(r)||this._isConstantBlendFunc(n)&&this._isConstantBlendFunc(i)?this.setError(f.INVALID_OPERATION):o(a(t.prototype),"blendFuncSeparate",this).call(this,e,r,n,i):this.setError(f.INVALID_ENUM)}},{key:"bufferData",value:function(e,r,n){if(e|=0,(n|=0)===f.STREAM_DRAW||n===f.STATIC_DRAW||n===f.DYNAMIC_DRAW)if(e===f.ARRAY_BUFFER||e===f.ELEMENT_ARRAY_BUFFER){var i=this._getActiveBuffer(e);if(i)if("object"===typeof r){var s=null;if(N(r))s=C(r);else{if(!(r instanceof ArrayBuffer))return void this.setError(f.INVALID_VALUE);s=new Uint8Array(r)}this._saveError(),o(a(t.prototype),"bufferData",this).call(this,e,s,n);var u=this.getError();if(this._restoreError(u),u!==f.NO_ERROR)return;i._size=s.length,e===f.ELEMENT_ARRAY_BUFFER&&(i._elements=new Uint8Array(s))}else if("number"===typeof r){var c=0|r;if(c<0)return void this.setError(f.INVALID_VALUE);this._saveError(),o(a(t.prototype),"bufferData",this).call(this,e,c,n);var l=this.getError();if(this._restoreError(l),l!==f.NO_ERROR)return;i._size=c,e===f.ELEMENT_ARRAY_BUFFER&&(i._elements=new Uint8Array(c))}else this.setError(f.INVALID_VALUE);else this.setError(f.INVALID_OPERATION)}else this.setError(f.INVALID_ENUM);else this.setError(f.INVALID_ENUM)}},{key:"bufferSubData",value:function(e,r,n){if(r|=0,(e|=0)===f.ARRAY_BUFFER||e===f.ELEMENT_ARRAY_BUFFER){if(null!==n)if(n&&"object"===typeof n){var i=this._getActiveBuffer(e);if(i)if(r<0||r>=i._size)this.setError(f.INVALID_VALUE);else{var s=null;if(N(n))s=C(n);else{if(!(n instanceof ArrayBuffer))return void this.setError(f.INVALID_VALUE);s=new Uint8Array(n)}r+s.length>i._size?this.setError(f.INVALID_VALUE):(e===f.ELEMENT_ARRAY_BUFFER&&i._elements.set(s,r),o(a(t.prototype),"bufferSubData",this).call(this,e,r,s))}else this.setError(f.INVALID_OPERATION)}else this.setError(f.INVALID_VALUE)}else this.setError(f.INVALID_ENUM)}},{key:"checkFramebufferStatus",value:function(e){if(e!==f.FRAMEBUFFER)return this.setError(f.INVALID_ENUM),0;var t=this._activeFramebuffer;return t?this._preCheckFramebufferStatus(t):f.FRAMEBUFFER_COMPLETE}},{key:"clear",value:function(e){if(this._framebufferOk())return o(a(t.prototype),"clear",this).call(this,0|e)}},{key:"clearColor",value:function(e,r,n,i){return o(a(t.prototype),"clearColor",this).call(this,+e,+r,+n,+i)}},{key:"clearDepth",value:function(e){return o(a(t.prototype),"clearDepth",this).call(this,+e)}},{key:"clearStencil",value:function(e){return o(a(t.prototype),"clearStencil",this).call(this,0|e)}},{key:"colorMask",value:function(e,r,n,i){return o(a(t.prototype),"colorMask",this).call(this,!!e,!!r,!!n,!!i)}},{key:"compileShader",value:function(e){if(!b(e))throw new TypeError("compileShader(WebGLShader)");if(this._checkWrapper(e,K)&&this._checkShaderSource(e)){var r=this.getError();o(a(t.prototype),"compileShader",this).call(this,0|e._);var n=this.getError();e._compileStatus=!!o(a(t.prototype),"getShaderParameter",this).call(this,0|e._,f.COMPILE_STATUS),e._compileInfo=o(a(t.prototype),"getShaderInfoLog",this).call(this,0|e._),this.getError(),this.setError(r||n)}}},{key:"copyTexImage2D",value:function(e,r,n,i,s,u,l,h){e|=0,r|=0,n|=0,i|=0,s|=0,u|=0,l|=0,h|=0;var p=this._getTexImage(e);if(p)if(n===f.RGBA||n===f.RGB||n===f.ALPHA||n===f.LUMINANCE||n===f.LUMINANCE_ALPHA)if(r<0||u<0||l<0||0!==h)this.setError(f.INVALID_VALUE);else if(!(r>0)||c.isPow2(u)&&c.isPow2(l)){this._saveError(),o(a(t.prototype),"copyTexImage2D",this).call(this,e,r,n,i,s,u,l,h);var d=this.getError();this._restoreError(d),d===f.NO_ERROR&&(p._levelWidth[r]=u,p._levelHeight[r]=l,p._format=f.RGBA,p._type=f.UNSIGNED_BYTE)}else this.setError(f.INVALID_VALUE);else this.setError(f.INVALID_ENUM);else this.setError(f.INVALID_OPERATION)}},{key:"copyTexSubImage2D",value:function(e,r,n,i,s,u,c,l){e|=0,r|=0,n|=0,i|=0,s|=0,u|=0,c|=0,l|=0,this._getTexImage(e)?c<0||l<0||n<0||i<0||r<0?this.setError(f.INVALID_VALUE):o(a(t.prototype),"copyTexSubImage2D",this).call(this,e,r,n,i,s,u,c,l):this.setError(f.INVALID_OPERATION)}},{key:"cullFace",value:function(e){return o(a(t.prototype),"cullFace",this).call(this,0|e)}},{key:"createShader",value:function(e){if((e|=0)!==f.FRAGMENT_SHADER&&e!==f.VERTEX_SHADER)return this.setError(f.INVALID_ENUM),null;var r=o(a(t.prototype),"createShader",this).call(this,e);if(r<0)return null;var n=new K(r,this,e);return this._shaders[r]=n,n}},{key:"deleteProgram",value:function(e){return this._deleteLinkable("deleteProgram",e,G)}},{key:"deleteShader",value:function(e){return this._deleteLinkable("deleteShader",e,K)}},{key:"_deleteLinkable",value:function(e,t,r){if(!b(t))throw new TypeError(e+"("+r.name+")");if(t instanceof r&&this._checkOwns(t))return t._pendingDelete=!0,void t._checkDelete();this.setError(f.INVALID_OPERATION)}},{key:"deleteBuffer",value:function(e){if(!b(e)||null!==e&&!(e instanceof V))throw new TypeError("deleteBuffer(WebGLBuffer)");if(e instanceof V&&this._checkOwns(e)){this._activeArrayBuffer===e&&this.bindBuffer(f.ARRAY_BUFFER,null),this._activeElementArrayBuffer===e&&this.bindBuffer(f.ELEMENT_ARRAY_BUFFER,null);for(var t=0;t<this._vertexAttribs.length;++t){var r=this._vertexAttribs[t];r._pointerBuffer===e&&(r._pointerBuffer=null,r._pointerStride=0,r._pointerOffset=0,r._pointerSize=4,e._refCount-=1)}e._pendingDelete=!0,e._checkDelete()}else this.setError(f.INVALID_OPERATION)}},{key:"deleteFramebuffer",value:function(e){if(!b(e))throw new TypeError("deleteFramebuffer(WebGLFramebuffer)");e instanceof U&&this._checkOwns(e)?(this._activeFramebuffer===e&&this.bindFramebuffer(f.FRAMEBUFFER,null),e._pendingDelete=!0,e._checkDelete()):this.setError(f.INVALID_OPERATION)}},{key:"deleteRenderbuffer",value:function(e){if(!b(e))throw new TypeError("deleteRenderbuffer(WebGLRenderbuffer)");if(e instanceof z&&this._checkOwns(e)){this._activeRenderbuffer===e&&this.bindRenderbuffer(f.RENDERBUFFER,null);var t=this._activeFramebuffer;this._tryDetachFramebuffer(t,e),e._pendingDelete=!0,e._checkDelete()}else this.setError(f.INVALID_OPERATION)}},{key:"deleteTexture",value:function(e){if(!b(e))throw new TypeError("deleteTexture(WebGLTexture)");if(e instanceof X)if(this._checkOwns(e)){for(var t=this._activeTextureUnit,r=0;r<this._textureUnits.length;++r){var n=this._textureUnits[r];n._bind2D===e?(this.activeTexture(f.TEXTURE0+r),this.bindTexture(f.TEXTURE_2D,null)):n._bindCube===e&&(this.activeTexture(f.TEXTURE0+r),this.bindTexture(f.TEXTURE_CUBE_MAP,null))}this.activeTexture(f.TEXTURE0+t);var i=this;!function(t){if(t&&t._linked(e))for(var r=i._getAttachments(),n=0;n<r.length;++n){var s=r[n];t._attachments[s]===e&&i.framebufferTexture2D(f.FRAMEBUFFER,s,f.TEXTURE_2D,null)}}(this._activeFramebuffer),e._pendingDelete=!0,e._checkDelete()}else this.setError(f.INVALID_OPERATION)}},{key:"depthFunc",value:function(e){switch(e|=0){case f.NEVER:case f.LESS:case f.EQUAL:case f.LEQUAL:case f.GREATER:case f.NOTEQUAL:case f.GEQUAL:case f.ALWAYS:return o(a(t.prototype),"depthFunc",this).call(this,e);default:this.setError(f.INVALID_ENUM)}}},{key:"depthMask",value:function(e){return o(a(t.prototype),"depthMask",this).call(this,!!e)}},{key:"depthRange",value:function(e,r){if((e=+e)<=(r=+r))return o(a(t.prototype),"depthRange",this).call(this,e,r);this.setError(f.INVALID_OPERATION)}},{key:"destroy",value:function(){o(a(t.prototype),"destroy",this).call(this)}},{key:"detachShader",value:function(e,r){if(!b(e)||!b(r))throw new TypeError("detachShader(WebGLProgram, WebGLShader)");this._checkWrapper(e,G)&&this._checkWrapper(r,K)&&(e._linked(r)?(o(a(t.prototype),"detachShader",this).call(this,e._,r._),e._unlink(r)):this.setError(f.INVALID_OPERATION))}},{key:"disable",value:function(e){if(e|=0,o(a(t.prototype),"disable",this).call(this,e),e===f.TEXTURE_2D||e===f.TEXTURE_CUBE_MAP){var r=this._getActiveTextureUnit();r._mode===e&&(r._mode=0)}}},{key:"disableVertexAttribArray",value:function(e){(e|=0)<0||e>=this._vertexAttribs.length?this.setError(f.INVALID_VALUE):(o(a(t.prototype),"disableVertexAttribArray",this).call(this,e),this._vertexAttribs[e]._isPointer=!1)}},{key:"drawArrays",value:function(e,r,n){if(e|=0,n|=0,(r|=0)<0||n<0)this.setError(f.INVALID_VALUE);else if(this._checkStencilState()){var i=D(e,n);if(i<0)this.setError(f.INVALID_ENUM);else if(this._framebufferOk()&&0!==n){var s=r;if(n>0&&(s=n+r-1>>>0),this._checkVertexAttribState(s)){if(this._vertexAttribs[0]._isPointer||this._extensions.webgl_draw_buffers&&this._extensions.webgl_draw_buffers._buffersState&&this._extensions.webgl_draw_buffers._buffersState.length>0)return o(a(t.prototype),"drawArrays",this).call(this,e,r,i);this._beginAttrib0Hack(),o(a(t.prototype),"_drawArraysInstanced",this).call(this,e,r,i,1),this._endAttrib0Hack()}}}}},{key:"drawElements",value:function(e,r,n,i){if(e|=0,n|=0,i|=0,(r|=0)<0||i<0)this.setError(f.INVALID_VALUE);else if(this._checkStencilState()){var s=this._activeElementArrayBuffer;if(s){var u=null,c=i;if(n===f.UNSIGNED_SHORT){if(c%2)return void this.setError(f.INVALID_OPERATION);c>>=1,u=new Uint16Array(s._elements.buffer)}else if(this._extensions.oes_element_index_uint&&n===f.UNSIGNED_INT){if(c%4)return void this.setError(f.INVALID_OPERATION);c>>=2,u=new Uint32Array(s._elements.buffer)}else{if(n!==f.UNSIGNED_BYTE)return void this.setError(f.INVALID_ENUM);u=s._elements}var l=r;switch(e){case f.TRIANGLES:r%3&&(l-=r%3);break;case f.LINES:r%2&&(l-=r%2);break;case f.POINTS:break;case f.LINE_LOOP:case f.LINE_STRIP:if(r<2)return void this.setError(f.INVALID_OPERATION);break;case f.TRIANGLE_FAN:case f.TRIANGLE_STRIP:if(r<3)return void this.setError(f.INVALID_OPERATION);break;default:return void this.setError(f.INVALID_ENUM)}if(this._framebufferOk())if(0!==r)if(r+c>>>0>u.length)this.setError(f.INVALID_OPERATION);else{for(var h=-1,p=c;p<c+r;++p)h=Math.max(h,u[p]);if(h<0)this._checkVertexAttribState(0);else if(this._checkVertexAttribState(h)&&l>0){if(this._vertexAttribs[0]._isPointer)return o(a(t.prototype),"drawElements",this).call(this,e,l,n,i);this._beginAttrib0Hack(),o(a(t.prototype),"_drawElementsInstanced",this).call(this,e,l,n,i,1),this._endAttrib0Hack()}}else this._checkVertexAttribState(0)}else this.setError(f.INVALID_OPERATION)}}},{key:"enable",value:function(e){e|=0,o(a(t.prototype),"enable",this).call(this,e)}},{key:"enableVertexAttribArray",value:function(e){(e|=0)<0||e>=this._vertexAttribs.length?this.setError(f.INVALID_VALUE):(o(a(t.prototype),"enableVertexAttribArray",this).call(this,e),this._vertexAttribs[e]._isPointer=!0)}},{key:"finish",value:function(){return o(a(t.prototype),"finish",this).call(this)}},{key:"flush",value:function(){return o(a(t.prototype),"flush",this).call(this)}},{key:"framebufferRenderbuffer",value:function(e,t,r,n){if(e|=0,t|=0,r|=0,!b(n))throw new TypeError("framebufferRenderbuffer(GLenum, GLenum, GLenum, WebGLRenderbuffer)");if(e===f.FRAMEBUFFER&&this._validFramebufferAttachment(t)&&r===f.RENDERBUFFER){var i=this._activeFramebuffer;i?n&&!this._checkWrapper(n,z)||(i._setAttachment(n,t),this._updateFramebufferAttachments(i)):this.setError(f.INVALID_OPERATION)}else this.setError(f.INVALID_ENUM)}},{key:"framebufferTexture2D",value:function(e,t,r,n,i){if(e|=0,t|=0,r|=0,i|=0,!b(n))throw new TypeError("framebufferTexture2D(GLenum, GLenum, GLenum, WebGLTexture, GLint)");if(e===f.FRAMEBUFFER&&this._validFramebufferAttachment(t))if(0===i){if(!n||this._checkWrapper(n,X)){if(r===f.TEXTURE_2D){if(n&&n._binding!==f.TEXTURE_2D)return void this.setError(f.INVALID_OPERATION)}else{if(!this._validCubeTarget(r))return void this.setError(f.INVALID_ENUM);if(n&&n._binding!==f.TEXTURE_CUBE_MAP)return void this.setError(f.INVALID_OPERATION)}var s=this._activeFramebuffer;s?(s._attachmentLevel[t]=i,s._attachmentFace[t]=r,s._setAttachment(n,t),this._updateFramebufferAttachments(s)):this.setError(f.INVALID_OPERATION)}}else this.setError(f.INVALID_VALUE);else this.setError(f.INVALID_ENUM)}},{key:"frontFace",value:function(e){return o(a(t.prototype),"frontFace",this).call(this,0|e)}},{key:"generateMipmap",value:function(e){return 0|o(a(t.prototype),"generateMipmap",this).call(this,0|e)}},{key:"getActiveAttrib",value:function(e,r){if(!b(e))throw new TypeError("getActiveAttrib(WebGLProgram)");if(e){if(this._checkWrapper(e,G)){var n=o(a(t.prototype),"getActiveAttrib",this).call(this,0|e._,0|r);if(n)return new M(n)}}else this.setError(f.INVALID_VALUE);return null}},{key:"getActiveUniform",value:function(e,r){if(!b(e))throw new TypeError("getActiveUniform(WebGLProgram, GLint)");if(e){if(this._checkWrapper(e,G)){var n=o(a(t.prototype),"getActiveUniform",this).call(this,0|e._,0|r);if(n)return new M(n)}}else this.setError(f.INVALID_VALUE);return null}},{key:"getAttachedShaders",value:function(e){if(!b(e)||"object"===typeof e&&null!==e&&!(e instanceof G))throw new TypeError("getAttachedShaders(WebGLProgram)");if(e){if(this._checkWrapper(e,G)){var r=o(a(t.prototype),"getAttachedShaders",this).call(this,0|e._);if(!r)return null;for(var n=new Array(r.length),i=0;i<r.length;++i)n[i]=this._shaders[r[i]];return n}}else this.setError(f.INVALID_VALUE);return null}},{key:"getAttribLocation",value:function(e,r){if(!b(e))throw new TypeError("getAttribLocation(WebGLProgram, String)");if(!k(r+="")||r.length>256)this.setError(f.INVALID_VALUE);else if(this._checkWrapper(e,G))return o(a(t.prototype),"getAttribLocation",this).call(this,0|e._,r+"");return-1}},{key:"getParameter",value:function(e){switch(e|=0){case f.ARRAY_BUFFER_BINDING:return this._activeArrayBuffer;case f.ELEMENT_ARRAY_BUFFER_BINDING:return this._activeElementArrayBuffer;case f.CURRENT_PROGRAM:return this._activeProgram;case f.FRAMEBUFFER_BINDING:return this._activeFramebuffer;case f.RENDERBUFFER_BINDING:return this._activeRenderbuffer;case f.TEXTURE_BINDING_2D:return this._getActiveTextureUnit()._bind2D;case f.TEXTURE_BINDING_CUBE_MAP:return this._getActiveTextureUnit()._bindCube;case f.VERSION:return"WebGL 1.0 stack-gl "+h;case f.VENDOR:return"stack-gl";case f.RENDERER:return"ANGLE";case f.SHADING_LANGUAGE_VERSION:return"WebGL GLSL ES 1.0 stack-gl";case f.COMPRESSED_TEXTURE_FORMATS:return new Uint32Array(0);case f.MAX_VIEWPORT_DIMS:case f.SCISSOR_BOX:case f.VIEWPORT:return new Int32Array(o(a(t.prototype),"getParameter",this).call(this,e));case f.ALIASED_LINE_WIDTH_RANGE:case f.ALIASED_POINT_SIZE_RANGE:case f.DEPTH_RANGE:case f.BLEND_COLOR:case f.COLOR_CLEAR_VALUE:return new Float32Array(o(a(t.prototype),"getParameter",this).call(this,e));case f.COLOR_WRITEMASK:return o(a(t.prototype),"getParameter",this).call(this,e);case f.DEPTH_CLEAR_VALUE:case f.LINE_WIDTH:case f.POLYGON_OFFSET_FACTOR:case f.POLYGON_OFFSET_UNITS:case f.SAMPLE_COVERAGE_VALUE:return+o(a(t.prototype),"getParameter",this).call(this,e);case f.BLEND:case f.CULL_FACE:case f.DEPTH_TEST:case f.DEPTH_WRITEMASK:case f.DITHER:case f.POLYGON_OFFSET_FILL:case f.SAMPLE_COVERAGE_INVERT:case f.SCISSOR_TEST:case f.STENCIL_TEST:case f.UNPACK_FLIP_Y_WEBGL:case f.UNPACK_PREMULTIPLY_ALPHA_WEBGL:return!!o(a(t.prototype),"getParameter",this).call(this,e);case f.ACTIVE_TEXTURE:case f.ALPHA_BITS:case f.BLEND_DST_ALPHA:case f.BLEND_DST_RGB:case f.BLEND_EQUATION_ALPHA:case f.BLEND_EQUATION_RGB:case f.BLEND_SRC_ALPHA:case f.BLEND_SRC_RGB:case f.BLUE_BITS:case f.CULL_FACE_MODE:case f.DEPTH_BITS:case f.DEPTH_FUNC:case f.FRONT_FACE:case f.GENERATE_MIPMAP_HINT:case f.GREEN_BITS:case f.MAX_COMBINED_TEXTURE_IMAGE_UNITS:case f.MAX_CUBE_MAP_TEXTURE_SIZE:case f.MAX_FRAGMENT_UNIFORM_VECTORS:case f.MAX_RENDERBUFFER_SIZE:case f.MAX_TEXTURE_IMAGE_UNITS:case f.MAX_TEXTURE_SIZE:case f.MAX_VARYING_VECTORS:case f.MAX_VERTEX_ATTRIBS:case f.MAX_VERTEX_TEXTURE_IMAGE_UNITS:case f.MAX_VERTEX_UNIFORM_VECTORS:case f.PACK_ALIGNMENT:case f.RED_BITS:case f.SAMPLE_BUFFERS:case f.SAMPLES:case f.STENCIL_BACK_FAIL:case f.STENCIL_BACK_FUNC:case f.STENCIL_BACK_PASS_DEPTH_FAIL:case f.STENCIL_BACK_PASS_DEPTH_PASS:case f.STENCIL_BACK_REF:case f.STENCIL_BACK_VALUE_MASK:case f.STENCIL_BACK_WRITEMASK:case f.STENCIL_BITS:case f.STENCIL_CLEAR_VALUE:case f.STENCIL_FAIL:case f.STENCIL_FUNC:case f.STENCIL_PASS_DEPTH_FAIL:case f.STENCIL_PASS_DEPTH_PASS:case f.STENCIL_REF:case f.STENCIL_VALUE_MASK:case f.STENCIL_WRITEMASK:case f.SUBPIXEL_BITS:case f.UNPACK_ALIGNMENT:case f.UNPACK_COLORSPACE_CONVERSION_WEBGL:return 0|o(a(t.prototype),"getParameter",this).call(this,e);case f.IMPLEMENTATION_COLOR_READ_FORMAT:case f.IMPLEMENTATION_COLOR_READ_TYPE:return o(a(t.prototype),"getParameter",this).call(this,e);default:if(this._extensions.webgl_draw_buffers){var r=this._extensions.webgl_draw_buffers;switch(e){case r.DRAW_BUFFER0_WEBGL:case r.DRAW_BUFFER1_WEBGL:case r.DRAW_BUFFER2_WEBGL:case r.DRAW_BUFFER3_WEBGL:case r.DRAW_BUFFER4_WEBGL:case r.DRAW_BUFFER5_WEBGL:case r.DRAW_BUFFER6_WEBGL:case r.DRAW_BUFFER7_WEBGL:case r.DRAW_BUFFER8_WEBGL:case r.DRAW_BUFFER9_WEBGL:case r.DRAW_BUFFER10_WEBGL:case r.DRAW_BUFFER11_WEBGL:case r.DRAW_BUFFER12_WEBGL:case r.DRAW_BUFFER13_WEBGL:case r.DRAW_BUFFER14_WEBGL:case r.DRAW_BUFFER15_WEBGL:return 1===r._buffersState.length&&r._buffersState[0]===f.BACK?f.BACK:o(a(t.prototype),"getParameter",this).call(this,e);case r.MAX_DRAW_BUFFERS_WEBGL:case r.MAX_COLOR_ATTACHMENTS_WEBGL:return o(a(t.prototype),"getParameter",this).call(this,e)}}return this.setError(f.INVALID_ENUM),null}}},{key:"getShaderPrecisionFormat",value:function(e,r){if(r|=0,!((e|=0)!==f.FRAGMENT_SHADER&&e!==f.VERTEX_SHADER||r!==f.LOW_FLOAT&&r!==f.MEDIUM_FLOAT&&r!==f.HIGH_FLOAT&&r!==f.LOW_INT&&r!==f.MEDIUM_INT&&r!==f.HIGH_INT)){var n=o(a(t.prototype),"getShaderPrecisionFormat",this).call(this,e,r);return n?new W(n):null}this.setError(f.INVALID_ENUM)}},{key:"getBufferParameter",value:function(e,r){if(r|=0,(e|=0)!==f.ARRAY_BUFFER&&e!==f.ELEMENT_ARRAY_BUFFER)return this.setError(f.INVALID_ENUM),null;switch(r){case f.BUFFER_SIZE:case f.BUFFER_USAGE:return o(a(t.prototype),"getBufferParameter",this).call(this,0|e,0|r);default:return this.setError(f.INVALID_ENUM),null}}},{key:"getError",value:function(){return o(a(t.prototype),"getError",this).call(this)}},{key:"getFramebufferAttachmentParameter",value:function(e,t,r){if(t|=0,r|=0,(e|=0)!==f.FRAMEBUFFER||!this._validFramebufferAttachment(t))return this.setError(f.INVALID_ENUM),null;var n=this._activeFramebuffer;if(!n)return this.setError(f.INVALID_OPERATION),null;var i=n._attachments[t];if(null===i){if(r===f.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE)return f.NONE}else if(i instanceof X)switch(r){case f.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:return i;case f.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:return f.TEXTURE;case f.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:return n._attachmentLevel[t];case f.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:var s=n._attachmentFace[t];return s===f.TEXTURE_2D?0:s}else if(i instanceof z)switch(r){case f.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:return i;case f.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:return f.RENDERBUFFER}return this.setError(f.INVALID_ENUM),null}},{key:"getProgramParameter",value:function(e,r){if(r|=0,!b(e))throw new TypeError("getProgramParameter(WebGLProgram, GLenum)");if(this._checkWrapper(e,G)){switch(r){case f.DELETE_STATUS:return e._pendingDelete;case f.LINK_STATUS:return e._linkStatus;case f.VALIDATE_STATUS:return!!o(a(t.prototype),"getProgramParameter",this).call(this,e._,r);case f.ATTACHED_SHADERS:case f.ACTIVE_ATTRIBUTES:case f.ACTIVE_UNIFORMS:return o(a(t.prototype),"getProgramParameter",this).call(this,e._,r)}this.setError(f.INVALID_ENUM)}return null}},{key:"getProgramInfoLog",value:function(e){if(!b(e))throw new TypeError("getProgramInfoLog(WebGLProgram)");return this._checkWrapper(e,G)?e._linkInfoLog:null}},{key:"getRenderbufferParameter",value:function(e,r){if(r|=0,(e|=0)!==f.RENDERBUFFER)return this.setError(f.INVALID_ENUM),null;var n=this._activeRenderbuffer;if(!n)return this.setError(f.INVALID_OPERATION),null;switch(r){case f.RENDERBUFFER_INTERNAL_FORMAT:return n._format;case f.RENDERBUFFER_WIDTH:return n._width;case f.RENDERBUFFER_HEIGHT:return n._height;case f.RENDERBUFFER_SIZE:case f.RENDERBUFFER_RED_SIZE:case f.RENDERBUFFER_GREEN_SIZE:case f.RENDERBUFFER_BLUE_SIZE:case f.RENDERBUFFER_ALPHA_SIZE:case f.RENDERBUFFER_DEPTH_SIZE:case f.RENDERBUFFER_STENCIL_SIZE:return o(a(t.prototype),"getRenderbufferParameter",this).call(this,e,r)}return this.setError(f.INVALID_ENUM),null}},{key:"getShaderParameter",value:function(e,t){if(t|=0,!b(e))throw new TypeError("getShaderParameter(WebGLShader, GLenum)");if(this._checkWrapper(e,K)){switch(t){case f.DELETE_STATUS:return e._pendingDelete;case f.COMPILE_STATUS:return e._compileStatus;case f.SHADER_TYPE:return e._type}this.setError(f.INVALID_ENUM)}return null}},{key:"getShaderInfoLog",value:function(e){if(!b(e))throw new TypeError("getShaderInfoLog(WebGLShader)");return this._checkWrapper(e,K)?e._compileInfo:null}},{key:"getShaderSource",value:function(e){if(!b(e))throw new TypeError("Input to getShaderSource must be an object");return this._checkWrapper(e,K)?e._source:null}},{key:"getTexParameter",value:function(e,r){if(e|=0,r|=0,!this._checkTextureTarget(e))return null;var n=this._getActiveTextureUnit();if(e===f.TEXTURE_2D&&!n._bind2D||e===f.TEXTURE_CUBE_MAP&&!n._bindCube)return this.setError(f.INVALID_OPERATION),null;switch(r){case f.TEXTURE_MAG_FILTER:case f.TEXTURE_MIN_FILTER:case f.TEXTURE_WRAP_S:case f.TEXTURE_WRAP_T:return o(a(t.prototype),"getTexParameter",this).call(this,e,r)}return this.setError(f.INVALID_ENUM),null}},{key:"getUniform",value:function(e,r){if(!b(e)||!b(r))throw new TypeError("getUniform(WebGLProgram, WebGLUniformLocation)");if(!e)return this.setError(f.INVALID_VALUE),null;if(!r)return null;if(this._checkWrapper(e,G)){if(!S(e,r))return this.setError(f.INVALID_OPERATION),null;var n=o(a(t.prototype),"getUniform",this).call(this,0|e._,0|r._);if(!n)return null;switch(r._activeInfo.type){case f.FLOAT:return n[0];case f.FLOAT_VEC2:return new Float32Array(n.slice(0,2));case f.FLOAT_VEC3:return new Float32Array(n.slice(0,3));case f.FLOAT_VEC4:return new Float32Array(n.slice(0,4));case f.INT:return 0|n[0];case f.INT_VEC2:return new Int32Array(n.slice(0,2));case f.INT_VEC3:return new Int32Array(n.slice(0,3));case f.INT_VEC4:return new Int32Array(n.slice(0,4));case f.BOOL:return!!n[0];case f.BOOL_VEC2:return[!!n[0],!!n[1]];case f.BOOL_VEC3:return[!!n[0],!!n[1],!!n[2]];case f.BOOL_VEC4:return[!!n[0],!!n[1],!!n[2],!!n[3]];case f.FLOAT_MAT2:return new Float32Array(n.slice(0,4));case f.FLOAT_MAT3:return new Float32Array(n.slice(0,9));case f.FLOAT_MAT4:return new Float32Array(n.slice(0,16));case f.SAMPLER_2D:case f.SAMPLER_CUBE:return 0|n[0];default:return null}}return null}},{key:"getUniformLocation",value:function(e,r){if(!b(e))throw new TypeError("getUniformLocation(WebGLProgram, String)");if(k(r+="")){if(this._checkWrapper(e,G)){var n=o(a(t.prototype),"getUniformLocation",this).call(this,0|e._,r);if(n>=0){var i=r;/\[\d+\]$/.test(r)&&(i=r.replace(/\[\d+\]$/,"[0]"));for(var s=null,u=0;u<e._uniforms.length;++u){var c=e._uniforms[u];c.name===i&&(s={size:c.size,type:c.type,name:c.name})}if(!s)return null;var l=new H(n,e,s);if(/\[0\]$/.test(r)){var h=r.replace(/\[0\]$/,""),p=[];this._saveError();for(var d=0;this.getError()===f.NO_ERROR;++d){var m=o(a(t.prototype),"getUniformLocation",this).call(this,0|e._,h+"["+d+"]");if(this.getError()!==f.NO_ERROR||m<0)break;p.push(m)}this._restoreError(f.NO_ERROR),l._array=p}else if(/\[(\d+)\]$/.test(r)){var g=+/\[(\d+)\]$/.exec(r)[1];if(g<0||g>=s.size)return null}return l}}return null}this.setError(f.INVALID_VALUE)}},{key:"getVertexAttrib",value:function(e,t){if(t|=0,(e|=0)<0||e>=this._vertexAttribs.length)return this.setError(f.INVALID_VALUE),null;var r=this._vertexAttribs[e],n=this._extensions.angle_instanced_arrays;if(n&&t===n.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)return r._divisor;switch(t){case f.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return r._pointerBuffer;case f.VERTEX_ATTRIB_ARRAY_ENABLED:return r._isPointer;case f.VERTEX_ATTRIB_ARRAY_SIZE:return r._inputSize;case f.VERTEX_ATTRIB_ARRAY_STRIDE:return r._inputStride;case f.VERTEX_ATTRIB_ARRAY_TYPE:return r._pointerType;case f.VERTEX_ATTRIB_ARRAY_NORMALIZED:return r._pointerNormal;case f.CURRENT_VERTEX_ATTRIB:return new Float32Array(r._data);default:return this.setError(f.INVALID_ENUM),null}}},{key:"getVertexAttribOffset",value:function(e,t){return t|=0,(e|=0)<0||e>=this._vertexAttribs.length?(this.setError(f.INVALID_VALUE),null):t===f.VERTEX_ATTRIB_ARRAY_POINTER?this._vertexAttribs[e]._pointerOffset:(this.setError(f.INVALID_ENUM),null)}},{key:"hint",value:function(e,r){if(r|=0,(e|=0)===f.GENERATE_MIPMAP_HINT){if(r===f.FASTEST||r===f.NICEST||r===f.DONT_CARE)return o(a(t.prototype),"hint",this).call(this,e,r);this.setError(f.INVALID_ENUM)}else this.setError(f.INVALID_ENUM)}},{key:"isBuffer",value:function(e){return!!this._isObject(e,"isBuffer",V)&&o(a(t.prototype),"isBuffer",this).call(this,0|e._)}},{key:"isFramebuffer",value:function(e){return!!this._isObject(e,"isFramebuffer",U)&&o(a(t.prototype),"isFramebuffer",this).call(this,0|e._)}},{key:"isProgram",value:function(e){return!!this._isObject(e,"isProgram",G)&&o(a(t.prototype),"isProgram",this).call(this,0|e._)}},{key:"isRenderbuffer",value:function(e){return!!this._isObject(e,"isRenderbuffer",z)&&o(a(t.prototype),"isRenderbuffer",this).call(this,0|e._)}},{key:"isShader",value:function(e){return!!this._isObject(e,"isShader",K)&&o(a(t.prototype),"isShader",this).call(this,0|e._)}},{key:"isTexture",value:function(e){return!!this._isObject(e,"isTexture",X)&&o(a(t.prototype),"isTexture",this).call(this,0|e._)}},{key:"isEnabled",value:function(e){return o(a(t.prototype),"isEnabled",this).call(this,0|e)}},{key:"lineWidth",value:function(e){if(!isNaN(e))return o(a(t.prototype),"lineWidth",this).call(this,+e);this.setError(f.INVALID_VALUE)}},{key:"linkProgram",value:function(e){if(!b(e))throw new TypeError("linkProgram(WebGLProgram)");if(this._checkWrapper(e,G)){e._linkCount+=1,e._attributes=[];var r=this.getError();o(a(t.prototype),"linkProgram",this).call(this,0|e._);var n=this.getError();n===f.NO_ERROR&&(e._linkStatus=this._fixupLink(e)),this.getError(),this.setError(r||n)}}},{key:"pixelStorei",value:function(e,r){if(r|=0,(e|=0)===f.UNPACK_ALIGNMENT){if(1!==r&&2!==r&&4!==r&&8!==r)return void this.setError(f.INVALID_VALUE);this._unpackAlignment=r}else if(e===f.PACK_ALIGNMENT){if(1!==r&&2!==r&&4!==r&&8!==r)return void this.setError(f.INVALID_VALUE);this._packAlignment=r}else if(e===f.UNPACK_COLORSPACE_CONVERSION_WEBGL&&r!==f.NONE&&r!==f.BROWSER_DEFAULT_WEBGL)return void this.setError(f.INVALID_VALUE);return o(a(t.prototype),"pixelStorei",this).call(this,e,r)}},{key:"polygonOffset",value:function(e,r){return o(a(t.prototype),"polygonOffset",this).call(this,+e,+r)}},{key:"readPixels",value:function(e,r,n,i,s,u,c){if(e|=0,r|=0,n|=0,i|=0,this._extensions.oes_texture_float&&u===f.FLOAT&&s===f.RGBA);else{if(s===f.RGB||s===f.ALPHA||u!==f.UNSIGNED_BYTE)return void this.setError(f.INVALID_OPERATION);if(s!==f.RGBA)return void this.setError(f.INVALID_ENUM);if(n<0||i<0||!(c instanceof Uint8Array))return void this.setError(f.INVALID_VALUE)}if(this._framebufferOk()){var l=4*n;l%this._packAlignment!==0&&(l+=this._packAlignment-l%this._packAlignment);var h=l*(i-1)+4*n;if(!(h<=0))if(c.length<h)this.setError(f.INVALID_VALUE);else{var p=this.drawingBufferWidth,d=this.drawingBufferHeight;this._activeFramebuffer&&(p=this._activeFramebuffer._width,d=this._activeFramebuffer._height);var m=C(c);if(e>=p||e+n<=0||r>=d||r+i<=0)for(var g=0;g<m.length;++g)m[g]=0;else if(e<0||e+n>p||r<0||r+i>d){for(var y=0;y<m.length;++y)m[y]=0;var _=e,x=n;e<0&&(x+=e,_=0),_+n>p&&(x=p-_);var v=r,T=i;r<0&&(T+=r,v=0),v+i>d&&(T=d-v);var E=4*x;if(E%this._packAlignment!==0&&(E+=this._packAlignment-E%this._packAlignment),x>0&&T>0){var A=new Uint8Array(E*T);o(a(t.prototype),"readPixels",this).call(this,_,v,x,T,s,u,A);for(var b=4*(_-e)+(v-r)*l,S=0;S<T;++S)for(var I=0;I<x;++I)for(var k=0;k<4;++k)m[b+S*l+4*I+k]=A[S*E+4*I+k]}}else o(a(t.prototype),"readPixels",this).call(this,e,r,n,i,s,u,m)}}}},{key:"renderbufferStorage",value:function(e,r,n,i){if(r|=0,n|=0,i|=0,(e|=0)===f.RENDERBUFFER){var s=this._activeRenderbuffer;if(s)if(r===f.RGBA4||r===f.RGB565||r===f.RGB5_A1||r===f.DEPTH_COMPONENT16||r===f.STENCIL_INDEX||r===f.STENCIL_INDEX8||r===f.DEPTH_STENCIL){this._saveError(),o(a(t.prototype),"renderbufferStorage",this).call(this,e,r,n,i);var u=this.getError();if(this._restoreError(u),u===f.NO_ERROR){s._width=n,s._height=i,s._format=r;var c=this._activeFramebuffer;if(c){for(var l=!1,h=this._getAttachments(),p=0;p<h.length;++p)if(c._attachments[h[p]]===s){l=!0;break}l&&this._updateFramebufferAttachments(this._activeFramebuffer)}}}else this.setError(f.INVALID_ENUM);else this.setError(f.INVALID_OPERATION)}else this.setError(f.INVALID_ENUM)}},{key:"resize",value:function(e,t){if(t|=0,!((e|=0)>0&&t>0))throw new Error("Invalid surface dimensions");e===this.drawingBufferWidth&&t===this.drawingBufferHeight||(this._resizeDrawingBuffer(e,t),this.drawingBufferWidth=e,this.drawingBufferHeight=t)}},{key:"sampleCoverage",value:function(e,r){return o(a(t.prototype),"sampleCoverage",this).call(this,+e,!!r)}},{key:"scissor",value:function(e,r,n,i){return o(a(t.prototype),"scissor",this).call(this,0|e,0|r,0|n,0|i)}},{key:"shaderSource",value:function(e,r){if(!b(e))throw new TypeError("shaderSource(WebGLShader, String)");e&&(r||"string"===typeof r)&&k(r+="")?this._checkWrapper(e,K)&&(o(a(t.prototype),"shaderSource",this).call(this,0|e._,this._wrapShader(e._type,r)),e._source=r):this.setError(f.INVALID_VALUE)}},{key:"stencilFunc",value:function(e,r,n){return o(a(t.prototype),"stencilFunc",this).call(this,0|e,0|r,0|n)}},{key:"stencilFuncSeparate",value:function(e,r,n,i){return o(a(t.prototype),"stencilFuncSeparate",this).call(this,0|e,0|r,0|n,0|i)}},{key:"stencilMask",value:function(e){return o(a(t.prototype),"stencilMask",this).call(this,0|e)}},{key:"stencilMaskSeparate",value:function(e,r){return o(a(t.prototype),"stencilMaskSeparate",this).call(this,0|e,0|r)}},{key:"stencilOp",value:function(e,r,n){return o(a(t.prototype),"stencilOp",this).call(this,0|e,0|r,0|n)}},{key:"stencilOpSeparate",value:function(e,r,n,i){return o(a(t.prototype),"stencilOpSeparate",this).call(this,0|e,0|r,0|n,0|i)}},{key:"texImage2D",value:function(e,r,n,i,s,u,c,l,h){if(6===arguments.length){if(l=s,c=i,null==(h=w(h=u)))throw new TypeError("texImage2D(GLenum, GLint, GLenum, GLint, GLenum, GLenum, ImageData | HTMLImageElement | HTMLCanvasElement | HTMLVideoElement)");i=h.width,s=h.height,h=h.data}if(e|=0,r|=0,n|=0,i|=0,s|=0,u|=0,c|=0,l|=0,"object"!==typeof h&&void 0!==h)throw new TypeError("texImage2D(GLenum, GLint, GLenum, GLint, GLint, GLint, GLenum, GLenum, Uint8Array)");if(O(c)&&O(n))if(l!==f.FLOAT||this._extensions.oes_texture_float){var p=this._getTexImage(e);if(p&&c===n){var d=this._computePixelSize(l,c);if(0!==d&&this._checkDimensions(e,i,s,r)){var m=F(h),g=this._computeRowStride(i,d),y=g*s;if(m&&m.length<y)this.setError(f.INVALID_OPERATION);else if(0!==u||P(e)&&i!==s)this.setError(f.INVALID_VALUE);else{this._saveError(),o(a(t.prototype),"texImage2D",this).call(this,e,r,n,i,s,u,c,l,m);var _=this.getError();if(this._restoreError(_),_===f.NO_ERROR){p._levelWidth[r]=i,p._levelHeight[r]=s,p._format=c,p._type=l;var x=this._activeFramebuffer;if(x){for(var v=!1,T=this._getAttachments(),E=0;E<T.length;++E)if(x._attachments[T[E]]===p){v=!0;break}v&&this._updateFramebufferAttachments(this._activeFramebuffer)}}}}}else this.setError(f.INVALID_OPERATION)}else this.setError(f.INVALID_ENUM);else this.setError(f.INVALID_ENUM)}},{key:"texSubImage2D",value:function(e,r,n,i,s,u,c,l,h){if(7===arguments.length){if(h=c,l=u,c=s,null==(h=w(h)))throw new TypeError("texSubImage2D(GLenum, GLint, GLint, GLint, GLenum, GLenum, ImageData | HTMLImageElement | HTMLCanvasElement | HTMLVideoElement)");s=h.width,u=h.height,h=h.data}if("object"!==typeof h)throw new TypeError("texSubImage2D(GLenum, GLint, GLint, GLint, GLint, GLint, GLenum, GLenum, Uint8Array)");e|=0,r|=0,n|=0,i|=0,s|=0,u|=0,c|=0,l|=0;var p=this._getTexImage(e);if(p)if(l!==f.FLOAT||this._extensions.oes_texture_float){var d=this._computePixelSize(l,c);if(0!==d&&this._checkDimensions(e,s,u,r))if(n<0||i<0)this.setError(f.INVALID_VALUE);else{var m=F(h),g=this._computeRowStride(s,d),y=g*u;!m||m.length<y?this.setError(f.INVALID_OPERATION):o(a(t.prototype),"texSubImage2D",this).call(this,e,r,n,i,s,u,c,l,m)}}else this.setError(f.INVALID_ENUM);else this.setError(f.INVALID_OPERATION)}},{key:"texParameterf",value:function(e,r,n){if(e|=0,r|=0,n=+n,this._checkTextureTarget(e)){switch(this._verifyTextureCompleteness(e,r,n),r){case f.TEXTURE_MIN_FILTER:case f.TEXTURE_MAG_FILTER:case f.TEXTURE_WRAP_S:case f.TEXTURE_WRAP_T:return o(a(t.prototype),"texParameterf",this).call(this,e,r,n)}this.setError(f.INVALID_ENUM)}}},{key:"texParameteri",value:function(e,r,n){if(e|=0,r|=0,n|=0,this._checkTextureTarget(e)){switch(this._verifyTextureCompleteness(e,r,n),r){case f.TEXTURE_MIN_FILTER:case f.TEXTURE_MAG_FILTER:case f.TEXTURE_WRAP_S:case f.TEXTURE_WRAP_T:return o(a(t.prototype),"texParameteri",this).call(this,e,r,n)}this.setError(f.INVALID_ENUM)}}},{key:"useProgram",value:function(e){if(!b(e))throw new TypeError("useProgram(WebGLProgram)");return e?this._checkWrapper(e,G)?(this._activeProgram!==e&&(this._switchActiveProgram(this._activeProgram),this._activeProgram=e,e._refCount+=1),o(a(t.prototype),"useProgram",this).call(this,0|e._)):void 0:(this._switchActiveProgram(this._activeProgram),this._activeProgram=null,o(a(t.prototype),"useProgram",this).call(this,0))}},{key:"validateProgram",value:function(e){if(this._checkWrapper(e,G)){o(a(t.prototype),"validateProgram",this).call(this,0|e._);var r=this.getError();r===f.NO_ERROR&&(e._linkInfoLog=o(a(t.prototype),"getProgramInfoLog",this).call(this,0|e._)),this.getError(),this.setError(r)}}},{key:"vertexAttribPointer",value:function(e,r,n,i,s,u){if(s<0||u<0)this.setError(f.INVALID_VALUE);else if(e|=0,r|=0,n|=0,i=!!i,u|=0,(s|=0)<0||u<0||e<0||e>=this._vertexAttribs.length||1!==r&&2!==r&&3!==r&&4!==r)this.setError(f.INVALID_VALUE);else if(null!==this._activeArrayBuffer){var c=R(n);if(0!==c&&n!==f.INT&&n!==f.UNSIGNED_INT)if(s>255||s<0)this.setError(f.INVALID_VALUE);else if(s%c===0&&u%c===0){o(a(t.prototype),"vertexAttribPointer",this).call(this,e,r,n,i,s,u);var l=this._vertexAttribs[e];l._pointerBuffer&&l._pointerBuffer!==this._activeArrayBuffer&&(l._pointerBuffer._refCount-=1,l._pointerBuffer._checkDelete()),this._activeArrayBuffer._refCount+=1,l._pointerBuffer=this._activeArrayBuffer,l._pointerSize=r*c,l._pointerOffset=u,l._pointerStride=s||r*c,l._pointerType=n,l._pointerNormal=i,l._inputStride=s,l._inputSize=r}else this.setError(f.INVALID_OPERATION);else this.setError(f.INVALID_ENUM)}else this.setError(f.INVALID_OPERATION)}},{key:"viewport",value:function(e,r,n,i){return o(a(t.prototype),"viewport",this).call(this,0|e,0|r,0|n,0|i)}},{key:"_allocateDrawingBuffer",value:function(e,r){this._drawingBuffer=new B(o(a(t.prototype),"createFramebuffer",this).call(this),o(a(t.prototype),"createTexture",this).call(this),o(a(t.prototype),"createRenderbuffer",this).call(this)),this._resizeDrawingBuffer(e,r)}},{key:"isContextLost",value:function(){return!1}},{key:"compressedTexImage2D",value:function(){}},{key:"compressedTexSubImage2D",value:function(){}},{key:"_checkUniformValid",value:function(e,t,r,n,i){if(!b(e))throw new TypeError("".concat(r,"(WebGLUniformLocation, ...)"));if(!e)return!1;if(this._checkLocationActive(e)){var s=e._activeInfo.type;if(s===f.SAMPLER_2D||s===f.SAMPLER_CUBE){if(1!==n)return void this.setError(f.INVALID_VALUE);if("i"!==i)return void this.setError(f.INVALID_OPERATION);if(t<0||t>=this._textureUnits.length)return this.setError(f.INVALID_VALUE),!1}return!(L(s)>n)||(this.setError(f.INVALID_OPERATION),!1)}return!1}},{key:"_checkUniformValueValid",value:function(e,t,r,n,i){if(!b(e)||!b(t))throw new TypeError("".concat(r,"v(WebGLUniformLocation, Array)"));if(!e)return!1;if(!this._checkLocationActive(e))return!1;if("object"!==typeof t||!t||"number"!==typeof t.length)throw new TypeError("Second argument to ".concat(r," must be array"));return L(e._activeInfo.type)>n?(this.setError(f.INVALID_OPERATION),!1):t.length>=n&&t.length%n===0?!!e._array||(t.length===n||(this.setError(f.INVALID_OPERATION),!1)):(this.setError(f.INVALID_VALUE),!1)}},{key:"uniform1f",value:function(e,r){this._checkUniformValid(e,r,"uniform1f",1,"f")&&o(a(t.prototype),"uniform1f",this).call(this,0|e._,r)}},{key:"uniform1fv",value:function(e,r){if(this._checkUniformValueValid(e,r,"uniform1fv",1,"f"))if(e._array)for(var n=e._array,i=0;i<n.length&&i<r.length;++i){var s=n[i];o(a(t.prototype),"uniform1f",this).call(this,s,r[i])}else o(a(t.prototype),"uniform1f",this).call(this,0|e._,r[0])}},{key:"uniform1i",value:function(e,r){this._checkUniformValid(e,r,"uniform1i",1,"i")&&o(a(t.prototype),"uniform1i",this).call(this,0|e._,r)}},{key:"uniform1iv",value:function(e,r){if(this._checkUniformValueValid(e,r,"uniform1iv",1,"i"))if(e._array)for(var n=e._array,i=0;i<n.length&&i<r.length;++i){var s=n[i];o(a(t.prototype),"uniform1i",this).call(this,s,r[i])}else this.uniform1i(e,r[0])}},{key:"uniform2f",value:function(e,r,n){this._checkUniformValid(e,r,"uniform2f",2,"f")&&o(a(t.prototype),"uniform2f",this).call(this,0|e._,r,n)}},{key:"uniform2fv",value:function(e,r){if(this._checkUniformValueValid(e,r,"uniform2fv",2,"f"))if(e._array)for(var n=e._array,i=0;i<n.length&&2*i<r.length;++i){var s=n[i];o(a(t.prototype),"uniform2f",this).call(this,s,r[2*i],r[2*i+1])}else o(a(t.prototype),"uniform2f",this).call(this,0|e._,r[0],r[1])}},{key:"uniform2i",value:function(e,r,n){this._checkUniformValid(e,r,"uniform2i",2,"i")&&o(a(t.prototype),"uniform2i",this).call(this,0|e._,r,n)}},{key:"uniform2iv",value:function(e,r){if(this._checkUniformValueValid(e,r,"uniform2iv",2,"i"))if(e._array)for(var n=e._array,i=0;i<n.length&&2*i<r.length;++i){var s=n[i];o(a(t.prototype),"uniform2i",this).call(this,s,r[2*i],r[2*i+1])}else this.uniform2i(e,r[0],r[1])}},{key:"uniform3f",value:function(e,r,n,i){this._checkUniformValid(e,r,"uniform3f",3,"f")&&o(a(t.prototype),"uniform3f",this).call(this,0|e._,r,n,i)}},{key:"uniform3fv",value:function(e,r){if(this._checkUniformValueValid(e,r,"uniform3fv",3,"f"))if(e._array)for(var n=e._array,i=0;i<n.length&&3*i<r.length;++i){var s=n[i];o(a(t.prototype),"uniform3f",this).call(this,s,r[3*i],r[3*i+1],r[3*i+2])}else o(a(t.prototype),"uniform3f",this).call(this,0|e._,r[0],r[1],r[2])}},{key:"uniform3i",value:function(e,r,n,i){this._checkUniformValid(e,r,"uniform3i",3,"i")&&o(a(t.prototype),"uniform3i",this).call(this,0|e._,r,n,i)}},{key:"uniform3iv",value:function(e,r){if(this._checkUniformValueValid(e,r,"uniform3iv",3,"i"))if(e._array)for(var n=e._array,i=0;i<n.length&&3*i<r.length;++i){var s=n[i];o(a(t.prototype),"uniform3i",this).call(this,s,r[3*i],r[3*i+1],r[3*i+2])}else this.uniform3i(e,r[0],r[1],r[2])}},{key:"uniform4f",value:function(e,r,n,i,s){this._checkUniformValid(e,r,"uniform4f",4,"f")&&o(a(t.prototype),"uniform4f",this).call(this,0|e._,r,n,i,s)}},{key:"uniform4fv",value:function(e,r){if(this._checkUniformValueValid(e,r,"uniform4fv",4,"f"))if(e._array)for(var n=e._array,i=0;i<n.length&&4*i<r.length;++i){var s=n[i];o(a(t.prototype),"uniform4f",this).call(this,s,r[4*i],r[4*i+1],r[4*i+2],r[4*i+3])}else o(a(t.prototype),"uniform4f",this).call(this,0|e._,r[0],r[1],r[2],r[3])}},{key:"uniform4i",value:function(e,r,n,i,s){this._checkUniformValid(e,r,"uniform4i",4,"i")&&o(a(t.prototype),"uniform4i",this).call(this,0|e._,r,n,i,s)}},{key:"uniform4iv",value:function(e,r){if(this._checkUniformValueValid(e,r,"uniform4iv",4,"i"))if(e._array)for(var n=e._array,i=0;i<n.length&&4*i<r.length;++i){var s=n[i];o(a(t.prototype),"uniform4i",this).call(this,s,r[4*i],r[4*i+1],r[4*i+2],r[4*i+3])}else this.uniform4i(e,r[0],r[1],r[2],r[3])}},{key:"_checkUniformMatrix",value:function(e,t,r,n,i){if(!b(e)||"object"!==typeof r)throw new TypeError(n+"(WebGLUniformLocation, Boolean, Array)");return t||"object"!==typeof r||null===r||!r.length||r.length%i*i!==0?(this.setError(f.INVALID_VALUE),!1):!!e&&(!!this._checkLocationActive(e)&&(r.length===i*i||(!!e._array||(this.setError(f.INVALID_VALUE),!1))))}},{key:"uniformMatrix2fv",value:function(e,r,n){if(this._checkUniformMatrix(e,r,n,"uniformMatrix2fv",2)){var i=new Float32Array(n);o(a(t.prototype),"uniformMatrix2fv",this).call(this,0|e._,!!r,i)}}},{key:"uniformMatrix3fv",value:function(e,r,n){if(this._checkUniformMatrix(e,r,n,"uniformMatrix3fv",3)){var i=new Float32Array(n);o(a(t.prototype),"uniformMatrix3fv",this).call(this,0|e._,!!r,i)}}},{key:"uniformMatrix4fv",value:function(e,r,n){if(this._checkUniformMatrix(e,r,n,"uniformMatrix4fv",4)){var i=new Float32Array(n);o(a(t.prototype),"uniformMatrix4fv",this).call(this,0|e._,!!r,i)}}},{key:"vertexAttrib1f",value:function(e,r){if(e|=0,this._checkVertexIndex(e)){var n=this._vertexAttribs[e]._data;return n[3]=1,n[1]=n[2]=0,n[0]=r,o(a(t.prototype),"vertexAttrib1f",this).call(this,0|e,+r)}}},{key:"vertexAttrib2f",value:function(e,r,n){if(e|=0,this._checkVertexIndex(e)){var i=this._vertexAttribs[e]._data;return i[3]=1,i[2]=0,i[1]=n,i[0]=r,o(a(t.prototype),"vertexAttrib2f",this).call(this,0|e,+r,+n)}}},{key:"vertexAttrib3f",value:function(e,r,n,i){if(e|=0,this._checkVertexIndex(e)){var s=this._vertexAttribs[e]._data;return s[3]=1,s[2]=i,s[1]=n,s[0]=r,o(a(t.prototype),"vertexAttrib3f",this).call(this,0|e,+r,+n,+i)}}},{key:"vertexAttrib4f",value:function(e,r,n,i,s){if(e|=0,this._checkVertexIndex(e)){var u=this._vertexAttribs[e]._data;return u[3]=s,u[2]=i,u[1]=n,u[0]=r,o(a(t.prototype),"vertexAttrib4f",this).call(this,0|e,+r,+n,+i,+s)}}},{key:"vertexAttrib1fv",value:function(e,r){if(!("object"!==typeof r||null===r||r.length<1)){var n=this._vertexAttribs[e]._data;return n[3]=1,n[2]=0,n[1]=0,n[0]=r[0],o(a(t.prototype),"vertexAttrib1f",this).call(this,0|e,+r[0])}this.setError(f.INVALID_OPERATION)}},{key:"vertexAttrib2fv",value:function(e,r){if(!("object"!==typeof r||null===r||r.length<2)){var n=this._vertexAttribs[e]._data;return n[3]=1,n[2]=0,n[1]=r[1],n[0]=r[0],o(a(t.prototype),"vertexAttrib2f",this).call(this,0|e,+r[0],+r[1])}this.setError(f.INVALID_OPERATION)}},{key:"vertexAttrib3fv",value:function(e,r){if(!("object"!==typeof r||null===r||r.length<3)){var n=this._vertexAttribs[e]._data;return n[3]=1,n[2]=r[2],n[1]=r[1],n[0]=r[0],o(a(t.prototype),"vertexAttrib3f",this).call(this,0|e,+r[0],+r[1],+r[2])}this.setError(f.INVALID_OPERATION)}},{key:"vertexAttrib4fv",value:function(e,r){if(!("object"!==typeof r||null===r||r.length<4)){var n=this._vertexAttribs[e]._data;return n[3]=r[3],n[2]=r[2],n[1]=r[1],n[0]=r[0],o(a(t.prototype),"vertexAttrib4f",this).call(this,0|e,+r[0],+r[1],+r[2],+r[3])}this.setError(f.INVALID_OPERATION)}}]),t}(d);e.exports={WebGLRenderingContext:J,wrapContext:function(e){var t=new J;return A(Object.keys(e),t,e,Z),A(Object.keys(e.constructor.prototype),t,e,Z),A(Object.getOwnPropertyNames(e),t,e,Z),A(Object.getOwnPropertyNames(e.constructor.prototype),t,e,Z),Object.defineProperties(t,{drawingBufferWidth:{get:function(){return e.drawingBufferWidth},set:function(t){e.drawingBufferWidth=t}},drawingBufferHeight:{get:function(){return e.drawingBufferHeight},set:function(t){e.drawingBufferHeight=t}}}),t}}},function(e,t,r){var n=r(81);e.exports=function(e,t){var r=n(t),i=[];return i=(i=i.concat(r(e))).concat(r(null))}},function(e,t,r){e.exports=function(e){var t,r,A,b=0,S=0,I=u,k=[],R=[],L=1,w=0,D=0,N=!1,C=!1,F="",O=s,P=n;"300 es"===(e=e||{}).version&&(O=o,P=a);var M={},U={};for(b=0;b<O.length;b++)M[O[b]]=!0;for(b=0;b<P.length;b++)U[P[b]]=!0;return function(e){return R=[],null!==e?function(e){b=0,e.toString&&(e=e.toString());var r;F+=e.replace(/\r\n/g,"\n"),A=F.length;for(;t=F[b],b<A;){switch(r=b,I){case l:b=K();break;case h:case p:b=z();break;case f:b=W();break;case d:b=j();break;case T:b=H();break;case m:b=Y();break;case c:b=q();break;case x:b=G();break;case u:b=B()}if(r!==b)switch(F[r]){case"\n":w=0,++L;break;default:++w}}return S+=b,F=F.slice(b),R}(e):function(e){k.length&&V(k.join(""));return I=v,V("(eof)"),R}()};function V(e){e.length&&R.push({type:E[I],data:e,position:D,line:L,column:w})}function B(){return k=k.length?[]:k,"/"===r&&"*"===t?(D=S+b-1,I=l,r=t,b+1):"/"===r&&"/"===t?(D=S+b-1,I=h,r=t,b+1):"#"===t?(I=p,D=S+b,b):/\s/.test(t)?(I=x,D=S+b,b):(N=/\d/.test(t),C=/[^\w_]/.test(t),D=S+b,I=N?d:C?f:c,b)}function G(){return/[^\s]/g.test(t)?(V(k.join("")),I=u,b):(k.push(t),r=t,b+1)}function z(){return"\r"!==t&&"\n"!==t||"\\"===r?(k.push(t),r=t,b+1):(V(k.join("")),I=u,b)}function K(){return"/"===t&&"*"===r?(k.push(t),V(k.join("")),I=u,b+1):(k.push(t),r=t,b+1)}function W(){if("."===r&&/\d/.test(t))return I=m,b;if("/"===r&&"*"===t)return I=l,b;if("/"===r&&"/"===t)return I=h,b;if("."===t&&k.length){for(;X(k););return I=m,b}if(";"===t||")"===t||"("===t){if(k.length)for(;X(k););return V(t),I=u,b+1}var e=2===k.length&&"="!==t;if(/[\w_\d\s]/.test(t)||e){for(;X(k););return I=u,b}return k.push(t),r=t,b+1}function X(e){for(var t,r,n=0;;){if(t=i.indexOf(e.slice(0,e.length+n).join("")),r=i[t],-1===t){if(n--+e.length>0)continue;r=e.slice(0,1).join("")}return V(r),D+=r.length,(k=k.slice(r.length)).length}}function H(){return/[^a-fA-F0-9]/.test(t)?(V(k.join("")),I=u,b):(k.push(t),r=t,b+1)}function j(){return"."===t?(k.push(t),I=m,r=t,b+1):/[eE]/.test(t)?(k.push(t),I=m,r=t,b+1):"x"===t&&1===k.length&&"0"===k[0]?(I=T,k.push(t),r=t,b+1):/[^\d]/.test(t)?(V(k.join("")),I=u,b):(k.push(t),r=t,b+1)}function Y(){return"f"===t&&(k.push(t),r=t,b+=1),/[eE]/.test(t)?(k.push(t),r=t,b+1):("-"!==t&&"+"!==t||!/[eE]/.test(r))&&/[^\d]/.test(t)?(V(k.join("")),I=u,b):(k.push(t),r=t,b+1)}function q(){if(/[^\d\w_]/.test(t)){var e=k.join("");return I=U[e]?_:M[e]?y:g,V(k.join("")),I=u,b}return k.push(t),r=t,b+1}};var n=r(38),i=r(82),s=r(39),a=r(83),o=r(84),u=999,c=9999,l=0,h=1,p=2,f=3,d=4,m=5,g=6,y=7,_=8,x=9,v=10,T=11,E=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},function(e,t){e.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},function(e,t,r){var n=r(38);e.exports=n.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"])},function(e,t,r){var n=r(39);n=n.slice().filter((function(e){return!/^(gl\_|texture)/.test(e)})),e.exports=n.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"])},function(e){e.exports=JSON.parse('{"_args":[["gl@4.4.0","/home/luke/Projects/javscript-gpgpu/javascript-gpgpu"]],"_from":"gl@4.4.0","_id":"gl@4.4.0","_inBundle":false,"_integrity":"sha512-4FIq5tqiltTsadrLh6DGY4R9+aQwj25OM2WlXEv81N6YN1q1C0qR7ct0SKp1uUJdnBqbKhUJP3zQ1td40AVeJg==","_location":"/gl","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"gl@4.4.0","name":"gl","escapedName":"gl","rawSpec":"4.4.0","saveSpec":null,"fetchSpec":"4.4.0"},"_requiredBy":["/gpu.js"],"_resolved":"https://registry.npmjs.org/gl/-/gl-4.4.0.tgz","_spec":"4.4.0","_where":"/home/luke/Projects/javscript-gpgpu/javascript-gpgpu","author":{"name":"Mikola Lysenko"},"browser":"browser_index.js","bugs":{"url":"https://github.com/stackgl/headless-gl/issues"},"dependencies":{"bindings":"^1.5.0","bit-twiddle":"^1.0.2","glsl-tokenizer":"^2.0.2","nan":"^2.14.0","node-gyp":"^4.0.0","prebuild-install":"^5.1.0"},"description":"Creates a WebGL context without a window","devDependencies":{"angle-normals":"^1.0.0","bunny":"^1.0.1","faucet":"0.0.1","gl-conformance":"^2.0.9","prebuild":"^8.0.1","snazzy":"^8.0.0","standard":"^12.0.1","tape":"^4.7.0"},"directories":{"test":"test"},"engines":{"node":">=8.0.0"},"gypfile":true,"homepage":"https://github.com/stackgl/headless-gl#readme","keywords":["webgl","opengl","gl","headless","server","gpgpu"],"license":"BSD-2-Clause","main":"index.js","name":"gl","repository":{"type":"git","url":"git://github.com/stackgl/headless-gl.git"},"scripts":{"install":"prebuild-install || node-gyp rebuild","prebuild":"prebuild --all --strip","rebuild":"node-gyp rebuild --verbose","test":"standard | snazzy && tape test/*.js | faucet"},"version":"4.4.0"}')},function(e,t,r){(function(n,i){var s=r(87),a=r(40),o=r(88),u=a.join,c=a.dirname,l=s.accessSync&&function(e){try{s.accessSync(e)}catch(t){return!1}return!0}||s.existsSync||a.existsSync,h={arrow:Object({NODE_ENV:"production",PUBLIC_URL:"/javascript-gpgpu-demo"}).NODE_BINDINGS_ARROW||" \u2192 ",compiled:Object({NODE_ENV:"production",PUBLIC_URL:"/javascript-gpgpu-demo"}).NODE_BINDINGS_COMPILED_DIR||"compiled",platform:n.platform,arch:n.arch,nodePreGyp:"node-v"+n.versions.modules+"-"+n.platform+"-"+n.arch,version:n.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};e.exports=t=function(e){"string"==typeof e?e={bindings:e}:e||(e={}),Object.keys(h).map((function(t){t in e||(e[t]=h[t])})),e.module_root||(e.module_root=t.getRoot(t.getFileName())),".node"!=a.extname(e.bindings)&&(e.bindings+=".node");for(var r,n,i,s=require,o=[],c=0,l=e.try.length;c<l;c++){r=u.apply(null,e.try[c].map((function(t){return e[t]||t}))),o.push(r);try{return n=e.path?s.resolve(r):s(r),e.path||(n.path=r),n}catch(p){if("MODULE_NOT_FOUND"!==p.code&&"QUALIFIED_PATH_RESOLUTION_FAILED"!==p.code&&!/not find/i.test(p.message))throw p}}throw(i=new Error("Could not locate the bindings file. Tried:\n"+o.map((function(t){return e.arrow+t})).join("\n"))).tries=o,i},t.getFileName=function(e){var t,r=Error.prepareStackTrace,n=Error.stackTraceLimit,s={};Error.stackTraceLimit=10,Error.prepareStackTrace=function(r,n){for(var s=0,a=n.length;s<a;s++)if((t=n[s].getFileName())!==i){if(!e)return;if(t!==e)return}},Error.captureStackTrace(s),Error.prepareStackTrace=r,Error.stackTraceLimit=n;return 0===t.indexOf("file://")&&(t=o(t)),t},t.getRoot=function(e){for(var t,r=c(e);;){if("."===r&&(r=n.cwd()),l(u(r,"package.json"))||l(u(r,"node_modules")))return r;if(t===r)throw new Error('Could not find module root given file: "'+e+'". Do you have a `package.json` file? ');t=r,r=u(r,"..")}}}).call(this,r(19),"/index.js")},function(e,t){},function(e,t,r){var n=r(40).sep||"/";e.exports=function(e){if("string"!=typeof e||e.length<=7||"file://"!=e.substring(0,7))throw new TypeError("must pass in a file:// URI to convert to a file path");var t=decodeURI(e.substring(7)),r=t.indexOf("/"),i=t.substring(0,r),s=t.substring(r+1);"localhost"==i&&(i="");i&&(i=n+n+i);s=s.replace(/^(.+)\|/,"$1:"),"\\"==n&&(s=s.replace(/\//g,"\\"));/^.+\:/.test(s)||(s=n+s);return i+s}},function(e,t,r){var n=r(0),i=r(1),s=r(9).gl,a=r(41).vertexCount,o=function(){"use strict";function e(t){n(this,e),this.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070,this.ctx=t,this._drawArraysInstanced=s._drawArraysInstanced.bind(t),this._drawElementsInstanced=s._drawElementsInstanced.bind(t),this._vertexAttribDivisor=s._vertexAttribDivisor.bind(t)}return i(e,[{key:"drawArraysInstancedANGLE",value:function(e,t,r,n){var i=this.ctx;if(e|=0,r|=0,n|=0,(t|=0)<0||r<0||n<0)i.setError(s.INVALID_VALUE);else if(i._checkStencilState()){var o=a(e,r);if(o<0)i.setError(s.INVALID_ENUM);else if(i._framebufferOk()&&0!==r&&0!==n){var u=t;return r>0&&(u=r+t-1>>>0),this.checkInstancedVertexAttribState(u,n)?this._drawArraysInstanced(e,t,o,n):void 0}}}},{key:"drawElementsInstancedANGLE",value:function(e,t,r,n,i){var a=this.ctx;if(e|=0,r|=0,n|=0,i|=0,(t|=0)<0||n<0||i<0)a.setError(s.INVALID_VALUE);else if(a._checkStencilState()){var o=a._activeElementArrayBuffer;if(o){var u=null,c=n;if(r===s.UNSIGNED_SHORT){if(c%2)return void a.setError(s.INVALID_OPERATION);c>>=1,u=new Uint16Array(o._elements.buffer)}else if(a._extensions.oes_element_index_uint&&r===s.UNSIGNED_INT){if(c%4)return void a.setError(s.INVALID_OPERATION);c>>=2,u=new Uint32Array(o._elements.buffer)}else{if(r!==s.UNSIGNED_BYTE)return void a.setError(s.INVALID_ENUM);u=o._elements}var l=t;switch(e){case s.TRIANGLES:t%3&&(l-=t%3);break;case s.LINES:t%2&&(l-=t%2);break;case s.POINTS:break;case s.LINE_LOOP:case s.LINE_STRIP:if(t<2)return void a.setError(s.INVALID_OPERATION);break;case s.TRIANGLE_FAN:case s.TRIANGLE_STRIP:if(t<3)return void a.setError(s.INVALID_OPERATION);break;default:return void a.setError(s.INVALID_ENUM)}if(a._framebufferOk())if(0!==t&&0!==i)if(t+c>>>0>u.length)a.setError(s.INVALID_OPERATION);else{for(var h=-1,p=c;p<c+t;++p)h=Math.max(h,u[p]);h<0?this.checkInstancedVertexAttribState(0,0):this.checkInstancedVertexAttribState(h,i)&&l>0&&this._drawElementsInstanced(e,l,r,n,i)}else this.checkInstancedVertexAttribState(0,0)}else a.setError(s.INVALID_OPERATION)}}},{key:"vertexAttribDivisorANGLE",value:function(e,t){var r=this.ctx;(e|=0,(t|=0)<0||e<0||e>=r._vertexAttribs.length)?r.setError(s.INVALID_VALUE):(r._vertexAttribs[e]._divisor=t,this._vertexAttribDivisor(e,t))}},{key:"checkInstancedVertexAttribState",value:function(e,t){var r=this.ctx,n=r._activeProgram;if(!n)return r.setError(s.INVALID_OPERATION),!1;for(var i=r._vertexAttribs,a=!1,o=0;o<i.length;++o){var u=i[o];if(u._isPointer){var c=u._pointerBuffer;if(n._attributes.indexOf(o)>=0){if(!c)return r.setError(s.INVALID_OPERATION),!1;var l=0;if(0===u._divisor?(a=!0,l=u._pointerStride*e+u._pointerSize+u._pointerOffset):l=u._pointerStride*(Math.ceil(t/u._divisor)-1)+u._pointerSize+u._pointerOffset,l>c._size)return r.setError(s.INVALID_OPERATION),!1}}}return!!a||(r.setError(s.INVALID_OPERATION),!1)}}]),e}();e.exports={ANGLEInstancedArrays:o,getANGLEInstancedArrays:function(e){return new o(e)}}},function(e,t,r){"use strict";(function(e){var n=r(92),i=r(93),s=r(94);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,r){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(e,t,r);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,r)}function c(e,t,r,n){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=p(e,t);return e}(e,t,r,n):"string"===typeof t?function(e,t,r){"string"===typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|d(t,r),i=(e=o(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(u.isBuffer(t)){var r=0|f(t.length);return 0===(e=o(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(n=t.length)!==n?o(e,0):p(e,t);if("Buffer"===t.type&&s(t.data))return p(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=o(e,t<0?0:0|f(t)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function p(e,t){var r=t.length<0?0:0|f(t.length);e=o(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function d(e,t){if(u.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(e).length;default:if(n)return G(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return w(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return R(this,t,r);case"latin1":case"binary":return L(this,t,r);case"base64":return S(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,i){if(0===e.length)return-1;if("string"===typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"===typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:_(e,t,r,n,i);if("number"===typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):_(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,r,n,i){var s,a=1,o=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,o/=2,u/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(s=r;s<o;s++)if(c(e,s)===c(t,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===u)return l*a}else-1!==l&&(s-=s-l),l=-1}else for(r+u>o&&(r=o-u),s=r;s>=0;s--){for(var h=!0,p=0;p<u;p++)if(c(e,s+p)!==c(t,p)){h=!1;break}if(h)return s}return-1}function x(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;if(s%2!==0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[r+a]=o}return a}function v(e,t,r,n){return K(G(t,e.length-r),e,r,n)}function T(e,t,r,n){return K(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function E(e,t,r,n){return T(e,t,r,n)}function A(e,t,r,n){return K(z(t),e,r,n)}function b(e,t,r,n){return K(function(e,t){for(var r,n,i,s=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function S(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:128===(192&(s=e[i+1]))&&(u=(31&c)<<6|63&s)>127&&(l=u);break;case 3:s=e[i+1],a=e[i+2],128===(192&s)&&128===(192&a)&&(u=(15&c)<<12|(63&s)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],128===(192&s)&&128===(192&a)&&128===(192&o)&&(u=(15&c)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=k));return r}(n)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=a(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,r){return c(null,e,t,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,r){return function(e,t,r,n){return l(t),t<=0?o(e,t):void 0!==r?"string"===typeof n?o(e,t).fill(r,n):o(e,t).fill(r):o(e,t)}(null,e,t,r)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,r,n,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),o=Math.min(s,a),c=this.slice(n,i),l=e.slice(t,r),h=0;h<o;++h)if(c[h]!==l[h]){s=c[h],a=l[h];break}return s<a?-1:a<s?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"===typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return x(this,e,t,r);case"utf8":case"utf-8":return v(this,e,t,r);case"ascii":return T(this,e,t,r);case"latin1":case"binary":return E(this,e,t,r);case"base64":return A(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function L(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function w(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=B(e[s]);return i}function D(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function N(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,r,n,i,s){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function F(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-r,2);i<s;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function O(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-r,4);i<s;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function P(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(e,t,r,n,s){return s||P(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function U(e,t,r,n,s){return s||P(e,0,r,8),i.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;r=new u(i,void 0);for(var s=0;s<i;++s)r[s]=this[s+e]}return r},u.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||N(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},u.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||N(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},u.prototype.readUInt8=function(e,t){return t||N(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||N(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||N(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||N(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||N(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},u.prototype.readInt8=function(e,t){return t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||N(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){t||N(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||N(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||N(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||N(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||N(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},u.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},u.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):O(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):O(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):O(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):O(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,r){return M(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return M(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return U(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return U(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,s=n-r;if(this===e&&r<t&&t<n)for(i=s-1;i>=0;--i)e[i+t]=this[i+r];else if(s<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+s),t);return s},u.prototype.fill=function(e,t,r,n){if("string"===typeof e){if("string"===typeof t?(n=t,t=0,r=this.length):"string"===typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!==typeof n)throw new TypeError("encoding must be a string");if("string"===typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"===typeof e)for(s=t;s<r;++s)this[s]=e;else{var a=u.isBuffer(e)?e:G(new u(e,n).toString()),o=a.length;for(s=0;s<r-t;++s)this[s+t]=a[s%o]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function G(e,t){var r;t=t||1/0;for(var n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function z(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(V,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function K(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(91))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(n){"object"===typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=c(e),a=n[0],o=n[1],u=new s(function(e,t,r){return 3*(t+r)/4-r}(0,a,o)),l=0,h=o>0?a-4:a;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===o&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,u[l++]=255&t);1===o&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],a=0,o=r-i;a<o;a+=16383)s.push(l(e,a,a+16383>o?o:a+16383));1===i?(t=e[r-1],s.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],s.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return s.join("")};for(var n=[],i=[],s="undefined"!==typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,u=a.length;o<u;++o)n[o]=a[o],i[a.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,r){for(var i,s,a=[],o=t;o<r;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(n[(s=i)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,u=(1<<o)-1,c=u>>1,l=-7,h=r?i-1:0,p=r?-1:1,f=e[t+h];for(h+=p,s=f&(1<<-l)-1,f>>=-l,l+=o;l>0;s=256*s+e[t+h],h+=p,l-=8);for(a=s&(1<<-l)-1,s>>=-l,l+=n;l>0;a=256*a+e[t+h],h+=p,l-=8);if(0===s)s=1-c;else{if(s===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=c}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,u,c=8*s-i-1,l=(1<<c)-1,h=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,d=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=l?(o=0,a=l):a+h>=1?(o=(t*u-1)*Math.pow(2,i),a+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=d,o/=256,i-=8);for(a=a<<i|o,c+=i;c>0;e[r+f]=255&a,f+=d,a/=256,c-=8);e[r+f-d]|=128*m}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){var n=r(0),i=function e(){"use strict";n(this,e)};e.exports={getOESElementIndexUint:function(e){var t=null,r=e.getSupportedExtensions();return r&&r.indexOf("OES_element_index_uint")>=0&&(t=new i),t},OESElementIndexUint:i}},function(e,t,r){var n=r(0),i=function e(){"use strict";n(this,e)};e.exports={getOESTextureFloat:function(e){var t=null,r=e.getSupportedExtensions();return r&&r.indexOf("OES_texture_float")>=0&&(t=new i),t},OESTextureFloat:i}},function(e,t,r){var n=r(0),i=function e(t){"use strict";n(this,e),this.destroy=t.destroy.bind(t)};e.exports={getSTACKGLDestroyContext:function(e){return new i(e)},STACKGLDestroyContext:i}},function(e,t,r){var n=r(0),i=function e(t){"use strict";n(this,e),this.resize=t.resize.bind(t)};e.exports={getSTACKGLResizeDrawingBuffer:function(e){return new i(e)},STACKGLResizeDrawingBuffer:i}},function(e,t,r){var n=r(0),i=r(1),s=r(9).gl,a=function(){"use strict";function e(t){n(this,e),this.ctx=t;var r=t.getSupportedExtensions();if(r&&r.indexOf("WEBGL_draw_buffers")>=0){Object.assign(this,t.extWEBGL_draw_buffers()),this._buffersState=[t.BACK],this._maxDrawBuffers=t._getParameterDirect(this.MAX_DRAW_BUFFERS_WEBGL),this._ALL_ATTACHMENTS=[],this._ALL_COLOR_ATTACHMENTS=[];for(var i=[this.COLOR_ATTACHMENT0_WEBGL,this.COLOR_ATTACHMENT1_WEBGL,this.COLOR_ATTACHMENT2_WEBGL,this.COLOR_ATTACHMENT3_WEBGL,this.COLOR_ATTACHMENT4_WEBGL,this.COLOR_ATTACHMENT5_WEBGL,this.COLOR_ATTACHMENT6_WEBGL,this.COLOR_ATTACHMENT7_WEBGL,this.COLOR_ATTACHMENT8_WEBGL,this.COLOR_ATTACHMENT9_WEBGL,this.COLOR_ATTACHMENT10_WEBGL,this.COLOR_ATTACHMENT11_WEBGL,this.COLOR_ATTACHMENT12_WEBGL,this.COLOR_ATTACHMENT13_WEBGL,this.COLOR_ATTACHMENT14_WEBGL,this.COLOR_ATTACHMENT15_WEBGL];this._ALL_ATTACHMENTS.length<this._maxDrawBuffers;){var a=i.shift();this._ALL_ATTACHMENTS.push(a),this._ALL_COLOR_ATTACHMENTS.push(a)}this._ALL_ATTACHMENTS.push(s.DEPTH_ATTACHMENT,s.STENCIL_ATTACHMENT,s.DEPTH_STENCIL_ATTACHMENT)}}return i(e,[{key:"drawBuffersWEBGL",value:function(e){var t=this.ctx;if(e.length<1)t.setError(s.INVALID_OPERATION);else{if(1===e.length&&e[0]===s.BACK)return this._buffersState=e,void t.drawBuffersWEBGL([this.COLOR_ATTACHMENT0_WEBGL]);if(!t._activeFramebuffer){if(e.length>1)return void t.setError(s.INVALID_OPERATION);for(var r=0;r<e.length;r++)if(e[r]>s.NONE)return void t.setError(s.INVALID_OPERATION)}this._buffersState=e,t.drawBuffersWEBGL(e)}}}]),e}();e.exports={getWebGLDrawBuffers:function(e){var t=e.getSupportedExtensions();return t&&t.indexOf("WEBGL_draw_buffers")>=0?new a(e):null},WebGLDrawBuffers:a}},function(e,t,r){var n=r(0);e.exports={WebGLActiveInfo:function e(t){"use strict";n(this,e),this.size=t.size,this.type=t.type,this.name=t.name}}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(11).Linkable,c=r(9).gl,l=function(e){"use strict";function t(e,r){var i;if(n(this,t),(i=s(this,a(t).call(this,e)))._ctx=r,i._binding=0,i._width=0,i._height=0,i._status=null,i._attachments={},i._attachments[c.COLOR_ATTACHMENT0]=null,i._attachments[c.DEPTH_ATTACHMENT]=null,i._attachments[c.STENCIL_ATTACHMENT]=null,i._attachments[c.DEPTH_STENCIL_ATTACHMENT]=null,i._attachmentLevel={},i._attachmentLevel[c.COLOR_ATTACHMENT0]=0,i._attachmentLevel[c.DEPTH_ATTACHMENT]=0,i._attachmentLevel[c.STENCIL_ATTACHMENT]=0,i._attachmentLevel[c.DEPTH_STENCIL_ATTACHMENT]=0,i._attachmentFace={},i._attachmentFace[c.COLOR_ATTACHMENT0]=0,i._attachmentFace[c.DEPTH_ATTACHMENT]=0,i._attachmentFace[c.STENCIL_ATTACHMENT]=0,i._attachmentFace[c.DEPTH_STENCIL_ATTACHMENT]=0,r._extensions.webgl_draw_buffers){var o=r._extensions.webgl_draw_buffers;i._attachments[o.COLOR_ATTACHMENT1_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT2_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT3_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT4_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT5_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT6_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT7_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT8_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT9_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT10_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT11_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT12_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT13_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT14_WEBGL]=null,i._attachments[o.COLOR_ATTACHMENT15_WEBGL]=null,i._attachments[c.NONE]=null,i._attachments[c.BACK]=null,i._attachmentLevel[o.COLOR_ATTACHMENT1_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT2_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT3_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT4_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT5_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT6_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT7_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT8_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT9_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT10_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT11_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT12_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT13_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT14_WEBGL]=0,i._attachmentLevel[o.COLOR_ATTACHMENT15_WEBGL]=0,i._attachmentLevel[c.NONE]=null,i._attachmentLevel[c.BACK]=null,i._attachmentFace[o.COLOR_ATTACHMENT1_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT2_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT3_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT4_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT5_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT6_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT7_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT8_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT9_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT10_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT11_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT12_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT13_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT14_WEBGL]=0,i._attachmentFace[o.COLOR_ATTACHMENT15_WEBGL]=0,i._attachmentFace[c.NONE]=null,i._attachmentFace[c.BACK]=null}return i}return o(t,e),i(t,[{key:"_clearAttachment",value:function(e){var t=this._attachments[e];t&&(this._attachments[e]=null,this._unlink(t))}},{key:"_setAttachment",value:function(e,t){this._attachments[t]!==e&&(this._clearAttachment(t),e&&(this._attachments[t]=e,this._link(e)))}},{key:"_performDelete",value:function(){var e=this._ctx;delete e._framebuffers[0|this._],c.deleteFramebuffer.call(e,0|this._)}}]),t}(u);e.exports={WebGLFramebuffer:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(11).Linkable,c=r(9).gl,l=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e)))._ctx=r,i._size=0,i._elements=new Uint8Array(0),i}return o(t,e),i(t,[{key:"_performDelete",value:function(){var e=this._ctx;delete e._buffers[0|this._],c.deleteBuffer.call(e,0|this._)}}]),t}(u);e.exports={WebGLBuffer:l}},function(e,t,r){var n=r(0);e.exports={WebGLDrawingBufferWrapper:function e(t,r,i){"use strict";n(this,e),this._framebuffer=t,this._color=r,this._depthStencil=i}}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(11).Linkable,c=r(9).gl,l=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e)))._ctx=r,i._linkCount=0,i._linkStatus=!1,i._linkInfoLog="not linked",i._attributes=[],i._uniforms=[],i}return o(t,e),i(t,[{key:"_performDelete",value:function(){var e=this._ctx;delete e._programs[0|this._],c.deleteProgram.call(e,0|this._)}}]),t}(u);e.exports={WebGLProgram:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(11).Linkable,c=r(9).gl,l=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e)))._ctx=r,i._binding=0,i._width=0,i._height=0,i._format=0,i}return o(t,e),i(t,[{key:"_performDelete",value:function(){var e=this._ctx;delete e._renderbuffers[0|this._],c.deleteRenderbuffer.call(e,0|this._)}}]),t}(u);e.exports={WebGLRenderbuffer:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(9).gl,c=function(e){"use strict";function t(e,r,i){var o;return n(this,t),(o=s(this,a(t).call(this,e)))._type=i,o._ctx=r,o._source="",o._compileStatus=!1,o._compileInfo="",o}return o(t,e),i(t,[{key:"_performDelete",value:function(){var e=this._ctx;delete e._shaders[0|this._],u.deleteShader.call(e,0|this._)}}]),t}(r(11).Linkable);e.exports={WebGLShader:c}},function(e,t,r){var n=r(0);e.exports={WebGLShaderPrecisionFormat:function e(t){"use strict";n(this,e),this.rangeMin=t.rangeMin,this.rangeMax=t.rangeMax,this.precision=t.precision}}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(11).Linkable,c=r(9).gl,l=function(e){"use strict";function t(e,r){var i;return n(this,t),(i=s(this,a(t).call(this,e)))._ctx=r,i._binding=0,i._levelWidth=new Int32Array(32),i._levelHeight=new Int32Array(32),i._format=0,i._type=0,i._complete=!0,i}return o(t,e),i(t,[{key:"_performDelete",value:function(){var e=this._ctx;delete e._textures[0|this._],c.deleteTexture.call(e,0|this._)}}]),t}(u);e.exports={WebGLTexture:l}},function(e,t,r){var n=r(0);e.exports={WebGLTextureUnit:function e(t,r){"use strict";n(this,e),this._ctx=t,this._idx=r,this._mode=0,this._bind2D=null,this._bindCube=null}}},function(e,t,r){var n=r(0),i=r(9).gl;e.exports={WebGLVertexAttribute:function e(t,r){"use strict";n(this,e),this._ctx=t,this._idx=r,this._isPointer=!1,this._pointerBuffer=null,this._pointerOffset=0,this._pointerSize=0,this._pointerStride=0,this._pointerType=i.FLOAT,this._pointerNormal=!1,this._divisor=0,this._inputSize=4,this._inputStride=0,this._data=new Float32Array([0,0,0,1])}}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(2)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erectArray2(this.renderValues(),this.output[0],this.output[1])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureArray2Float:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(2)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erect2DArray2(this.renderValues(),this.output[0],this.output[1])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureArray2Float2D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(2)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erect3DArray2(this.renderValues(),this.output[0],this.output[1],this.output[2])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureArray2Float3D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(3)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erectArray3(this.renderValues(),this.output[0])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureArray3Float:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(3)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erect2DArray3(this.renderValues(),this.output[0],this.output[1])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureArray3Float2D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(3)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erect3DArray3(this.renderValues(),this.output[0],this.output[1],this.output[2])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureArray3Float3D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(4)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erectArray4(this.renderValues(),this.output[0])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureArray4Float:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(4)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erect2DArray4(this.renderValues(),this.output[0],this.output[1])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureArray4Float2D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(4)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erect3DArray4(this.renderValues(),this.output[0],this.output[1],this.output[2])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureArray4Float3D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(1)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erect2DFloat(this.renderValues(),this.output[0],this.output[1])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureFloat2D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(1)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erect3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureFloat3D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="MemoryOptimizedNumberTexture",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erectMemoryOptimizedFloat(this.renderValues(),this.output[0])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureMemoryOptimized:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="MemoryOptimizedNumberTexture",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erectMemoryOptimized2DFloat(this.renderValues(),this.output[0],this.output[1])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureMemoryOptimized2D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="MemoryOptimizedNumberTexture",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erectMemoryOptimized3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}]),t}(r(8).GLTextureFloat);e.exports={GLTextureMemoryOptimized3D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="NumberTexture",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erect2DPackedFloat(this.renderValues(),this.output[0],this.output[1])}}]),t}(r(16).GLTextureUnsigned);e.exports={GLTextureUnsigned2D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="NumberTexture",r}return o(t,e),i(t,[{key:"toArray",value:function(){return u.erect3DPackedFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}]),t}(r(16).GLTextureUnsigned);e.exports={GLTextureUnsigned3D:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=function(e){"use strict";function t(e){var r;return n(this,t),(r=s(this,a(t).call(this,e))).type="ArrayTexture(4)",r}return o(t,e),i(t,[{key:"toArray",value:function(){return this.renderValues()}}]),t}(r(16).GLTextureUnsigned);e.exports={GLTextureGraphical:u}},function(e,t){e.exports={name:"triangle-noise-noise",onBeforeRun:function(e){e.setUniform1f("triangle_noise_seed",Math.random())},functionMatch:"Math.random()",functionReplace:"n4rand(vTexCoord)",functionReturnType:"Number",source:"\n\nuniform highp float triangle_noise_seed;\nhighp float triangle_noise_shift = 0.000001;\n\n//https://www.shadertoy.com/view/4t2SDh\n//note: uniformly distributed, normalized rand, [0;1[\nfloat nrand( vec2 n )\n{\n  return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n//note: remaps v to [0;1] in interval [a;b]\nfloat remap( float a, float b, float v )\n{\n  return clamp( (v-a) / (b-a), 0.0, 1.0 );\n}\n\nfloat n4rand( vec2 n )\n{\n  float t = fract( triangle_noise_seed + triangle_noise_shift );\n  float nrnd0 = nrand( n + 0.07*t );\n  float nrnd1 = nrand( n + 0.11*t );  \n  float nrnd2 = nrand( n + 0.13*t );\n  float nrnd3 = nrand( n + 0.17*t );\n  float result = (nrnd0+nrnd1+nrnd2+nrnd3) / 4.0;\n  triangle_noise_shift = result + 0.000001;\n  return result;\n}"}},function(e,t){e.exports={fragmentShader:"__HEADER__;\n__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n\nconst int LOOP_MAX = __LOOP_MAX__;\n\n__PLUGINS__;\n__CONSTANTS__;\n\nvarying vec2 vTexCoord;\n\nvec4 round(vec4 x) {\n  return floor(x + 0.5);\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\n\nconst int BIT_COUNT = 32;\nint modi(int x, int y) {\n  return x - y * (x / y);\n}\n\nint bitwiseOr(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseXOR(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseAnd(int a, int b) {\n  int result = 0;\n  int n = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 && b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseNot(int a) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (modi(a, 2) == 0) {\n      result += n;    \n    }\n    a = a / 2;\n    n = n * 2;\n  }\n  return result;\n}\nint bitwiseZeroFillLeftShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n *= 2;\n  }\n\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nint bitwiseSignedRightShift(int num, int shifts) {\n  return int(floor(float(num) / pow(2.0, float(shifts))));\n}\n\nint bitwiseZeroFillRightShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n /= 2;\n  }\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x / y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 texel) {\n  __DECODE32_ENDIANNESS__;\n  texel *= 255.0;\n  vec2 gte128;\n  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  texel.b = texel.b - 128.0 * gte128.x;\n  res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nfloat decode16(vec4 texel, int index) {\n  int channel = integerMod(index, 2);\n  if (channel == 0) return texel.r * 255.0 + texel.g * 65280.0;\n  if (channel == 1) return texel.b * 255.0 + texel.a * 65280.0;\n  return 0.0;\n}\n\nfloat decode8(vec4 texel, int index) {\n  int channel = integerMod(index, 4);\n  if (channel == 0) return texel.r * 255.0;\n  if (channel == 1) return texel.g * 255.0;\n  if (channel == 2) return texel.b * 255.0;\n  if (channel == 3) return texel.a * 255.0;\n  return 0.0;\n}\n\nvec4 legacyEncode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  texel.rg = integerMod(texel.rg, 256.0);\n  texel.b = integerMod(texel.b, 128.0);\n  texel.a = exponent*0.5 + 63.5;\n  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  texel = floor(texel);\n  texel *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return texel;\n}\n\n// https://github.com/gpujs/gpu.js/wiki/Encoder-details\nvec4 encode32(float value) {\n  if (value == 0.0) return vec4(0, 0, 0, 0);\n\n  float exponent;\n  float mantissa;\n  vec4  result;\n  float sgn;\n\n  sgn = step(0.0, -value);\n  value = abs(value);\n\n  exponent = floor(log2(value));\n\n  mantissa = value*pow(2.0, -exponent)-1.0;\n  exponent = exponent+127.0;\n  result   = vec4(0,0,0,0);\n\n  result.a = floor(exponent/2.0);\n  exponent = exponent - result.a*2.0;\n  result.a = result.a + 128.0*sgn;\n\n  result.b = floor(mantissa * 128.0);\n  mantissa = mantissa - result.b / 128.0;\n  result.b = result.b + exponent*128.0;\n\n  result.g = floor(mantissa*32768.0);\n  mantissa = mantissa - result.g/32768.0;\n\n  result.r = floor(mantissa*8388608.0);\n  return result/255.0;\n}\n// Dragons end here\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  return decode32(texel);\n}\n\nfloat get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x * 2;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize.x * 2, texSize.y));\n  return decode16(texel, index);\n}\n\nfloat get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x * 4;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize.x * 4, texSize.y));\n  return decode8(texel, index);\n}\n\nfloat getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 4);\n  index = index / 4;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  if (channel == 0) return texel.r;\n  if (channel == 1) return texel.g;\n  if (channel == 2) return texel.b;\n  if (channel == 3) return texel.a;\n  return 0.0;\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  return texture2D(tex, st / vec2(texSize));\n}\n\nfloat getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return result[0];\n}\n\nvec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec2(result[0], result[1]);\n}\n\nvec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int channel = integerMod(index, 2);\n  index = index / 2;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  if (channel == 0) return vec2(texel.r, texel.g);\n  if (channel == 1) return vec2(texel.b, texel.a);\n  return vec2(0.0, 0.0);\n}\n\nvec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec3(result[0], result[1], result[2]);\n}\n\nvec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\n  int vectorIndex = fieldIndex / 4;\n  int vectorOffset = fieldIndex - vectorIndex * 4;\n  int readY = vectorIndex / texSize.x;\n  int readX = vectorIndex - readY * texSize.x;\n  vec4 tex1 = texture2D(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\n  \n  if (vectorOffset == 0) {\n    return tex1.xyz;\n  } else if (vectorOffset == 1) {\n    return tex1.yzw;\n  } else {\n    readX++;\n    if (readX >= texSize.x) {\n      readX = 0;\n      readY++;\n    }\n    vec4 tex2 = texture2D(tex, vec2(readX, readY) / vec2(texSize));\n    if (vectorOffset == 2) {\n      return vec3(tex1.z, tex1.w, tex2.x);\n    } else {\n      return vec3(tex1.w, tex2.x, tex2.y);\n    }\n  }\n}\n\nvec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  return getImage2D(tex, texSize, texDim, z, y, x);\n}\n\nvec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 2);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  return vec4(texel.r, texel.g, texel.b, texel.a);\n}\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\nvoid color(sampler2D image) {\n  actualColor = texture2D(image, vTexCoord);\n}\n\n__MAIN_CONSTANTS__;\n__MAIN_ARGUMENTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}"}},function(e,t){e.exports={vertexShader:"__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n\nattribute vec2 aPos;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"}},function(e,t,r){function n(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.contextName,o=void 0===n?"gl":n,u=r.throwGetError,c=r.useTrackablePrimitives,l=r.readPixelsFile,h=r.recording,p=void 0===h?[]:h,f=r.variables,d=void 0===f?{}:f,m=r.onReadPixels,g=r.onUnrecognizedArgumentLookup,y=new Proxy(e,{get:function(r,n){switch(n){case"addComment":return L;case"checkThrowError":return w;case"getReadPixelsVariableName":return t;case"insertVariable":return b;case"reset":return A;case"setIndent":return I;case"toString":return E;case"getContextVariableName":return C}if("function"===typeof e[n])return function(){switch(n){case"getError":return u?p.push("".concat(T,"if (").concat(o,".getError() !== ").concat(o,".NONE) throw new Error('error');")):p.push("".concat(T).concat(o,".getError();")),e.getError();case"getExtension":var r="".concat(o,"Variables").concat(_.length);p.push("".concat(T,"const ").concat(r," = ").concat(o,".getExtension('").concat(arguments[0],"');"));var h=e.getExtension(arguments[0]);if(h&&"object"===typeof h){var f=i(h,{getEntity:S,useTrackablePrimitives:c,recording:p,contextName:r,contextVariables:_,variables:d,indent:T,onUnrecognizedArgumentLookup:g});return _.push(f),f}return _.push(null),h;case"readPixels":var y,x=_.indexOf(arguments[6]);if(-1===x){var v=N(arguments[6]);v?(y=v,p.push("".concat(T).concat(v))):(y="".concat(o,"Variable").concat(_.length),_.push(arguments[6]),p.push("".concat(T,"const ").concat(y," = new ").concat(arguments[6].constructor.name,"(").concat(arguments[6].length,");")))}else y="".concat(o,"Variable").concat(x);t=y;var E=[arguments[0],arguments[1],arguments[2],arguments[3],S(arguments[4]),S(arguments[5]),y];return p.push("".concat(T).concat(o,".readPixels(").concat(E.join(", "),");")),l&&R(arguments[2],arguments[3]),m&&m(y,E),e.readPixels.apply(e,arguments);case"drawBuffers":return p.push("".concat(T).concat(o,".drawBuffers([").concat(s(arguments[0],{contextName:o,contextVariables:_,getEntity:S,addVariable:k,variables:d,onUnrecognizedArgumentLookup:g}),"]);")),e.drawBuffers(arguments[0])}var A=e[n].apply(e,arguments);switch(typeof A){case"undefined":return void p.push("".concat(T).concat(D(n,arguments),";"));case"number":case"boolean":if(c&&-1===_.indexOf(a(A))){p.push("".concat(T,"const ").concat(o,"Variable").concat(_.length," = ").concat(D(n,arguments),";")),_.push(A=a(A));break}default:null===A?p.push("".concat(D(n,arguments),";")):p.push("".concat(T,"const ").concat(o,"Variable").concat(_.length," = ").concat(D(n,arguments),";")),_.push(A)}return A};return x[e[n]]=n,e[n]}}),_=[],x={},v=0,T="";return y;function E(){return p.join("\n")}function A(){for(;p.length>0;)p.pop()}function b(e,t){d[e]=t}function S(e){var t=x[e];return t?o+"."+t:e}function I(e){T=" ".repeat(e)}function k(e,t){var r="".concat(o,"Variable").concat(_.length);return p.push("".concat(T,"const ").concat(r," = ").concat(t,";")),_.push(e),r}function R(e,t){var r="".concat(o,"Variable").concat(_.length),n="imageDatum".concat(v);p.push("".concat(T,"let ").concat(n,' = ["P3\\n# ').concat(l,'.ppm\\n", ').concat(e,", ' ', ").concat(t,', "\\n255\\n"].join("");')),p.push("".concat(T,"for (let i = 0; i < ").concat(n,".length; i += 4) {")),p.push("".concat(T,"  ").concat(n," += ").concat(r,"[i] + ' ' + ").concat(r,"[i + 1] + ' ' + ").concat(r,"[i + 2] + ' ';")),p.push("".concat(T,"}")),p.push("".concat(T,'if (typeof require !== "undefined") {')),p.push("".concat(T,"  require('fs').writeFileSync('./").concat(l,".ppm', ").concat(n,");")),p.push("".concat(T,"}")),v++}function L(e){p.push("".concat(T,"// ").concat(e))}function w(){p.push("".concat(T,"(() => {\n").concat(T,"const error = ").concat(o,".getError();\n").concat(T,"if (error !== ").concat(o,".NONE) {\n").concat(T,"  const names = Object.getOwnPropertyNames(gl);\n").concat(T,"  for (let i = 0; i < names.length; i++) {\n").concat(T,"    const name = names[i];\n").concat(T,"    if (").concat(o,"[name] === error) {\n").concat(T,"      throw new Error('").concat(o," threw ' + name);\n").concat(T,"    }\n").concat(T,"  }\n").concat(T,"}\n").concat(T,"})();"))}function D(e,t){return"".concat(o,".").concat(e,"(").concat(s(t,{contextName:o,contextVariables:_,getEntity:S,addVariable:k,variables:d,onUnrecognizedArgumentLookup:g}),")")}function N(e){if(d)for(var t in d)if(d[t]===e)return t;return null}function C(e){var t=_.indexOf(e);return-1!==t?"".concat(o,"Variable").concat(t):null}}function i(e,t){var r=new Proxy(e,{get:function(t,r){if("function"===typeof t[r])return function(){switch(r){case"drawBuffersWEBGL":return l.push("".concat(p).concat(i,".drawBuffersWEBGL([").concat(s(arguments[0],{contextName:i,contextVariables:o,getEntity:d,addVariable:g,variables:h,onUnrecognizedArgumentLookup:f}),"]);")),e.drawBuffersWEBGL(arguments[0])}var t=e[r].apply(e,arguments);switch(typeof t){case"undefined":return void l.push("".concat(p).concat(m(r,arguments),";"));case"number":case"boolean":c&&-1===o.indexOf(a(t))?(l.push("".concat(p,"const ").concat(i,"Variable").concat(o.length," = ").concat(m(r,arguments),";")),o.push(t=a(t))):(l.push("".concat(p,"const ").concat(i,"Variable").concat(o.length," = ").concat(m(r,arguments),";")),o.push(t));break;default:null===t?l.push("".concat(m(r,arguments),";")):l.push("".concat(p,"const ").concat(i,"Variable").concat(o.length," = ").concat(m(r,arguments),";")),o.push(t)}return t};return n[e[r]]=r,e[r]}}),n={},i=t.contextName,o=t.contextVariables,u=t.getEntity,c=t.useTrackablePrimitives,l=t.recording,h=t.variables,p=t.indent,f=t.onUnrecognizedArgumentLookup;return r;function d(e){return n.hasOwnProperty(e)?"".concat(i,".").concat(n[e]):u(e)}function m(e,t){return"".concat(i,".").concat(e,"(").concat(s(t,{contextName:i,contextVariables:o,getEntity:d,addVariable:g,variables:h,onUnrecognizedArgumentLookup:f}),")")}function g(e,t){var r="".concat(i,"Variable").concat(o.length);return o.push(e),l.push("".concat(p,"const ").concat(r," = ").concat(t,";")),r}}function s(e,t){var r=t.variables;return Array.from(e).map((function(e){var n=function(e){if(r)for(var t in r)if(r[t]===e)return t;return null}(e);return n||function(e,t){var r=t.contextName,n=t.contextVariables,i=t.getEntity,s=t.addVariable,a=t.onUnrecognizedArgumentLookup;if("undefined"===typeof e)return"undefined";if(null===e)return"null";var o=n.indexOf(e);if(o>-1)return"".concat(r,"Variable").concat(o);switch(e.constructor.name){case"String":var u=/\n/.test(e),c=/'/.test(e),l=/"/.test(e);return u?"`"+e+"`":c&&!l?'"'+e+'"':"'"+e+"'";case"Number":case"Boolean":return i(e);case"Array":return s(e,"new ".concat(e.constructor.name,"(").concat(Array.from(e).join(","),")"));case"Float32Array":case"Uint8Array":case"Uint16Array":case"Int32Array":return s(e,"new ".concat(e.constructor.name,"(").concat(JSON.stringify(Array.from(e)),")"));default:if(a){var h=a(e);if(h)return h}throw new Error("unrecognized argument type ".concat(e.constructor.name))}}(e,t)})).join(", ")}function a(e){return new e.constructor(e)}e.exports={glWiretap:n,glExtensionWiretap:i},"undefined"!==typeof window&&(n.glExtensionWiretap=i,window.glWiretap=n)},function(e,t,r){var n,i=r(34),s=r(45).WebGLKernelValueBoolean,a=r(46).WebGLKernelValueFloat,o=r(47).WebGLKernelValueInteger,u=r(21).WebGLKernelValueHTMLImage,c=r(48).WebGLKernelValueDynamicHTMLImage,l=r(22).WebGLKernelValueSingleInput,h=r(134).WebGLKernelValueDynamicSingleInput,p=r(23).WebGLKernelValueUnsignedInput,f=r(49).WebGLKernelValueDynamicUnsignedInput,d=r(24).WebGLKernelValueMemoryOptimizedNumberTexture,m=r(50).WebGLKernelValueDynamicMemoryOptimizedNumberTexture,g=r(25).WebGLKernelValueNumberTexture,y=r(51).WebGLKernelValueDynamicNumberTexture,_=r(26).WebGLKernelValueSingleArray,x=r(135).WebGLKernelValueDynamicSingleArray,v=r(27).WebGLKernelValueSingleArray1DI,T=r(136).WebGLKernelValueDynamicSingleArray1DI,E=r(28).WebGLKernelValueSingleArray2DI,A=r(137).WebGLKernelValueDynamicSingleArray2DI,b=r(29).WebGLKernelValueSingleArray3DI,S=r(138).WebGLKernelValueDynamicSingleArray3DI,I=r(52).WebGLKernelValueSingleArray2,k=r(53).WebGLKernelValueSingleArray3,R=r(54).WebGLKernelValueSingleArray4,L=r(30).WebGLKernelValueUnsignedArray,w={unsigned:{dynamic:{Boolean:s,Integer:o,Float:a,Array:r(55).WebGLKernelValueDynamicUnsignedArray,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:f,NumberTexture:y,"ArrayTexture(1)":y,"ArrayTexture(2)":y,"ArrayTexture(3)":y,"ArrayTexture(4)":y,MemoryOptimizedNumberTexture:m,HTMLImage:c,HTMLImageArray:!1},static:{Boolean:s,Float:a,Integer:o,Array:L,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:p,NumberTexture:g,"ArrayTexture(1)":g,"ArrayTexture(2)":g,"ArrayTexture(3)":g,"ArrayTexture(4)":g,MemoryOptimizedNumberTexture:m,HTMLImage:u,HTMLImageArray:!1}},single:{dynamic:(n={Boolean:s,Integer:o,Float:a,Array:x,"Array(2)":I,"Array(3)":k,"Array(4)":R,"Array1D(2)":T,"Array1D(3)":T,"Array1D(4)":T,"Array2D(2)":A,"Array2D(3)":A,"Array2D(4)":A,"Array3D(2)":S,"Array3D(3)":S,"Array3D(4)":S},i(n,"Array",x),i(n,"Input",h),i(n,"NumberTexture",y),i(n,"ArrayTexture(1)",y),i(n,"ArrayTexture(2)",y),i(n,"ArrayTexture(3)",y),i(n,"ArrayTexture(4)",y),i(n,"MemoryOptimizedNumberTexture",m),i(n,"HTMLImage",c),i(n,"HTMLImageArray",!1),n),static:{Boolean:s,Float:a,Integer:o,Array:_,"Array(2)":I,"Array(3)":k,"Array(4)":R,"Array1D(2)":v,"Array1D(3)":v,"Array1D(4)":v,"Array2D(2)":E,"Array2D(3)":E,"Array2D(4)":E,"Array3D(2)":b,"Array3D(3)":b,"Array3D(4)":b,Input:l,NumberTexture:g,"ArrayTexture(1)":g,"ArrayTexture(2)":g,"ArrayTexture(3)":g,"ArrayTexture(4)":g,MemoryOptimizedNumberTexture:d,HTMLImage:u,HTMLImageArray:!1}}};e.exports={lookupKernelValueType:function(e,t,r,n){if(!e)throw new Error("type missing");if(!t)throw new Error("dynamic missing");if(!r)throw new Error("precision missing");n.type&&(e=n.type);var i=w[r][t];if(!1===i[e])return null;if(void 0===i[e])throw new Error("Could not find a KernelValue for ".concat(e));return i[e]}}},function(e,t,r){var n=r(0),i=r(1),s=function(){"use strict";function e(t,r){n(this,e);var i=r.name,s=r.kernel,a=r.context,o=r.checkContext,u=r.onRequestContextHandle,c=r.onUpdateValueMismatch,l=r.origin,h=r.strictIntegers,p=r.type,f=r.tactic;if(!i)throw new Error("name not set");if(!p)throw new Error("type not set");if(!l)throw new Error("origin not set");if(!f)throw new Error("tactic not set");if("user"!==l&&"constants"!==l)throw new Error('origin must be "user" or "constants" value is "'.concat(l,'"'));if(!u)throw new Error("onRequestContextHandle is not set");this.name=i,this.origin=l,this.tactic=f,this.id="".concat(this.origin,"_").concat(i),this.varName="constants"===l?"constants.".concat(i):i,this.kernel=s,this.strictIntegers=h,this.type=t.type||p,this.size=t.size||null,this.index=null,this.context=a,this.checkContext=null===o||void 0===o||o,this.contextHandle=null,this.onRequestContextHandle=u,this.onUpdateValueMismatch=c}return i(e,[{key:"getSource",value:function(){throw new Error('"getSource" not defined on '.concat(this.constructor.name))}},{key:"updateValue",value:function(e){throw new Error('"updateValue" not defined on '.concat(this.constructor.name))}},{key:"getFocusString",value:function(){throw new Error('"getFocusString" not defined on '.concat(this.constructor.name))}}]),e}();e.exports={KernelValue:s}},function(e,t,r){var n=r(10),i=r(0),s=r(1),a=r(3),o=r(2),u=r(6),c=r(4),l=r(5).utils,h=function(e){"use strict";function t(){return i(this,t),a(this,o(t).apply(this,arguments))}return c(t,e),s(t,[{key:"getSource",value:function(){return l.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){var r=n(e.size,3),i=r[0],s=r[1],a=r[2];this.dimensions=new Int32Array([i||1,s||1,a||1]),this.textureSize=l.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),u(o(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(22).WebGLKernelValueSingleInput);e.exports={WebGLKernelValueDynamicSingleInput:h}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){return c.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.dimensions=c.getDimensions(e,!0),this.textureSize=c.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(26).WebGLKernelValueSingleArray);e.exports={WebGLKernelValueDynamicSingleArray:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){return c.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(27).WebGLKernelValueSingleArray1DI);e.exports={WebGLKernelValueDynamicSingleArray1DI:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){return c.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(28).WebGLKernelValueSingleArray2DI);e.exports={WebGLKernelValueDynamicSingleArray2DI:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){return c.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(29).WebGLKernelValueSingleArray3DI);e.exports={WebGLKernelValueDynamicSingleArray3DI:l}},function(e,t){e.exports={fragmentShader:"#version 300 es\n__HEADER__;\n__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n__SAMPLER_2D_ARRAY_TACTIC_DECLARATION__;\n\nconst int LOOP_MAX = __LOOP_MAX__;\n\n__PLUGINS__;\n__CONSTANTS__;\n\nin vec2 vTexCoord;\n\nconst int BIT_COUNT = 32;\nint modi(int x, int y) {\n  return x - y * (x / y);\n}\n\nint bitwiseOr(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseXOR(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseAnd(int a, int b) {\n  int result = 0;\n  int n = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 && b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseNot(int a) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (modi(a, 2) == 0) {\n      result += n;    \n    }\n    a = a / 2;\n    n = n * 2;\n  }\n  return result;\n}\nint bitwiseZeroFillLeftShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n *= 2;\n  }\n\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nint bitwiseSignedRightShift(int num, int shifts) {\n  return int(floor(float(num) / pow(2.0, float(shifts))));\n}\n\nint bitwiseZeroFillRightShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n /= 2;\n  }\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x/y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 texel) {\n  __DECODE32_ENDIANNESS__;\n  texel *= 255.0;\n  vec2 gte128;\n  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  texel.b = texel.b - 128.0 * gte128.x;\n  res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nfloat decode16(vec4 texel, int index) {\n  int channel = integerMod(index, 2);\n  return texel[channel*2] * 255.0 + texel[channel*2 + 1] * 65280.0;\n}\n\nfloat decode8(vec4 texel, int index) {\n  int channel = integerMod(index, 4);\n  return texel[channel] * 255.0;\n}\n\nvec4 legacyEncode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  texel.rg = integerMod(texel.rg, 256.0);\n  texel.b = integerMod(texel.b, 128.0);\n  texel.a = exponent*0.5 + 63.5;\n  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  texel = floor(texel);\n  texel *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return texel;\n}\n\n// https://github.com/gpujs/gpu.js/wiki/Encoder-details\nvec4 encode32(float value) {\n  if (value == 0.0) return vec4(0, 0, 0, 0);\n\n  float exponent;\n  float mantissa;\n  vec4  result;\n  float sgn;\n\n  sgn = step(0.0, -value);\n  value = abs(value);\n\n  exponent = floor(log2(value));\n\n  mantissa = value*pow(2.0, -exponent)-1.0;\n  exponent = exponent+127.0;\n  result   = vec4(0,0,0,0);\n\n  result.a = floor(exponent/2.0);\n  exponent = exponent - result.a*2.0;\n  result.a = result.a + 128.0*sgn;\n\n  result.b = floor(mantissa * 128.0);\n  mantissa = mantissa - result.b / 128.0;\n  result.b = result.b + exponent*128.0;\n\n  result.g = floor(mantissa*32768.0);\n  mantissa = mantissa - result.g/32768.0;\n\n  result.r = floor(mantissa*8388608.0);\n  return result/255.0;\n}\n// Dragons end here\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  return decode32(texel);\n}\n\nfloat get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int w = texSize.x * 2;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize.x * 2, texSize.y));\n  return decode16(texel, index);\n}\n\nfloat get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int w = texSize.x * 4;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize.x * 4, texSize.y));\n  return decode8(texel, index);\n}\n\nfloat getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int channel = integerMod(index, 4);\n  index = index / 4;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  index = index / 4;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  return texel[channel];\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  return texture(tex, st / vec2(texSize));\n}\n\nvec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  return texture(tex, vec3(st / vec2(texSize), z));\n}\n\nfloat getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return result[0];\n}\n\nvec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec2(result[0], result[1]);\n}\n\nvec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 2);\n  index = index / 2;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  if (channel == 0) return vec2(texel.r, texel.g);\n  if (channel == 1) return vec2(texel.b, texel.a);\n  return vec2(0.0, 0.0);\n}\n\nvec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec3(result[0], result[1], result[2]);\n}\n\nvec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\n  int vectorIndex = fieldIndex / 4;\n  int vectorOffset = fieldIndex - vectorIndex * 4;\n  int readY = vectorIndex / texSize.x;\n  int readX = vectorIndex - readY * texSize.x;\n  vec4 tex1 = texture(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\n\n  if (vectorOffset == 0) {\n    return tex1.xyz;\n  } else if (vectorOffset == 1) {\n    return tex1.yzw;\n  } else {\n    readX++;\n    if (readX >= texSize.x) {\n      readX = 0;\n      readY++;\n    }\n    vec4 tex2 = texture(tex, vec2(readX, readY) / vec2(texSize));\n    if (vectorOffset == 2) {\n      return vec3(tex1.z, tex1.w, tex2.x);\n    } else {\n      return vec3(tex1.w, tex2.x, tex2.y);\n    }\n  }\n}\n\nvec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  return getImage2D(tex, texSize, texDim, z, y, x);\n}\n\nvec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 2);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  return vec4(texel.r, texel.g, texel.b, texel.a);\n}\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\n__MAIN_CONSTANTS__;\n__MAIN_ARGUMENTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}"}},function(e,t){e.exports={vertexShader:"#version 300 es\n__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n\nin vec2 aPos;\nin vec2 aTexCoord;\n\nout vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"}},function(e,t,r){var n=r(142).WebGL2KernelValueBoolean,i=r(143).WebGL2KernelValueFloat,s=r(144).WebGL2KernelValueInteger,a=r(145).WebGL2KernelValueHTMLImage,o=r(146).WebGL2KernelValueDynamicHTMLImage,u=r(58).WebGL2KernelValueHtmlImageArray,c=r(147).WebGL2KernelValueDynamicHtmlImageArray,l=r(59).WebGL2KernelValueSingleInput,h=r(148).WebGL2KernelValueDynamicSingleInput,p=r(149).WebGL2KernelValueUnsignedInput,f=r(150).WebGL2KernelValueDynamicUnsignedInput,d=r(151).WebGL2KernelValueMemoryOptimizedNumberTexture,m=r(152).WebGL2KernelValueDynamicMemoryOptimizedNumberTexture,g=r(153).WebGL2KernelValueNumberTexture,y=r(154).WebGL2KernelValueDynamicNumberTexture,_=r(60).WebGL2KernelValueSingleArray,x=r(155).WebGL2KernelValueDynamicSingleArray,v=r(61).WebGL2KernelValueSingleArray1DI,T=r(156).WebGL2KernelValueDynamicSingleArray1DI,E=r(62).WebGL2KernelValueSingleArray2DI,A=r(157).WebGL2KernelValueDynamicSingleArray2DI,b=r(63).WebGL2KernelValueSingleArray3DI,S=r(158).WebGL2KernelValueDynamicSingleArray3DI,I=r(159).WebGL2KernelValueSingleArray2,k=r(160).WebGL2KernelValueSingleArray3,R=r(161).WebGL2KernelValueSingleArray4,L=r(162).WebGL2KernelValueUnsignedArray,w={unsigned:{dynamic:{Boolean:n,Integer:s,Float:i,Array:r(163).WebGL2KernelValueDynamicUnsignedArray,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:f,NumberTexture:y,"ArrayTexture(1)":y,"ArrayTexture(2)":y,"ArrayTexture(3)":y,"ArrayTexture(4)":y,MemoryOptimizedNumberTexture:m,HTMLImage:o,HTMLImageArray:c},static:{Boolean:n,Float:i,Integer:s,Array:L,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:p,NumberTexture:g,"ArrayTexture(1)":g,"ArrayTexture(2)":g,"ArrayTexture(3)":g,"ArrayTexture(4)":g,MemoryOptimizedNumberTexture:m,HTMLImage:a,HTMLImageArray:u}},single:{dynamic:{Boolean:n,Integer:s,Float:i,Array:x,"Array(2)":I,"Array(3)":k,"Array(4)":R,"Array1D(2)":T,"Array1D(3)":T,"Array1D(4)":T,"Array2D(2)":A,"Array2D(3)":A,"Array2D(4)":A,"Array3D(2)":S,"Array3D(3)":S,"Array3D(4)":S,Input:h,NumberTexture:y,"ArrayTexture(1)":y,"ArrayTexture(2)":y,"ArrayTexture(3)":y,"ArrayTexture(4)":y,MemoryOptimizedNumberTexture:m,HTMLImage:o,HTMLImageArray:c},static:{Boolean:n,Float:i,Integer:s,Array:_,"Array(2)":I,"Array(3)":k,"Array(4)":R,"Array1D(2)":v,"Array1D(3)":v,"Array1D(4)":v,"Array2D(2)":E,"Array2D(3)":E,"Array2D(4)":E,"Array3D(2)":b,"Array3D(3)":b,"Array3D(4)":b,Input:l,NumberTexture:g,"ArrayTexture(1)":g,"ArrayTexture(2)":g,"ArrayTexture(3)":g,"ArrayTexture(4)":g,MemoryOptimizedNumberTexture:d,HTMLImage:a,HTMLImageArray:u}}};e.exports={lookupKernelValueType:function(e,t,r,n){if(!e)throw new Error("type missing");if(!t)throw new Error("dynamic missing");if(!r)throw new Error("precision missing");n.type&&(e=n.type);var i=w[r][t];if(!1===i[e])return null;if(void 0===i[e])throw new Error("Could not find a KernelValue for ".concat(e));return i[e]}}},function(e,t,r){var n=r(0),i=r(3),s=r(2),a=r(4),o=function(e){"use strict";function t(){return n(this,t),i(this,s(t).apply(this,arguments))}return a(t,e),t}(r(45).WebGLKernelValueBoolean);e.exports={WebGL2KernelValueBoolean:o}},function(e,t,r){var n=r(0),i=r(3),s=r(2),a=r(4),o=(r(5).utils,function(e){"use strict";function t(){return n(this,t),i(this,s(t).apply(this,arguments))}return a(t,e),t}(r(46).WebGLKernelValueFloat));e.exports={WebGL2KernelValueFloat:o}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=(r(5).utils,function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(e){var t=this.getVariablePrecisionString();return"constants"===this.origin?"const ".concat(t," int ").concat(this.id," = ").concat(parseInt(e),";\n"):"uniform ".concat(t," int ").concat(this.id,";\n")}},{key:"updateValue",value:function(e){"constants"!==this.origin&&this.kernel.setUniform1i(this.id,this.uploadValue=e)}}]),t}(r(47).WebGLKernelValueInteger));e.exports={WebGL2KernelValueInteger:u}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"".concat(e," ivec2 ").concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"".concat(e," ivec3 ").concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}}]),t}(r(21).WebGLKernelValueHTMLImage);e.exports={WebGL2KernelValueHTMLImage:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"uniform ".concat(e," ivec2 ").concat(this.sizeId),"uniform ".concat(e," ivec3 ").concat(this.dimensionsId)])}}]),t}(r(48).WebGLKernelValueDynamicHTMLImage);e.exports={WebGL2KernelValueDynamicHTMLImage:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return utils.linesToString(["uniform ".concat(e," sampler2DArray ").concat(this.id),"uniform ".concat(e," ivec2 ").concat(this.sizeId),"uniform ".concat(e," ivec3 ").concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.dimensions=[e[0].width,e[0].height,e.length],this.textureSize=[e[0].width,e[0].height],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(58).WebGL2KernelValueHtmlImageArray);e.exports={WebGL2KernelValueDynamicHtmlImageArray:c}},function(e,t,r){var n=r(10),i=r(0),s=r(1),a=r(3),o=r(2),u=r(6),c=r(4),l=r(5).utils,h=function(e){"use strict";function t(){return i(this,t),a(this,o(t).apply(this,arguments))}return c(t,e),s(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return l.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"uniform ".concat(e," ivec2 ").concat(this.sizeId),"uniform ".concat(e," ivec3 ").concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){var r=n(e.size,3),i=r[0],s=r[1],a=r[2];this.dimensions=new Int32Array([i||1,s||1,a||1]),this.textureSize=l.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),u(o(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(59).WebGL2KernelValueSingleInput);e.exports={WebGL2KernelValueDynamicSingleInput:h}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"".concat(e," ivec2 ").concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"".concat(e," ivec3 ").concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}}]),t}(r(23).WebGLKernelValueUnsignedInput);e.exports={WebGL2KernelValueUnsignedInput:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"uniform ".concat(e," ivec2 ").concat(this.sizeId),"uniform ".concat(e," ivec3 ").concat(this.dimensionsId)])}}]),t}(r(49).WebGLKernelValueDynamicUnsignedInput);e.exports={WebGL2KernelValueDynamicUnsignedInput:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform sampler2D ".concat(this.id),"".concat(e," ivec2 ").concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"".concat(e," ivec3 ").concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}}]),t}(r(24).WebGLKernelValueMemoryOptimizedNumberTexture);e.exports={WebGL2KernelValueMemoryOptimizedNumberTexture:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){return u.linesToString(["uniform sampler2D ".concat(this.id),"uniform ivec2 ".concat(this.sizeId),"uniform ivec3 ".concat(this.dimensionsId)])}}]),t}(r(50).WebGLKernelValueDynamicMemoryOptimizedNumberTexture);e.exports={WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"".concat(e," ivec2 ").concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"".concat(e," ivec3 ").concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}}]),t}(r(25).WebGLKernelValueNumberTexture);e.exports={WebGL2KernelValueNumberTexture:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"uniform ".concat(e," ivec2 ").concat(this.sizeId),"uniform ".concat(e," ivec3 ").concat(this.dimensionsId)])}}]),t}(r(51).WebGLKernelValueDynamicNumberTexture);e.exports={WebGL2KernelValueDynamicNumberTexture:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return c.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"uniform ".concat(e," ivec2 ").concat(this.sizeId),"uniform ".concat(e," ivec3 ").concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.dimensions=c.getDimensions(e,!0),this.textureSize=c.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(60).WebGL2KernelValueSingleArray);e.exports={WebGL2KernelValueDynamicSingleArray:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return c.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"uniform ".concat(e," ivec2 ").concat(this.sizeId),"uniform ".concat(e," ivec3 ").concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(61).WebGL2KernelValueSingleArray1DI);e.exports={WebGL2KernelValueDynamicSingleArray1DI:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return c.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"uniform ".concat(e," ivec2 ").concat(this.sizeId),"uniform ".concat(e," ivec3 ").concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(62).WebGL2KernelValueSingleArray2DI);e.exports={WebGL2KernelValueDynamicSingleArray2DI:l}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(6),u=r(4),c=r(5).utils,l=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return u(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return c.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"uniform ".concat(e," ivec2 ").concat(this.sizeId),"uniform ".concat(e," ivec3 ").concat(this.dimensionsId)])}},{key:"updateValue",value:function(e){this.setShape(e),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),o(a(t.prototype),"updateValue",this).call(this,e)}}]),t}(r(63).WebGL2KernelValueSingleArray3DI);e.exports={WebGL2KernelValueDynamicSingleArray3DI:l}},function(e,t,r){var n=r(0),i=r(3),s=r(2),a=r(4),o=function(e){"use strict";function t(){return n(this,t),i(this,s(t).apply(this,arguments))}return a(t,e),t}(r(52).WebGLKernelValueSingleArray2);e.exports={WebGL2KernelValueSingleArray2:o}},function(e,t,r){var n=r(0),i=r(3),s=r(2),a=r(4),o=function(e){"use strict";function t(){return n(this,t),i(this,s(t).apply(this,arguments))}return a(t,e),t}(r(53).WebGLKernelValueSingleArray3);e.exports={WebGL2KernelValueSingleArray3:o}},function(e,t,r){var n=r(0),i=r(3),s=r(2),a=r(4),o=function(e){"use strict";function t(){return n(this,t),i(this,s(t).apply(this,arguments))}return a(t,e),t}(r(54).WebGLKernelValueSingleArray4);e.exports={WebGL2KernelValueSingleArray4:o}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"".concat(e," ivec2 ").concat(this.sizeId," = ivec2(").concat(this.textureSize[0],", ").concat(this.textureSize[1],")"),"".concat(e," ivec3 ").concat(this.dimensionsId," = ivec3(").concat(this.dimensions[0],", ").concat(this.dimensions[1],", ").concat(this.dimensions[2],")")])}}]),t}(r(30).WebGLKernelValueUnsignedArray);e.exports={WebGL2KernelValueUnsignedArray:c}},function(e,t,r){var n=r(0),i=r(1),s=r(3),a=r(2),o=r(4),u=r(5).utils,c=function(e){"use strict";function t(){return n(this,t),s(this,a(t).apply(this,arguments))}return o(t,e),i(t,[{key:"getSource",value:function(){var e=this.getVariablePrecisionString();return u.linesToString(["uniform ".concat(e," sampler2D ").concat(this.id),"uniform ".concat(e," ivec2 ").concat(this.sizeId),"uniform ".concat(e," ivec3 ").concat(this.dimensionsId)])}}]),t}(r(55).WebGLKernelValueDynamicUnsignedArray);e.exports={WebGL2KernelValueDynamicUnsignedArray:c}},function(e,t,r){var n=r(5).utils;function i(e,t){for(var r=n.allPropertiesOf(e),i=function(n){var i=r[n];if("_"===i[0]&&"_"===i[1])return"continue";"function"===typeof e[i]?"add"===i.substring(0,3)||"set"===i.substring(0,3)?t[i]=function(){return e[i].apply(e,arguments),t}:"toString"===i?t.toString=function(){return e.toString.apply(e,arguments)}:t[i]=e[i].bind(e):(t.__defineGetter__(i,(function(){return e[i]})),t.__defineSetter__(i,(function(t){e[i]=t})))},s=0;s<r.length;s++)i(s)}e.exports={kernelRunShortcut:function(e){var t=function(){return e.build.apply(e,arguments),(t=e.renderKernels?function(){return e.run.apply(e,arguments),e.switchingKernels?(e.switchingKernels=!1,e.onRequestSwitchKernel(arguments,e)):e.renderKernels()}:e.renderOutput?function(){return e.run.apply(e,arguments),e.switchingKernels?(e.switchingKernels=!1,e.onRequestSwitchKernel(arguments,e)):e.renderOutput()}:function(){return e.run.apply(e,arguments)}).apply(e,arguments)},r=function(){return t.apply(e,arguments)};return r.exec=function(){var e=this,r=arguments;return new Promise((function(n,i){try{n(t.apply(e,r))}catch(s){i(s)}}))},r.replaceKernel=function(t){i(e=t,r),r.kernel=e},i(e,r),r.kernel=e,r}}},function(e,t,r){var n=r(5).utils;e.exports={alias:function(e,t){var r=t.toString();return new Function("return function ".concat(e," (").concat(n.getArgumentNamesFromString(r).join(", "),") {\n  ").concat(n.getFunctionBodyFromString(r),"\n}"))()}}},function(e,t,r){"use strict";r.r(t);var n=r(64);var i=self,s=5e3,a=(new n.GPU).createKernel((function(e){return 10*e[this.thread.x]})).setPipeline(!0).setImmutable(!0).setOutput([s,s]),o=new Array(25e6).fill(1);i.addEventListener("message",(function(e){Array(100).fill(0).forEach((function(e,t){a(o),i.postMessage("message")}))}));t.default=i}]);
//# sourceMappingURL=6eca8aa194c4d0b07208.worker.js.map